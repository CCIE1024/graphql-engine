<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Arrows #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Top-level functions concerned specifically with operations on the schema cache, such as</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- rebuilding it from the catalog and incorporating schema changes. See the module documentation for</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- &quot;Hasura.RQL.DDL.Schema&quot; for more details.</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- __Note__: this module is __mutually recursive__ with other @Hasura.RQL.DDL.Schema.*@ modules, which</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- both define pieces of the implementation of building the schema cache and define handlers that</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- trigger schema cache rebuilds.</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier">lastBuiltSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCache"><span class="hs-identifier">buildRebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCacheWithReason"><span class="hs-identifier">buildRebuildableSchemaCacheWithReason</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier">CacheRWT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#runCacheRWT"><span class="hs-identifier">runCacheRWT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#mkBooleanPermissionMap"><span class="hs-identifier">mkBooleanPermissionMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow.Extended</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow.Interpret</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBaseControl</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Retry</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Retry</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">isLeft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Environment.html"><span class="hs-identifier">Data.Environment</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.HashMap.Strict.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.HashMap.Strict.InsOrd.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.InsOrd.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OMap</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HS</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Sequence</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.html"><span class="hs-identifier">Hasura.GraphQL.Schema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Schema.html#buildGQLContext"><span class="hs-identifier">buildGQLContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.NamingCase.html"><span class="hs-identifier">Hasura.GraphQL.Schema.NamingCase</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hasura.Incremental</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Inc</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Action.html"><span class="hs-identifier">Hasura.RQL.DDL.Action</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.CustomTypes.html"><span class="hs-identifier">Hasura.RQL.DDL.CustomTypes</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#buildEventTriggerInfo"><span class="hs-identifier">buildEventTriggerInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.InheritedRoles.html"><span class="hs-identifier">Hasura.RQL.DDL.InheritedRoles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.InheritedRoles.html#resolveInheritedRole"><span class="hs-identifier">resolveInheritedRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html"><span class="hs-identifier">Hasura.RQL.DDL.RemoteRelationship</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#CreateRemoteSchemaRemoteRelationship"><span class="hs-identifier">CreateRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier">PartiallyResolvedSource</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#buildRemoteFieldInfo"><span class="hs-identifier">buildRemoteFieldInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#getRemoteSchemaEntityJoinColumns"><span class="hs-identifier">getRemoteSchemaEntityJoinColumns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.ScheduledTrigger</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Common</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Dependencies.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Dependencies</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Fields.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Fields</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Permission</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Function.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Function</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Table.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Table</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html"><span class="hs-identifier">Hasura.RQL.Types.Action</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html"><span class="hs-identifier">Hasura.RQL.Types.Allowlist</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html"><span class="hs-identifier">Hasura.RQL.Types.Column</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html"><span class="hs-identifier">Hasura.RQL.Types.CustomTypes</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html"><span class="hs-identifier">Hasura.RQL.Types.Endpoint</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.EventTrigger</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Eventing.Backend</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Function.html"><span class="hs-identifier">Hasura.RQL.Types.Function</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#fmFunction"><span class="hs-identifier">fmFunction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#tmTable"><span class="hs-identifier">tmTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Backend</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Object</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Network.html"><span class="hs-identifier">Hasura.RQL.Types.Network</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html"><span class="hs-identifier">Hasura.RQL.Types.OpenTelemetry</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html"><span class="hs-identifier">Hasura.RQL.Types.QueryCollection</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Remote.html"><span class="hs-identifier">Hasura.RQL.Types.Relationships.Remote</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html"><span class="hs-identifier">Hasura.RQL.Types.Roles</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.ScheduledTrigger</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Instances.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Instances</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCacheTypes</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SourceCustomization.html"><span class="hs-identifier">Hasura.RQL.Types.SourceCustomization</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html"><span class="hs-identifier">Hasura.RQL.Types.Table</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.html"><span class="hs-identifier">Hasura.RemoteSchema.Metadata</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RemoteSchema.SchemaCache.html"><span class="hs-identifier">Hasura.RemoteSchema.SchemaCache</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html"><span class="hs-identifier">Hasura.SQL.Backend</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.BackendMap.html"><span class="hs-identifier">Hasura.SQL.BackendMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier">BackendMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.BackendMap.html"><span class="hs-identifier">Hasura.SQL.BackendMap</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BackendMap</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Tag.html"><span class="hs-identifier">Hasura.SQL.Tag</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Migrate.Version.html"><span class="hs-identifier">Hasura.Server.Migrate.Version</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Services.html"><span class="hs-identifier">Hasura.Services</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier">Language.GraphQL.Draft.Syntax</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">{- Note [Roles Inheritance]
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Roles may have parent roles defined from which they can inherit permission and this is
called as roles inheritance. Roles which have parents can also be parents of other roles.
So, cycle in roles should be disallowed and this is done in the `orderRoles` function.

When the metadata contains a permission for a role for a entity, then it will override the
inherited permission, if any.

Roles inheritance work differently for different features:

1. Select permissions
~~~~~~~~~~~~~~~~~~~~~

See note [Inherited roles architecture for read queries]

2. Mutation permissions and remote schema permissions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For mutation and remote schema permissions, an inherited role can only inherit permission
from its parent roles when the relevant parts of the permissions are equal i.e. the non-relevant
parts are discarded for the equality, for example, in two remote schema permissions the order
of the fields in an Object type is discarded.

When an inherited role cannot inherit permission from its parents due to a conflict, then we mark
the inherited role and the entity (remote schema or table) combination as inconsistent in the metadata.

3. Actions and Custom function permissions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Currently, actions and custom function permissions can be thought of as a boolean. Either a role has
permission to the entity or it doesn't, so in these cases there's no possiblity of a conflict. An inherited
role will have access to the action/function if any one of the parents have permission to access the
action/function.

-}</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCache"><span class="hs-identifier hs-type">buildRebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#CacheBuild"><span class="hs-identifier hs-type">CacheBuild</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span>
</span><span id="line-141"></span><span id="buildRebuildableSchemaCache"><span class="annot"><span class="annottext">buildRebuildableSchemaCache :: Logger Hasura
-&gt; Environment -&gt; Metadata -&gt; CacheBuild RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCache"><span class="hs-identifier hs-var hs-var">buildRebuildableSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="annottext">BuildReason
-&gt; Logger Hasura
-&gt; Environment
-&gt; Metadata
-&gt; CacheBuild RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCacheWithReason"><span class="hs-identifier hs-var">buildRebuildableSchemaCacheWithReason</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCacheWithReason"><span class="hs-identifier hs-type">buildRebuildableSchemaCacheWithReason</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#CacheBuild"><span class="hs-identifier hs-type">CacheBuild</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span>
</span><span id="line-150"></span><span id="buildRebuildableSchemaCacheWithReason"><span class="annot"><span class="annottext">buildRebuildableSchemaCacheWithReason :: BuildReason
-&gt; Logger Hasura
-&gt; Environment
-&gt; Metadata
-&gt; CacheBuild RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCacheWithReason"><span class="hs-identifier hs-var hs-var">buildRebuildableSchemaCacheWithReason</span></a></span></span><span> </span><span id="local-6989586621690770768"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690770768"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621690770767"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770767"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690770766"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770766"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621690770765"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770765"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621690770764"><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770764"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690770768"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Applicative m =&gt;
Rule m a b -&gt; a -&gt; m (Result m a b)
</span><span class="hs-identifier hs-var">Inc.build</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, MonadError QErr m,
 MonadReader BuildReason m, ProvidesNetwork m, MonadResolveSource m,
 HasServerConfigCtx m) =&gt;
Logger Hasura
-&gt; Environment
-&gt; arr
     (Metadata, InvalidationKeys, Maybe StoredIntrospection) SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSchemaCacheRule"><span class="hs-identifier hs-var">buildSchemaCacheRule</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770767"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770766"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770765"><span class="hs-identifier hs-var">metadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#initialInvalidationKeys"><span class="hs-identifier hs-var">initialInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; InvalidationKeys
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (Metadata, InvalidationKeys, Maybe StoredIntrospection)
     SchemaCache
-&gt; RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-var">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; b
</span><span class="hs-identifier hs-var">Inc.result</span></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770764"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#initialInvalidationKeys"><span class="hs-identifier hs-var">initialInvalidationKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; Rule m a b
</span><span class="hs-identifier hs-var">Inc.rebuildRule</span></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770764"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">newtype</span><span> </span><span id="CacheRWT"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span></span><span> </span><span id="local-6989586621690771924"><span class="annot"><a href="#local-6989586621690771924"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621690771730"><span class="annot"><a href="#local-6989586621690771730"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The CacheInvalidations component of the state could actually be collected using WriterT, but</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- WriterT implementations prior to transformers-0.5.6.0 (which added</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- Control.Monad.Trans.Writer.CPS) are leaky, and we don&#8217;t have that yet.</span><span>
</span><span id="line-161"></span><span>    </span><span id="CacheRWT"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771924"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771730"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621690770747"><span id="local-6989586621690770752"><span class="annot"><span class="annottext">forall a b. a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall a b. (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; CacheRWT m b -&gt; CacheRWT m a
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; CacheRWT m b -&gt; CacheRWT m a
fmap :: forall a b. (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>      </span><span id="local-6989586621690770720"><span id="local-6989586621690770724"><span id="local-6989586621690770728"><span id="local-6989586621690770732"><span id="local-6989586621690770737"><span class="annot"><span class="annottext">forall a. a -&gt; CacheRWT m a
forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall a b. CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
forall {m :: * -&gt; *}. Monad m =&gt; Functor (CacheRWT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m a
*&gt; :: forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m c
&lt;*&gt; :: forall a b. CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m (a -&gt; b) -&gt; CacheRWT m a -&gt; CacheRWT m b
pure :: forall a. a -&gt; CacheRWT m a
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>      </span><span id="local-6989586621690770699"><span id="local-6989586621690770703"><span id="local-6989586621690770708"><span class="annot"><span class="annottext">forall a. a -&gt; CacheRWT m a
forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall a b. CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (CacheRWT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; CacheRWT m a
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; CacheRWT m a
&gt;&gt; :: forall a b. CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; CacheRWT m b -&gt; CacheRWT m b
&gt;&gt;= :: forall a b. CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
CacheRWT m a -&gt; (a -&gt; CacheRWT m b) -&gt; CacheRWT m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>      </span><span id="local-6989586621690770689"><span class="annot"><span class="annottext">forall a. IO a -&gt; CacheRWT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; CacheRWT m a
liftIO :: forall a. IO a -&gt; CacheRWT m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; CacheRWT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>      </span><span id="local-6989586621690770668"><span id="local-6989586621690770672"><span id="local-6989586621690770677"><span id="local-6989586621690771870"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771870"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>      </span><span id="local-6989586621690770652"><span id="local-6989586621690770657"><span id="local-6989586621690771858"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771858"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>      </span><span id="local-6989586621690770641"><span class="annot"><span class="annottext">CacheRWT m UserInfo
forall (m :: * -&gt; *). Monad m -&gt; m UserInfo -&gt; UserInfoM m
forall {m :: * -&gt; *}. UserInfoM m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *). UserInfoM m =&gt; CacheRWT m UserInfo
askUserInfo :: CacheRWT m UserInfo
$caskUserInfo :: forall (m :: * -&gt; *). UserInfoM m =&gt; CacheRWT m UserInfo
</span><a href="Hasura.Session.html#C%3AUserInfoM"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">UserInfoM</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>      </span><span id="local-6989586621690770520"><span id="local-6989586621690770524"><span id="local-6989586621690770528"><span id="local-6989586621690770532"><span id="local-6989586621690770536"><span id="local-6989586621690770540"><span id="local-6989586621690770544"><span id="local-6989586621690770548"><span id="local-6989586621690770552"><span id="local-6989586621690770556"><span id="local-6989586621690770560"><span id="local-6989586621690770564"><span id="local-6989586621690770568"><span id="local-6989586621690770572"><span id="local-6989586621690770576"><span id="local-6989586621690770580"><span id="local-6989586621690770584"><span id="local-6989586621690770588"><span id="local-6989586621690770592"><span id="local-6989586621690770596"><span id="local-6989586621690770600"><span id="local-6989586621690770604"><span id="local-6989586621690770608"><span id="local-6989586621690770612"><span id="local-6989586621690770616"><span id="local-6989586621690770620"><span id="local-6989586621690770624"><span id="local-6989586621690770629"><span class="annot"><span class="annottext">CacheRWT m (Either QErr [ActionLogItem])
CacheRWT m (Either QErr ())
CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
CacheRWT m (Either QErr (Metadata, MetadataResourceVersion))
CacheRWT m (Either QErr CatalogState)
CacheRWT m (Either QErr MetadataDbId)
CacheRWT m (Either QErr MetadataResourceVersion)
[TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
ScheduledEventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
ScheduledEventType
-&gt; [ScheduledEventId] -&gt; CacheRWT m (Either QErr Int)
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
ActionName -&gt; CacheRWT m (Either QErr ())
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
Monad m
-&gt; m (Either QErr MetadataResourceVersion)
-&gt; m (Either QErr (Metadata, MetadataResourceVersion))
-&gt; (MetadataResourceVersion
    -&gt; InstanceId
    -&gt; m (Either QErr [(MetadataResourceVersion, CacheInvalidations)]))
-&gt; (MetadataResourceVersion
    -&gt; Metadata -&gt; m (Either QErr MetadataResourceVersion))
-&gt; (MetadataResourceVersion
    -&gt; InstanceId -&gt; CacheInvalidations -&gt; m (Either QErr ()))
-&gt; m (Either QErr CatalogState)
-&gt; (CatalogStateType -&gt; Value -&gt; m (Either QErr ()))
-&gt; m (Either QErr MetadataDbId)
-&gt; m (Either QErr ())
-&gt; ([TriggerName] -&gt; m (Either QErr [CronTriggerStats]))
-&gt; m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
-&gt; ([CronEventSeed] -&gt; m (Either QErr ()))
-&gt; (OneOffEvent -&gt; m (Either QErr ScheduledEventId))
-&gt; (Invocation 'ScheduledType
    -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ScheduledEventId
    -&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ScheduledEventType
    -&gt; [ScheduledEventId] -&gt; m (Either QErr Int))
-&gt; m (Either QErr ())
-&gt; (ClearCronEvents -&gt; m (Either QErr ()))
-&gt; (ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent])))
-&gt; (TriggerName
    -&gt; ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; m (Either QErr (WithOptionalTotalCount [CronEvent])))
-&gt; (GetScheduledEventInvocations
    -&gt; m (Either
            QErr (WithOptionalTotalCount [ScheduledEventInvocation])))
-&gt; (ScheduledEventId -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ActionName
    -&gt; SessionVariables
    -&gt; [Header]
    -&gt; Value
    -&gt; m (Either QErr ActionId))
-&gt; m (Either QErr [ActionLogItem])
-&gt; (ActionId -&gt; AsyncActionStatus -&gt; m (Either QErr ()))
-&gt; (ActionId -&gt; m (Either QErr ActionLogResponse))
-&gt; (ActionName -&gt; m (Either QErr ()))
-&gt; (LockedActionIdArray -&gt; m (Either QErr ()))
-&gt; MonadMetadataStorage m
forall {m :: * -&gt; *}. MonadMetadataStorage m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr [ActionLogItem])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr (Metadata, MetadataResourceVersion))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr CatalogState)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataDbId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventType
-&gt; [ScheduledEventId] -&gt; CacheRWT m (Either QErr Int)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
setProcessingActionLogsToPending :: LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
$csetProcessingActionLogsToPending :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; CacheRWT m (Either QErr ())
clearActionData :: ActionName -&gt; CacheRWT m (Either QErr ())
$cclearActionData :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName -&gt; CacheRWT m (Either QErr ())
fetchActionResponse :: ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
$cfetchActionResponse :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; CacheRWT m (Either QErr ActionLogResponse)
setActionStatus :: ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
$csetActionStatus :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; AsyncActionStatus -&gt; CacheRWT m (Either QErr ())
fetchUndeliveredActionEvents :: CacheRWT m (Either QErr [ActionLogItem])
$cfetchUndeliveredActionEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr [ActionLogItem])
insertAction :: ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
$cinsertAction :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; CacheRWT m (Either QErr ActionId)
deleteScheduledEvent :: ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
$cdeleteScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
getScheduledEventInvocations :: GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
$cgetScheduledEventInvocations :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
getCronEvents :: TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
$cgetCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT m (Either QErr (WithOptionalTotalCount [CronEvent]))
getOneOffScheduledEvents :: ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
$cgetOneOffScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
clearFutureCronEvents :: ClearCronEvents -&gt; CacheRWT m (Either QErr ())
$cclearFutureCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
unlockAllLockedScheduledEvents :: CacheRWT m (Either QErr ())
$cunlockAllLockedScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ())
unlockScheduledEvents :: ScheduledEventType
-&gt; [ScheduledEventId] -&gt; CacheRWT m (Either QErr Int)
$cunlockScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventType
-&gt; [ScheduledEventId] -&gt; CacheRWT m (Either QErr Int)
setScheduledEventOp :: ScheduledEventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
$csetScheduledEventOp :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; CacheRWT m (Either QErr ())
insertScheduledEventInvocation :: Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
$cinsertScheduledEventInvocation :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
insertOneOffScheduledEvent :: OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
$cinsertOneOffScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
insertCronEvents :: [CronEventSeed] -&gt; CacheRWT m (Either QErr ())
$cinsertCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
getScheduledEventsForDelivery :: CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
$cgetScheduledEventsForDelivery :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
getDeprivedCronTriggerStats :: [TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
$cgetDeprivedCronTriggerStats :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; CacheRWT m (Either QErr [CronTriggerStats])
checkMetadataStorageHealth :: CacheRWT m (Either QErr ())
$ccheckMetadataStorageHealth :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr ())
getMetadataDbUid :: CacheRWT m (Either QErr MetadataDbId)
$cgetMetadataDbUid :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataDbId)
setCatalogState :: CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
$csetCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
getCatalogState :: CacheRWT m (Either QErr CatalogState)
$cgetCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr CatalogState)
notifySchemaCacheSync :: MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
$cnotifySchemaCacheSync :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; CacheRWT m (Either QErr ())
setMetadata :: MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
$csetMetadata :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Metadata -&gt; CacheRWT m (Either QErr MetadataResourceVersion)
fetchMetadataNotifications :: MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
$cfetchMetadataNotifications :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheRWT
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
fetchMetadata :: CacheRWT m (Either QErr (Metadata, MetadataResourceVersion))
$cfetchMetadata :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr (Metadata, MetadataResourceVersion))
fetchMetadataResourceVersion :: CacheRWT m (Either QErr MetadataResourceVersion)
$cfetchMetadataResourceVersion :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CacheRWT m (Either QErr MetadataResourceVersion)
</span><a href="Hasura.Metadata.Class.html#C%3AMonadMetadataStorage"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMetadataStorage</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>      </span><span id="local-6989586621690770476"><span id="local-6989586621690770480"><span id="local-6989586621690770484"><span id="local-6989586621690770488"><span id="local-6989586621690770492"><span id="local-6989586621690770496"><span id="local-6989586621690770500"><span id="local-6989586621690770504"><span id="local-6989586621690770509"><span class="annot"><span class="annottext">CacheRWT m (Either QErr CatalogState)
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
GetScheduledEvents -&gt; CacheRWT m (Either QErr Value)
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
ActionName -&gt; CacheRWT m (Either QErr ())
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
forall {m :: * -&gt; *}.
MonadMetadataStorageQueryAPI m =&gt;
MonadMetadataStorage (CacheRWT m)
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
CacheRWT m (Either QErr CatalogState)
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
GetScheduledEvents -&gt; CacheRWT m (Either QErr Value)
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
ActionName -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m
-&gt; (OneOffEvent -&gt; m (Either QErr ScheduledEventId))
-&gt; ([CronEventSeed] -&gt; m (Either QErr ()))
-&gt; (ClearCronEvents -&gt; m (Either QErr ()))
-&gt; (ActionName -&gt; m (Either QErr ()))
-&gt; (GetScheduledEventInvocations
    -&gt; m (Either
            QErr (WithOptionalTotalCount [ScheduledEventInvocation])))
-&gt; (GetScheduledEvents -&gt; m (Either QErr Value))
-&gt; (ScheduledEventId -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; m (Either QErr CatalogState)
-&gt; (CatalogStateType -&gt; Value -&gt; m (Either QErr ()))
-&gt; MonadMetadataStorageQueryAPI m
updateCatalogState :: CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
$cupdateCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
CatalogStateType -&gt; Value -&gt; CacheRWT m (Either QErr ())
fetchCatalogState :: CacheRWT m (Either QErr CatalogState)
$cfetchCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
CacheRWT m (Either QErr CatalogState)
dropEvent :: ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
$cdropEvent :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
ScheduledEventId
-&gt; ScheduledEventType -&gt; CacheRWT m (Either QErr ())
fetchScheduledEvents :: GetScheduledEvents -&gt; CacheRWT m (Either QErr Value)
$cfetchScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
GetScheduledEvents -&gt; CacheRWT m (Either QErr Value)
fetchScheduledEventInvocations :: GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
$cfetchScheduledEventInvocations :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
GetScheduledEventInvocations
-&gt; CacheRWT
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
deleteActionData :: ActionName -&gt; CacheRWT m (Either QErr ())
$cdeleteActionData :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
ActionName -&gt; CacheRWT m (Either QErr ())
dropFutureCronEvents :: ClearCronEvents -&gt; CacheRWT m (Either QErr ())
$cdropFutureCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
ClearCronEvents -&gt; CacheRWT m (Either QErr ())
createCronEvents :: [CronEventSeed] -&gt; CacheRWT m (Either QErr ())
$ccreateCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
[CronEventSeed] -&gt; CacheRWT m (Either QErr ())
createOneOffScheduledEvent :: OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
$ccreateOneOffScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorageQueryAPI m =&gt;
OneOffEvent -&gt; CacheRWT m (Either QErr ScheduledEventId)
</span><a href="Hasura.Metadata.Class.html#C%3AMonadMetadataStorageQueryAPI"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMetadataStorageQueryAPI</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>      </span><span id="local-6989586621690770444"><span id="local-6989586621690770448"><span id="local-6989586621690770452"><span id="local-6989586621690770456"><span id="local-6989586621690770460"><span id="local-6989586621690770465"><span class="annot"><span class="annottext">CacheRWT m (IORef TracingMetadata)
CacheRWT m SamplingDecision
CacheRWT m TraceContext
CacheRWT m Reporter
TracingMetadata -&gt; CacheRWT m ()
forall a. Text -&gt; CacheRWT m a -&gt; CacheRWT m a
forall (m :: * -&gt; *).
Monad m
-&gt; (forall a. Text -&gt; m a -&gt; m a)
-&gt; m TraceContext
-&gt; m Reporter
-&gt; m (IORef TracingMetadata)
-&gt; m SamplingDecision
-&gt; (TracingMetadata -&gt; m ())
-&gt; MonadTrace m
forall {m :: * -&gt; *}. MonadTrace m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
MonadTrace m =&gt;
CacheRWT m (IORef TracingMetadata)
forall (m :: * -&gt; *). MonadTrace m =&gt; CacheRWT m SamplingDecision
forall (m :: * -&gt; *). MonadTrace m =&gt; CacheRWT m TraceContext
forall (m :: * -&gt; *). MonadTrace m =&gt; CacheRWT m Reporter
forall (m :: * -&gt; *).
MonadTrace m =&gt;
TracingMetadata -&gt; CacheRWT m ()
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
Text -&gt; CacheRWT m a -&gt; CacheRWT m a
attachMetadata :: TracingMetadata -&gt; CacheRWT m ()
$cattachMetadata :: forall (m :: * -&gt; *).
MonadTrace m =&gt;
TracingMetadata -&gt; CacheRWT m ()
currentSamplingDecision :: CacheRWT m SamplingDecision
$ccurrentSamplingDecision :: forall (m :: * -&gt; *). MonadTrace m =&gt; CacheRWT m SamplingDecision
currentMetadataRef :: CacheRWT m (IORef TracingMetadata)
$ccurrentMetadataRef :: forall (m :: * -&gt; *).
MonadTrace m =&gt;
CacheRWT m (IORef TracingMetadata)
currentReporter :: CacheRWT m Reporter
$ccurrentReporter :: forall (m :: * -&gt; *). MonadTrace m =&gt; CacheRWT m Reporter
currentContext :: CacheRWT m TraceContext
$ccurrentContext :: forall (m :: * -&gt; *). MonadTrace m =&gt; CacheRWT m TraceContext
trace :: forall a. Text -&gt; CacheRWT m a -&gt; CacheRWT m a
$ctrace :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
Text -&gt; CacheRWT m a -&gt; CacheRWT m a
</span><a href="Hasura.Tracing.html#C%3AMonadTrace"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Tracing.MonadTrace</span></a></span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>      </span><span id="local-6989586621690770433"><span class="annot"><span class="annottext">CacheRWT m ServerConfigCtx
forall (m :: * -&gt; *).
Monad m -&gt; m ServerConfigCtx -&gt; HasServerConfigCtx m
forall {m :: * -&gt; *}. HasServerConfigCtx m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *).
HasServerConfigCtx m =&gt;
CacheRWT m ServerConfigCtx
askServerConfigCtx :: CacheRWT m ServerConfigCtx
$caskServerConfigCtx :: forall (m :: * -&gt; *).
HasServerConfigCtx m =&gt;
CacheRWT m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#C%3AHasServerConfigCtx"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasServerConfigCtx</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>      </span><span id="local-6989586621690770413"><span id="local-6989586621690771780"><span class="annot"><span class="hs-identifier hs-type">MonadBase</span></span><span> </span><span class="annot"><a href="#local-6989586621690771780"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>      </span><span id="local-6989586621690770393"><span id="local-6989586621690770399"><span id="local-6989586621690771765"><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="#local-6989586621690771765"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>      </span><span id="local-6989586621690770381"><span class="annot"><span class="annottext">CacheRWT m Manager
forall (m :: * -&gt; *). Monad m -&gt; m Manager -&gt; ProvidesNetwork m
forall {m :: * -&gt; *}. ProvidesNetwork m =&gt; Monad (CacheRWT m)
forall (m :: * -&gt; *). ProvidesNetwork m =&gt; CacheRWT m Manager
askHTTPManager :: CacheRWT m Manager
$caskHTTPManager :: forall (m :: * -&gt; *). ProvidesNetwork m =&gt; CacheRWT m Manager
</span><a href="Hasura.Services.Network.html#C%3AProvidesNetwork"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">ProvidesNetwork</span></a></span></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690771749"><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771749"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771749"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621690770360"><span class="annot"><span class="annottext">runLogCleaner :: TriggerLogCleanupConfig -&gt; CacheRWT m (Either QErr EncJSON)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#runLogCleaner"><span class="hs-identifier hs-var hs-var hs-var hs-var">runLogCleaner</span></a></span></span><span> </span><span id="local-6989586621690770358"><span class="annot"><span class="annottext">TriggerLogCleanupConfig
</span><a href="#local-6989586621690770358"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
TriggerLogCleanupConfig -&gt; m (Either QErr EncJSON)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#runLogCleaner"><span class="hs-identifier hs-var">runLogCleaner</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerLogCleanupConfig
</span><a href="#local-6989586621690770358"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621690770353"><span class="annot"><span class="annottext">generateCleanupSchedules :: AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; CacheRWT m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#generateCleanupSchedules"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateCleanupSchedules</span></a></span></span><span> </span><span id="local-6989586621690770351"><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621690770351"><span class="hs-identifier hs-var">sourceInfo</span></a></span></span><span> </span><span id="local-6989586621690770350"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690770350"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span id="local-6989586621690770349"><span class="annot"><span class="annottext">AutoTriggerLogCleanupConfig
</span><a href="#local-6989586621690770349"><span class="hs-identifier hs-var">cleanupConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
AnyBackend SourceInfo
-&gt; TriggerName -&gt; AutoTriggerLogCleanupConfig -&gt; m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#generateCleanupSchedules"><span class="hs-identifier hs-var">generateCleanupSchedules</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceInfo
</span><a href="#local-6989586621690770351"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690770350"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">AutoTriggerLogCleanupConfig
</span><a href="#local-6989586621690770349"><span class="hs-identifier hs-var">cleanupConfig</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621690770345"><span class="annot"><span class="annottext">updateTriggerCleanupSchedules :: Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; CacheRWT m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#updateTriggerCleanupSchedules"><span class="hs-identifier hs-var hs-var hs-var hs-var">updateTriggerCleanupSchedules</span></a></span></span><span> </span><span id="local-6989586621690770343"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770343"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690770342"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770342"><span class="hs-identifier hs-var">oldSources</span></a></span></span><span> </span><span id="local-6989586621690770341"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770341"><span class="hs-identifier hs-var">newSources</span></a></span></span><span> </span><span id="local-6989586621690770340"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770340"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#updateTriggerCleanupSchedules"><span class="hs-identifier hs-var">updateTriggerCleanupSchedules</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770343"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770342"><span class="hs-identifier hs-var">oldSources</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770341"><span class="hs-identifier hs-var">newSources</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770340"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621690771743"><span id="local-6989586621690771744"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#runCacheRWT"><span class="hs-identifier hs-type">runCacheRWT</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771743"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="#local-6989586621690771744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621690771743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-189"></span><span id="runCacheRWT"><span class="annot"><span class="annottext">runCacheRWT :: forall (m :: * -&gt; *) a.
Functor m =&gt;
RebuildableSchemaCache
-&gt; CacheRWT m a
-&gt; m (a, RebuildableSchemaCache, CacheInvalidations)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#runCacheRWT"><span class="hs-identifier hs-var hs-var">runCacheRWT</span></a></span></span><span> </span><span id="local-6989586621690770335"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770335"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span id="local-6989586621690770334"><span class="annot"><span class="annottext">StateT (RebuildableSchemaCache, CacheInvalidations) m a
</span><a href="#local-6989586621690770334"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runStateT</span></a></span><span> </span><span class="annot"><span class="annottext">StateT (RebuildableSchemaCache, CacheInvalidations) m a
</span><a href="#local-6989586621690770334"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770335"><span class="hs-identifier hs-var">cache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621690770331"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621690770331"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690770330"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770330"><span class="hs-identifier hs-var">newCache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770329"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770329"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621690770331"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770330"><span class="hs-identifier hs-var">newCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770329"><span class="hs-identifier hs-var">invalidations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">MonadTrans</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621690770322"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; CacheRWT m a
</span><a href="#local-6989586621690770322"><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
StateT (RebuildableSchemaCache, CacheInvalidations) m a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690771723"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771723"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-type">CacheRM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771723"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621690770308"><span class="annot"><span class="annottext">askSchemaCache :: CacheRWT m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var hs-var hs-var hs-var">askSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
StateT (RebuildableSchemaCache, CacheInvalidations) m a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621690771699"><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771699"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771699"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771699"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771699"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#HasServerConfigCtx"><span class="hs-identifier hs-type">HasServerConfigCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771699"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-type">CacheRWT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771699"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621690770277"><span class="annot"><span class="annottext">buildSchemaCacheWithOptions :: BuildReason -&gt; CacheInvalidations -&gt; Metadata -&gt; CacheRWT m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithOptions"><span class="hs-identifier hs-var hs-var hs-var hs-var">buildSchemaCacheWithOptions</span></a></span></span><span> </span><span id="local-6989586621690770275"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690770275"><span class="hs-identifier hs-var">buildReason</span></a></span></span><span> </span><span id="local-6989586621690770274"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770274"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span> </span><span id="local-6989586621690770273"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770273"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
StateT (RebuildableSchemaCache, CacheInvalidations) m a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span id="local-6989586621690770272"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770272"><span class="hs-identifier hs-var">lastBuiltSC</span></a></span></span><span> </span><span id="local-6989586621690770271"><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770271"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span> </span><span id="local-6989586621690770270"><span class="annot"><span class="annottext">Rule
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770270"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770269"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770269"><span class="hs-identifier hs-var">oldInvalidations</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690770267"><span class="annot"><span class="annottext">metadataVersion :: Maybe MetadataResourceVersion
</span><a href="#local-6989586621690770267"><span class="hs-identifier hs-var hs-var">metadataVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; Maybe MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770272"><span class="hs-identifier hs-var">lastBuiltSC</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span id="local-6989586621690770265"><span class="annot"><span class="annottext">newInvalidationKeys :: InvalidationKeys
</span><a href="#local-6989586621690770265"><span class="hs-identifier hs-var hs-var">newInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations -&gt; InvalidationKeys -&gt; InvalidationKeys
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#invalidateKeys"><span class="hs-identifier hs-var">invalidateKeys</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770274"><span class="hs-identifier hs-var">invalidations</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770271"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621690770263"><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770263"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, MonadError QErr m, HasServerConfigCtx m,
 MonadResolveSource m, ProvidesNetwork m) =&gt;
CacheBuild a -&gt; m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#runCacheBuildM"><span class="hs-identifier hs-var">runCacheBuildM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-214"></span><span>          </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690770275"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Applicative m =&gt;
Rule m a b -&gt; a -&gt; m (Result m a b)
</span><span class="hs-identifier hs-var">Inc.build</span></span><span> </span><span class="annot"><span class="annottext">Rule
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770270"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770273"><span class="hs-identifier hs-var">metadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770265"><span class="hs-identifier hs-var">newInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690770261"><span class="annot"><span class="annottext">schemaCache :: SchemaCache
</span><a href="#local-6989586621690770261"><span class="hs-identifier hs-var hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; b
</span><span class="hs-identifier hs-var">Inc.result</span></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770263"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">scMetadataResourceVersion :: Maybe MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResourceVersion
</span><a href="#local-6989586621690770267"><span class="hs-identifier hs-var">metadataVersion</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>        </span><span id="local-6989586621690770260"><span class="annot"><span class="annottext">prunedInvalidationKeys :: InvalidationKeys
</span><a href="#local-6989586621690770260"><span class="hs-identifier hs-var hs-var">prunedInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; InvalidationKeys -&gt; InvalidationKeys
</span><a href="#local-6989586621690770259"><span class="hs-identifier hs-var">pruneInvalidationKeys</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770261"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770265"><span class="hs-identifier hs-var">newInvalidationKeys</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621690770258"><span class="annot"><span class="annottext">newCache :: RebuildableSchemaCache
</span><a href="#local-6989586621690770258"><span class="hs-identifier hs-var hs-var">newCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; InvalidationKeys
-&gt; Rule
     (ReaderT BuildReason CacheBuild)
     (Metadata, InvalidationKeys, Maybe StoredIntrospection)
     SchemaCache
-&gt; RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-var">RebuildableSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770261"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770260"><span class="hs-identifier hs-var">prunedInvalidationKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; *) a b. Result m a b -&gt; Rule m a b
</span><span class="hs-identifier hs-var">Inc.rebuildRule</span></span><span> </span><span class="annot"><span class="annottext">Result
  (ReaderT BuildReason CacheBuild)
  (Metadata, InvalidationKeys, Maybe StoredIntrospection)
  SchemaCache
</span><a href="#local-6989586621690770263"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621690770257"><span class="annot"><span class="annottext">newInvalidations :: CacheInvalidations
</span><a href="#local-6989586621690770257"><span class="hs-identifier hs-var hs-var">newInvalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770269"><span class="hs-identifier hs-var">oldInvalidations</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770274"><span class="hs-identifier hs-var">invalidations</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770258"><span class="hs-identifier hs-var">newCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770257"><span class="hs-identifier hs-var">newInvalidations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-comment">-- Prunes invalidation keys that no longer exist in the schema to avoid leaking memory by</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-comment">-- hanging onto unnecessary keys.</span><span>
</span><span id="line-224"></span><span>      </span><span id="local-6989586621690770259"><span class="annot"><span class="annottext">pruneInvalidationKeys :: SchemaCache -&gt; InvalidationKeys -&gt; InvalidationKeys
</span><a href="#local-6989586621690770259"><span class="hs-identifier hs-var hs-var">pruneInvalidationKeys</span></a></span></span><span> </span><span id="local-6989586621690770249"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770249"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">Lens' InvalidationKeys (HashMap RemoteSchemaName InvalidationKey)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#ikRemoteSchemas"><span class="hs-identifier hs-var">ikRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. (k -&gt; v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690770245"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690770245"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">InvalidationKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- see Note [Keep invalidation keys for inconsistent objects]</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690770245"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [RemoteSchemaName]
</span><a href="Hasura.RQL.Types.SchemaCache.html#getAllRemoteSchemas"><span class="hs-identifier hs-var">getAllRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690770249"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621690770239"><span class="annot"><span class="annottext">setMetadataResourceVersionInSchemaCache :: MetadataResourceVersion -&gt; CacheRWT m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#setMetadataResourceVersionInSchemaCache"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadataResourceVersionInSchemaCache</span></a></span></span><span> </span><span id="local-6989586621690770237"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690770237"><span class="hs-identifier hs-var">resourceVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
StateT (RebuildableSchemaCache, CacheInvalidations) m a
-&gt; CacheRWT m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#CacheRWT"><span class="hs-identifier hs-var">CacheRWT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621690770236"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770236"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770235"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770235"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">put</span></a></span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770236"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span>
</span><span id="line-232"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lastBuiltSchemaCache :: SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690770236"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scMetadataResourceVersion :: Maybe MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690770237"><span class="hs-identifier hs-var">resourceVersion</span></a></span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690770235"><span class="hs-identifier hs-var">invalidations</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | Generate health checks related cache from sources metadata</span><span>
</span><span id="line-241"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildHealthCheckCache"><span class="hs-identifier hs-type">buildHealthCheckCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Sources"><span class="hs-identifier hs-type">Sources</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceHealthCheckCache"><span class="hs-identifier hs-type">SourceHealthCheckCache</span></a></span><span>
</span><span id="line-242"></span><span id="buildHealthCheckCache"><span class="annot"><span class="annottext">buildHealthCheckCache :: InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SourceHealthCheckCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildHealthCheckCache"><span class="hs-identifier hs-var hs-var">buildHealthCheckCache</span></a></span></span><span> </span><span id="local-6989586621690770232"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770232"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; Maybe BackendSourceHealthCheckInfo
</span><a href="#local-6989586621690770228"><span class="hs-identifier hs-var">mkSourceHealthCheck</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">OMap.toList</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770232"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="#local-6989586621690770228"><span class="hs-identifier hs-type">mkSourceHealthCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#BackendSourceHealthCheckInfo"><span class="hs-identifier hs-type">BackendSourceHealthCheckInfo</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621690770228"><span class="annot"><span class="annottext">mkSourceHealthCheck :: BackendSourceMetadata -&gt; Maybe BackendSourceHealthCheckInfo
</span><a href="#local-6989586621690770228"><span class="hs-identifier hs-var hs-var">mkSourceHealthCheck</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621690770225"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621690770225"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *)
       (j :: BackendType -&gt; *) (f :: * -&gt; *).
(AllBackendsSatisfy c, Functor f) =&gt;
AnyBackend i
-&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; f (j b))
-&gt; f (AnyBackend j)
</span><a href="Hasura.SQL.AnyBackend.html#traverseBackend"><span class="hs-identifier hs-var">AB.traverseBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621690770225"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b -&gt; Maybe (SourceHealthCheckInfo b)
</span><a href="#local-6989586621690770223"><span class="hs-identifier hs-var">mkSourceHealthCheckBackend</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621690771660"><span class="annot"><a href="#local-6989586621690770223"><span class="hs-identifier hs-type">mkSourceHealthCheckBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771660"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceHealthCheckInfo"><span class="hs-identifier hs-type">SourceHealthCheckInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771660"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621690770223"><span class="annot"><span class="annottext">mkSourceHealthCheckBackend :: forall (b :: BackendType).
SourceMetadata b -&gt; Maybe (SourceHealthCheckInfo b)
</span><a href="#local-6989586621690770223"><span class="hs-identifier hs-var hs-var">mkSourceHealthCheckBackend</span></a></span></span><span> </span><span id="local-6989586621690770220"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770220"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690770219"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621690770219"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770220"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-252"></span><span>          </span><span id="local-6989586621690770217"><span class="annot"><span class="annottext">connection :: SourceConnConfiguration b
</span><a href="#local-6989586621690770217"><span class="hs-identifier hs-var hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770220"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span id="local-6989586621690770215"><span class="annot"><span class="annottext">healthCheck :: Maybe (HealthCheckConfig b)
</span><a href="#local-6989586621690770215"><span class="hs-identifier hs-var hs-var">healthCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b -&gt; Maybe (HealthCheckConfig b)
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smHealthCheckConfig"><span class="hs-identifier hs-var">_smHealthCheckConfig</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770220"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceName
-&gt; SourceConnConfiguration b
-&gt; HealthCheckConfig b
-&gt; SourceHealthCheckInfo b
</span><a href="Hasura.RQL.Types.Source.html#SourceHealthCheckInfo"><span class="hs-identifier hs-var">SourceHealthCheckInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690770219"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621690770217"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
</span><a href="#local-6989586621690770215"><span class="hs-identifier hs-var">healthCheck</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Generate cache of source connection details so that we can ping sources for</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- attribution</span><span>
</span><span id="line-258"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcePingCache"><span class="hs-identifier hs-type">buildSourcePingCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Sources"><span class="hs-identifier hs-type">Sources</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourcePingCache"><span class="hs-identifier hs-type">SourcePingCache</span></a></span><span>
</span><span id="line-259"></span><span id="buildSourcePingCache"><span class="annot"><span class="annottext">buildSourcePingCache :: InsOrdHashMap SourceName BackendSourceMetadata -&gt; SourcePingCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcePingCache"><span class="hs-identifier hs-var hs-var">buildSourcePingCache</span></a></span></span><span> </span><span id="local-6989586621690770210"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770210"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; BackendSourcePingInfo
</span><a href="#local-6989586621690770209"><span class="hs-identifier hs-var">mkSourcePing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">OMap.toList</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770210"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="#local-6989586621690770209"><span class="hs-identifier hs-type">mkSourcePing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#BackendSourcePingInfo"><span class="hs-identifier hs-type">BackendSourcePingInfo</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621690770209"><span class="annot"><span class="annottext">mkSourcePing :: BackendSourceMetadata -&gt; BackendSourcePingInfo
</span><a href="#local-6989586621690770209"><span class="hs-identifier hs-var hs-var">mkSourcePing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621690770208"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621690770208"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">forall (i :: BackendType -&gt; *) (j :: BackendType -&gt; *).
AnyBackend i
-&gt; (forall (b :: BackendType). i b -&gt; j b) -&gt; AnyBackend j
</span><a href="Hasura.SQL.AnyBackend.html#mapBackend"><span class="hs-identifier hs-var">AB.mapBackend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621690770208"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; SourcePingInfo b
</span><a href="#local-6989586621690770206"><span class="hs-identifier hs-var">mkSourcePingBackend</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621690771642"><span class="annot"><a href="#local-6989586621690770206"><span class="hs-identifier hs-type">mkSourcePingBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771642"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourcePingInfo"><span class="hs-identifier hs-type">SourcePingInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771642"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621690770206"><span class="annot"><span class="annottext">mkSourcePingBackend :: forall (b :: BackendType). SourceMetadata b -&gt; SourcePingInfo b
</span><a href="#local-6989586621690770206"><span class="hs-identifier hs-var hs-var">mkSourcePingBackend</span></a></span></span><span> </span><span id="local-6989586621690770205"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770205"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690770204"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621690770204"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770205"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-269"></span><span>          </span><span id="local-6989586621690770203"><span class="annot"><span class="annottext">connection :: SourceConnConfiguration b
</span><a href="#local-6989586621690770203"><span class="hs-identifier hs-var hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690770205"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-270"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceName -&gt; SourceConnConfiguration b -&gt; SourcePingInfo b
</span><a href="Hasura.RQL.Types.Source.html#SourcePingInfo"><span class="hs-identifier hs-var">SourcePingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690770204"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621690770203"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">{- Note [Avoiding GraphQL schema rebuilds when changing irrelevant Metadata]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are many Metadata operations that don't influence the GraphQL schema.  So
we should be caching its construction.

The `Hasura.Incremental` framework allows us to cache such constructions:
whenever we have an arrow `Rule m a b`, where `a` is the input to the arrow and
`b` the output, we can use the `Inc.cache` combinator to obtain a new arrow
which is only re-executed when the input `a` changes in a material way.  To test
this, `a` needs an `Eq` instance.

We can't simply apply `Inc.cache` to the GraphQL schema cache building phase
(`buildGQLContext`), because the inputs (components of `BuildOutputs` such as
`SourceCache`) don't have an `Eq` instance.

So the purpose of `buildOutputsAndSchema` is that we cach already at an earlier
point, encompassing more computation.  The Metadata and invalidation keys (which
have `Eq` instances) are used as a caching key, and `Inc.cache` can be applied
to the whole sequence of steps.

But because of the all-or-nothing nature of caching, it's important that
`buildOutputsAndSchema` is re-run as little as possible.  So the exercise
becomes to minimize the amount of stuff stored in `BuildOutputs`, so that as
many Metadata operations as possible can be handled outside of this codepath
that produces a GraphQL schema.
-}</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span id="local-6989586621690771951"><span id="local-6989586621690771952"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSchemaCacheRule"><span class="hs-identifier hs-type">buildSchemaCacheRule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-comment">-- Note: by supplying BuildReason via MonadReader, it does not participate in caching, which is</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-comment">-- what we want!</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771952"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></span><span> </span><span class="annot"><a href="#local-6989586621690771952"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771952"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#HasServerConfigCtx"><span class="hs-identifier hs-type">HasServerConfigCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771951"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#InvalidationKeys"><span class="hs-identifier hs-type">InvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771952"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span></span></span><span>
</span><span id="line-316"></span><span id="buildSchemaCacheRule"><span class="annot"><span class="annottext">buildSchemaCacheRule :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr, MonadIO m,
 MonadBaseControl IO m, MonadError QErr m,
 MonadReader BuildReason m, ProvidesNetwork m, MonadResolveSource m,
 HasServerConfigCtx m) =&gt;
Logger Hasura
-&gt; Environment
-&gt; arr
     (Metadata, InvalidationKeys, Maybe StoredIntrospection) SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSchemaCacheRule"><span class="hs-identifier hs-var hs-var">buildSchemaCacheRule</span></a></span></span><span> </span><span id="local-6989586621690770132"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770132"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690770131"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690770130"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770130"><span class="hs-identifier hs-var">metadataNoDefaults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770129"><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770129"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770128"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690770128"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621690770127"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690770127"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowCache m arr =&gt;
arr a (Dependency a)
</span><span class="hs-identifier hs-var">Inc.newDependency</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">InvalidationKeys
</span><a href="#local-6989586621690770129"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span id="local-6989586621690770125"><span class="annot"><span class="annottext">MetadataDefaults
</span><a href="#local-6989586621690770125"><span class="hs-identifier hs-var">metadataDefaults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m MetadataDefaults
</span><a href="Hasura.Server.Types.html#askMetadataDefaults"><span class="hs-identifier hs-var">askMetadataDefaults</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690770122"><span class="annot"><span class="annottext">metadata :: Metadata
</span><a href="#local-6989586621690770122"><span class="hs-identifier hs-var">metadata</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690770106"><span id="local-6989586621690770107"><span id="local-6989586621690770108"><span id="local-6989586621690770109"><span id="local-6989586621690770110"><span id="local-6989586621690770111"><span id="local-6989586621690770112"><span id="local-6989586621690770113"><span id="local-6989586621690770114"><span id="local-6989586621690770115"><span id="local-6989586621690770116"><span id="local-6989586621690770117"><span id="local-6989586621690770118"><span id="local-6989586621690770119"><span id="local-6989586621690770120"><span class="annot"><span class="annottext">RemoteSchemas
InsOrdHashMap SourceName BackendSourceMetadata
QueryCollections
MetadataAllowlist
Endpoints
InheritedRoles
CronTriggers
Actions
Network
OpenTelemetryConfig
BackendMap BackendConfigWrapper
MetricsConfig
SetGraphqlIntrospectionOptions
ApiLimit
CustomTypes
_metaOpenTelemetryConfig :: Metadata -&gt; OpenTelemetryConfig
_metaBackendConfigs :: Metadata -&gt; BackendMap BackendConfigWrapper
_metaNetwork :: Metadata -&gt; Network
_metaSetGraphqlIntrospectionOptions :: Metadata -&gt; SetGraphqlIntrospectionOptions
_metaInheritedRoles :: Metadata -&gt; InheritedRoles
_metaMetricsConfig :: Metadata -&gt; MetricsConfig
_metaApiLimits :: Metadata -&gt; ApiLimit
_metaRestEndpoints :: Metadata -&gt; Endpoints
_metaCronTriggers :: Metadata -&gt; CronTriggers
_metaActions :: Metadata -&gt; Actions
_metaCustomTypes :: Metadata -&gt; CustomTypes
_metaAllowlist :: Metadata -&gt; MetadataAllowlist
_metaQueryCollections :: Metadata -&gt; QueryCollections
_metaRemoteSchemas :: Metadata -&gt; RemoteSchemas
_metaSources :: Metadata -&gt; InsOrdHashMap SourceName BackendSourceMetadata
_metaOpenTelemetryConfig :: OpenTelemetryConfig
_metaBackendConfigs :: BackendMap BackendConfigWrapper
_metaNetwork :: Network
_metaSetGraphqlIntrospectionOptions :: SetGraphqlIntrospectionOptions
_metaInheritedRoles :: InheritedRoles
_metaMetricsConfig :: MetricsConfig
_metaApiLimits :: ApiLimit
_metaRestEndpoints :: Endpoints
_metaCronTriggers :: CronTriggers
_metaActions :: Actions
_metaCustomTypes :: CustomTypes
_metaAllowlist :: MetadataAllowlist
_metaQueryCollections :: QueryCollections
_metaRemoteSchemas :: RemoteSchemas
_metaSources :: InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.html#_metaOpenTelemetryConfig"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; MetadataDefaults -&gt; Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#overrideMetadataDefaults"><span class="hs-identifier hs-var">overrideMetadataDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770130"><span class="hs-identifier hs-var">metadataNoDefaults</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataDefaults
</span><a href="#local-6989586621690770125"><span class="hs-identifier hs-var">metadataDefaults</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span id="local-6989586621690770089"><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690770089"><span class="hs-identifier hs-var">metadataDep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowCache m arr =&gt;
arr a (Dependency a)
</span><span class="hs-identifier hs-var">Inc.newDependency</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690770122"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621690770088"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690770088"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690770087"><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690770087"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770086"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690770086"><span class="hs-identifier hs-var">dependencyInconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770085"><span class="annot"><span class="annottext">DepMap
</span><a href="#local-6989586621690770085"><span class="hs-identifier hs-var">resolvedDependencies</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621690770084"><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621690770084"><span class="hs-identifier hs-var">adminIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770083"><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621690770083"><span class="hs-identifier hs-var">gqlContext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770082"><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621690770082"><span class="hs-identifier hs-var">gqlContextUnauth</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770081"><span class="annot"><span class="annottext">HashSet InconsistentMetadata
</span><a href="#local-6989586621690770081"><span class="hs-identifier hs-var">inconsistentRemoteSchemas</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690770080"><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621690770080"><span class="hs-identifier hs-var">relayContext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770079"><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621690770079"><span class="hs-identifier hs-var">relayContextUnauth</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><span class="hs-identifier hs-var">Inc.cache</span></span><span> </span><span class="annot"><span class="annottext">arr
  (Dependency Metadata, Dependency InvalidationKeys,
   Maybe StoredIntrospection)
  ([InconsistentMetadata],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext)))
</span><a href="#local-6989586621690770077"><span class="hs-identifier hs-var">buildOutputsAndSchema</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690770089"><span class="hs-identifier hs-var">metadataDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690770127"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690770128"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690770076"><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621690770076"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770075"><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata Void)
</span><a href="#local-6989586621690770075"><span class="hs-identifier hs-var">endpointCollectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Identity a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">runIdentity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runWriterT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
QueryCollections
-&gt; [CreateEndpoint]
-&gt; m (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621690770072"><span class="hs-identifier hs-var">buildRESTEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690770118"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">Endpoints
</span><a href="#local-6989586621690770113"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621690770070"><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621690770070"><span class="hs-identifier hs-var">cronTriggersMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770069"><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata Void)
</span><a href="#local-6989586621690770069"><span class="hs-identifier hs-var">cronTriggersCollectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Identity a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">runIdentity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runWriterT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
[CronTriggerMetadata] -&gt; m (HashMap TriggerName CronTriggerInfo)
</span><a href="#local-6989586621690770068"><span class="hs-identifier hs-var">buildCronTriggers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621690770114"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621690770067"><span class="annot"><span class="annottext">OpenTelemetryInfo
</span><a href="#local-6989586621690770067"><span class="hs-identifier hs-var">openTelemetryInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770066"><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata Void)
</span><a href="#local-6989586621690770066"><span class="hs-identifier hs-var">openTelemetryCollectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Identity a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">runIdentity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runWriterT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
OpenTelemetryConfig -&gt; m OpenTelemetryInfo
</span><a href="#local-6989586621690770065"><span class="hs-identifier hs-var">buildOpenTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfig
</span><a href="#local-6989586621690770106"><span class="hs-identifier hs-var">_metaOpenTelemetryConfig</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>      </span><span id="local-6989586621690771566"><span class="annot"><a href="#local-6989586621690770064"><span class="hs-identifier hs-type">duplicateVariables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771566"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-330"></span><span>      </span><span id="local-6989586621690770064"><span class="annot"><span class="annottext">duplicateVariables :: forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621690770064"><span class="hs-identifier hs-var hs-var">duplicateVariables</span></a></span></span><span> </span><span id="local-6989586621690770052"><span class="annot"><span class="annottext">EndpointMetadata a
</span><a href="#local-6989586621690770052"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">group</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (Text -&gt; a) -&gt; (Text -&gt; a) -&gt; EndpointUrl -&gt; [a]
</span><a href="Hasura.RQL.Types.Endpoint.html#splitPath"><span class="hs-identifier hs-var">splitPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata a
</span><a href="#local-6989586621690770052"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>      </span><span id="local-6989586621690771553"><span class="annot"><a href="#local-6989586621690770043"><span class="hs-identifier hs-type">endpointObjId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771553"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span></span><span>
</span><span id="line-333"></span><span>      </span><span id="local-6989586621690770043"><span class="annot"><span class="annottext">endpointObjId :: forall q. EndpointMetadata q -&gt; MetadataObjId
</span><a href="#local-6989586621690770043"><span class="hs-identifier hs-var hs-var">endpointObjId</span></a></span></span><span> </span><span id="local-6989586621690770042"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770042"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOEndpoint"><span class="hs-identifier hs-var">MOEndpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770042"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>      </span><span id="local-6989586621690771549"><span class="annot"><a href="#local-6989586621690770039"><span class="hs-identifier hs-type">endpointObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771549"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span></span><span>
</span><span id="line-336"></span><span>      </span><span id="local-6989586621690770039"><span class="annot"><span class="annottext">endpointObject :: forall q. EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690770039"><span class="hs-identifier hs-var hs-var">endpointObject</span></a></span></span><span> </span><span id="local-6989586621690770028"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770028"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall q. EndpointMetadata q -&gt; MetadataObjId
</span><a href="#local-6989586621690770043"><span class="hs-identifier hs-var">endpointObjId</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770028"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770028"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Endpoints
</span><a href="#local-6989586621690770113"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><a href="#local-6989586621690770024"><span class="hs-identifier hs-type">listedQueryObjects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-339"></span><span>      </span><span id="local-6989586621690770024"><span class="annot"><span class="annottext">listedQueryObjects :: (CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621690770024"><span class="hs-identifier hs-var hs-var">listedQueryObjects</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621690770023"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621690770023"><span class="hs-identifier hs-var">cName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690770022"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621690770022"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionName -&gt; ListedQuery -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOQueryCollectionsQuery"><span class="hs-identifier hs-var">MOQueryCollectionsQuery</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621690770023"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621690770022"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621690770022"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-comment">--  Cases of urls that generate invalid segments:</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621690770020"><span class="annot"><a href="#local-6989586621690770019"><span class="hs-identifier hs-type">hasInvalidSegments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690770020"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621690770019"><span class="annot"><span class="annottext">hasInvalidSegments :: forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621690770019"><span class="hs-identifier hs-var hs-var">hasInvalidSegments</span></a></span></span><span> </span><span id="local-6989586621690770012"><span class="annot"><span class="annottext">EndpointMetadata query
</span><a href="#local-6989586621690770012"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (Text -&gt; a) -&gt; (Text -&gt; a) -&gt; EndpointUrl -&gt; [a]
</span><a href="Hasura.RQL.Types.Endpoint.html#splitPath"><span class="hs-identifier hs-var">splitPath</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata query
</span><a href="#local-6989586621690770012"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>      </span><span id="local-6989586621690770008"><span class="annot"><span class="annottext">ceUrlTxt :: EndpointMetadata query -&gt; Text
</span><a href="#local-6989586621690770008"><span class="hs-identifier hs-var hs-var">ceUrlTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>      </span><span id="local-6989586621690770006"><span class="annot"><span class="annottext">endpoints :: EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621690770006"><span class="hs-identifier hs-var hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall query.
Ord query =&gt;
[EndpointMetadata query] -&gt; EndpointTrie query
</span><a href="Hasura.RQL.Types.Endpoint.html#buildEndpointsTrie"><span class="hs-identifier hs-var">buildEndpointsTrie</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621690770076"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>      </span><span id="local-6989586621690770003"><span class="annot"><span class="annottext">duplicateF :: EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621690770003"><span class="hs-identifier hs-var hs-var">duplicateF</span></a></span></span><span> </span><span id="local-6989586621690770002"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770002"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#DuplicateRestVariables"><span class="hs-identifier hs-var">DuplicateRestVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {query}. EndpointMetadata query -&gt; Text
</span><a href="#local-6989586621690770008"><span class="hs-identifier hs-var">ceUrlTxt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770002"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall q. EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690770039"><span class="hs-identifier hs-var">endpointObject</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690770002"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>      </span><span id="local-6989586621690770000"><span class="annot"><span class="annottext">duplicateRestVariables :: [InconsistentMetadata]
</span><a href="#local-6989586621690770000"><span class="hs-identifier hs-var hs-var">duplicateRestVariables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall {q}. EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621690770003"><span class="hs-identifier hs-var">duplicateF</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621690770064"><span class="hs-identifier hs-var">duplicateVariables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621690770076"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>      </span><span id="local-6989586621690769999"><span class="annot"><span class="annottext">invalidF :: EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621690769999"><span class="hs-identifier hs-var hs-var">invalidF</span></a></span></span><span> </span><span id="local-6989586621690769998"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690769998"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MetadataObject -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#InvalidRestSegments"><span class="hs-identifier hs-var">InvalidRestSegments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {query}. EndpointMetadata query -&gt; Text
</span><a href="#local-6989586621690770008"><span class="hs-identifier hs-var">ceUrlTxt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690769998"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall q. EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690770039"><span class="hs-identifier hs-var">endpointObject</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690769998"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>      </span><span id="local-6989586621690769996"><span class="annot"><span class="annottext">invalidRestSegments :: [InconsistentMetadata]
</span><a href="#local-6989586621690769996"><span class="hs-identifier hs-var hs-var">invalidRestSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall {q}. EndpointMetadata q -&gt; InconsistentMetadata
</span><a href="#local-6989586621690769999"><span class="hs-identifier hs-var">invalidF</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EndpointMetadata a -&gt; Bool
</span><a href="#local-6989586621690770019"><span class="hs-identifier hs-var">hasInvalidSegments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">HashMap EndpointName (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621690770076"><span class="hs-identifier hs-var">resolvedEndpoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>      </span><span id="local-6989586621690769992"><span class="annot"><span class="annottext">ambiguousF' :: EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690769992"><span class="hs-identifier hs-var hs-var">ambiguousF'</span></a></span></span><span> </span><span id="local-6989586621690769991"><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690769991"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall q. EndpointMetadata q -&gt; MetadataObjId
</span><a href="#local-6989586621690770043"><span class="hs-identifier hs-var">endpointObjId</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690769991"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata q
</span><a href="#local-6989586621690769991"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>      </span><span id="local-6989586621690769986"><span class="annot"><span class="annottext">ambiguousF :: [EndpointMetadata q] -&gt; InconsistentMetadata
</span><a href="#local-6989586621690769986"><span class="hs-identifier hs-var hs-var">ambiguousF</span></a></span></span><span> </span><span id="local-6989586621690769985"><span class="annot"><span class="annottext">[EndpointMetadata q]
</span><a href="#local-6989586621690769985"><span class="hs-identifier hs-var">mds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [MetadataObject] -&gt; InconsistentMetadata
</span><a href="Hasura.RQL.Types.Metadata.Object.html#AmbiguousRestEndpoints"><span class="hs-identifier hs-var">AmbiguousRestEndpoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceUrl"><span class="hs-identifier hs-var">_ceUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[EndpointMetadata q]
</span><a href="#local-6989586621690769985"><span class="hs-identifier hs-var">mds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall {q}. ToJSON q =&gt; EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690769992"><span class="hs-identifier hs-var">ambiguousF'</span></a></span><span> </span><span class="annot"><span class="annottext">[EndpointMetadata q]
</span><a href="#local-6989586621690769985"><span class="hs-identifier hs-var">mds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>      </span><span id="local-6989586621690769982"><span class="annot"><span class="annottext">ambiguousRestEndpoints :: [InconsistentMetadata]
</span><a href="#local-6989586621690769982"><span class="hs-identifier hs-var hs-var">ambiguousRestEndpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {q}.
ToJSON q =&gt;
[EndpointMetadata q] -&gt; InconsistentMetadata
</span><a href="#local-6989586621690769986"><span class="hs-identifier hs-var">ambiguousF</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">S.elems</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a k v.
(Hashable a, Hashable k, Ord v, Ord a) =&gt;
MultiMapPathTrie a k v -&gt; [(Set [PathComponent a], Set v)]
</span><a href="Hasura.RQL.Types.Endpoint.Trie.html#ambiguousPathsGrouped"><span class="hs-identifier hs-var">ambiguousPathsGrouped</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621690770006"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>      </span><span id="local-6989586621690769979"><span class="annot"><span class="annottext">inlinedAllowlist :: InlinedAllowlist
</span><a href="#local-6989586621690769979"><span class="hs-identifier hs-var hs-var">inlinedAllowlist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QueryCollections -&gt; MetadataAllowlist -&gt; InlinedAllowlist
</span><a href="Hasura.RQL.Types.Allowlist.html#inlineAllowlist"><span class="hs-identifier hs-var">inlineAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690770118"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataAllowlist
</span><a href="#local-6989586621690770117"><span class="hs-identifier hs-var">_metaAllowlist</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span id="local-6989586621690769977"><span class="annot"><span class="annottext">globalAllowLists :: [NormalizedQuery]
</span><a href="#local-6989586621690769977"><span class="hs-identifier hs-var hs-var">globalAllowLists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">HS.toList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist -&gt; HashSet NormalizedQuery
</span><a href="Hasura.RQL.Types.Allowlist.html#iaGlobal"><span class="hs-identifier hs-var">iaGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist
</span><a href="#local-6989586621690769979"><span class="hs-identifier hs-var">inlinedAllowlist</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-comment">-- Endpoints don't generate any dependencies</span><span>
</span><span id="line-364"></span><span>      </span><span id="local-6989586621690769974"><span class="annot"><span class="annottext">endpointInconsistencies :: [InconsistentMetadata]
</span><a href="#local-6989586621690769974"><span class="hs-identifier hs-var hs-var">endpointInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Void -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">absurd</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata Void)
</span><a href="#local-6989586621690770075"><span class="hs-identifier hs-var">endpointCollectedInfo</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-comment">-- Cron triggers don't generate any dependencies</span><span>
</span><span id="line-367"></span><span>      </span><span id="local-6989586621690769970"><span class="annot"><span class="annottext">cronTriggersInconsistencies :: [InconsistentMetadata]
</span><a href="#local-6989586621690769970"><span class="hs-identifier hs-var hs-var">cronTriggersInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Void -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">absurd</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata Void)
</span><a href="#local-6989586621690770069"><span class="hs-identifier hs-var">cronTriggersCollectedInfo</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-comment">-- OpenTelemerty doesn't generate any dependencies</span><span>
</span><span id="line-370"></span><span>      </span><span id="local-6989586621690769969"><span class="annot"><span class="annottext">openTelemetryInconsistencies :: [InconsistentMetadata]
</span><a href="#local-6989586621690769969"><span class="hs-identifier hs-var hs-var">openTelemetryInconsistencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Void -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">absurd</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata Void)
</span><a href="#local-6989586621690770066"><span class="hs-identifier hs-var">openTelemetryCollectedInfo</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>      </span><span id="local-6989586621690769968"><span class="annot"><span class="annottext">inconsistentQueryCollections :: [InconsistentMetadata]
</span><a href="#local-6989586621690769968"><span class="hs-identifier hs-var hs-var">inconsistentQueryCollections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
-&gt; QueryCollections
-&gt; ((CollectionName, ListedQuery) -&gt; MetadataObject)
-&gt; EndpointTrie GQLQueryWithText
-&gt; [NormalizedQuery]
-&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#getInconsistentQueryCollections"><span class="hs-identifier hs-var">getInconsistentQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621690770084"><span class="hs-identifier hs-var">adminIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690770118"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionName, ListedQuery) -&gt; MetadataObject
</span><a href="#local-6989586621690770024"><span class="hs-identifier hs-var">listedQueryObjects</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621690770006"><span class="hs-identifier hs-var">endpoints</span></a></span><span> </span><span class="annot"><span class="annottext">[NormalizedQuery]
</span><a href="#local-6989586621690769977"><span class="hs-identifier hs-var">globalAllowLists</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span>
</span><span id="line-377"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scSources :: SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildOutputs -&gt; SourceCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boSources"><span class="hs-identifier hs-var">_boSources</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690770087"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-378"></span><span>          </span><span class="annot"><span class="annottext">scActions :: ActionCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scActions"><span class="hs-identifier hs-var">scActions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildOutputs -&gt; ActionCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boActions"><span class="hs-identifier hs-var">_boActions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690770087"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-379"></span><span>          </span><span class="hs-comment">-- TODO this is not the right value: we should track what part of the schema</span><span>
</span><span id="line-380"></span><span>          </span><span class="hs-comment">-- we can stitch without consistencies, I think.</span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><span class="annottext">scRemoteSchemas :: RemoteSchemaMap
</span><a href="Hasura.RQL.Types.SchemaCache.html#scRemoteSchemas"><span class="hs-identifier hs-var">scRemoteSchemas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRemoteSchemas"><span class="hs-identifier hs-var">_boRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690770087"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- remoteSchemaMap</span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">scAllowlist :: InlinedAllowlist
</span><a href="Hasura.RQL.Types.SchemaCache.html#scAllowlist"><span class="hs-identifier hs-var">scAllowlist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist
</span><a href="#local-6989586621690769979"><span class="hs-identifier hs-var">inlinedAllowlist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-383"></span><span>          </span><span class="hs-comment">-- , scCustomTypes = _boCustomTypes resolvedOutputs</span><span>
</span><span id="line-384"></span><span>          </span><span class="annot"><span class="annottext">scAdminIntrospection :: SchemaIntrospection
</span><a href="Hasura.RQL.Types.SchemaCache.html#scAdminIntrospection"><span class="hs-identifier hs-var">scAdminIntrospection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaIntrospection
</span><a href="#local-6989586621690770084"><span class="hs-identifier hs-var">adminIntrospection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-385"></span><span>          </span><span class="annot"><span class="annottext">scGQLContext :: HashMap RoleName (RoleContext GQLContext)
</span><a href="Hasura.RQL.Types.SchemaCache.html#scGQLContext"><span class="hs-identifier hs-var">scGQLContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621690770083"><span class="hs-identifier hs-var">gqlContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-386"></span><span>          </span><span class="annot"><span class="annottext">scUnauthenticatedGQLContext :: GQLContext
</span><a href="Hasura.RQL.Types.SchemaCache.html#scUnauthenticatedGQLContext"><span class="hs-identifier hs-var">scUnauthenticatedGQLContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621690770082"><span class="hs-identifier hs-var">gqlContextUnauth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-387"></span><span>          </span><span class="annot"><span class="annottext">scRelayContext :: HashMap RoleName (RoleContext GQLContext)
</span><a href="Hasura.RQL.Types.SchemaCache.html#scRelayContext"><span class="hs-identifier hs-var">scRelayContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName (RoleContext GQLContext)
</span><a href="#local-6989586621690770080"><span class="hs-identifier hs-var">relayContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-388"></span><span>          </span><span class="annot"><span class="annottext">scUnauthenticatedRelayContext :: GQLContext
</span><a href="Hasura.RQL.Types.SchemaCache.html#scUnauthenticatedRelayContext"><span class="hs-identifier hs-var">scUnauthenticatedRelayContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GQLContext
</span><a href="#local-6989586621690770079"><span class="hs-identifier hs-var">relayContextUnauth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-389"></span><span>          </span><span class="hs-comment">-- , scGCtxMap = gqlSchema</span><span>
</span><span id="line-390"></span><span>          </span><span class="hs-comment">-- , scDefaultRemoteGCtx = remoteGQLSchema</span><span>
</span><span id="line-391"></span><span>          </span><span class="annot"><span class="annottext">scDepMap :: DepMap
</span><a href="Hasura.RQL.Types.SchemaCache.html#scDepMap"><span class="hs-identifier hs-var">scDepMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DepMap
</span><a href="#local-6989586621690770085"><span class="hs-identifier hs-var">resolvedDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-392"></span><span>          </span><span class="annot"><span class="annottext">scCronTriggers :: HashMap TriggerName CronTriggerInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scCronTriggers"><span class="hs-identifier hs-var">scCronTriggers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621690770070"><span class="hs-identifier hs-var">cronTriggersMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-393"></span><span>          </span><span class="annot"><span class="annottext">scEndpoints :: EndpointTrie GQLQueryWithText
</span><a href="Hasura.RQL.Types.SchemaCache.html#scEndpoints"><span class="hs-identifier hs-var">scEndpoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621690770006"><span class="hs-identifier hs-var">endpoints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-394"></span><span>          </span><span class="annot"><span class="annottext">scInconsistentObjs :: [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-395"></span><span>            </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690770088"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span>
</span><span id="line-396"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690770086"><span class="hs-identifier hs-var">dependencyInconsistentObjects</span></a></span><span>
</span><span id="line-397"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet InconsistentMetadata
</span><a href="#local-6989586621690770081"><span class="hs-identifier hs-var">inconsistentRemoteSchemas</span></a></span><span>
</span><span id="line-398"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690770000"><span class="hs-identifier hs-var">duplicateRestVariables</span></a></span><span>
</span><span id="line-399"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769996"><span class="hs-identifier hs-var">invalidRestSegments</span></a></span><span>
</span><span id="line-400"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769982"><span class="hs-identifier hs-var">ambiguousRestEndpoints</span></a></span><span>
</span><span id="line-401"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769974"><span class="hs-identifier hs-var">endpointInconsistencies</span></a></span><span>
</span><span id="line-402"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769970"><span class="hs-identifier hs-var">cronTriggersInconsistencies</span></a></span><span>
</span><span id="line-403"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769969"><span class="hs-identifier hs-var">openTelemetryInconsistencies</span></a></span><span>
</span><span id="line-404"></span><span>              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769968"><span class="hs-identifier hs-var">inconsistentQueryCollections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-405"></span><span>          </span><span class="annot"><span class="annottext">scApiLimits :: ApiLimit
</span><a href="Hasura.RQL.Types.SchemaCache.html#scApiLimits"><span class="hs-identifier hs-var">scApiLimits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiLimit
</span><a href="#local-6989586621690770112"><span class="hs-identifier hs-var">_metaApiLimits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-406"></span><span>          </span><span class="annot"><span class="annottext">scMetricsConfig :: MetricsConfig
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetricsConfig"><span class="hs-identifier hs-var">scMetricsConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetricsConfig
</span><a href="#local-6989586621690770111"><span class="hs-identifier hs-var">_metaMetricsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-407"></span><span>          </span><span class="annot"><span class="annottext">scMetadataResourceVersion :: Maybe MetadataResourceVersion
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetadataResourceVersion"><span class="hs-identifier hs-var">scMetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-408"></span><span>          </span><span class="annot"><span class="annottext">scSetGraphqlIntrospectionOptions :: SetGraphqlIntrospectionOptions
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSetGraphqlIntrospectionOptions"><span class="hs-identifier hs-var">scSetGraphqlIntrospectionOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetGraphqlIntrospectionOptions
</span><a href="#local-6989586621690770109"><span class="hs-identifier hs-var">_metaSetGraphqlIntrospectionOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-409"></span><span>          </span><span class="annot"><span class="annottext">scTlsAllowlist :: [TlsAllow]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scTlsAllowlist"><span class="hs-identifier hs-var">scTlsAllowlist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Network -&gt; [TlsAllow]
</span><a href="Hasura.RQL.Types.Network.html#networkTlsAllowlist"><span class="hs-identifier hs-var">networkTlsAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621690770108"><span class="hs-identifier hs-var">_metaNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-410"></span><span>          </span><span class="annot"><span class="annottext">scQueryCollections :: QueryCollections
</span><a href="Hasura.RQL.Types.SchemaCache.html#scQueryCollections"><span class="hs-identifier hs-var">scQueryCollections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690770118"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-411"></span><span>          </span><span class="annot"><span class="annottext">scBackendCache :: BackendCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scBackendCache"><span class="hs-identifier hs-var">scBackendCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildOutputs -&gt; BackendCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boBackendCache"><span class="hs-identifier hs-var">_boBackendCache</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690770087"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-412"></span><span>          </span><span class="annot"><span class="annottext">scSourceHealthChecks :: SourceHealthCheckCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSourceHealthChecks"><span class="hs-identifier hs-var">scSourceHealthChecks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SourceHealthCheckCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildHealthCheckCache"><span class="hs-identifier hs-var">buildHealthCheckCache</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770120"><span class="hs-identifier hs-var">_metaSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><span class="annottext">scSourcePingConfig :: SourcePingCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSourcePingConfig"><span class="hs-identifier hs-var">scSourcePingConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata -&gt; SourcePingCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildSourcePingCache"><span class="hs-identifier hs-var">buildSourcePingCache</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690770120"><span class="hs-identifier hs-var">_metaSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-414"></span><span>          </span><span class="annot"><span class="annottext">scOpenTelemetryConfig :: OpenTelemetryInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scOpenTelemetryConfig"><span class="hs-identifier hs-var">scOpenTelemetryConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenTelemetryInfo
</span><a href="#local-6989586621690770067"><span class="hs-identifier hs-var">openTelemetryInfo</span></a></span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">-- See Note [Avoiding GraphQL schema rebuilds when changing irrelevant Metadata]</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621690770077"><span class="annot"><span class="annottext">buildOutputsAndSchema :: arr
  (Dependency Metadata, Dependency InvalidationKeys,
   Maybe StoredIntrospection)
  ([InconsistentMetadata],
   (BuildOutputs, [InconsistentMetadata], DepMap),
   ((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
     GQLContext, HashSet InconsistentMetadata),
    (HashMap RoleName (RoleContext GQLContext), GQLContext)))
</span><a href="#local-6989586621690770077"><span class="hs-identifier hs-var hs-var">buildOutputsAndSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769905"><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769905"><span class="hs-identifier hs-var">metadataDep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769904"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690769904"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769903"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690769903"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621690769902"><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769902"><span class="hs-identifier hs-var">outputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769901"><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata MetadataDependency)
</span><a href="#local-6989586621690769901"><span class="hs-identifier hs-var">collectedInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a b.
(Monoid w, Arrow arr) =&gt;
WriterA w arr a b -&gt; arr a (b, w)
</span><span class="hs-identifier hs-var">runWriterA</span></span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadError QErr m, MonadReader BuildReason m,
 MonadBaseControl IO m, ProvidesNetwork m, HasServerConfigCtx m,
 MonadResolveSource m) =&gt;
arr
  (Dependency Metadata, Dependency InvalidationKeys,
   Maybe StoredIntrospection)
  BuildOutputs
</span><a href="#local-6989586621690769899"><span class="hs-identifier hs-var">buildAndCollectInfo</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769905"><span class="hs-identifier hs-var">metadataDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690769904"><span class="hs-identifier hs-var">invalidationKeysDep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690769903"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769898"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769898"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769897"><span class="annot"><span class="annottext">[MetadataDependency]
</span><a href="#local-6989586621690769897"><span class="hs-identifier hs-var">unresolvedDependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Either InconsistentMetadata MetadataDependency)
</span><a href="#local-6989586621690769901"><span class="hs-identifier hs-var">collectedInfo</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span id="local-6989586621690769895"><span class="annot"><span class="annottext">out2 :: (BuildOutputs, [InconsistentMetadata], DepMap)
</span><a href="#local-6989586621690769895"><span class="hs-identifier hs-var">out2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621690769894"><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769894"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769893"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769893"><span class="hs-identifier hs-var">_dependencyInconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769892"><span class="annot"><span class="annottext">DepMap
</span><a href="#local-6989586621690769892"><span class="hs-identifier hs-var">_resolvedDependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *).
(ArrowKleisli m arr, QErrM m) =&gt;
arr
  (BuildOutputs, [MetadataDependency])
  (BuildOutputs, [InconsistentMetadata], DepMap)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Dependencies.html#resolveDependencies"><span class="hs-identifier hs-var">resolveDependencies</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769902"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MetadataDependency]
</span><a href="#local-6989586621690769897"><span class="hs-identifier hs-var">unresolvedDependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>      </span><span id="local-6989586621690769890"><span class="annot"><span class="annottext">((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
  GQLContext, HashSet InconsistentMetadata),
 (HashMap RoleName (RoleContext GQLContext), GQLContext))
</span><a href="#local-6989586621690769890"><span class="hs-identifier hs-var">out3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-423"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-424"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>            </span><span id="local-6989586621690769889"><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690769889"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-426"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadError QErr m, MonadIO m) =&gt;
ServerConfigCtx
-&gt; SourceCache
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
-&gt; ActionCache
-&gt; AnnotatedCustomTypes
-&gt; m ((SchemaIntrospection,
       HashMap RoleName (RoleContext GQLContext), GQLContext,
       HashSet InconsistentMetadata),
      (HashMap RoleName (RoleContext GQLContext), GQLContext))
</span><a href="Hasura.GraphQL.Schema.html#buildGQLContext"><span class="hs-identifier hs-var">buildGQLContext</span></a></span><span>
</span><span id="line-427"></span><span>              </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690769889"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-428"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs -&gt; SourceCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boSources"><span class="hs-identifier hs-var">_boSources</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769894"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs
-&gt; HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRemoteSchemas"><span class="hs-identifier hs-var">_boRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769894"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs -&gt; ActionCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boActions"><span class="hs-identifier hs-var">_boActions</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769894"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildOutputs -&gt; AnnotatedCustomTypes
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boCustomTypes"><span class="hs-identifier hs-var">_boCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">BuildOutputs
</span><a href="#local-6989586621690769894"><span class="hs-identifier hs-var">resolvedOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>      </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690769898"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(BuildOutputs, [InconsistentMetadata], DepMap)
</span><a href="#local-6989586621690769895"><span class="hs-identifier hs-var">out2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((SchemaIntrospection, HashMap RoleName (RoleContext GQLContext),
  GQLContext, HashSet InconsistentMetadata),
 (HashMap RoleName (RoleContext GQLContext), GQLContext))
</span><a href="#local-6989586621690769890"><span class="hs-identifier hs-var">out3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>    </span><span class="annot"><a href="#local-6989586621690769886"><span class="hs-identifier hs-type">resolveBackendInfo'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-435"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771469"><span class="annot"><a href="#local-6989586621690771469"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771468"><span class="annot"><a href="#local-6989586621690771468"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621690771471"><span class="annot"><a href="#local-6989586621690771471"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-436"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771471"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771469"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771468"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771469"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-439"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></span><span> </span><span class="annot"><a href="#local-6989586621690771469"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771469"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-441"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771468"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-442"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771468"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771468"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendConfigWrapper"><span class="hs-identifier hs-type">BackendConfigWrapper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771471"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier hs-type">BackendMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BackendInvalidationKeysWrapper"><span class="hs-identifier hs-type">BackendInvalidationKeysWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771469"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#BackendCache"><span class="hs-identifier hs-type">BackendCache</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621690769886"><span class="annot"><span class="annottext">resolveBackendInfo' :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(BackendMetadata b, ArrowChoice arr, ArrowCache m arr,
 ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (BackendConfigWrapper b,
   Dependency (BackendMap BackendInvalidationKeysWrapper))
  BackendCache
</span><a href="#local-6989586621690769886"><span class="hs-identifier hs-var hs-var">resolveBackendInfo'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769852"><span class="annot"><span class="annottext">BackendConfigWrapper b
</span><a href="#local-6989586621690769852"><span class="hs-identifier hs-var">backendConfigWrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769851"><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690769851"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769850"><span class="annot"><span class="annottext">backendInvalidationKeys :: Dependency (Maybe (BackendInvalidationKeys b))
</span><a href="#local-6989586621690769850"><span class="hs-identifier hs-var hs-var">backendInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-448"></span><span>            </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency (Maybe a) -&gt; Dependency (Maybe b)
</span><span class="hs-identifier hs-var">Inc.selectMaybeD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;unBackendInvalidationKeysWrapper&quot; a =&gt; a
</span><span class="">#unBackendInvalidationKeysWrapper</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-449"></span><span>              </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
Dependency (BackendMap i) -&gt; Dependency (Maybe (i b))
</span><a href="Hasura.SQL.BackendMap.html#lookupD"><span class="hs-identifier hs-var">BackendMap.lookupD</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771471"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690769851"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span id="local-6989586621690769847"><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621690769847"><span class="hs-identifier hs-var">backendInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(BackendMetadata b, ArrowChoice arr, ArrowCache m arr,
 ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, ProvidesNetwork m) =&gt;
Logger Hasura
-&gt; arr
     (Dependency (Maybe (BackendInvalidationKeys b)), BackendConfig b)
     (BackendInfo b)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#resolveBackendInfo"><span class="hs-identifier hs-var">resolveBackendInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771471"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770132"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (Maybe (BackendInvalidationKeys b))
</span><a href="#local-6989586621690769850"><span class="hs-identifier hs-var">backendInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendConfigWrapper b -&gt; BackendConfig b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendConfigWrapper"><span class="hs-identifier hs-var">unBackendConfigWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">BackendConfigWrapper b
</span><a href="#local-6989586621690769852"><span class="hs-identifier hs-var">backendConfigWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; BackendMap i
</span><a href="Hasura.SQL.BackendMap.html#singleton"><span class="hs-identifier hs-var">BackendMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). BackendInfo b -&gt; BackendInfoWrapper b
</span><a href="Hasura.RQL.Types.SchemaCache.html#BackendInfoWrapper"><span class="hs-identifier hs-var">BackendInfoWrapper</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771471"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621690769847"><span class="hs-identifier hs-var">backendInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="#local-6989586621690769842"><span class="hs-identifier hs-type">resolveBackendCache</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771439"><span class="annot"><a href="#local-6989586621690771439"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771438"><span class="annot"><a href="#local-6989586621690771438"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771439"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771438"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771439"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-457"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></span><span> </span><span class="annot"><a href="#local-6989586621690771439"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-458"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771439"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771438"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771438"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-461"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771438"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier hs-type">BackendMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BackendInvalidationKeysWrapper"><span class="hs-identifier hs-type">BackendInvalidationKeysWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendConfigWrapper"><span class="hs-identifier hs-type">BackendConfigWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771439"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#BackendCache"><span class="hs-identifier hs-type">BackendCache</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621690769842"><span class="annot"><span class="annottext">resolveBackendCache :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
</span><a href="#local-6989586621690769842"><span class="hs-identifier hs-var hs-var">resolveBackendCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769769"><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690769769"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769768"><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621690769768"><span class="hs-identifier hs-var">backendConfigs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621690769768"><span class="hs-identifier hs-var">backendConfigs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621690769767"><span class="annot"><span class="annottext">AnyBackend BackendConfigWrapper
</span><a href="#local-6989586621690769767"><span class="hs-identifier hs-var">anyBackendConfig</span></a></span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621690769766"><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621690769766"><span class="hs-identifier hs-var">backendConfigs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>          </span><span id="local-6989586621690769765"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690769765"><span class="hs-identifier hs-var">backendInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-469"></span><span>            </span><span class="annot"><span class="annottext">forall (c1 :: BackendType -&gt; Constraint)
       (c2 :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r
       (arr :: * -&gt; * -&gt; *) x.
(ArrowChoice arr, AllBackendsSatisfy c1, AllBackendsSatisfy c2) =&gt;
(forall (b :: BackendType). (c1 b, c2 b) =&gt; arr (i b, x) r)
-&gt; arr (AnyBackend i, x) r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackendArrow"><span class="hs-identifier hs-var">AB.dispatchAnyBackendArrow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.SQL.Tag.html#HasTag"><span class="hs-identifier hs-type">HasTag</span></a></span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(BackendMetadata b, ArrowChoice arr, ArrowCache m arr,
 ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (BackendConfigWrapper b,
   Dependency (BackendMap BackendInvalidationKeysWrapper))
  BackendCache
</span><a href="#local-6989586621690769886"><span class="hs-identifier hs-var">resolveBackendInfo'</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnyBackend BackendConfigWrapper
</span><a href="#local-6989586621690769767"><span class="hs-identifier hs-var">anyBackendConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690769769"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>          </span><span id="local-6989586621690769753"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690769753"><span class="hs-identifier hs-var">backendInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
</span><a href="#local-6989586621690769842"><span class="hs-identifier hs-var">resolveBackendCache</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690769769"><span class="hs-identifier hs-var">backendInvalidationMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AnyBackend BackendConfigWrapper]
</span><a href="#local-6989586621690769766"><span class="hs-identifier hs-var">backendConfigs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690769765"><span class="hs-identifier hs-var">backendInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690769753"><span class="hs-identifier hs-var">backendInfos</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="#local-6989586621690769752"><span class="hs-identifier hs-type">tryGetSourceConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771418"><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621690771420"><span class="annot"><a href="#local-6989586621690771420"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771419"><span class="annot"><a href="#local-6989586621690771419"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771420"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771419"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771420"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771420"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771419"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-479"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771419"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771419"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771419"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-484"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.InvalidationKey</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConnConfiguration"><span class="hs-identifier hs-type">SourceConnConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-487"></span><span>        </span><span class="annot"><a href="Hasura.SQL.Backend.html#BackendSourceKind"><span class="hs-identifier hs-type">BackendSourceKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-488"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#BackendInfo"><span class="hs-identifier hs-type">BackendInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>        </span><span class="annot"><a href="#local-6989586621690771420"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>    </span><span id="local-6989586621690769752"><span class="annot"><span class="annottext">tryGetSourceConfig :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, MonadResolveSource m,
 ProvidesNetwork m, BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey), SourceName,
   SourceConnConfiguration b, BackendSourceKind b, BackendInfo b)
  (Maybe (SourceConfig b))
</span><a href="#local-6989586621690769752"><span class="hs-identifier hs-var hs-var">tryGetSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><span class="hs-identifier hs-var">Inc.cache</span></span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769697"><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621690769697"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769696"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769696"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769695"><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621690769695"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769694"><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621690769694"><span class="hs-identifier hs-var">backendKind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769693"><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621690769693"><span class="hs-identifier hs-var">backendInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-492"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769692"><span class="annot"><span class="annottext">metadataObj :: MetadataObject
</span><a href="#local-6989586621690769692"><span class="hs-identifier hs-var hs-var">metadataObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-var">MOSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769696"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769696"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span class="hs-comment">-- TODO: if we make all of 'resolveSourceConfig' a Service, we could</span><span>
</span><span id="line-494"></span><span>      </span><span class="hs-comment">-- delegate to it the responsibility of extracting the HTTP manager, and</span><span>
</span><span id="line-495"></span><span>      </span><span class="hs-comment">-- avoid having to thread 'ProvidesNetwork' throughout the cache building</span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-comment">-- code.</span><span>
</span><span id="line-497"></span><span>      </span><span id="local-6989586621690769690"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690769690"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). ProvidesNetwork m =&gt; m Manager
</span><a href="Hasura.Services.Network.html#askHTTPManager"><span class="hs-identifier hs-var">askHTTPManager</span></a></span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a k v.
(Select a, Selector a ~ ConstS k v) =&gt;
k -&gt; Dependency a -&gt; Dependency v
</span><span class="hs-identifier hs-var">Inc.selectKeyD</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769696"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621690769697"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-glyph">(|</span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) md e s a.
(ArrowChoice arr,
 ArrowWriter (Seq (Either InconsistentMetadata md)) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var">withRecordInconsistency</span></a></span><span>
</span><span id="line-501"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) e a.
(ArrowChoice arr, ArrowError e arr) =&gt;
arr (Either e a) a
</span><span class="hs-identifier hs-var">liftEitherA</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadBaseControl IO m,
 MonadResolveSource m) =&gt;
Logger Hasura
-&gt; SourceName
-&gt; SourceConnConfiguration b
-&gt; BackendSourceKind b
-&gt; BackendInfo b
-&gt; Environment
-&gt; Manager
-&gt; m (Either QErr (SourceConfig b))
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#resolveSourceConfig"><span class="hs-identifier hs-var">resolveSourceConfig</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771418"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770132"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769696"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><a href="#local-6989586621690769695"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621690769694"><span class="hs-identifier hs-var">backendKind</span></a></span><span> </span><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621690769693"><span class="hs-identifier hs-var">backendInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690769690"><span class="hs-identifier hs-var">httpMgr</span></a></span><span>
</span><span id="line-502"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-glyph">|)</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690769692"><span class="hs-identifier hs-var">metadataObj</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><a href="#local-6989586621690769680"><span class="hs-identifier hs-type">tryResolveSource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-506"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771369"><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621690771371"><span class="annot"><a href="#local-6989586621690771371"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771370"><span class="annot"><a href="#local-6989586621690771370"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771371"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771370"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771371"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-509"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771371"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-510"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-511"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-512"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-513"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771370"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.InvalidationKey</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BackendIntrospection"><span class="hs-identifier hs-type">BackendIntrospection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>        </span><span class="annot"><a href="#local-6989586621690771371"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#DBObjectsIntrospection"><span class="hs-identifier hs-type">DBObjectsIntrospection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>    </span><span id="local-6989586621690769680"><span class="annot"><span class="annottext">tryResolveSource :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, MonadResolveSource m,
 ProvidesNetwork m, BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey),
   Maybe (BackendIntrospection b), BackendInfoAndSourceMetadata b)
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
</span><a href="#local-6989586621690769680"><span class="hs-identifier hs-var hs-var">tryResolveSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><span class="hs-identifier hs-var">Inc.cache</span></span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769623"><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621690769623"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769622"><span class="annot"><span class="annottext">Maybe (BackendIntrospection b)
</span><a href="#local-6989586621690769622"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690769619"><span id="local-6989586621690769620"><span class="annot"><span class="annottext">BackendInfo b
SourceMetadata b
_bcasmSourceMetadata :: forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
_bcasmBackendInfo :: forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; BackendInfo b
_bcasmSourceMetadata :: SourceMetadata b
_bcasmBackendInfo :: BackendInfo b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmSourceMetadata"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-522"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769616"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621690769616"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690769619"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span>
</span><span id="line-523"></span><span>          </span><span id="local-6989586621690769615"><span class="annot"><span class="annottext">metadataObj :: MetadataObject
</span><a href="#local-6989586621690769615"><span class="hs-identifier hs-var hs-var">metadataObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-var">MOSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769616"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769616"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>      </span><span id="local-6989586621690769614"><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><a href="#local-6989586621690769614"><span class="hs-identifier hs-var">maybeSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, MonadResolveSource m,
 ProvidesNetwork m, BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey), SourceName,
   SourceConnConfiguration b, BackendSourceKind b, BackendInfo b)
  (Maybe (SourceConfig b))
</span><a href="#local-6989586621690769752"><span class="hs-identifier hs-var">tryGetSourceConfig</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771369"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621690769623"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769616"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690769619"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; BackendSourceKind b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smKind"><span class="hs-identifier hs-var">_smKind</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690769619"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BackendInfo b
</span><a href="#local-6989586621690769620"><span class="hs-identifier hs-var">_bcasmBackendInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><a href="#local-6989586621690769614"><span class="hs-identifier hs-var">maybeSourceConfig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-528"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690769612"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769612"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-529"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendIntrospection b -&gt; DBObjectsIntrospection b
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#biMetadata"><span class="hs-identifier hs-var">biMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (BackendIntrospection b)
</span><a href="#local-6989586621690769622"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-530"></span><span>            </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690769610"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690769610"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769612"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690769610"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>            </span><span class="annot"><span class="annottext">Maybe (DBObjectsIntrospection b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-532"></span><span>              </span><span class="hs-glyph">(|</span><span>
</span><span id="line-533"></span><span>                </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) md e s a.
(ArrowChoice arr,
 ArrowWriter (Seq (Either InconsistentMetadata md)) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var">withRecordInconsistency</span></a></span><span>
</span><span id="line-534"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) e a.
(ArrowChoice arr, ArrowError e arr) =&gt;
arr (Either e a) a
</span><span class="hs-identifier hs-var">liftEitherA</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-535"></span><span>                      </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>                        </span><span id="local-6989586621690769607"><span class="annot"><span class="annottext">Either QErr (DBObjectsIntrospection b)
</span><a href="#local-6989586621690769607"><span class="hs-identifier hs-var">resSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadBaseControl IO m,
 MonadResolveSource m) =&gt;
SourceMetadata b
-&gt; SourceConfig b -&gt; m (Either QErr (DBObjectsIntrospection b))
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#resolveDatabaseMetadata"><span class="hs-identifier hs-var">resolveDatabaseMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690769619"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769612"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-537"></span><span>                        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (DBObjectsIntrospection b)
</span><a href="#local-6989586621690769607"><span class="hs-identifier hs-var">resSource</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770132"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-538"></span><span>                        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769612"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (DBObjectsIntrospection b)
</span><a href="#local-6989586621690769607"><span class="hs-identifier hs-var">resSource</span></a></span><span>
</span><span id="line-539"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>              </span><span class="hs-glyph">|)</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690769615"><span class="hs-identifier hs-var">metadataObj</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-comment">-- impl notes (swann):</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-comment">-- as our cache invalidation key, we use the fact of the availability of event triggers</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-comment">-- present, rerunning catalog init when this changes. i.e we invalidate the cache and</span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-comment">-- rebuild it with the catalog only when there is at least one event trigger present.</span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-comment">-- This is correct, because we only care about the transition from zero event triggers</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-comment">-- to nonzero (not necessarily one, as Anon has observed, because replace_metadata can</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-comment">-- add multiple event triggers in one go)</span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-comment">-- a future optimisation would be to cache, on a per-source basis, whether or not</span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-comment">-- the event catalog itself exists, and to then trigger catalog init when an event</span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-comment">-- trigger is created _but only if_ this cached information says the event catalog</span><span>
</span><span id="line-554"></span><span>    </span><span class="hs-comment">-- doesn't already exist.</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><a href="#local-6989586621690769602"><span class="hs-identifier hs-type">initCatalogIfNeeded</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-557"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771346"><span class="annot"><a href="#local-6989586621690771346"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621690771348"><span class="annot"><a href="#local-6989586621690771348"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771347"><span class="annot"><a href="#local-6989586621690771347"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-558"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771348"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-559"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771347"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771348"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-560"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771347"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-561"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771346"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-562"></span><span>        </span><span class="annot"><a href="Hasura.Server.Types.html#HasServerConfigCtx"><span class="hs-identifier hs-type">HasServerConfigCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771347"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-563"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771347"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-564"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771347"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771346"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771346"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771348"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#RecreateEventTriggers"><span class="hs-identifier hs-type">RecreateEventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Migrate.Version.html#SourceCatalogMigrationState"><span class="hs-identifier hs-type">SourceCatalogMigrationState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>    </span><span id="local-6989586621690769602"><span class="annot"><span class="annottext">initCatalogIfNeeded :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, MonadIO m, BackendMetadata b,
 HasServerConfigCtx m, MonadError QErr m, MonadBaseControl IO m) =&gt;
arr
  (Proxy b, Bool, SourceConfig b)
  (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="#local-6989586621690769602"><span class="hs-identifier hs-var hs-var">initCatalogIfNeeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><span class="hs-identifier hs-var">Inc.cache</span></span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769538"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690769538"><span class="hs-identifier hs-var">atleastOneTrigger</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769537"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769537"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-570"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690769538"><span class="hs-identifier hs-var">atleastOneTrigger</span></a></span><span>
</span><span id="line-571"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>              </span><span id="local-6989586621690769536"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621690769536"><span class="hs-identifier hs-var">maintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.Types.html#_sccMaintenanceMode"><span class="hs-identifier hs-var">_sccMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-573"></span><span>              </span><span id="local-6989586621690769534"><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621690769534"><span class="hs-identifier hs-var">eventingMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; EventingMode
</span><a href="Hasura.Server.Types.html#_sccEventingMode"><span class="hs-identifier hs-var">_sccEventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-574"></span><span>              </span><span id="local-6989586621690769532"><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621690769532"><span class="hs-identifier hs-var">readOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.Types.html#_sccReadOnlyMode"><span class="hs-identifier hs-var">_sccReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>              </span><span class="hs-keyword">if</span><span>
</span><span id="line-577"></span><span>                  </span><span class="hs-comment">-- when safe mode is enabled, don't perform any migrations</span><span>
</span><span id="line-578"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621690769532"><span class="hs-identifier hs-var">readOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeEnabled"><span class="hs-identifier hs-var">ReadOnlyModeEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSMigrationOnHold"><span class="hs-identifier hs-var">SCMSMigrationOnHold</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;read-only mode enabled&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>                  </span><span class="hs-comment">-- when eventing mode is disabled, don't perform any migrations</span><span>
</span><span id="line-580"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621690769534"><span class="hs-identifier hs-var">eventingMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingDisabled"><span class="hs-identifier hs-var">EventingDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSMigrationOnHold"><span class="hs-identifier hs-var">SCMSMigrationOnHold</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;eventing mode disabled&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>                  </span><span class="hs-comment">-- when maintenance mode is enabled, don't perform any migrations</span><span>
</span><span id="line-582"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621690769536"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; MaintenanceMode a
</span><a href="Hasura.Server.Types.html#MaintenanceModeEnabled"><span class="hs-identifier hs-var">MaintenanceModeEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSMigrationOnHold"><span class="hs-identifier hs-var">SCMSMigrationOnHold</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;maintenance mode enabled&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-584"></span><span>                      </span><span class="hs-comment">-- The `initCatalogForSource` action is retried here because</span><span>
</span><span id="line-585"></span><span>                      </span><span class="hs-comment">-- in cloud there will be multiple workers (graphql-engine instances)</span><span>
</span><span id="line-586"></span><span>                      </span><span class="hs-comment">-- trying to migrate the source catalog, when needed. This introduces</span><span>
</span><span id="line-587"></span><span>                      </span><span class="hs-comment">-- a race condition as both the workers try to migrate the source catalog</span><span>
</span><span id="line-588"></span><span>                      </span><span class="hs-comment">-- concurrently and when one of them succeeds the other ones will fail</span><span>
</span><span id="line-589"></span><span>                      </span><span class="hs-comment">-- and be in an inconsistent state. To avoid the inconsistency, we retry</span><span>
</span><span id="line-590"></span><span>                      </span><span class="hs-comment">-- migrating the catalog on error and in the retry `initCatalogForSource`</span><span>
</span><span id="line-591"></span><span>                      </span><span class="hs-comment">-- will see that the catalog is already migrated, so it won't attempt the</span><span>
</span><span id="line-592"></span><span>                      </span><span class="hs-comment">-- migration again</span><span>
</span><span id="line-593"></span><span>                      </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span>
</span><span id="line-594"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadIO m =&gt;
RetryPolicyM m
-&gt; (RetryStatus -&gt; b -&gt; m Bool) -&gt; (RetryStatus -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">Retry.retrying</span></span><span>
</span><span id="line-595"></span><span>                          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; Int -&gt; RetryPolicyM m
</span><span class="hs-identifier hs-var">Retry.constantDelay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Integer
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">diffTimeToMicroSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds -&gt; DiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">seconds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Seconds
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">Seconds</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; RetryPolicy
</span><span class="hs-identifier hs-var">Retry.limitRetries</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-597"></span><span>                          </span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Either a b -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">isLeft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadIO m, MonadBaseControl IO m) =&gt;
SourceConfig b
-&gt; ExceptT
     QErr m (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#prepareCatalog"><span class="hs-identifier hs-var">prepareCatalog</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771346"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769537"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="Hasura.Server.Migrate.Version.html#SCMSUninitializedSource"><span class="hs-identifier hs-var">SCMSUninitializedSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><a href="#local-6989586621690769514"><span class="hs-identifier hs-type">buildSource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-603"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771307"><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621690771309"><span class="annot"><a href="#local-6989586621690771309"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771308"><span class="annot"><a href="#local-6989586621690771308"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-604"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771309"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowKleisli</span></span><span> </span><span class="annot"><a href="#local-6989586621690771308"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771309"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771309"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>        </span><span class="annot"><a href="Hasura.Server.Types.html#HasServerConfigCtx"><span class="hs-identifier hs-type">HasServerConfigCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771308"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771308"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-610"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#GetAggregationPredicatesDeps"><span class="hs-identifier hs-type">GetAggregationPredicatesDeps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-611"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-613"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-615"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#TableCoreInfoG"><span class="hs-identifier hs-type">TableCoreInfoG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-616"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerInfoMap"><span class="hs-identifier hs-type">EventTriggerInfoMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-617"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#DBTablesMetadata"><span class="hs-identifier hs-type">DBTablesMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Function.html#DBFunctionsMetadata"><span class="hs-identifier hs-type">DBFunctionsMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-619"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#PartiallyResolvedRemoteSchemaMap"><span class="hs-identifier hs-type">PartiallyResolvedRemoteSchemaMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-620"></span><span>        </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#OrderedRoles"><span class="hs-identifier hs-type">OrderedRoles</span></a></span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>        </span><span class="annot"><a href="#local-6989586621690771309"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>    </span><span id="local-6989586621690769514"><span class="annot"><span class="annottext">buildSource :: forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowKleisli m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 HasServerConfigCtx m, MonadError QErr m, BackendMetadata b,
 GetAggregationPredicatesDeps b) =&gt;
arr
  (HashMap SourceName (AnyBackend PartiallyResolvedSource),
   SourceMetadata b, SourceConfig b,
   HashMap
     (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)),
   HashMap (TableName b) (EventTriggerInfoMap b), DBTablesMetadata b,
   DBFunctionsMetadata b, PartiallyResolvedRemoteSchemaMap,
   OrderedRoles)
  (SourceInfo b)
</span><a href="#local-6989586621690769514"><span class="hs-identifier hs-var hs-var">buildSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769399"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690769399"><span class="hs-identifier hs-var">allSources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769398"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690769398"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769397"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769397"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769396"><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690769396"><span class="hs-identifier hs-var">tablesRawInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769395"><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621690769395"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769394"><span class="annot"><span class="annottext">DBTablesMetadata b
</span><a href="#local-6989586621690769394"><span class="hs-identifier hs-var">_dbTables</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769393"><span class="annot"><span class="annottext">DBFunctionsMetadata b
</span><a href="#local-6989586621690769393"><span class="hs-identifier hs-var">dbFunctions</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769392"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690769392"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769391"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769391"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-624"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span id="local-6989586621690769389"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621690769388"><span class="annot"><span class="annottext">BackendSourceKind b
</span><a href="#local-6989586621690769388"><span class="hs-identifier hs-var">_backendKind</span></a></span></span><span> </span><span id="local-6989586621690769387"><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621690769387"><span class="hs-identifier hs-var">tables</span></a></span></span><span> </span><span id="local-6989586621690769386"><span class="annot"><span class="annottext">Functions b
</span><a href="#local-6989586621690769386"><span class="hs-identifier hs-var">functions</span></a></span></span><span> </span><span id="local-6989586621690769385"><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621690769385"><span class="hs-identifier hs-var">customSQL</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690769384"><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><a href="#local-6989586621690769384"><span class="hs-identifier hs-var">queryTagsConfig</span></a></span></span><span> </span><span id="local-6989586621690769383"><span class="annot"><span class="annottext">SourceCustomization
</span><a href="#local-6989586621690769383"><span class="hs-identifier hs-var">sourceCustomization</span></a></span></span><span> </span><span id="local-6989586621690769382"><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
</span><a href="#local-6989586621690769382"><span class="hs-identifier hs-var">_healthCheckConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690769398"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-625"></span><span>          </span><span id="local-6989586621690769381"><span class="annot"><span class="annottext">tablesMetadata :: [TableMetadata b]
</span><a href="#local-6989586621690769381"><span class="hs-identifier hs-var hs-var">tablesMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621690769387"><span class="hs-identifier hs-var">tables</span></a></span><span>
</span><span id="line-626"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TableBuildInput b]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769380"><span class="annot"><span class="annottext">[NonColumnTableInputs b]
</span><a href="#local-6989586621690769380"><span class="hs-identifier hs-var">nonColumnInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769379"><span class="annot"><span class="annottext">[TablePermissionInputs b]
</span><a href="#local-6989586621690769379"><span class="hs-identifier hs-var">permissions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unzip3</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableMetadata b
-&gt; (TableBuildInput b, NonColumnTableInputs b,
    TablePermissionInputs b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#mkTableInputs"><span class="hs-identifier hs-var">mkTableInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TableMetadata b]
</span><a href="#local-6989586621690769381"><span class="hs-identifier hs-var">tablesMetadata</span></a></span><span>
</span><span id="line-627"></span><span>          </span><span id="local-6989586621690771252"><span id="local-6989586621690771253"><span class="annot"><a href="#local-6989586621690769376"><span class="hs-identifier hs-type">alignTableMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771253"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771252"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621690771253"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621690771252"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-628"></span><span>          </span><span id="local-6989586621690769376"><span class="annot"><span class="annottext">alignTableMap :: forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621690769376"><span class="hs-identifier hs-var hs-var">alignTableMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v1 v2 v3.
(Eq k, Hashable k) =&gt;
(v1 -&gt; v2 -&gt; v3) -&gt; HashMap k v1 -&gt; HashMap k v2 -&gt; HashMap k v3
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>      </span><span class="hs-comment">-- relationships and computed fields</span><span>
</span><span id="line-631"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769372"><span class="annot"><span class="annottext">nonColumnsByTable :: HashMap (TableName b) (NonColumnTableInputs b)
</span><a href="#local-6989586621690769372"><span class="hs-identifier hs-var hs-var">nonColumnsByTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). NonColumnTableInputs b -&gt; TableName b
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_nctiTable"><span class="hs-identifier hs-var">_nctiTable</span></a></span><span> </span><span class="annot"><span class="annottext">[NonColumnTableInputs b]
</span><a href="#local-6989586621690769380"><span class="hs-identifier hs-var">nonColumnInputs</span></a></span><span>
</span><span id="line-632"></span><span>      </span><span id="local-6989586621690769369"><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621690769369"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#TableCoreInfo"><span class="hs-identifier hs-type">TableCoreInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><span class="hs-identifier hs-var">interpretWriter</span></span><span>
</span><span id="line-634"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690769396"><span class="hs-identifier hs-var">tablesRawInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621690769376"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (NonColumnTableInputs b)
</span><a href="#local-6989586621690769372"><span class="hs-identifier hs-var">nonColumnsByTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621690769366"><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690769366"><span class="hs-identifier hs-var">tableRawInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769365"><span class="annot"><span class="annottext">NonColumnTableInputs b
</span><a href="#local-6989586621690769365"><span class="hs-identifier hs-var">nonColumnInput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-635"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769364"><span class="annot"><span class="annottext">columns :: FieldInfoMap (ColumnInfo b)
</span><a href="#local-6989586621690769364"><span class="hs-identifier hs-var hs-var">columns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.RQL.Types.Table.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690769366"><span class="hs-identifier hs-var">tableRawInfo</span></a></span><span>
</span><span id="line-636"></span><span>            </span><span id="local-6989586621690769362"><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621690769362"><span class="hs-identifier hs-var">allFields</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfoMap"><span class="hs-identifier hs-type">FieldInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Table.html#FieldInfo"><span class="hs-identifier hs-type">FieldInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(MonadWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) m,
 BackendMetadata b) =&gt;
HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; SourceName
-&gt; HashMap
     (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
-&gt; FieldInfoMap (ColumnInfo b)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; DBFunctionsMetadata b
-&gt; NonColumnTableInputs b
-&gt; m (FieldInfoMap (FieldInfo b))
</span><a href="Hasura.RQL.DDL.Schema.Cache.Fields.html#addNonColumnFields"><span class="hs-identifier hs-var">addNonColumnFields</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690769399"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690769396"><span class="hs-identifier hs-var">tablesRawInfo</span></a></span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (ColumnInfo b)
</span><a href="#local-6989586621690769364"><span class="hs-identifier hs-var">columns</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690769392"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span> </span><span class="annot"><span class="annottext">DBFunctionsMetadata b
</span><a href="#local-6989586621690769393"><span class="hs-identifier hs-var">dbFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">NonColumnTableInputs b
</span><a href="#local-6989586621690769365"><span class="hs-identifier hs-var">nonColumnInput</span></a></span><span>
</span><span id="line-637"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690769366"><span class="hs-identifier hs-var">tableRawInfo</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_tciFieldInfoMap :: FieldInfoMap (FieldInfo b)
</span><a href="Hasura.RQL.Types.Table.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621690769362"><span class="hs-identifier hs-var">allFields</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>      </span><span class="hs-comment">-- permissions</span><span>
</span><span id="line-640"></span><span>      </span><span id="local-6989586621690769360"><span class="annot"><span class="annottext">Either QErr (HashMap (TableName b) (TableInfo b))
</span><a href="#local-6989586621690769360"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-641"></span><span>        </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><span class="hs-identifier hs-var">interpretWriter</span></span><span>
</span><span id="line-642"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-643"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span>
</span><span id="line-644"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621690769369"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span><span> </span><span class="annot"><span class="annottext">forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621690769376"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). TablePermissionInputs b -&gt; TableName b
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_tpiTable"><span class="hs-identifier hs-var">_tpiTable</span></a></span><span> </span><span class="annot"><span class="annottext">[TablePermissionInputs b]
</span><a href="#local-6989586621690769379"><span class="hs-identifier hs-var">permissions</span></a></span><span> </span><span class="annot"><span class="annottext">forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621690769376"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621690769395"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>              </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621690769358"><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621690769358"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769357"><span class="annot"><span class="annottext">TablePermissionInputs b
</span><a href="#local-6989586621690769357"><span class="hs-identifier hs-var">permissionInputs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769356"><span class="annot"><span class="annottext">EventTriggerInfoMap b
</span><a href="#local-6989586621690769356"><span class="hs-identifier hs-var">eventTriggerInfos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-646"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769355"><span class="annot"><span class="annottext">tableFields :: FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621690769355"><span class="hs-identifier hs-var hs-var">tableFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.RQL.Types.Table.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621690769358"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span>
</span><span id="line-647"></span><span>                </span><span id="local-6989586621690769354"><span class="annot"><span class="annottext">RolePermInfoMap b
</span><a href="#local-6989586621690769354"><span class="hs-identifier hs-var">permissionInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-648"></span><span>                  </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(MonadError QErr m,
 MonadWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) m,
 BackendMetadata b, GetAggregationPredicatesDeps b) =&gt;
SourceName
-&gt; TableCoreCache b
-&gt; FieldInfoMap (FieldInfo b)
-&gt; TablePermissionInputs b
-&gt; OrderedRoles
-&gt; m (RolePermInfoMap b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#buildTablePermissions"><span class="hs-identifier hs-var">buildTablePermissions</span></a></span><span>
</span><span id="line-649"></span><span>                    </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-650"></span><span>                    </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableCoreInfo b)
</span><a href="#local-6989586621690769369"><span class="hs-identifier hs-var">tableCoreInfos</span></a></span><span>
</span><span id="line-651"></span><span>                    </span><span class="annot"><span class="annottext">FieldInfoMap (FieldInfo b)
</span><a href="#local-6989586621690769355"><span class="hs-identifier hs-var">tableFields</span></a></span><span>
</span><span id="line-652"></span><span>                    </span><span class="annot"><span class="annottext">TablePermissionInputs b
</span><a href="#local-6989586621690769357"><span class="hs-identifier hs-var">permissionInputs</span></a></span><span>
</span><span id="line-653"></span><span>                    </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769391"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-654"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableCoreInfo b
-&gt; RolePermInfoMap b
-&gt; EventTriggerInfoMap b
-&gt; RolePermInfo b
-&gt; TableInfo b
</span><a href="Hasura.RQL.Types.Table.html#TableInfo"><span class="hs-identifier hs-var">TableInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621690769358"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RolePermInfoMap b
</span><a href="#local-6989586621690769354"><span class="hs-identifier hs-var">permissionInfos</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerInfoMap b
</span><a href="#local-6989586621690769356"><span class="hs-identifier hs-var">eventTriggerInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
TableCoreInfo b -&gt; RolePermInfo b
</span><a href="Hasura.RQL.Types.Table.html#mkAdminRolePermInfo"><span class="hs-identifier hs-var">mkAdminRolePermInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfo b
</span><a href="#local-6989586621690769358"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>      </span><span class="hs-comment">-- Generate a non-recoverable error when inherited roles were not ordered in a way that allows for building permissions to succeed</span><span>
</span><span id="line-656"></span><span>      </span><span id="local-6989586621690769350"><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621690769350"><span class="hs-identifier hs-var">tableCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (HashMap (TableName b) (TableInfo b))
</span><a href="#local-6989586621690769360"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-comment">-- not forcing the evaluation here results in a measurable negative impact</span><span>
</span><span id="line-659"></span><span>      </span><span class="hs-comment">-- on memory residency as measured by our benchmark</span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621690769349"><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769349"><span class="hs-identifier hs-var">defaultNC</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; NamingCase
</span><a href="Hasura.Server.Types.html#_sccDefaultNamingConvention"><span class="hs-identifier hs-var">_sccDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-661"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621690769347"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690769347"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFNamingConventions"><span class="hs-identifier hs-var">EFNamingConventions</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.Server.Types.html#_sccExperimentalFeatures"><span class="hs-identifier hs-var">_sccExperimentalFeatures</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621690769344"><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769344"><span class="hs-identifier hs-var">namingConv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-663"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-664"></span><span>          </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-665"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690769347"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span><span>
</span><span id="line-666"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
SourceCustomization
-&gt; SupportedNamingCase -&gt; NamingCase -&gt; m NamingCase
</span><a href="Hasura.RQL.Types.SourceCustomization.html#getNamingCase"><span class="hs-identifier hs-var">getNamingCase</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCustomization
</span><a href="#local-6989586621690769383"><span class="hs-identifier hs-var">sourceCustomization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). Backend b =&gt; SupportedNamingCase
</span><a href="Hasura.RQL.Types.Backend.html#namingConventionSupport"><span class="hs-identifier hs-var">namingConventionSupport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769349"><span class="hs-identifier hs-var">defaultNC</span></a></span><span>
</span><span id="line-667"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="Hasura.GraphQL.Schema.NamingCase.html#HasuraCase"><span class="hs-identifier hs-var">HasuraCase</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769340"><span class="annot"><span class="annottext">resolvedCustomization :: ResolvedSourceCustomization
</span><a href="#local-6989586621690769340"><span class="hs-identifier hs-var hs-var">resolvedCustomization</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceCustomization -&gt; NamingCase -&gt; ResolvedSourceCustomization
</span><a href="Hasura.RQL.Types.SourceCustomization.html#mkResolvedSourceCustomization"><span class="hs-identifier hs-var">mkResolvedSourceCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCustomization
</span><a href="#local-6989586621690769383"><span class="hs-identifier hs-var">sourceCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769344"><span class="hs-identifier hs-var">namingConv</span></a></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-comment">-- sql functions</span><span>
</span><span id="line-671"></span><span>      </span><span id="local-6989586621690769338"><span class="annot"><span class="annottext">[Maybe (FunctionInfo b)]
</span><a href="#local-6989586621690769338"><span class="hs-identifier hs-var">functionCacheMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-672"></span><span>        </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><span class="hs-identifier hs-var">interpretWriter</span></span><span>
</span><span id="line-673"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span>
</span><span id="line-674"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">Functions b
</span><a href="#local-6989586621690769386"><span class="hs-identifier hs-var">functions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>            </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-676"></span><span>              </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#FunctionMetadata"><span class="hs-identifier hs-type">FunctionMetadata</span></a></span><span> </span><span id="local-6989586621690769336"><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span></span><span> </span><span id="local-6989586621690769335"><span class="annot"><span class="annottext">FunctionConfig
</span><a href="#local-6989586621690769335"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621690769334"><span class="annot"><span class="annottext">[FunctionPermissionInfo]
</span><a href="#local-6989586621690769334"><span class="hs-identifier hs-var">functionPermissions</span></a></span></span><span> </span><span id="local-6989586621690769333"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690769333"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-677"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769332"><span class="annot"><span class="annottext">systemDefined :: SystemDefined
</span><a href="#local-6989586621690769332"><span class="hs-identifier hs-var hs-var">systemDefined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SystemDefined
</span><a href="Hasura.RQL.Types.Common.html#SystemDefined"><span class="hs-identifier hs-var">SystemDefined</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-678"></span><span>                    </span><span id="local-6989586621690769330"><span class="annot"><span class="annottext">definition :: TrackFunction b
</span><a href="#local-6989586621690769330"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; TrackFunction b
</span><a href="Hasura.RQL.DDL.Schema.Function.html#TrackFunction"><span class="hs-identifier hs-var">TrackFunction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-679"></span><span>                    </span><span id="local-6989586621690769328"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621690769328"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-680"></span><span>                      </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-681"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-682"></span><span>                            </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-683"></span><span>                              </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOFunction"><span class="hs-identifier hs-var">SMOFunction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-684"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">TrackFunction b
</span><a href="#local-6989586621690769330"><span class="hs-identifier hs-var">definition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>                    </span><span id="local-6989586621690769324"><span class="annot"><span class="annottext">schemaObject :: SchemaObjId
</span><a href="#local-6989586621690769324"><span class="hs-identifier hs-var hs-var">schemaObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-687"></span><span>                      </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-688"></span><span>                        </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-689"></span><span>                          </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionName b -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOIFunction"><span class="hs-identifier hs-var">SOIFunction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-690"></span><span>                    </span><span id="local-6989586621690769321"><span class="annot"><span class="annottext">addFunctionContext :: Text -&gt; Text
</span><a href="#local-6989586621690769321"><span class="hs-identifier hs-var hs-var">addFunctionContext</span></a></span></span><span> </span><span id="local-6989586621690769320"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690769320"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in function &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690769320"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-691"></span><span>                    </span><span id="local-6989586621690769318"><span class="annot"><span class="annottext">metadataPermissions :: HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621690769318"><span class="hs-identifier hs-var hs-var">metadataPermissions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionPermissionInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Function.html#_fpmRole"><span class="hs-identifier hs-var">_fpmRole</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionPermissionInfo]
</span><a href="#local-6989586621690769334"><span class="hs-identifier hs-var">functionPermissions</span></a></span><span>
</span><span id="line-692"></span><span>                    </span><span id="local-6989586621690769316"><span class="annot"><span class="annottext">permissionsMap :: HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621690769316"><span class="hs-identifier hs-var hs-var">permissionsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(RoleName -&gt; a)
-&gt; HashMap RoleName a -&gt; OrderedRoles -&gt; HashMap RoleName a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#mkBooleanPermissionMap"><span class="hs-identifier hs-var">mkBooleanPermissionMap</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; FunctionPermissionInfo
</span><a href="Hasura.RQL.Types.Function.html#FunctionPermissionInfo"><span class="hs-identifier hs-var">FunctionPermissionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621690769318"><span class="hs-identifier hs-var">metadataPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769391"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-693"></span><span>                </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690769328"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690769321"><span class="hs-identifier hs-var">addFunctionContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>                  </span><span id="local-6989586621690769312"><span class="annot"><span class="annottext">FunctionOverloads b
</span><a href="#local-6989586621690769312"><span class="hs-identifier hs-var">funcDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-695"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-696"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">DBFunctionsMetadata b
</span><a href="#local-6989586621690769393"><span class="hs-identifier hs-var">dbFunctions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no such function exists: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall t. ToTxt t =&gt; Text -&gt; t -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>                  </span><span id="local-6989586621690769306"><span class="annot"><span class="annottext">RawFunctionInfo b
</span><a href="#local-6989586621690769306"><span class="hs-identifier hs-var">rawfunctionInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(QErrM m, Backend b) =&gt;
FunctionName b -&gt; FunctionOverloads b -&gt; m (RawFunctionInfo b)
</span><a href="Hasura.RQL.DDL.Schema.Function.html#getSingleUniqueFunctionOverload"><span class="hs-identifier hs-var">getSingleUniqueFunctionOverload</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771307"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOverloads b
</span><a href="#local-6989586621690769312"><span class="hs-identifier hs-var">funcDefs</span></a></span><span>
</span><span id="line-700"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621690769304"><span class="annot"><span class="annottext">FunctionInfo b
</span><a href="#local-6989586621690769304"><span class="hs-identifier hs-var">functionInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769303"><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621690769303"><span class="hs-identifier hs-var">dep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendMetadata b, MonadError QErr m) =&gt;
SourceName
-&gt; FunctionName b
-&gt; SystemDefined
-&gt; FunctionConfig
-&gt; HashMap RoleName FunctionPermissionInfo
-&gt; RawFunctionInfo b
-&gt; Maybe Text
-&gt; NamingCase
-&gt; m (FunctionInfo b, SchemaDependency)
</span><a href="Hasura.RQL.Types.Metadata.Backend.html#buildFunctionInfo"><span class="hs-identifier hs-var">buildFunctionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621690769336"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">SystemDefined
</span><a href="#local-6989586621690769332"><span class="hs-identifier hs-var">systemDefined</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionConfig
</span><a href="#local-6989586621690769335"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName FunctionPermissionInfo
</span><a href="#local-6989586621690769316"><span class="hs-identifier hs-var">permissionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">RawFunctionInfo b
</span><a href="#local-6989586621690769306"><span class="hs-identifier hs-var">rawfunctionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690769333"><span class="hs-identifier hs-var">comment</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769344"><span class="hs-identifier hs-var">namingConv</span></a></span><span>
</span><span id="line-701"></span><span>                  </span><span class="annot"><span class="annottext">forall im (m :: * -&gt; *).
MonadWriter (Seq (Either im MetadataDependency)) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690769328"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621690769324"><span class="hs-identifier hs-var">schemaObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Seq a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Seq.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621690769303"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>                  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionInfo b
</span><a href="#local-6989586621690769304"><span class="hs-identifier hs-var">functionInfo</span></a></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769299"><span class="annot"><span class="annottext">functionCache :: HashMap (FunctionName b) (FunctionInfo b)
</span><a href="#local-6989586621690769299"><span class="hs-identifier hs-var hs-var">functionCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). FunctionInfo b -&gt; FunctionName b
</span><a href="Hasura.RQL.Types.Function.html#_fiSQLName"><span class="hs-identifier hs-var">_fiSQLName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (FunctionInfo b)]
</span><a href="#local-6989586621690769338"><span class="hs-identifier hs-var">functionCacheMaybes</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>      </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceName
-&gt; TableCache b
-&gt; FunctionCache b
-&gt; LogicalModels b
-&gt; SourceConfig b
-&gt; Maybe QueryTagsConfig
-&gt; ResolvedSourceCustomization
-&gt; SourceInfo b
</span><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-var">SourceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690769389"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (TableInfo b)
</span><a href="#local-6989586621690769350"><span class="hs-identifier hs-var">tableCache</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (FunctionName b) (FunctionInfo b)
</span><a href="#local-6989586621690769299"><span class="hs-identifier hs-var">functionCache</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621690769385"><span class="hs-identifier hs-var">customSQL</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690769397"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><a href="#local-6989586621690769384"><span class="hs-identifier hs-var">queryTagsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedSourceCustomization
</span><a href="#local-6989586621690769340"><span class="hs-identifier hs-var">resolvedCustomization</span></a></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span>    </span><span class="annot"><a href="#local-6989586621690769899"><span class="hs-identifier hs-type">buildAndCollectInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-709"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771480"><span class="annot"><a href="#local-6989586621690771480"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771479"><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-710"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771480"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-711"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></span><span> </span><span class="annot"><a href="#local-6989586621690771480"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-712"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771480"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-713"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771480"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-714"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-717"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-718"></span><span>        </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-719"></span><span>        </span><span class="annot"><a href="Hasura.Server.Types.html#HasServerConfigCtx"><span class="hs-identifier hs-type">HasServerConfigCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-720"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771479"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-721"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-722"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#InvalidationKeys"><span class="hs-identifier hs-type">InvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#StoredIntrospection"><span class="hs-identifier hs-type">StoredIntrospection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771480"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BuildOutputs"><span class="hs-identifier hs-type">BuildOutputs</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span id="local-6989586621690769899"><span class="annot"><span class="annottext">buildAndCollectInfo :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowDistribute arr, ArrowCache m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadError QErr m, MonadReader BuildReason m,
 MonadBaseControl IO m, ProvidesNetwork m, HasServerConfigCtx m,
 MonadResolveSource m) =&gt;
arr
  (Dependency Metadata, Dependency InvalidationKeys,
   Maybe StoredIntrospection)
  BuildOutputs
</span><a href="#local-6989586621690769899"><span class="hs-identifier hs-var hs-var">buildAndCollectInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690769056"><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769055"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690769055"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690769054"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690769054"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-724"></span><span>      </span><span id="local-6989586621690769053"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690769053"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_metaSources&quot; a =&gt; a
</span><span class="">#_metaSources</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-725"></span><span>      </span><span id="local-6989586621690769051"><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621690769051"><span class="hs-identifier hs-var">remoteSchemas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_metaRemoteSchemas&quot; a =&gt; a
</span><span class="">#_metaRemoteSchemas</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-726"></span><span>      </span><span id="local-6989586621690769050"><span class="annot"><span class="annottext">CustomTypes
</span><a href="#local-6989586621690769050"><span class="hs-identifier hs-var">customTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_metaCustomTypes&quot; a =&gt; a
</span><span class="">#_metaCustomTypes</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-727"></span><span>      </span><span id="local-6989586621690769049"><span class="annot"><span class="annottext">Actions
</span><a href="#local-6989586621690769049"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_metaActions&quot; a =&gt; a
</span><span class="">#_metaActions</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-728"></span><span>      </span><span id="local-6989586621690769048"><span class="annot"><span class="annottext">InheritedRoles
</span><a href="#local-6989586621690769048"><span class="hs-identifier hs-var">inheritedRoles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_metaInheritedRoles&quot; a =&gt; a
</span><span class="">#_metaInheritedRoles</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-729"></span><span>      </span><span id="local-6989586621690769047"><span class="annot"><span class="annottext">BackendMap BackendConfigWrapper
</span><a href="#local-6989586621690769047"><span class="hs-identifier hs-var">backendConfigs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
(ArrowCache m arr, Eq a) =&gt;
arr (Dependency a) a
</span><span class="hs-identifier hs-var">Inc.dependOn</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_metaBackendConfigs&quot; a =&gt; a
</span><span class="">#_metaBackendConfigs</span></span><span> </span><span class="annot"><span class="annottext">Dependency Metadata
</span><a href="#local-6989586621690769056"><span class="hs-identifier hs-var">metadataDep</span></a></span><span>
</span><span id="line-730"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769046"><span class="annot"><span class="annottext">actionRoles :: [RoleName]
</span><a href="#local-6989586621690769046"><span class="hs-identifier hs-var hs-var">actionRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ActionPermissionMetadata -&gt; RoleName
</span><a href="Hasura.RQL.Types.Action.html#_apmRole"><span class="hs-identifier hs-var">_apmRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; [ActionPermissionMetadata]
</span><a href="Hasura.RQL.Types.Action.html#_amPermissions"><span class="hs-identifier hs-var">_amPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">Actions
</span><a href="#local-6989586621690769049"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-731"></span><span>          </span><span id="local-6989586621690769043"><span class="annot"><span class="annottext">remoteSchemaRoles :: [RoleName]
</span><a href="#local-6989586621690769043"><span class="hs-identifier hs-var hs-var">remoteSchemaRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissionMetadata -&gt; RoleName
</span><a href="Hasura.RemoteSchema.Metadata.Permission.html#_rspmRole"><span class="hs-identifier hs-var">_rspmRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall r.
RemoteSchemaMetadataG r -&gt; [RemoteSchemaPermissionMetadata]
</span><a href="Hasura.RemoteSchema.Metadata.Core.html#_rsmPermissions"><span class="hs-identifier hs-var">_rsmPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621690769051"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span>
</span><span id="line-732"></span><span>          </span><span id="local-6989586621690769040"><span class="annot"><span class="annottext">sourceRoles :: HashSet RoleName
</span><a href="#local-6989586621690769040"><span class="hs-identifier hs-var hs-var">sourceRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-733"></span><span>            </span><span class="annot"><span class="annottext">forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-734"></span><span>              </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-735"></span><span>                </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690769053"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621690769037"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621690769037"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-736"></span><span>                  </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621690769037"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BackendSourceKind b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690769028"><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621690769028"><span class="hs-identifier hs-var">tables</span></a></span></span><span> </span><span id="local-6989586621690769027"><span class="annot"><span class="annottext">Functions b
</span><a href="#local-6989586621690769027"><span class="hs-identifier hs-var">_functions</span></a></span></span><span> </span><span id="local-6989586621690769026"><span class="annot"><span class="annottext">LogicalModels b
</span><a href="#local-6989586621690769026"><span class="hs-identifier hs-var">_customSQL</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SourceCustomization
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-737"></span><span>                    </span><span id="local-6989586621690769025"><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621690769025"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">Tables b
</span><a href="#local-6989586621690769028"><span class="hs-identifier hs-var">tables</span></a></span><span>
</span><span id="line-738"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-739"></span><span>                      </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">OMap.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableMetadata b -&gt; Permissions (InsPermDef b)
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_tmInsertPermissions"><span class="hs-identifier hs-var">_tmInsertPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621690769025"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">OMap.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableMetadata b -&gt; Permissions (SelPermDef b)
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_tmSelectPermissions"><span class="hs-identifier hs-var">_tmSelectPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621690769025"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">OMap.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableMetadata b -&gt; Permissions (UpdPermDef b)
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_tmUpdatePermissions"><span class="hs-identifier hs-var">_tmUpdatePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621690769025"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">OMap.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableMetadata b -&gt; Permissions (DelPermDef b)
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_tmDeletePermissions"><span class="hs-identifier hs-var">_tmDeletePermissions</span></a></span><span> </span><span class="annot"><span class="annottext">TableMetadata b
</span><a href="#local-6989586621690769025"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>          </span><span id="local-6989586621690769019"><span class="annot"><span class="annottext">inheritedRoleNames :: [RoleName]
</span><a href="#local-6989586621690769019"><span class="hs-identifier hs-var hs-var">inheritedRoleNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">OMap.keys</span></span><span> </span><span class="annot"><span class="annottext">InheritedRoles
</span><a href="#local-6989586621690769048"><span class="hs-identifier hs-var">inheritedRoles</span></a></span><span>
</span><span id="line-744"></span><span>          </span><span id="local-6989586621690769018"><span class="annot"><span class="annottext">allRoleNames :: HashSet RoleName
</span><a href="#local-6989586621690769018"><span class="hs-identifier hs-var hs-var">allRoleNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621690769040"><span class="hs-identifier hs-var">sourceRoles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RoleName]
</span><a href="#local-6989586621690769043"><span class="hs-identifier hs-var">remoteSchemaRoles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[RoleName]
</span><a href="#local-6989586621690769046"><span class="hs-identifier hs-var">actionRoles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[RoleName]
</span><a href="#local-6989586621690769019"><span class="hs-identifier hs-var">inheritedRoleNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>      </span><span class="hs-comment">-- roles which have some kind of permission (action/remote schema/table/function) set in the metadata</span><span>
</span><span id="line-747"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769017"><span class="annot"><span class="annottext">metadataRoles :: HashMap RoleName Role
</span><a href="#local-6989586621690769017"><span class="hs-identifier hs-var hs-var">metadataRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName -&gt; ParentRoles -&gt; Role
</span><a href="Hasura.RQL.Types.Roles.html#Role"><span class="hs-operator hs-var">`Role`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName -&gt; ParentRoles
</span><a href="Hasura.RQL.Types.Roles.html#ParentRoles"><span class="hs-identifier hs-var">ParentRoles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621690769018"><span class="hs-identifier hs-var">allRoleNames</span></a></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span>      </span><span id="local-6989586621690769013"><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621690769013"><span class="hs-identifier hs-var">resolvedInheritedRoles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><span class="hs-identifier hs-var">interpretWriter</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadWriter
  (Seq (Either InconsistentMetadata MetadataDependency)) m =&gt;
HashSet RoleName -&gt; [Role] -&gt; m (HashMap RoleName Role)
</span><a href="#local-6989586621690769012"><span class="hs-identifier hs-var">buildInheritedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621690769018"><span class="hs-identifier hs-var">allRoleNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">InheritedRoles
</span><a href="#local-6989586621690769048"><span class="hs-identifier hs-var">inheritedRoles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769011"><span class="annot"><span class="annottext">allRoles :: HashMap RoleName Role
</span><a href="#local-6989586621690769011"><span class="hs-identifier hs-var hs-var">allRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621690769013"><span class="hs-identifier hs-var">resolvedInheritedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-operator hs-var">`M.union`</span></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621690769017"><span class="hs-identifier hs-var">metadataRoles</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>      </span><span id="local-6989586621690769009"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769009"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadError QErr m =&gt; [Role] -&gt; m OrderedRoles
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#orderRoles"><span class="hs-identifier hs-var">orderRoles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName Role
</span><a href="#local-6989586621690769011"><span class="hs-identifier hs-var">allRoles</span></a></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span>      </span><span class="hs-comment">-- remote schemas</span><span>
</span><span id="line-756"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769007"><span class="annot"><span class="annottext">remoteSchemaInvalidationKeys :: Dependency (HashMap RemoteSchemaName InvalidationKey)
</span><a href="#local-6989586621690769007"><span class="hs-identifier hs-var hs-var">remoteSchemaInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_ikRemoteSchemas&quot; a =&gt; a
</span><span class="">#_ikRemoteSchemas</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690769055"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-757"></span><span>      </span><span id="local-6989586621690769006"><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
</span><a href="#local-6989586621690769006"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *)
       remoteRelationshipDefinition.
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 ArrowCache m arr, MonadIO m, MonadBaseControl IO m,
 Eq remoteRelationshipDefinition,
 ToJSON remoteRelationshipDefinition, MonadError QErr m,
 ProvidesNetwork m) =&gt;
Environment
-&gt; arr
     ((Dependency (HashMap RemoteSchemaName InvalidationKey),
       OrderedRoles, Maybe (HashMap RemoteSchemaName ByteString)),
      [RemoteSchemaMetadataG remoteRelationshipDefinition])
     (HashMap
        RemoteSchemaName
        (PartiallyResolvedRemoteSchemaCtxG remoteRelationshipDefinition,
         MetadataObject))
</span><a href="Hasura.RemoteSchema.SchemaCache.Build.html#buildRemoteSchemas"><span class="hs-identifier hs-var">buildRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (HashMap RemoteSchemaName InvalidationKey)
</span><a href="#local-6989586621690769007"><span class="hs-identifier hs-var">remoteSchemaInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769009"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection -&gt; HashMap RemoteSchemaName EncJSON
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#siRemotes"><span class="hs-identifier hs-var">siRemotes</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690769054"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas
</span><a href="#local-6989586621690769051"><span class="hs-identifier hs-var">remoteSchemas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690769002"><span class="annot"><span class="annottext">remoteSchemaCtxMap :: PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690769002"><span class="hs-identifier hs-var hs-var">remoteSchemaCtxMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
</span><a href="#local-6989586621690769006"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621690769000"><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769000"><span class="hs-identifier hs-var">defaultNC</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; NamingCase
</span><a href="Hasura.Server.Types.html#_sccDefaultNamingConvention"><span class="hs-identifier hs-var">_sccDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-761"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621690768999"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690768999"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFNamingConventions"><span class="hs-identifier hs-var">EFNamingConventions</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; HashSet ExperimentalFeature
</span><a href="Hasura.Server.Types.html#_sccExperimentalFeatures"><span class="hs-identifier hs-var">_sccExperimentalFeatures</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768998"><span class="annot"><span class="annottext">backendInvalidationKeys :: Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690768998"><span class="hs-identifier hs-var hs-var">backendInvalidationKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_ikBackends&quot; a =&gt; a
</span><span class="">#_ikBackends</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690769055"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-764"></span><span>      </span><span id="local-6989586621690768997"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690768997"><span class="hs-identifier hs-var">backendCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, ProvidesNetwork m) =&gt;
arr
  (Dependency (BackendMap BackendInvalidationKeysWrapper),
   [AnyBackend BackendConfigWrapper])
  BackendCache
</span><a href="#local-6989586621690769842"><span class="hs-identifier hs-var">resolveBackendCache</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (BackendMap BackendInvalidationKeysWrapper)
</span><a href="#local-6989586621690768998"><span class="hs-identifier hs-var">backendInvalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (i :: BackendType -&gt; *). BackendMap i -&gt; [AnyBackend i]
</span><a href="Hasura.SQL.BackendMap.html#elems"><span class="hs-identifier hs-var">BackendMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap BackendConfigWrapper
</span><a href="#local-6989586621690769047"><span class="hs-identifier hs-var">backendConfigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768995"><span class="annot"><span class="annottext">backendInfoAndSourceMetadata :: InsOrdHashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="#local-6989586621690768995"><span class="hs-identifier hs-var hs-var">backendInfoAndSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendCache
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#joinBackendInfosToSources"><span class="hs-identifier hs-var">joinBackendInfosToSources</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690768997"><span class="hs-identifier hs-var">backendCache</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690769053"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span>      </span><span class="hs-comment">-- sources are build in two steps</span><span>
</span><span id="line-769"></span><span>      </span><span class="hs-comment">-- first we resolve them, and build the table cache</span><span>
</span><span id="line-770"></span><span>      </span><span id="local-6989586621690768993"><span class="annot"><span class="annottext">HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource))
</span><a href="#local-6989586621690768993"><span class="hs-identifier hs-var">partiallyResolvedSourcesMaybes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-771"></span><span>        </span><span class="hs-glyph">(|</span><span>
</span><span id="line-772"></span><span>          </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><span class="hs-identifier hs-var">Inc.keyed</span></span><span>
</span><span id="line-773"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690768989"><span class="annot"><span class="annottext">AnyBackend BackendInfoAndSourceMetadata
</span><a href="#local-6989586621690768989"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-774"></span><span>                </span><span class="annot"><span class="annottext">forall (c1 :: BackendType -&gt; Constraint)
       (c2 :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r
       (arr :: * -&gt; * -&gt; *) x.
(ArrowChoice arr, AllBackendsSatisfy c1, AllBackendsSatisfy c2) =&gt;
(forall (b :: BackendType). (c1 b, c2 b) =&gt; arr (i b, x) r)
-&gt; arr (AnyBackend i, x) r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackendArrow"><span class="hs-identifier hs-var">AB.dispatchAnyBackendArrow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span>
</span><span id="line-775"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768912"><span id="local-6989586621690768911"><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b
</span><a href="#local-6989586621690768911"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768910"><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690768910"><span class="hs-identifier hs-var">invalidationKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768909"><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690768909"><span class="hs-identifier hs-var">storedIntrospection</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768908"><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690768908"><span class="hs-identifier hs-var">defaultNC</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768907"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690768907"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768906"><span class="annot"><span class="annottext">sourceMetadata :: SourceMetadata b
</span><a href="#local-6989586621690768906"><span class="hs-identifier hs-var hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmSourceMetadata"><span class="hs-identifier hs-var">_bcasmSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b
</span><a href="#local-6989586621690768911"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span><span>
</span><span id="line-777"></span><span>                          </span><span id="local-6989586621690768905"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621690768905"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; SourceName
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smName"><span class="hs-identifier hs-var">_smName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768906"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-778"></span><span>                          </span><span id="local-6989586621690768904"><span class="annot"><span class="annottext">sourceInvalidationsKeys :: Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621690768904"><span class="hs-identifier hs-var hs-var">sourceInvalidationsKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_ikSources&quot; a =&gt; a
</span><span class="">#_ikSources</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690768910"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-779"></span><span>                          </span><span id="local-6989586621690768903"><span class="annot"><span class="annottext">sourceIntrospection :: Maybe (BackendIntrospection b)
</span><a href="#local-6989586621690768903"><span class="hs-identifier hs-var hs-var">sourceIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
AnyBackend i -&gt; Maybe (i b)
</span><a href="Hasura.SQL.AnyBackend.html#unpackAnyBackend"><span class="hs-identifier hs-var">AB.unpackAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768905"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">StoredIntrospection
-&gt; HashMap SourceName (AnyBackend BackendIntrospection)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#siBackendIntrospection"><span class="hs-identifier hs-var">siBackendIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690768909"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span>
</span><span id="line-780"></span><span>                      </span><span id="local-6989586621690768900"><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
</span><a href="#local-6989586621690768900"><span class="hs-identifier hs-var">maybeResolvedSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 MonadIO m, MonadBaseControl IO m, MonadResolveSource m,
 ProvidesNetwork m, BackendMetadata b) =&gt;
arr
  (Dependency (HashMap SourceName InvalidationKey),
   Maybe (BackendIntrospection b), BackendInfoAndSourceMetadata b)
  (Maybe (SourceConfig b, DBObjectsIntrospection b))
</span><a href="#local-6989586621690769680"><span class="hs-identifier hs-var">tryResolveSource</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency (HashMap SourceName InvalidationKey)
</span><a href="#local-6989586621690768904"><span class="hs-identifier hs-var">sourceInvalidationsKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (BackendIntrospection b)
</span><a href="#local-6989586621690768903"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BackendInfoAndSourceMetadata b
</span><a href="#local-6989586621690768911"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
</span><a href="#local-6989586621690768900"><span class="hs-identifier hs-var">maybeResolvedSource</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-782"></span><span>                        </span><span class="annot"><span class="annottext">Maybe (SourceConfig b, DBObjectsIntrospection b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-783"></span><span>                        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768899"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768899"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768898"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690768898"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-784"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768897"><span class="annot"><span class="annottext">metadataInvalidationKey :: Dependency InvalidationKey
</span><a href="#local-6989586621690768897"><span class="hs-identifier hs-var hs-var">metadataInvalidationKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b.
Select a =&gt;
Selector a b -&gt; Dependency a -&gt; Dependency b
</span><span class="hs-identifier hs-var">Inc.selectD</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsLabel &quot;_ikMetadata&quot; a =&gt; a
</span><span class="">#_ikMetadata</span></span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690768910"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span>
</span><span id="line-785"></span><span>                              </span><span class="hs-special">(</span><span id="local-6989586621690768896"><span class="annot"><span class="annottext">[TableBuildInput b]
</span><a href="#local-6989586621690768896"><span class="hs-identifier hs-var">tableInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[NonColumnTableInputs b]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TablePermissionInputs b]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unzip3</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableMetadata b
-&gt; (TableBuildInput b, NonColumnTableInputs b,
    TablePermissionInputs b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#mkTableInputs"><span class="hs-identifier hs-var">mkTableInputs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; Tables b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smTables"><span class="hs-identifier hs-var">_smTables</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768906"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-786"></span><span>                              </span><span id="local-6989586621690768894"><span class="annot"><span class="annottext">scNamingConvention :: Maybe NamingCase
</span><a href="#local-6989586621690768894"><span class="hs-identifier hs-var hs-var">scNamingConvention</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceCustomization -&gt; Maybe NamingCase
</span><a href="Hasura.RQL.Types.SourceCustomization.html#_scNamingConvention"><span class="hs-identifier hs-var">_scNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; SourceCustomization
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smCustomization"><span class="hs-identifier hs-var">_smCustomization</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768906"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-787"></span><span>                              </span><span class="hs-glyph">!</span><span id="local-6989586621690768891"><span class="annot"><span class="annottext">namingConv :: NamingCase
</span><a href="#local-6989586621690768891"><span class="hs-identifier hs-var hs-var">namingConv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690768907"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690768908"><span class="hs-identifier hs-var">defaultNC</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621690768894"><span class="hs-identifier hs-var">scNamingConvention</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="Hasura.GraphQL.Schema.NamingCase.html#HasuraCase"><span class="hs-identifier hs-var">HasuraCase</span></a></span><span>
</span><span id="line-788"></span><span>                          </span><span id="local-6989586621690768889"><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690768889"><span class="hs-identifier hs-var">tablesCoreInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-789"></span><span>                            </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 ArrowCache m arr, MonadIO m, MonadBaseControl IO m,
 BackendMetadata b) =&gt;
arr
  (SourceName, SourceConfig b, DBTablesMetadata b,
   [TableBuildInput b], Dependency InvalidationKey,
   Maybe (BackendIntrospection b), NamingCase)
  (HashMap
     (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)))
</span><a href="Hasura.RQL.DDL.Schema.Table.html#buildTableCache"><span class="hs-identifier hs-var">buildTableCache</span></a></span><span>
</span><span id="line-790"></span><span>                              </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-791"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768905"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-792"></span><span>                                  </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768899"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-793"></span><span>                                  </span><span class="annot"><span class="annottext">forall (b :: BackendType).
DBObjectsIntrospection b -&gt; DBTablesMetadata b
</span><a href="Hasura.RQL.Types.Source.html#_rsTables"><span class="hs-identifier hs-var">_rsTables</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690768898"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-794"></span><span>                                  </span><span class="annot"><span class="annottext">[TableBuildInput b]
</span><a href="#local-6989586621690768896"><span class="hs-identifier hs-var">tableInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-795"></span><span>                                  </span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621690768897"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-796"></span><span>                                  </span><span class="annot"><span class="annottext">Maybe (BackendIntrospection b)
</span><a href="#local-6989586621690768903"><span class="hs-identifier hs-var">sourceIntrospection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-797"></span><span>                                  </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690768891"><span class="hs-identifier hs-var">namingConv</span></a></span><span>
</span><span id="line-798"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768886"><span class="annot"><span class="annottext">tablesMetadata :: [TableMetadata b]
</span><a href="#local-6989586621690768886"><span class="hs-identifier hs-var hs-var">tablesMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; Tables b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smTables"><span class="hs-identifier hs-var">_smTables</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768906"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-801"></span><span>                              </span><span id="local-6989586621690768885"><span class="annot"><span class="annottext">eventTriggers :: [(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621690768885"><span class="hs-identifier hs-var hs-var">eventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). TableMetadata b -&gt; TableName b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_tmTable"><span class="hs-identifier hs-var">_tmTable</span></a></span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). TableMetadata b -&gt; EventTriggers b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_tmEventTriggers"><span class="hs-identifier hs-var">_tmEventTriggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TableMetadata b]
</span><a href="#local-6989586621690768886"><span class="hs-identifier hs-var">tablesMetadata</span></a></span><span>
</span><span id="line-802"></span><span>                              </span><span id="local-6989586621690768881"><span class="annot"><span class="annottext">numEventTriggers :: Int
</span><a href="#local-6989586621690768881"><span class="hs-identifier hs-var hs-var">numEventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621690768885"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span>                          </span><span class="hs-special">(</span><span id="local-6989586621690768879"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768879"><span class="hs-identifier hs-var">recreateEventTriggers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768878"><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="#local-6989586621690768878"><span class="hs-identifier hs-var">sourceCatalogMigrationState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowCache m arr, MonadIO m, BackendMetadata b,
 HasServerConfigCtx m, MonadError QErr m, MonadBaseControl IO m) =&gt;
arr
  (Proxy b, Bool, SourceConfig b)
  (RecreateEventTriggers, SourceCatalogMigrationState)
</span><a href="#local-6989586621690769602"><span class="hs-identifier hs-var">initCatalogIfNeeded</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690768881"><span class="hs-identifier hs-var">numEventTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768899"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>                          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690770132"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768905"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceCatalogMigrationState
</span><a href="#local-6989586621690768878"><span class="hs-identifier hs-var">sourceCatalogMigrationState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690771089"><span id="local-6989586621690771090"><span class="annot"><a href="#local-6989586621690768877"><span class="hs-identifier hs-type">alignTableMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771090"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771089"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621690771090"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621690771089"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-809"></span><span>                              </span><span id="local-6989586621690768877"><span class="annot"><span class="annottext">alignTableMap :: forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621690768877"><span class="hs-identifier hs-var hs-var">alignTableMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v1 v2 v3.
(Eq k, Hashable k) =&gt;
(v1 -&gt; v2 -&gt; v3) -&gt; HashMap k v1 -&gt; HashMap k v2 -&gt; HashMap k v3
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>                          </span><span id="local-6989586621690768874"><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621690768874"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-812"></span><span>                            </span><span class="hs-glyph">(|</span><span>
</span><span id="line-813"></span><span>                              </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><span class="hs-identifier hs-var">Inc.keyed</span></span><span>
</span><span id="line-814"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768871"><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768871"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768870"><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621690768870"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-815"></span><span>                                    </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 ArrowCache m arr, MonadIO m, MonadError QErr m,
 MonadBaseControl IO m, MonadReader BuildReason m,
 HasServerConfigCtx m, BackendMetadata b, BackendEventTrigger b) =&gt;
arr
  (SourceName, SourceConfig b,
   TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
   [EventTriggerConf b], Dependency InvalidationKey,
   RecreateEventTriggers)
  (EventTriggerInfoMap b)
</span><a href="#local-6989586621690768869"><span class="hs-identifier hs-var">buildTableEventTriggers</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768905"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768899"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768871"><span class="hs-identifier hs-var">tableCoreInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621690768870"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621690768897"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768879"><span class="hs-identifier hs-var">recreateEventTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>                              </span><span class="hs-glyph">|)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690768889"><span class="hs-identifier hs-var">tablesCoreInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a c.
HashMap (TableName b) a
-&gt; HashMap (TableName b) c -&gt; HashMap (TableName b) (a, c)
</span><a href="#local-6989586621690768877"><span class="hs-operator hs-var">`alignTableMap`</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(TableName b, [EventTriggerConf b])]
</span><a href="#local-6989586621690768885"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>                          </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span>
</span><span id="line-820"></span><span>                            </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-821"></span><span>                              </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-822"></span><span>                                </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690768912"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-823"></span><span>                                  </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b
-&gt; SourceConfig b
-&gt; DBObjectsIntrospection b
-&gt; HashMap
     (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
-&gt; HashMap (TableName b) (EventTriggerInfoMap b)
-&gt; PartiallyResolvedSource b
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-var">PartiallyResolvedSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768906"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768899"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690768898"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690768889"><span class="hs-identifier hs-var">tablesCoreInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621690768874"><span class="hs-identifier hs-var">eventTriggerInfoMaps</span></a></span><span>
</span><span id="line-824"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>                  </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-826"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnyBackend BackendInfoAndSourceMetadata
</span><a href="#local-6989586621690768989"><span class="hs-identifier hs-var">exists</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency InvalidationKeys
</span><a href="#local-6989586621690769055"><span class="hs-identifier hs-var">invalidationKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StoredIntrospection
</span><a href="#local-6989586621690769054"><span class="hs-identifier hs-var">storedIntrospection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621690769000"><span class="hs-identifier hs-var">defaultNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690768999"><span class="hs-identifier hs-var">isNamingConventionEnabled</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>          </span><span class="hs-glyph">|)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">OMap.toList</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="#local-6989586621690768995"><span class="hs-identifier hs-var">backendInfoAndSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768867"><span class="annot"><span class="annottext">partiallyResolvedSources :: HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768867"><span class="hs-identifier hs-var hs-var">partiallyResolvedSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (Maybe (AnyBackend PartiallyResolvedSource))
</span><a href="#local-6989586621690768993"><span class="hs-identifier hs-var">partiallyResolvedSourcesMaybes</span></a></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span>      </span><span class="hs-comment">-- then we can build the entire source output</span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-comment">-- we need to have the table cache of all sources to build cross-sources relationships</span><span>
</span><span id="line-833"></span><span>      </span><span id="local-6989586621690768866"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend SourceInfo, BackendMap ScalarMap)
</span><a href="#local-6989586621690768866"><span class="hs-identifier hs-var">sourcesOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-834"></span><span>        </span><span class="hs-glyph">(|</span><span>
</span><span id="line-835"></span><span>          </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) k e a s b.
(ArrowDistribute arr, Hashable k) =&gt;
arr (e, (k, (a, s))) b -&gt; arr (e, (HashMap k a, s)) (HashMap k b)
</span><span class="hs-identifier hs-var">Inc.keyed</span></span><span>
</span><span id="line-836"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690768863"><span class="annot"><span class="annottext">AnyBackend PartiallyResolvedSource
</span><a href="#local-6989586621690768863"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-837"></span><span>                </span><span class="hs-comment">-- Note that it's a bit of a coincidence that</span><span>
</span><span id="line-838"></span><span>                </span><span class="hs-comment">-- 'AB.dispatchAnyBackendArrow' accepts exactly two constraints,</span><span>
</span><span id="line-839"></span><span>                </span><span class="hs-comment">-- and that we happen to want to apply to exactly two</span><span>
</span><span id="line-840"></span><span>                </span><span class="hs-comment">-- constraints.</span><span>
</span><span id="line-841"></span><span>                </span><span class="hs-comment">-- Ideally the function should be able to take an arbitrary</span><span>
</span><span id="line-842"></span><span>                </span><span class="hs-comment">-- number of constraints.</span><span>
</span><span id="line-843"></span><span>                </span><span class="annot"><span class="annottext">forall (c1 :: BackendType -&gt; Constraint)
       (c2 :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r
       (arr :: * -&gt; * -&gt; *) x.
(ArrowChoice arr, AllBackendsSatisfy c1, AllBackendsSatisfy c2) =&gt;
(forall (b :: BackendType). (c1 b, c2 b) =&gt; arr (i b, x) r)
-&gt; arr (AnyBackend i, x) r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackendArrow"><span class="hs-identifier hs-var">AB.dispatchAnyBackendArrow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCacheTypes.html#GetAggregationPredicatesDeps"><span class="hs-identifier hs-type">GetAggregationPredicatesDeps</span></a></span><span>
</span><span id="line-844"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">proc</span><span>
</span><span id="line-845"></span><span>                      </span><span class="hs-special">(</span><span> </span><span id="local-6989586621690768837"><span id="local-6989586621690768836"><span class="annot"><span class="annottext">PartiallyResolvedSource b
</span><a href="#local-6989586621690768836"><span class="hs-identifier hs-var">partiallyResolvedSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768837"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-846"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621690768835"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768835"><span class="hs-identifier hs-var">allResolvedSources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768834"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690768834"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768833"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690768833"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-849"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span> </span><span id="local-6989586621690768832"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768832"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span id="local-6989586621690768831"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768831"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span> </span><span id="local-6989586621690768830"><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690768830"><span class="hs-identifier hs-var">introspection</span></a></span></span><span> </span><span id="local-6989586621690768829"><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690768829"><span class="hs-identifier hs-var">tablesInfo</span></a></span></span><span> </span><span id="local-6989586621690768828"><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621690768828"><span class="hs-identifier hs-var">eventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedSource b
</span><a href="#local-6989586621690768836"><span class="hs-identifier hs-var">partiallyResolvedSource</span></a></span><span>
</span><span id="line-850"></span><span>                          </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#DBObjectsIntrospection"><span class="hs-identifier hs-type">DBObjectsIntrospection</span></a></span><span> </span><span id="local-6989586621690768826"><span class="annot"><span class="annottext">HashMap (TableName b) (DBTableMetadata b)
</span><a href="#local-6989586621690768826"><span class="hs-identifier hs-var">tablesMeta</span></a></span></span><span> </span><span id="local-6989586621690768825"><span class="annot"><span class="annottext">HashMap (FunctionName b) (FunctionOverloads b)
</span><a href="#local-6989586621690768825"><span class="hs-identifier hs-var">functionsMeta</span></a></span></span><span> </span><span id="local-6989586621690768824"><span class="annot"><span class="annottext">ScalarMap b
</span><a href="#local-6989586621690768824"><span class="hs-identifier hs-var">scalars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DBObjectsIntrospection b
</span><a href="#local-6989586621690768830"><span class="hs-identifier hs-var">introspection</span></a></span><span>
</span><span id="line-851"></span><span>                      </span><span id="local-6989586621690768823"><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621690768823"><span class="hs-identifier hs-var">so</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-852"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><span class="hs-identifier hs-var">Inc.cache</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *).
(ArrowChoice arr, ArrowKleisli m arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 HasServerConfigCtx m, MonadError QErr m, BackendMetadata b,
 GetAggregationPredicatesDeps b) =&gt;
arr
  (HashMap SourceName (AnyBackend PartiallyResolvedSource),
   SourceMetadata b, SourceConfig b,
   HashMap
     (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)),
   HashMap (TableName b) (EventTriggerInfoMap b), DBTablesMetadata b,
   DBFunctionsMetadata b, PartiallyResolvedRemoteSchemaMap,
   OrderedRoles)
  (SourceInfo b)
</span><a href="#local-6989586621690769514"><span class="hs-identifier hs-var">buildSource</span></a></span><span>
</span><span id="line-853"></span><span>                          </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-854"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768835"><span class="hs-identifier hs-var">allResolvedSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-855"></span><span>                              </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768832"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-856"></span><span>                              </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768831"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-857"></span><span>                              </span><span class="annot"><span class="annottext">HashMap
  (TableName b) (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b))
</span><a href="#local-6989586621690768829"><span class="hs-identifier hs-var">tablesInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-858"></span><span>                              </span><span class="annot"><span class="annottext">HashMap (TableName b) (EventTriggerInfoMap b)
</span><a href="#local-6989586621690768828"><span class="hs-identifier hs-var">eventTriggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-859"></span><span>                              </span><span class="annot"><span class="annottext">HashMap (TableName b) (DBTableMetadata b)
</span><a href="#local-6989586621690768826"><span class="hs-identifier hs-var">tablesMeta</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-860"></span><span>                              </span><span class="annot"><span class="annottext">HashMap (FunctionName b) (FunctionOverloads b)
</span><a href="#local-6989586621690768825"><span class="hs-identifier hs-var">functionsMeta</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-861"></span><span>                              </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690768834"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-862"></span><span>                              </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690768833"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-863"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>                      </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621690768823"><span class="hs-identifier hs-var">so</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; BackendMap i
</span><a href="Hasura.SQL.BackendMap.html#singleton"><span class="hs-identifier hs-var">BackendMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarMap b
</span><a href="#local-6989586621690768824"><span class="hs-identifier hs-var">scalars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>                  </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-867"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AnyBackend PartiallyResolvedSource
</span><a href="#local-6989586621690768863"><span class="hs-identifier hs-var">exists</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-868"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768867"><span class="hs-identifier hs-var">partiallyResolvedSources</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690769002"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769009"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>          </span><span class="hs-glyph">|)</span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768867"><span class="hs-identifier hs-var">partiallyResolvedSources</span></a></span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>      </span><span id="local-6989586621690768822"><span class="annot"><span class="annottext">HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="#local-6989586621690768822"><span class="hs-identifier hs-var">remoteSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-874"></span><span>        </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><span class="hs-identifier hs-var">interpretWriter</span></span><span>
</span><span id="line-875"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap
  RemoteSchemaName
  (PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition,
   MetadataObject)
</span><a href="#local-6989586621690769006"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621690768821"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768821"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768820"><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768820"><span class="hs-identifier hs-var">metadataObj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-876"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768819"><span class="annot"><span class="annottext">remoteSchemaIntrospection :: RemoteSchemaIntrospection
</span><a href="#local-6989586621690768819"><span class="hs-identifier hs-var hs-var">remoteSchemaIntrospection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntrospectionResult -&gt; RemoteSchemaIntrospection
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#irDoc"><span class="hs-identifier hs-var">irDoc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall remoteFieldInfo.
RemoteSchemaCtxG remoteFieldInfo -&gt; IntrospectionResult
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#_rscIntroOriginal"><span class="hs-identifier hs-var">_rscIntroOriginal</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768821"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span><span>
</span><span id="line-877"></span><span>            </span><span id="local-6989586621690768816"><span class="annot"><span class="annottext">RemoteSchemaCtxG (Maybe (RemoteFieldInfo Name))
</span><a href="#local-6989586621690768816"><span class="hs-identifier hs-var">resolvedSchemaCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768821"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Hasura.RemoteSchema.SchemaCache.Types.html#PartiallyResolvedRemoteRelationship"><span class="hs-identifier hs-type">PartiallyResolvedRemoteRelationship</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690768813"><span id="local-6989586621690768814"><span class="annot"><span class="annottext">Name
RemoteRelationshipG RemoteRelationshipDefinition
_prrrDefinition :: forall remoteRelationshipDefinition.
PartiallyResolvedRemoteRelationship remoteRelationshipDefinition
-&gt; RemoteRelationshipG remoteRelationshipDefinition
_prrrTypeName :: forall remoteRelationshipDefinition.
PartiallyResolvedRemoteRelationship remoteRelationshipDefinition
-&gt; Name
_prrrDefinition :: RemoteRelationshipG RemoteRelationshipDefinition
_prrrTypeName :: Name
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#_prrrDefinition"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-878"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadWriter
  (Seq (Either InconsistentMetadata MetadataDependency)) m =&gt;
HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; RemoteSchemaName
-&gt; RemoteSchemaIntrospection
-&gt; Name
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; m (Maybe (RemoteFieldInfo Name))
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">buildRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768867"><span class="hs-identifier hs-var">partiallyResolvedSources</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690769002"><span class="hs-identifier hs-var">remoteSchemaCtxMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall remoteFieldInfo.
RemoteSchemaCtxG remoteFieldInfo -&gt; RemoteSchemaName
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#_rscName"><span class="hs-identifier hs-var">_rscName</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaCtxG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768821"><span class="hs-identifier hs-var">partiallyResolvedRemoteSchemaCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaIntrospection
</span><a href="#local-6989586621690768819"><span class="hs-identifier hs-var">remoteSchemaIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621690768814"><span class="hs-identifier hs-var">_prrrTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRelationshipG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768813"><span class="hs-identifier hs-var">_prrrDefinition</span></a></span><span>
</span><span id="line-879"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaCtxG (Maybe (RemoteFieldInfo Name))
</span><a href="#local-6989586621690768816"><span class="hs-identifier hs-var">resolvedSchemaCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768820"><span class="hs-identifier hs-var">metadataObj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>      </span><span class="hs-comment">-- actions</span><span>
</span><span id="line-882"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621690768808"><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621690768808"><span class="hs-identifier hs-var">actionCache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768807"><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768807"><span class="hs-identifier hs-var">annotatedCustomTypes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-883"></span><span>        </span><span class="annot"><span class="annottext">forall w (arr :: * -&gt; * -&gt; *) a.
ArrowWriter w arr =&gt;
arr (Writer w a) a
</span><span class="hs-identifier hs-var">interpretWriter</span></span><span>
</span><span id="line-884"></span><span>          </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>            </span><span class="hs-comment">-- custom types</span><span>
</span><span id="line-886"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768806"><span class="annot"><span class="annottext">scalarsMap :: BackendMap ScalarMap
</span><a href="#local-6989586621690768806"><span class="hs-identifier hs-var hs-var">scalarsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend SourceInfo, BackendMap ScalarMap)
</span><a href="#local-6989586621690768866"><span class="hs-identifier hs-var">sourcesOutput</span></a></span><span>
</span><span id="line-887"></span><span>                </span><span id="local-6989586621690768805"><span class="annot"><span class="annottext">sourcesCache :: SourceCache
</span><a href="#local-6989586621690768805"><span class="hs-identifier hs-var hs-var">sourcesCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend SourceInfo, BackendMap ScalarMap)
</span><a href="#local-6989586621690768866"><span class="hs-identifier hs-var">sourcesOutput</span></a></span><span>
</span><span id="line-888"></span><span>                </span><span id="local-6989586621690768804"><span class="annot"><span class="annottext">actionList :: [ActionMetadata]
</span><a href="#local-6989586621690768804"><span class="hs-identifier hs-var hs-var">actionList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. InsOrdHashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">OMap.elems</span></span><span> </span><span class="annot"><span class="annottext">Actions
</span><a href="#local-6989586621690769049"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-889"></span><span>            </span><span id="local-6989586621690768803"><span class="annot"><span class="annottext">Maybe AnnotatedCustomTypes
</span><a href="#local-6989586621690768803"><span class="hs-identifier hs-var">maybeResolvedCustomTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-890"></span><span>              </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOCustomTypes"><span class="hs-identifier hs-var">MOCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">CustomTypes
</span><a href="#local-6989586621690769050"><span class="hs-identifier hs-var">customTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-891"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
SourceCache
-&gt; CustomTypes -&gt; BackendMap ScalarMap -&gt; m AnnotatedCustomTypes
</span><a href="Hasura.RQL.DDL.CustomTypes.html#resolveCustomTypes"><span class="hs-identifier hs-var">resolveCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621690768805"><span class="hs-identifier hs-var">sourcesCache</span></a></span><span> </span><span class="annot"><span class="annottext">CustomTypes
</span><a href="#local-6989586621690769050"><span class="hs-identifier hs-var">customTypes</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap ScalarMap
</span><a href="#local-6989586621690768806"><span class="hs-identifier hs-var">scalarsMap</span></a></span><span>
</span><span id="line-892"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe AnnotatedCustomTypes
</span><a href="#local-6989586621690768803"><span class="hs-identifier hs-var">maybeResolvedCustomTypes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-893"></span><span>              </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690768800"><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768800"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-894"></span><span>                </span><span id="local-6989586621690768799"><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621690768799"><span class="hs-identifier hs-var">actionCache'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadWriter
  (Seq (Either InconsistentMetadata MetadataDependency)) m =&gt;
AnnotatedCustomTypes
-&gt; BackendMap ScalarMap
-&gt; OrderedRoles
-&gt; [ActionMetadata]
-&gt; m ActionCache
</span><a href="#local-6989586621690768798"><span class="hs-identifier hs-var">buildActions</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768800"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap ScalarMap
</span><a href="#local-6989586621690768806"><span class="hs-identifier hs-var">scalarsMap</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769009"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">[ActionMetadata]
</span><a href="#local-6989586621690768804"><span class="hs-identifier hs-var">actionList</span></a></span><span>
</span><span id="line-895"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621690768799"><span class="hs-identifier hs-var">actionCache'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768800"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>              </span><span class="hs-comment">-- If the custom types themselves are inconsistent, we can&#8217;t really do</span><span>
</span><span id="line-897"></span><span>              </span><span class="hs-comment">-- anything with actions, so just mark them all inconsistent.</span><span>
</span><span id="line-898"></span><span>              </span><span class="annot"><span class="annottext">Maybe AnnotatedCustomTypes
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-899"></span><span>                </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
[MetadataObject] -&gt; Text -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordInconsistenciesM"><span class="hs-identifier hs-var">recordInconsistenciesM</span></a></span><span>
</span><span id="line-900"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768796"><span class="hs-identifier hs-var">mkActionMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">[ActionMetadata]
</span><a href="#local-6989586621690768804"><span class="hs-identifier hs-var">actionList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>                  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;custom types are inconsistent&quot;</span></span><span>
</span><span id="line-902"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>      </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span>
</span><span id="line-905"></span><span>        </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-906"></span><span>          </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#BuildOutputs"><span class="hs-identifier hs-type">BuildOutputs</span></a></span><span>
</span><span id="line-907"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_boSources :: SourceCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boSources"><span class="hs-identifier hs-var">_boSources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend SourceInfo, BackendMap ScalarMap)
</span><a href="#local-6989586621690768866"><span class="hs-identifier hs-var">sourcesOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-908"></span><span>              </span><span class="annot"><span class="annottext">_boActions :: ActionCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boActions"><span class="hs-identifier hs-var">_boActions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActionCache
</span><a href="#local-6989586621690768808"><span class="hs-identifier hs-var">actionCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-909"></span><span>              </span><span class="annot"><span class="annottext">_boRemoteSchemas :: HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boRemoteSchemas"><span class="hs-identifier hs-var">_boRemoteSchemas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap RemoteSchemaName (RemoteSchemaCtx, MetadataObject)
</span><a href="#local-6989586621690768822"><span class="hs-identifier hs-var">remoteSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-910"></span><span>              </span><span class="annot"><span class="annottext">_boCustomTypes :: AnnotatedCustomTypes
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boCustomTypes"><span class="hs-identifier hs-var">_boCustomTypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768807"><span class="hs-identifier hs-var">annotatedCustomTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-911"></span><span>              </span><span class="annot"><span class="annottext">_boRoles :: HashMap RoleName Role
</span><a href="#local-6989586621690768794"><span class="hs-identifier hs-var">_boRoles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles -&gt; [Role]
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#_unOrderedRoles"><span class="hs-identifier hs-var">_unOrderedRoles</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690769009"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-912"></span><span>              </span><span class="annot"><span class="annottext">_boBackendCache :: BackendCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#_boBackendCache"><span class="hs-identifier hs-var">_boBackendCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690768997"><span class="hs-identifier hs-var">backendCache</span></a></span><span>
</span><span id="line-913"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>    </span><span id="local-6989586621690771567"><span id="local-6989586621690771568"><span class="annot"><a href="#local-6989586621690770065"><span class="hs-identifier hs-type">buildOpenTelemetry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-916"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771568"><span class="hs-identifier hs-type">md</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771567"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-917"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryConfig"><span class="hs-identifier hs-type">OpenTelemetryConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-918"></span><span>      </span><span class="annot"><a href="#local-6989586621690771567"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryInfo"><span class="hs-identifier hs-type">OpenTelemetryInfo</span></a></span></span></span><span>
</span><span id="line-919"></span><span>    </span><span id="local-6989586621690770065"><span class="annot"><span class="annottext">buildOpenTelemetry :: forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
OpenTelemetryConfig -&gt; m OpenTelemetryInfo
</span><a href="#local-6989586621690770065"><span class="hs-identifier hs-var hs-var">buildOpenTelemetry</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryConfig"><span class="hs-identifier hs-type">OpenTelemetryConfig</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690768768"><span id="local-6989586621690768769"><span id="local-6989586621690768770"><span id="local-6989586621690768771"><span class="annot"><span class="annottext">Set OtelDataType
OtelBatchSpanProcessorConfig
OtelExporterConfig
OtelStatus
_ocBatchSpanProcessor :: OpenTelemetryConfig -&gt; OtelBatchSpanProcessorConfig
_ocExporterOtlp :: OpenTelemetryConfig -&gt; OtelExporterConfig
_ocEnabledDataTypes :: OpenTelemetryConfig -&gt; Set OtelDataType
_ocStatus :: OpenTelemetryConfig -&gt; OtelStatus
_ocBatchSpanProcessor :: OtelBatchSpanProcessorConfig
_ocExporterOtlp :: OtelExporterConfig
_ocEnabledDataTypes :: Set OtelDataType
_ocStatus :: OtelStatus
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#_ocBatchSpanProcessor"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-920"></span><span>      </span><span class="hs-comment">-- Always perform validation, even if OpenTelemetry is disabled</span><span>
</span><span id="line-921"></span><span>      </span><span id="local-6989586621690768763"><span class="annot"><span class="annottext">Maybe OtelExporterInfo
</span><a href="#local-6989586621690768763"><span class="hs-identifier hs-var">mOtelExporterInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-922"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-923"></span><span>          </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOOpenTelemetry"><span class="hs-identifier hs-var">MOOpenTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectExporterOtlp"><span class="hs-identifier hs-var">OtelSubobjectExporterOtlp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">OtelExporterConfig
</span><a href="#local-6989586621690768769"><span class="hs-identifier hs-var">_ocExporterOtlp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-924"></span><span>            </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-925"></span><span>              </span><span class="annot"><span class="annottext">OtelStatus
-&gt; Environment
-&gt; OtelExporterConfig
-&gt; Either QErr (Maybe OtelExporterInfo)
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#parseOtelExporterConfig"><span class="hs-identifier hs-var">parseOtelExporterConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="#local-6989586621690768771"><span class="hs-identifier hs-var">_ocStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OtelExporterConfig
</span><a href="#local-6989586621690768769"><span class="hs-identifier hs-var">_ocExporterOtlp</span></a></span><span>
</span><span id="line-926"></span><span>      </span><span id="local-6989586621690768759"><span class="annot"><span class="annottext">Maybe OtelBatchSpanProcessorInfo
</span><a href="#local-6989586621690768759"><span class="hs-identifier hs-var">mOtelBatchSpanProcessorInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-927"></span><span>        </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOOpenTelemetry"><span class="hs-identifier hs-var">MOOpenTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectBatchSpanProcessor"><span class="hs-identifier hs-var">OtelSubobjectBatchSpanProcessor</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
</span><a href="#local-6989586621690768768"><span class="hs-identifier hs-var">_ocBatchSpanProcessor</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-928"></span><span>          </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-929"></span><span>            </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
-&gt; Either QErr OtelBatchSpanProcessorInfo
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#parseOtelBatchSpanProcessorConfig"><span class="hs-identifier hs-var">parseOtelBatchSpanProcessorConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
</span><a href="#local-6989586621690768768"><span class="hs-identifier hs-var">_ocBatchSpanProcessor</span></a></span><span>
</span><span id="line-930"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-931"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="#local-6989586621690768771"><span class="hs-identifier hs-var">_ocStatus</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-932"></span><span>          </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelDisabled"><span class="hs-identifier hs-var">OtelDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-933"></span><span>            </span><span class="hs-comment">-- Disable all components if OpenTelemetry export not enabled</span><span>
</span><span id="line-934"></span><span>            </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
-&gt; Maybe OtelBatchSpanProcessorInfo -&gt; OpenTelemetryInfo
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryInfo"><span class="hs-identifier hs-var">OpenTelemetryInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-935"></span><span>          </span><span class="annot"><span class="annottext">OtelStatus
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelEnabled"><span class="hs-identifier hs-var">OtelEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-936"></span><span>            </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
-&gt; Maybe OtelBatchSpanProcessorInfo -&gt; OpenTelemetryInfo
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OpenTelemetryInfo"><span class="hs-identifier hs-var">OpenTelemetryInfo</span></a></span><span>
</span><span id="line-937"></span><span>              </span><span class="annot"><span class="annottext">Maybe OtelExporterInfo
</span><a href="#local-6989586621690768763"><span class="hs-identifier hs-var">mOtelExporterInfo</span></a></span><span>
</span><span id="line-938"></span><span>              </span><span class="hs-comment">-- Disable data types if they are not in the enabled set</span><span>
</span><span id="line-939"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">OtelDataType
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelTraces"><span class="hs-identifier hs-var">OtelTraces</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set OtelDataType
</span><a href="#local-6989586621690768770"><span class="hs-identifier hs-var">_ocEnabledDataTypes</span></a></span><span>
</span><span id="line-940"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe OtelBatchSpanProcessorInfo
</span><a href="#local-6989586621690768759"><span class="hs-identifier hs-var">mOtelBatchSpanProcessorInfo</span></a></span><span>
</span><span id="line-941"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-942"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span>    </span><span id="local-6989586621690771577"><span id="local-6989586621690771578"><span class="annot"><a href="#local-6989586621690770072"><span class="hs-identifier hs-type">buildRESTEndpoints</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-945"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771578"><span class="hs-identifier hs-type">md</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771577"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-946"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#QueryCollections"><span class="hs-identifier hs-type">QueryCollections</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-947"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#CreateEndpoint"><span class="hs-identifier hs-type">CreateEndpoint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-948"></span><span>      </span><span class="annot"><a href="#local-6989586621690771577"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointName"><span class="hs-identifier hs-type">EndpointName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-949"></span><span>    </span><span id="local-6989586621690770072"><span class="annot"><span class="annottext">buildRESTEndpoints :: forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
QueryCollections
-&gt; [CreateEndpoint]
-&gt; m (HashMap EndpointName (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621690770072"><span class="hs-identifier hs-var hs-var">buildRESTEndpoints</span></a></span></span><span> </span><span id="local-6989586621690768735"><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690768735"><span class="hs-identifier hs-var">collections</span></a></span></span><span> </span><span id="local-6989586621690768734"><span class="annot"><span class="annottext">[CreateEndpoint]
</span><a href="#local-6989586621690768734"><span class="hs-identifier hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) k a b.
(MonadWriter (Seq (Either InconsistentMetadata md)) m,
 Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">forall query. EndpointMetadata query -&gt; EndpointName
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceName"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {q}. ToJSON q =&gt; EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690768732"><span class="hs-identifier hs-var">mkEndpointMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint -&gt; m (Maybe (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621690768731"><span class="hs-identifier hs-var">buildEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">[CreateEndpoint]
</span><a href="#local-6989586621690768734"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-950"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-951"></span><span>        </span><span id="local-6989586621690768732"><span class="annot"><span class="annottext">mkEndpointMetadataObject :: EndpointMetadata query -&gt; MetadataObject
</span><a href="#local-6989586621690768732"><span class="hs-identifier hs-var hs-var">mkEndpointMetadataObject</span></a></span></span><span> </span><span id="local-6989586621690768727"><span class="annot"><span class="annottext">createEndpoint :: EndpointMetadata query
</span><a href="#local-6989586621690768727"><span class="hs-identifier hs-var">createEndpoint</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690768721"><span id="local-6989586621690768722"><span id="local-6989586621690768723"><span id="local-6989586621690768724"><span id="local-6989586621690768725"><span class="annot"><span class="annottext">Maybe Text
NonEmpty EndpointMethod
EndpointUrl
EndpointName
EndpointDef query
_ceComment :: forall query. EndpointMetadata query -&gt; Maybe Text
_ceDefinition :: forall query. EndpointMetadata query -&gt; EndpointDef query
_ceMethods :: forall query. EndpointMetadata query -&gt; NonEmpty EndpointMethod
_ceComment :: Maybe Text
_ceDefinition :: EndpointDef query
_ceMethods :: NonEmpty EndpointMethod
_ceUrl :: EndpointUrl
_ceName :: EndpointName
_ceName :: forall query. EndpointMetadata query -&gt; EndpointName
_ceUrl :: forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceComment"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-952"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768717"><span class="annot"><span class="annottext">objectId :: MetadataObjId
</span><a href="#local-6989586621690768717"><span class="hs-identifier hs-var hs-var">objectId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOEndpoint"><span class="hs-identifier hs-var">MOEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointName
</span><a href="#local-6989586621690768725"><span class="hs-identifier hs-var">_ceName</span></a></span><span>
</span><span id="line-953"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621690768717"><span class="hs-identifier hs-var">objectId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">EndpointMetadata query
</span><a href="#local-6989586621690768727"><span class="hs-identifier hs-var">createEndpoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>        </span><span id="local-6989586621690768731"><span class="annot"><span class="annottext">buildEndpoint :: CreateEndpoint -&gt; m (Maybe (EndpointMetadata GQLQueryWithText))
</span><a href="#local-6989586621690768731"><span class="hs-identifier hs-var hs-var">buildEndpoint</span></a></span></span><span> </span><span id="local-6989586621690768716"><span class="annot"><span class="annottext">createEndpoint :: CreateEndpoint
</span><a href="#local-6989586621690768716"><span class="hs-identifier hs-var">createEndpoint</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690768711"><span id="local-6989586621690768712"><span id="local-6989586621690768713"><span id="local-6989586621690768714"><span id="local-6989586621690768715"><span class="annot"><span class="annottext">Maybe Text
NonEmpty EndpointMethod
EndpointUrl
EndpointName
EndpointDef QueryReference
_ceComment :: Maybe Text
_ceDefinition :: EndpointDef QueryReference
_ceMethods :: NonEmpty EndpointMethod
_ceUrl :: EndpointUrl
_ceName :: EndpointName
_ceComment :: forall query. EndpointMetadata query -&gt; Maybe Text
_ceDefinition :: forall query. EndpointMetadata query -&gt; EndpointDef query
_ceMethods :: forall query. EndpointMetadata query -&gt; NonEmpty EndpointMethod
_ceName :: forall query. EndpointMetadata query -&gt; EndpointName
_ceUrl :: forall query. EndpointMetadata query -&gt; EndpointUrl
</span><a href="#local-6989586621690768711"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-956"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- QueryReference collName queryName = _edQuery endpoint</span><span>
</span><span id="line-957"></span><span>              </span><span id="local-6989586621690768710"><span class="annot"><span class="annottext">addContext :: Text -&gt; Text
</span><a href="#local-6989586621690768710"><span class="hs-identifier hs-var hs-var">addContext</span></a></span></span><span> </span><span id="local-6989586621690768709"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768709"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in endpoint &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointName
</span><a href="#local-6989586621690768715"><span class="hs-identifier hs-var">_ceName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768709"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-958"></span><span>          </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {q}. ToJSON q =&gt; EndpointMetadata q -&gt; MetadataObject
</span><a href="#local-6989586621690768732"><span class="hs-identifier hs-var">mkEndpointMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint
</span><a href="#local-6989586621690768716"><span class="hs-identifier hs-var">createEndpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690768710"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
QErrM m =&gt;
QueryCollections
-&gt; CreateEndpoint -&gt; m (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621690768708"><span class="hs-identifier hs-var">resolveEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690768735"><span class="hs-identifier hs-var">collections</span></a></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint
</span><a href="#local-6989586621690768716"><span class="hs-identifier hs-var">createEndpoint</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>    </span><span id="local-6989586621690771041"><span class="annot"><a href="#local-6989586621690768708"><span class="hs-identifier hs-type">resolveEndpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-961"></span><span>      </span><span class="annot"><a href="Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-962"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-963"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#QueryReference"><span class="hs-identifier hs-type">QueryReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-964"></span><span>      </span><span class="annot"><a href="#local-6989586621690771041"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#EndpointMetadata"><span class="hs-identifier hs-type">EndpointMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-965"></span><span>    </span><span id="local-6989586621690768708"><span class="annot"><span class="annottext">resolveEndpoint :: forall (m :: * -&gt; *).
QErrM m =&gt;
QueryCollections
-&gt; CreateEndpoint -&gt; m (EndpointMetadata GQLQueryWithText)
</span><a href="#local-6989586621690768708"><span class="hs-identifier hs-var hs-var">resolveEndpoint</span></a></span></span><span> </span><span id="local-6989586621690768651"><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690768651"><span class="hs-identifier hs-var">collections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#QueryReference"><span class="hs-identifier hs-type">QueryReference</span></a></span><span> </span><span id="local-6989586621690768648"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621690768648"><span class="hs-identifier hs-var">collName</span></a></span></span><span> </span><span id="local-6989586621690768647"><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621690768647"><span class="hs-identifier hs-var">queryName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-966"></span><span>      </span><span id="local-6989586621690768646"><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621690768646"><span class="hs-identifier hs-var">collection</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-967"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-968"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">OMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621690768648"><span class="hs-identifier hs-var">collName</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621690768651"><span class="hs-identifier hs-var">collections</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;collection with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621690768648"><span class="hs-identifier hs-var">collName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not exist&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>      </span><span id="local-6989586621690768645"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621690768645"><span class="hs-identifier hs-var">listedQuery</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-971"></span><span>        </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span>
</span><span id="line-972"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-973"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-974"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span>
</span><span id="line-975"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621690768647"><span class="hs-identifier hs-var">queryName</span></a></span><span>
</span><span id="line-976"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not exist in collection &quot;</span></span><span>
</span><span id="line-977"></span><span>                </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621690768648"><span class="hs-identifier hs-var">collName</span></a></span><span>
</span><span id="line-978"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621690768647"><span class="hs-identifier hs-var">queryName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery -&gt; QueryName
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqName"><span class="hs-identifier hs-var">_lqName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionDef -&gt; [ListedQuery]
</span><a href="Hasura.RQL.Types.QueryCollection.html#_cdQueries"><span class="hs-identifier hs-var">_cdQueries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateCollection -&gt; CollectionDef
</span><a href="Hasura.RQL.Types.QueryCollection.html#_ccDefinition"><span class="hs-identifier hs-var">_ccDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621690768646"><span class="hs-identifier hs-var">collection</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768640"><span class="annot"><span class="annottext">lq :: GQLQueryWithText
</span><a href="#local-6989586621690768640"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#GQLQueryWithText"><span class="hs-identifier hs-type">GQLQueryWithText</span></a></span><span> </span><span id="local-6989586621690768638"><span class="annot"><span class="annottext">(Text, GQLQuery)
</span><a href="#local-6989586621690768638"><span class="hs-identifier hs-var">lqq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListedQuery -&gt; GQLQueryWithText
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqQuery"><span class="hs-identifier hs-var">_lqQuery</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621690768645"><span class="hs-identifier hs-var">listedQuery</span></a></span><span>
</span><span id="line-982"></span><span>          </span><span id="local-6989586621690768636"><span class="annot"><span class="annottext">ds :: [ExecutableDefinition Name]
</span><a href="#local-6989586621690768636"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall var. ExecutableDocument var -&gt; [ExecutableDefinition var]
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-var">G.getExecutableDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GQLQuery -&gt; ExecutableDocument Name
</span><a href="Hasura.RQL.Types.QueryCollection.html#unGQLQuery"><span class="hs-identifier hs-var">unGQLQuery</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Text, GQLQuery)
</span><a href="#local-6989586621690768638"><span class="hs-identifier hs-var">lqq</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ExecutableDefinition Name]
</span><a href="#local-6989586621690768636"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-type">G.ExecutableDefinitionOperation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-type">G.OperationDefinitionTyped</span></a></span><span> </span><span id="local-6989586621690768631"><span class="annot"><span class="annottext">TypedOperationDefinition FragmentSpread Name
</span><a href="#local-6989586621690768631"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-986"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (frag :: * -&gt; *) var.
TypedOperationDefinition frag var -&gt; OperationType
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-var">G._todType</span></a></span><span> </span><span class="annot"><span class="annottext">TypedOperationDefinition FragmentSpread Name
</span><a href="#local-6989586621690768631"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">OperationType
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-var">G.OperationTypeSubscription</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-987"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw405"><span class="hs-identifier hs-var">throw405</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621690768647"><span class="hs-identifier hs-var">queryName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; is a subscription&quot;</span></span><span>
</span><span id="line-988"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621690768647"><span class="hs-identifier hs-var">queryName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; has no definitions.&quot;</span></span><span>
</span><span id="line-990"></span><span>        </span><span class="annot"><span class="annottext">[ExecutableDefinition Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;query with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621690768647"><span class="hs-identifier hs-var">queryName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; has multiple definitions.&quot;</span></span><span>
</span><span id="line-991"></span><span>
</span><span id="line-992"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GQLQueryWithText
</span><a href="#local-6989586621690768640"><span class="hs-identifier hs-var">lq</span></a></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span>    </span><span class="annot"><a href="#local-6989586621690768626"><span class="hs-identifier hs-type">mkEventTriggerMetadataObject</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-995"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771018"><span class="annot"><a href="#local-6989586621690771018"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621690771017"><span class="annot"><a href="#local-6989586621690771017"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621690771016"><span class="annot"><a href="#local-6989586621690771016"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-996"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771018"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621690771017"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621690771016"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#TableName"><span class="hs-identifier hs-type">TableName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771018"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#RecreateEventTriggers"><span class="hs-identifier hs-type">RecreateEventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerConf"><span class="hs-identifier hs-type">EventTriggerConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771018"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-998"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-type">MetadataObject</span></a></span><span>
</span><span id="line-999"></span><span>    </span><span id="local-6989586621690768626"><span class="annot"><span class="annottext">mkEventTriggerMetadataObject :: forall (b :: BackendType) a c.
Backend b =&gt;
(a, SourceName, c, TableName b, RecreateEventTriggers,
 EventTriggerConf b)
-&gt; MetadataObject
</span><a href="#local-6989586621690768626"><span class="hs-identifier hs-var hs-var">mkEventTriggerMetadataObject</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768609"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768609"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768608"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768608"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768607"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768607"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1000"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768606"><span class="annot"><span class="annottext">objectId :: MetadataObjId
</span><a href="#local-6989586621690768606"><span class="hs-identifier hs-var hs-var">objectId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1001"></span><span>            </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768609"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1002"></span><span>              </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1003"></span><span>                </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTableObj"><span class="hs-identifier hs-var">SMOTableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771018"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768608"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1004"></span><span>                  </span><span class="annot"><span class="annottext">TriggerName -&gt; TableMetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MTOTrigger"><span class="hs-identifier hs-var">MTOTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1005"></span><span>                    </span><span class="annot"><span class="annottext">forall (b :: BackendType). EventTriggerConf b -&gt; TriggerName
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcName"><span class="hs-identifier hs-var">etcName</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768607"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1006"></span><span>          </span><span id="local-6989586621690768602"><span class="annot"><span class="annottext">definition :: Value
</span><a href="#local-6989586621690768602"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;table&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768608"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;configuration&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768607"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1007"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621690768606"><span class="hs-identifier hs-var">objectId</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690768602"><span class="hs-identifier hs-var">definition</span></a></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span>    </span><span id="local-6989586621690768597"><span class="annot"><span class="annottext">mkCronTriggerMetadataObject :: CronTriggerMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768597"><span class="hs-identifier hs-var hs-var">mkCronTriggerMetadataObject</span></a></span></span><span> </span><span id="local-6989586621690768596"><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768596"><span class="hs-identifier hs-var">catalogCronTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1010"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768595"><span class="annot"><span class="annottext">definition :: Value
</span><a href="#local-6989586621690768595"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768596"><span class="hs-identifier hs-var">catalogCronTrigger</span></a></span><span>
</span><span id="line-1011"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span>
</span><span id="line-1012"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOCronTrigger"><span class="hs-identifier hs-var">MOCronTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768596"><span class="hs-identifier hs-var">catalogCronTrigger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>            </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690768595"><span class="hs-identifier hs-var">definition</span></a></span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span>    </span><span id="local-6989586621690768796"><span class="annot"><span class="annottext">mkActionMetadataObject :: ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768796"><span class="hs-identifier hs-var hs-var">mkActionMetadataObject</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionMetadata"><span class="hs-identifier hs-type">ActionMetadata</span></a></span><span> </span><span id="local-6989586621690768589"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690768589"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621690768588"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690768588"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span id="local-6989586621690768587"><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621690768587"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ActionPermissionMetadata]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1016"></span><span>      </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOAction"><span class="hs-identifier hs-var">MOAction</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690768589"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; ActionDefinitionInput -&gt; Maybe Text -&gt; CreateAction
</span><a href="Hasura.RQL.DDL.Action.html#CreateAction"><span class="hs-identifier hs-var">CreateAction</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690768589"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621690768587"><span class="hs-identifier hs-var">defn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690768588"><span class="hs-identifier hs-var">comment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>    </span><span id="local-6989586621690768582"><span class="annot"><span class="annottext">mkInheritedRoleMetadataObject :: Role -&gt; MetadataObject
</span><a href="#local-6989586621690768582"><span class="hs-identifier hs-var hs-var">mkInheritedRoleMetadataObject</span></a></span></span><span> </span><span id="local-6989586621690768581"><span class="annot"><span class="annottext">inheritedRole :: Role
</span><a href="#local-6989586621690768581"><span class="hs-identifier hs-var">inheritedRole</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span id="local-6989586621690768580"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621690768580"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span class="annot"><span class="annottext">ParentRoles
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1019"></span><span>      </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOInheritedRole"><span class="hs-identifier hs-var">MOInheritedRole</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621690768580"><span class="hs-identifier hs-var">roleName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768581"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span>    </span><span class="annot"><a href="#local-6989586621690768869"><span class="hs-identifier hs-type">buildTableEventTriggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1022"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690771088"><span class="annot"><a href="#local-6989586621690771088"><span class="hs-identifier hs-type">arr</span></a></span></span><span> </span><span id="local-6989586621690771087"><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621690771086"><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ArrowChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771088"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1024"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowDistribute</span></span><span> </span><span class="annot"><a href="#local-6989586621690771088"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1025"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ArrowWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771088"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1026"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.ArrowCache</span></span><span> </span><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771088"><span class="hs-identifier hs-type">arr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1027"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1028"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1029"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1030"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#BuildReason"><span class="hs-identifier hs-type">BuildReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1031"></span><span>        </span><span class="annot"><a href="Hasura.Server.Types.html#HasServerConfigCtx"><span class="hs-identifier hs-type">HasServerConfigCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771087"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1032"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1033"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1034"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1035"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1036"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SourceConfiguration.html#SourceConfig"><span class="hs-identifier hs-type">SourceConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1037"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.Table.html#TableCoreInfoG"><span class="hs-identifier hs-type">TableCoreInfoG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Column.html#ColumnInfo"><span class="hs-identifier hs-type">ColumnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1038"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerConf"><span class="hs-identifier hs-type">EventTriggerConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1039"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Inc.Dependency</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Inc.InvalidationKey</span></span><span class="hs-special">,</span><span>
</span><span id="line-1040"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#RecreateEventTriggers"><span class="hs-identifier hs-type">RecreateEventTriggers</span></a></span><span>
</span><span id="line-1041"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>        </span><span class="annot"><a href="#local-6989586621690771088"><span class="hs-operator hs-type">`arr`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventTriggerInfoMap"><span class="hs-identifier hs-type">EventTriggerInfoMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>    </span><span id="local-6989586621690768869"><span class="annot"><span class="annottext">buildTableEventTriggers :: forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) (b :: BackendType).
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter
   (Seq (Either InconsistentMetadata MetadataDependency)) arr,
 ArrowCache m arr, MonadIO m, MonadError QErr m,
 MonadBaseControl IO m, MonadReader BuildReason m,
 HasServerConfigCtx m, BackendMetadata b, BackendEventTrigger b) =&gt;
arr
  (SourceName, SourceConfig b,
   TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
   [EventTriggerConf b], Dependency InvalidationKey,
   RecreateEventTriggers)
  (EventTriggerInfoMap b)
</span><a href="#local-6989586621690768869"><span class="hs-identifier hs-var hs-var">buildTableEventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768474"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768474"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768473"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768473"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768472"><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768472"><span class="hs-identifier hs-var">tableInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768471"><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621690768471"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768470"><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621690768470"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768469"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768469"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1044"></span><span>      </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) md k a e b.
(ArrowChoice arr, ArrowDistribute arr,
 ArrowWriter (Seq (Either InconsistentMetadata md)) arr,
 Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; arr (e, a) (Maybe b)
-&gt; arr (e, [a]) (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMap"><span class="hs-identifier hs-var">buildInfoMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). EventTriggerConf b -&gt; TriggerName
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcName"><span class="hs-identifier hs-var">etcName</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. Field6 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_6</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) a c.
Backend b =&gt;
(a, SourceName, c, TableName b, RecreateEventTriggers,
 EventTriggerConf b)
-&gt; MetadataObject
</span><a href="#local-6989586621690768626"><span class="hs-identifier hs-var">mkEventTriggerMetadataObject</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">arr
  (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
   (Dependency InvalidationKey, SourceName, SourceConfig b,
    TableName b, RecreateEventTriggers, EventTriggerConf b))
  (Maybe (EventTriggerInfo b))
</span><a href="#local-6989586621690768466"><span class="hs-identifier hs-var">buildEventTrigger</span></a></span><span>
</span><span id="line-1045"></span><span>        </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1046"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768472"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621690768470"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768474"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768473"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; TableName b
</span><a href="Hasura.RQL.Types.Table.html#_tciName"><span class="hs-identifier hs-var">_tciName</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768472"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768469"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EventTriggerConf b]
</span><a href="#local-6989586621690768471"><span class="hs-identifier hs-var">eventTriggerConfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1048"></span><span>        </span><span id="local-6989586621690768466"><span class="annot"><span class="annottext">buildEventTrigger :: arr
  (TableCoreInfoG b (ColumnInfo b) (ColumnInfo b),
   (Dependency InvalidationKey, SourceName, SourceConfig b,
    TableName b, RecreateEventTriggers, EventTriggerConf b))
  (Maybe (EventTriggerInfo b))
</span><a href="#local-6989586621690768466"><span class="hs-identifier hs-var hs-var">buildEventTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">proc</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768464"><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768464"><span class="hs-identifier hs-var">tableInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690768463"><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621690768463"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768462"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768462"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768461"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768461"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768460"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768459"><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768459"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768458"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1049"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768457"><span class="annot"><span class="annottext">triggerName :: TriggerName
</span><a href="#local-6989586621690768457"><span class="hs-identifier hs-var hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). EventTriggerConf b -&gt; TriggerName
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcName"><span class="hs-identifier hs-var">etcName</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1050"></span><span>              </span><span id="local-6989586621690768456"><span class="annot"><span class="annottext">triggerOnReplication :: TriggerOnReplication
</span><a href="#local-6989586621690768456"><span class="hs-identifier hs-var hs-var">triggerOnReplication</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
EventTriggerConf b -&gt; TriggerOnReplication
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcTriggerOnReplication"><span class="hs-identifier hs-var">etcTriggerOnReplication</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1051"></span><span>              </span><span id="local-6989586621690768454"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621690768454"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) a c.
Backend b =&gt;
(a, SourceName, c, TableName b, RecreateEventTriggers,
 EventTriggerConf b)
-&gt; MetadataObject
</span><a href="#local-6989586621690768626"><span class="hs-identifier hs-var">mkEventTriggerMetadataObject</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependency InvalidationKey
</span><a href="#local-6989586621690768463"><span class="hs-identifier hs-var">metadataInvalidationKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768462"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768461"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768459"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>              </span><span id="local-6989586621690768453"><span class="annot"><span class="annottext">schemaObjectId :: SchemaObjId
</span><a href="#local-6989586621690768453"><span class="hs-identifier hs-var hs-var">schemaObjectId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1053"></span><span>                </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceObjId -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOSourceObj"><span class="hs-identifier hs-var">SOSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768462"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1054"></span><span>                  </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1055"></span><span>                    </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableName b -&gt; TableObjId b -&gt; SourceObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SOITableObj"><span class="hs-identifier hs-var">SOITableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1056"></span><span>                      </span><span class="annot"><span class="annottext">forall (b :: BackendType). TriggerName -&gt; TableObjId b
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#TOTrigger"><span class="hs-identifier hs-var">TOTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768457"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1057"></span><span>              </span><span id="local-6989586621690768450"><span class="annot"><span class="annottext">addTriggerContext :: Text -&gt; Text
</span><a href="#local-6989586621690768450"><span class="hs-identifier hs-var hs-var">addTriggerContext</span></a></span></span><span> </span><span id="local-6989586621690768449"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768449"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in event trigger &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768457"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768449"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1058"></span><span>          </span><span id="local-6989586621690768448"><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690768448"><span class="hs-identifier hs-var">buildReason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-1059"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768446"><span class="annot"><span class="annottext">reloadMetadataRecreateEventTrigger :: RecreateEventTriggers
</span><a href="#local-6989586621690768446"><span class="hs-identifier hs-var hs-var">reloadMetadataRecreateEventTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1060"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690768448"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1061"></span><span>                  </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span>
</span><span id="line-1062"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span>
</span><span id="line-1063"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690768444"><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621690768444"><span class="hs-identifier hs-var">sources</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768462"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621690768444"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETRecreate"><span class="hs-identifier hs-var">RETRecreate</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETDoNothing"><span class="hs-identifier hs-var">RETDoNothing</span></a></span><span>
</span><span id="line-1064"></span><span>          </span><span class="hs-glyph">(|</span><span>
</span><span id="line-1065"></span><span>            </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) md e s a.
(ArrowChoice arr,
 ArrowWriter (Seq (Either InconsistentMetadata md)) arr) =&gt;
ErrorA QErr arr (e, s) a -&gt; arr (e, (MetadataObject, s)) (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistency"><span class="hs-identifier hs-var">withRecordInconsistency</span></a></span><span>
</span><span id="line-1066"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1067"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621690768440"><span class="annot"><span class="annottext">EventTriggerInfo b
</span><a href="#local-6989586621690768440"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768439"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621690768439"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (arr :: * -&gt; * -&gt; *) (m :: * -&gt; *) e a.
(ArrowChoice arr, ArrowKleisli m arr, ArrowError e arr,
 MonadError e m) =&gt;
arr (m a) a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#bindErrorA"><span class="hs-identifier hs-var">bindErrorA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). Backend b =&gt; TableName b -&gt; Text -&gt; Text
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#addTableContext"><span class="hs-identifier hs-var">addTableContext</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690768450"><span class="hs-identifier hs-var">addTriggerContext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(Backend b, QErrM m) =&gt;
Environment
-&gt; SourceName
-&gt; TableName b
-&gt; EventTriggerConf b
-&gt; m (EventTriggerInfo b, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#buildEventTriggerInfo"><span class="hs-identifier hs-var">buildEventTriggerInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690768462"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span>
</span><span id="line-1068"></span><span>                  </span><span id="local-6989586621690768436"><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690768436"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-1069"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768435"><span class="annot"><span class="annottext">isCatalogUpdate :: Bool
</span><a href="#local-6989586621690768435"><span class="hs-identifier hs-var hs-var">isCatalogUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1070"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690768448"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1071"></span><span>                          </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HashSet SourceName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1072"></span><span>                          </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1073"></span><span>                      </span><span id="local-6989586621690768434"><span class="annot"><span class="annottext">tableColumns :: [ColumnInfo b]
</span><a href="#local-6989586621690768434"><span class="hs-identifier hs-var hs-var">tableColumns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn -&gt; FieldInfoMap field
</span><a href="Hasura.RQL.Types.Table.html#_tciFieldInfoMap"><span class="hs-identifier hs-var">_tciFieldInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768464"><span class="hs-identifier hs-var">tableInfo</span></a></span><span>
</span><span id="line-1074"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.Types.html#_sccMaintenanceMode"><span class="hs-identifier hs-var">_sccMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690768436"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. MaintenanceMode a
</span><a href="Hasura.Server.Types.html#MaintenanceModeDisabled"><span class="hs-identifier hs-var">MaintenanceModeDisabled</span></a></span><span>
</span><span id="line-1075"></span><span>                         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; ReadOnlyMode
</span><a href="Hasura.Server.Types.html#_sccReadOnlyMode"><span class="hs-identifier hs-var">_sccReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690768436"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeDisabled"><span class="hs-identifier hs-var">ReadOnlyModeDisabled</span></a></span><span>
</span><span id="line-1076"></span><span>                     </span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1078"></span><span>                      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-1079"></span><span>                        </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1080"></span><span>                          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768446"><span class="hs-identifier hs-var">reloadMetadataRecreateEventTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETRecreate"><span class="hs-identifier hs-var">RETRecreate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1081"></span><span>                            </span><span class="hs-comment">-- This is the case when the user sets `recreate_event_triggers`</span><span>
</span><span id="line-1082"></span><span>                            </span><span class="hs-comment">-- to `true` in `reload_metadata`, in this case, we recreate</span><span>
</span><span id="line-1083"></span><span>                            </span><span class="hs-comment">-- the SQL trigger by force, even if it may not be necessary</span><span>
</span><span id="line-1084"></span><span>                            </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1085"></span><span>                              </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadBaseControl IO m, MonadIO m,
 MonadError QErr m) =&gt;
ServerConfigCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; [ColumnInfo b]
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
-&gt; m (Either QErr ())
</span><a href="Hasura.RQL.Types.Eventing.Backend.html#createTableEventTrigger"><span class="hs-identifier hs-var">createTableEventTrigger</span></a></span><span>
</span><span id="line-1086"></span><span>                                </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1087"></span><span>                                </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690768436"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-1088"></span><span>                                </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768461"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1089"></span><span>                                </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1090"></span><span>                                </span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621690768434"><span class="hs-identifier hs-var">tableColumns</span></a></span><span>
</span><span id="line-1091"></span><span>                                </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768457"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1092"></span><span>                                </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621690768456"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span>
</span><span id="line-1093"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
</span><a href="Hasura.RQL.Types.Table.html#_tciPrimaryKey"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768464"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690768435"><span class="hs-identifier hs-var">isCatalogUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="#local-6989586621690768459"><span class="hs-identifier hs-var">migrationRecreateEventTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">RecreateEventTriggers
</span><a href="Hasura.RQL.Types.EventTrigger.html#RETRecreate"><span class="hs-identifier hs-var">RETRecreate</span></a></span><span>
</span><span id="line-1096"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1097"></span><span>                          </span><span class="annot"><span class="annottext">ErrorA
  QErr
  arr
  (TableName b, [ColumnInfo b], TriggerName, TriggerOnReplication,
   TriggerOpsDef b, SourceConfig b,
   Maybe (PrimaryKey b (ColumnInfo b)))
  ()
</span><a href="#local-6989586621690768424"><span class="hs-identifier hs-var">recreateTriggerIfNeeded</span></a></span><span>
</span><span id="line-1098"></span><span>                            </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1099"></span><span>                              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1100"></span><span>                                </span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621690768434"><span class="hs-identifier hs-var">tableColumns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1101"></span><span>                                </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768457"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1102"></span><span>                                </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621690768456"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1103"></span><span>                                </span><span class="annot"><span class="annottext">forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1104"></span><span>                                </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768461"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1105"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
</span><a href="Hasura.RQL.Types.Table.html#_tciPrimaryKey"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768464"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>                              </span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>                          </span><span class="hs-comment">-- We check if the SQL triggers for the event triggers</span><span>
</span><span id="line-1108"></span><span>                          </span><span class="hs-comment">-- are present. If any SQL triggers are missing, those are</span><span>
</span><span id="line-1109"></span><span>                          </span><span class="hs-comment">-- created.</span><span>
</span><span id="line-1110"></span><span>                          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-1111"></span><span>                            </span><span class="hs-glyph">-&lt;</span><span>
</span><span id="line-1112"></span><span>                              </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadIO m, MonadError QErr m,
 MonadBaseControl IO m, Backend b, HasServerConfigCtx m) =&gt;
SourceConfig b
-&gt; TableName b
-&gt; ([ColumnInfo b], Maybe (PrimaryKey b (ColumnInfo b)))
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; m ()
</span><a href="Hasura.RQL.Types.Eventing.Backend.html#createMissingSQLTriggers"><span class="hs-identifier hs-var">createMissingSQLTriggers</span></a></span><span>
</span><span id="line-1113"></span><span>                                </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768461"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1114"></span><span>                                </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768460"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1115"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621690768434"><span class="hs-identifier hs-var">tableColumns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) field primaryKeyColumn.
TableCoreInfoG b field primaryKeyColumn
-&gt; Maybe (PrimaryKey b primaryKeyColumn)
</span><a href="Hasura.RQL.Types.Table.html#_tciPrimaryKey"><span class="hs-identifier hs-var">_tciPrimaryKey</span></a></span><span> </span><span class="annot"><span class="annottext">TableCoreInfoG b (ColumnInfo b) (ColumnInfo b)
</span><a href="#local-6989586621690768464"><span class="hs-identifier hs-var">tableInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span>                                </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768457"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1117"></span><span>                                </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621690768456"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span>
</span><span id="line-1118"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621690768458"><span class="hs-identifier hs-var">eventTriggerConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1119"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>                  </span><span class="annot"><span class="annottext">forall im (arr :: * -&gt; * -&gt; *).
ArrowWriter (Seq (Either im MetadataDependency)) arr =&gt;
arr (MetadataObject, SchemaObjId, Seq SchemaDependency) ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependencies"><span class="hs-identifier hs-var">recordDependencies</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768454"><span class="hs-identifier hs-var">metadataObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621690768453"><span class="hs-identifier hs-var">schemaObjectId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621690768439"><span class="hs-identifier hs-var">dependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>                  </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b. Arrow a =&gt; a b b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">returnA</span></a></span><span> </span><span class="hs-glyph">-&lt;</span><span> </span><span class="annot"><span class="annottext">EventTriggerInfo b
</span><a href="#local-6989586621690768440"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1123"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>            </span><span class="hs-glyph">|)</span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768454"><span class="hs-identifier hs-var">metadataObject</span></a></span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>        </span><span id="local-6989586621690768424"><span class="annot"><span class="annottext">recreateTriggerIfNeeded :: ErrorA
  QErr
  arr
  (TableName b, [ColumnInfo b], TriggerName, TriggerOnReplication,
   TriggerOpsDef b, SourceConfig b,
   Maybe (PrimaryKey b (ColumnInfo b)))
  ()
</span><a href="#local-6989586621690768424"><span class="hs-identifier hs-var hs-var">recreateTriggerIfNeeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1127"></span><span>          </span><span class="hs-comment">-- using `Inc.cache` here means that the response will be cached for the given output and the</span><span>
</span><span id="line-1128"></span><span>          </span><span class="hs-comment">-- next time this arrow recieves the same input, the cached response will be returned and the</span><span>
</span><span id="line-1129"></span><span>          </span><span class="hs-comment">-- computation will not be done again.</span><span>
</span><span id="line-1130"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a b.
(ArrowCache m arr, Given Accesses =&gt; Eq a) =&gt;
arr a b -&gt; arr a b
</span><span class="hs-identifier hs-var">Inc.cache</span></span><span>
</span><span id="line-1131"></span><span>            </span><span class="hs-keyword">proc</span><span>
</span><span id="line-1132"></span><span>              </span><span class="hs-special">(</span><span> </span><span id="local-6989586621690768421"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768421"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1133"></span><span>                </span><span id="local-6989586621690768420"><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621690768420"><span class="hs-identifier hs-var">tableColumns</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1134"></span><span>                </span><span id="local-6989586621690768419"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768419"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1135"></span><span>                </span><span id="local-6989586621690768418"><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621690768418"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1136"></span><span>                </span><span id="local-6989586621690768417"><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621690768417"><span class="hs-identifier hs-var">triggerDefinition</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1137"></span><span>                </span><span id="local-6989586621690768416"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768416"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1138"></span><span>                </span><span id="local-6989586621690768415"><span class="annot"><span class="annottext">Maybe (PrimaryKey b (ColumnInfo b))
</span><a href="#local-6989586621690768415"><span class="hs-identifier hs-var">primaryKey</span></a></span></span><span>
</span><span id="line-1139"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1141"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (arr :: * -&gt; * -&gt; *) a.
ArrowKleisli m arr =&gt;
arr (m a) a
</span><span class="hs-identifier hs-var">bindA</span></span><span>
</span><span id="line-1142"></span><span>                </span><span class="hs-glyph">-&lt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1143"></span><span>                  </span><span id="local-6989586621690768414"><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690768414"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasServerConfigCtx m =&gt; m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#askServerConfigCtx"><span class="hs-identifier hs-var">askServerConfigCtx</span></a></span><span>
</span><span id="line-1144"></span><span>                  </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1145"></span><span>                    </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadBaseControl IO m, MonadIO m,
 MonadError QErr m) =&gt;
ServerConfigCtx
-&gt; SourceConfig b
-&gt; TableName b
-&gt; [ColumnInfo b]
-&gt; TriggerName
-&gt; TriggerOnReplication
-&gt; TriggerOpsDef b
-&gt; Maybe (PrimaryKey b (ColumnInfo b))
-&gt; m (Either QErr ())
</span><a href="Hasura.RQL.Types.Eventing.Backend.html#createTableEventTrigger"><span class="hs-identifier hs-var">createTableEventTrigger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690771086"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1146"></span><span>                      </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690768414"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-1147"></span><span>                      </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690768416"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-1148"></span><span>                      </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621690768421"><span class="hs-identifier hs-var">tableName</span></a></span><span>
</span><span id="line-1149"></span><span>                      </span><span class="annot"><span class="annottext">[ColumnInfo b]
</span><a href="#local-6989586621690768420"><span class="hs-identifier hs-var">tableColumns</span></a></span><span>
</span><span id="line-1150"></span><span>                      </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690768419"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-1151"></span><span>                      </span><span class="annot"><span class="annottext">TriggerOnReplication
</span><a href="#local-6989586621690768418"><span class="hs-identifier hs-var">triggerOnReplication</span></a></span><span>
</span><span id="line-1152"></span><span>                      </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621690768417"><span class="hs-identifier hs-var">triggerDefinition</span></a></span><span>
</span><span id="line-1153"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (PrimaryKey b (ColumnInfo b))
</span><a href="#local-6989586621690768415"><span class="hs-identifier hs-var">primaryKey</span></a></span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>    </span><span id="local-6989586621690771571"><span id="local-6989586621690771572"><span class="annot"><a href="#local-6989586621690770068"><span class="hs-identifier hs-type">buildCronTriggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1156"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771572"><span class="hs-identifier hs-type">md</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771571"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1157"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronTriggerMetadata"><span class="hs-identifier hs-type">CronTriggerMetadata</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1158"></span><span>      </span><span class="annot"><a href="#local-6989586621690771571"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1159"></span><span>    </span><span id="local-6989586621690770068"><span class="annot"><span class="annottext">buildCronTriggers :: forall md (m :: * -&gt; *).
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
[CronTriggerMetadata] -&gt; m (HashMap TriggerName CronTriggerInfo)
</span><a href="#local-6989586621690770068"><span class="hs-identifier hs-var hs-var">buildCronTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) k a b.
(MonadWriter (Seq (Either InconsistentMetadata md)) m,
 Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768597"><span class="hs-identifier hs-var">mkCronTriggerMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; m (Maybe CronTriggerInfo)
</span><a href="#local-6989586621690768401"><span class="hs-identifier hs-var">buildCronTrigger</span></a></span><span>
</span><span id="line-1160"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1161"></span><span>        </span><span id="local-6989586621690768401"><span class="annot"><span class="annottext">buildCronTrigger :: CronTriggerMetadata -&gt; m (Maybe CronTriggerInfo)
</span><a href="#local-6989586621690768401"><span class="hs-identifier hs-var hs-var">buildCronTrigger</span></a></span></span><span> </span><span id="local-6989586621690768400"><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768400"><span class="hs-identifier hs-var">cronTrigger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768399"><span class="annot"><span class="annottext">triggerName :: Text
</span><a href="#local-6989586621690768399"><span class="hs-identifier hs-var hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768400"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span>
</span><span id="line-1163"></span><span>              </span><span id="local-6989586621690768397"><span class="annot"><span class="annottext">addCronTriggerContext :: Text -&gt; Text
</span><a href="#local-6989586621690768397"><span class="hs-identifier hs-var hs-var">addCronTriggerContext</span></a></span></span><span> </span><span id="local-6989586621690768396"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768396"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in cron trigger &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768399"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768396"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1164"></span><span>          </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768597"><span class="hs-identifier hs-var">mkCronTriggerMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768400"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1165"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690768397"><span class="hs-identifier hs-var">addCronTriggerContext</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1166"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
QErrM m =&gt;
Environment -&gt; CronTriggerMetadata -&gt; m CronTriggerInfo
</span><a href="Hasura.RQL.DDL.ScheduledTrigger.html#resolveCronTrigger"><span class="hs-identifier hs-var">resolveCronTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621690768400"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>    </span><span id="local-6989586621690771129"><span class="annot"><a href="#local-6989586621690769012"><span class="hs-identifier hs-type">buildInheritedRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1169"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771129"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1170"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1171"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#InheritedRole"><span class="hs-identifier hs-type">InheritedRole</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1172"></span><span>      </span><span class="annot"><a href="#local-6989586621690771129"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Session.html#RoleName"><span class="hs-identifier hs-type">RoleName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1173"></span><span>    </span><span id="local-6989586621690769012"><span class="annot"><span class="annottext">buildInheritedRoles :: forall (m :: * -&gt; *).
MonadWriter
  (Seq (Either InconsistentMetadata MetadataDependency)) m =&gt;
HashSet RoleName -&gt; [Role] -&gt; m (HashMap RoleName Role)
</span><a href="#local-6989586621690769012"><span class="hs-identifier hs-var hs-var">buildInheritedRoles</span></a></span></span><span> </span><span id="local-6989586621690768374"><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621690768374"><span class="hs-identifier hs-var">allRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) k a b.
(MonadWriter (Seq (Either InconsistentMetadata md)) m,
 Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; MetadataObject
</span><a href="#local-6989586621690768582"><span class="hs-identifier hs-var">mkInheritedRoleMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; m (Maybe Role)
</span><a href="#local-6989586621690768373"><span class="hs-identifier hs-var">buildInheritedRole</span></a></span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1175"></span><span>        </span><span id="local-6989586621690768373"><span class="annot"><span class="annottext">buildInheritedRole :: Role -&gt; m (Maybe Role)
</span><a href="#local-6989586621690768373"><span class="hs-identifier hs-var hs-var">buildInheritedRole</span></a></span></span><span> </span><span id="local-6989586621690768372"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768372"><span class="hs-identifier hs-var">inheritedRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1176"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768371"><span class="annot"><span class="annottext">addInheritedRoleContext :: Text -&gt; Text
</span><a href="#local-6989586621690768371"><span class="hs-identifier hs-var hs-var">addInheritedRoleContext</span></a></span></span><span> </span><span id="local-6989586621690768370"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768370"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in inherited role &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; Text
</span><a href="Hasura.Session.html#roleNameToTxt"><span class="hs-identifier hs-var">roleNameToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768372"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768370"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1177"></span><span>              </span><span id="local-6989586621690768368"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621690768368"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; MetadataObject
</span><a href="#local-6989586621690768582"><span class="hs-identifier hs-var">mkInheritedRoleMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768372"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span>
</span><span id="line-1178"></span><span>              </span><span id="local-6989586621690768367"><span class="annot"><span class="annottext">schemaObject :: SchemaObjId
</span><a href="#local-6989586621690768367"><span class="hs-identifier hs-var hs-var">schemaObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SORole"><span class="hs-identifier hs-var">SORole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; RoleName
</span><a href="Hasura.RQL.Types.Roles.html#_rRoleName"><span class="hs-identifier hs-var">_rRoleName</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768372"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span>
</span><span id="line-1179"></span><span>          </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768368"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690768371"><span class="hs-identifier hs-var">addInheritedRoleContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1180"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621690768365"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768365"><span class="hs-identifier hs-var">resolvedInheritedRole</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768364"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621690768364"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
HashSet RoleName -&gt; Role -&gt; m (Role, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.InheritedRoles.html#resolveInheritedRole"><span class="hs-identifier hs-var">resolveInheritedRole</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RoleName
</span><a href="#local-6989586621690768374"><span class="hs-identifier hs-var">allRoles</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768372"><span class="hs-identifier hs-var">inheritedRole</span></a></span><span>
</span><span id="line-1181"></span><span>            </span><span class="annot"><span class="annottext">forall im (m :: * -&gt; *).
MonadWriter (Seq (Either im MetadataDependency)) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768368"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621690768367"><span class="hs-identifier hs-var">schemaObject</span></a></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621690768364"><span class="hs-identifier hs-var">dependencies</span></a></span><span>
</span><span id="line-1182"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621690768365"><span class="hs-identifier hs-var">resolvedInheritedRole</span></a></span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span>    </span><span id="local-6989586621690771070"><span class="annot"><a href="#local-6989586621690768798"><span class="hs-identifier hs-type">buildActions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1185"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771070"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1186"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.CustomTypes.html#AnnotatedCustomTypes"><span class="hs-identifier hs-type">AnnotatedCustomTypes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1187"></span><span>      </span><span class="annot"><a href="Hasura.SQL.BackendMap.html#BackendMap"><span class="hs-identifier hs-type">BackendMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#ScalarMap"><span class="hs-identifier hs-type">ScalarMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1188"></span><span>      </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#OrderedRoles"><span class="hs-identifier hs-type">OrderedRoles</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1189"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionMetadata"><span class="hs-identifier hs-type">ActionMetadata</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1190"></span><span>      </span><span class="annot"><a href="#local-6989586621690771070"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionName"><span class="hs-identifier hs-type">ActionName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionInfo"><span class="hs-identifier hs-type">ActionInfo</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1191"></span><span>    </span><span id="local-6989586621690768798"><span class="annot"><span class="annottext">buildActions :: forall (m :: * -&gt; *).
MonadWriter
  (Seq (Either InconsistentMetadata MetadataDependency)) m =&gt;
AnnotatedCustomTypes
-&gt; BackendMap ScalarMap
-&gt; OrderedRoles
-&gt; [ActionMetadata]
-&gt; m ActionCache
</span><a href="#local-6989586621690768798"><span class="hs-identifier hs-var hs-var">buildActions</span></a></span></span><span> </span><span id="local-6989586621690768347"><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768347"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span></span><span> </span><span id="local-6989586621690768346"><span class="annot"><span class="annottext">BackendMap ScalarMap
</span><a href="#local-6989586621690768346"><span class="hs-identifier hs-var">scalarsMap</span></a></span></span><span> </span><span id="local-6989586621690768345"><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690768345"><span class="hs-identifier hs-var">orderedRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) k a b.
(MonadWriter (Seq (Either InconsistentMetadata md)) m,
 Hashable k) =&gt;
(a -&gt; k)
-&gt; (a -&gt; MetadataObject)
-&gt; (a -&gt; m (Maybe b))
-&gt; [a]
-&gt; m (HashMap k b)
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#buildInfoMapM"><span class="hs-identifier hs-var">buildInfoMapM</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; ActionName
</span><a href="Hasura.RQL.Types.Action.html#_amName"><span class="hs-identifier hs-var">_amName</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768796"><span class="hs-identifier hs-var">mkActionMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata -&gt; m (Maybe ActionInfo)
</span><a href="#local-6989586621690768343"><span class="hs-identifier hs-var">buildAction</span></a></span><span>
</span><span id="line-1192"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1193"></span><span>        </span><span id="local-6989586621690768343"><span class="annot"><span class="annottext">buildAction :: ActionMetadata -&gt; m (Maybe ActionInfo)
</span><a href="#local-6989586621690768343"><span class="hs-identifier hs-var hs-var">buildAction</span></a></span></span><span> </span><span id="local-6989586621690768342"><span class="annot"><span class="annottext">action :: ActionMetadata
</span><a href="#local-6989586621690768342"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Action.html#ActionMetadata"><span class="hs-identifier hs-type">ActionMetadata</span></a></span><span> </span><span id="local-6989586621690768341"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690768341"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621690768340"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690768340"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span id="local-6989586621690768339"><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621690768339"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621690768338"><span class="annot"><span class="annottext">[ActionPermissionMetadata]
</span><a href="#local-6989586621690768338"><span class="hs-identifier hs-var">actionPermissions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1194"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768337"><span class="annot"><span class="annottext">addActionContext :: Text -&gt; Text
</span><a href="#local-6989586621690768337"><span class="hs-identifier hs-var hs-var">addActionContext</span></a></span></span><span> </span><span id="local-6989586621690768336"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768336"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in action &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690768341"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768336"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1195"></span><span>              </span><span id="local-6989586621690768335"><span class="annot"><span class="annottext">permissionInfos :: [ActionPermissionInfo]
</span><a href="#local-6989586621690768335"><span class="hs-identifier hs-var hs-var">permissionInfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName -&gt; ActionPermissionInfo
</span><a href="Hasura.RQL.Types.Action.html#ActionPermissionInfo"><span class="hs-identifier hs-var">ActionPermissionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ActionPermissionMetadata -&gt; RoleName
</span><a href="Hasura.RQL.Types.Action.html#_apmRole"><span class="hs-identifier hs-var">_apmRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ActionPermissionMetadata]
</span><a href="#local-6989586621690768338"><span class="hs-identifier hs-var">actionPermissions</span></a></span><span>
</span><span id="line-1196"></span><span>              </span><span id="local-6989586621690768333"><span class="annot"><span class="annottext">metadataPermissionMap :: HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621690768333"><span class="hs-identifier hs-var hs-var">metadataPermissionMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Hashable k =&gt; (a -&gt; k) -&gt; [a] -&gt; HashMap k a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">mapFromL</span></a></span><span> </span><span class="annot"><span class="annottext">ActionPermissionInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Action.html#_apiRole"><span class="hs-identifier hs-var">_apiRole</span></a></span><span> </span><span class="annot"><span class="annottext">[ActionPermissionInfo]
</span><a href="#local-6989586621690768335"><span class="hs-identifier hs-var">permissionInfos</span></a></span><span>
</span><span id="line-1197"></span><span>              </span><span id="local-6989586621690768331"><span class="annot"><span class="annottext">permissionsMap :: HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621690768331"><span class="hs-identifier hs-var hs-var">permissionsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(RoleName -&gt; a)
-&gt; HashMap RoleName a -&gt; OrderedRoles -&gt; HashMap RoleName a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Permission.html#mkBooleanPermissionMap"><span class="hs-identifier hs-var">mkBooleanPermissionMap</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; ActionPermissionInfo
</span><a href="Hasura.RQL.Types.Action.html#ActionPermissionInfo"><span class="hs-identifier hs-var">ActionPermissionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621690768333"><span class="hs-identifier hs-var">metadataPermissionMap</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedRoles
</span><a href="#local-6989586621690768345"><span class="hs-identifier hs-var">orderedRoles</span></a></span><span>
</span><span id="line-1198"></span><span>              </span><span id="local-6989586621690768330"><span class="annot"><span class="annottext">outputType :: GType
</span><a href="#local-6989586621690768330"><span class="hs-identifier hs-var hs-var">outputType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphQLType -&gt; GType
</span><a href="Hasura.RQL.Types.CustomTypes.html#unGraphQLType"><span class="hs-identifier hs-var">unGraphQLType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall arg webhook. ActionDefinition arg webhook -&gt; GraphQLType
</span><a href="Hasura.RQL.Types.Action.html#_adOutputType"><span class="hs-identifier hs-var">_adOutputType</span></a></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621690768339"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1199"></span><span>          </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionMetadata -&gt; MetadataObject
</span><a href="#local-6989586621690768796"><span class="hs-identifier hs-var">mkActionMetadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">ActionMetadata
</span><a href="#local-6989586621690768342"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690768337"><span class="hs-identifier hs-var">addActionContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1200"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621690768327"><span class="annot"><span class="annottext">ResolvedActionDefinition
</span><a href="#local-6989586621690768327"><span class="hs-identifier hs-var">resolvedDef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768326"><span class="annot"><span class="annottext">AnnotatedOutputType
</span><a href="#local-6989586621690768326"><span class="hs-identifier hs-var">outObject</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
QErrM m =&gt;
Environment
-&gt; AnnotatedCustomTypes
-&gt; ActionDefinitionInput
-&gt; BackendMap ScalarMap
-&gt; m (ResolvedActionDefinition, AnnotatedOutputType)
</span><a href="Hasura.RQL.DDL.Action.html#resolveAction"><span class="hs-identifier hs-var">resolveAction</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690770131"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedCustomTypes
</span><a href="#local-6989586621690768347"><span class="hs-identifier hs-var">resolvedCustomTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ActionDefinitionInput
</span><a href="#local-6989586621690768339"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">BackendMap ScalarMap
</span><a href="#local-6989586621690768346"><span class="hs-identifier hs-var">scalarsMap</span></a></span><span>
</span><span id="line-1201"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768324"><span class="annot"><span class="annottext">forwardClientHeaders :: Bool
</span><a href="#local-6989586621690768324"><span class="hs-identifier hs-var hs-var">forwardClientHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall arg webhook. ActionDefinition arg webhook -&gt; Bool
</span><a href="Hasura.RQL.Types.Action.html#_adForwardClientHeaders"><span class="hs-identifier hs-var">_adForwardClientHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedActionDefinition
</span><a href="#local-6989586621690768327"><span class="hs-identifier hs-var">resolvedDef</span></a></span><span>
</span><span id="line-1202"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
-&gt; (GType, AnnotatedOutputType)
-&gt; ResolvedActionDefinition
-&gt; HashMap RoleName ActionPermissionInfo
-&gt; Bool
-&gt; Maybe Text
-&gt; ActionInfo
</span><a href="Hasura.RQL.Types.Action.html#ActionInfo"><span class="hs-identifier hs-var">ActionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690768341"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GType
</span><a href="#local-6989586621690768330"><span class="hs-identifier hs-var">outputType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnotatedOutputType
</span><a href="#local-6989586621690768326"><span class="hs-identifier hs-var">outObject</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResolvedActionDefinition
</span><a href="#local-6989586621690768327"><span class="hs-identifier hs-var">resolvedDef</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap RoleName ActionPermissionInfo
</span><a href="#local-6989586621690768331"><span class="hs-identifier hs-var">permissionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690768324"><span class="hs-identifier hs-var">forwardClientHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690768340"><span class="hs-identifier hs-var">comment</span></a></span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span id="local-6989586621690771073"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-type">buildRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1205"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#MetadataDependency"><span class="hs-identifier hs-type">MetadataDependency</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690771073"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1206"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html#PartiallyResolvedSource"><span class="hs-identifier hs-type">PartiallyResolvedSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1207"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#PartiallyResolvedRemoteSchemaMap"><span class="hs-identifier hs-type">PartiallyResolvedRemoteSchemaMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1208"></span><span>  </span><span class="annot"><a href="Hasura.RemoteSchema.Metadata.Base.html#RemoteSchemaName"><span class="hs-identifier hs-type">RemoteSchemaName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1209"></span><span>  </span><span class="annot"><a href="Hasura.RemoteSchema.SchemaCache.Types.html#RemoteSchemaIntrospection"><span class="hs-identifier hs-type">RemoteSchemaIntrospection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1210"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-type">G.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1211"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Remote.html#RemoteRelationship"><span class="hs-identifier hs-type">RemoteRelationship</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1212"></span><span>  </span><span class="annot"><a href="#local-6989586621690771073"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Remote.html#RemoteFieldInfo"><span class="hs-identifier hs-type">RemoteFieldInfo</span></a></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.5/graphql-parser-0.2.0.0/opt/doc/html/graphql-parser/src"><span class="hs-identifier hs-type">G.Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1213"></span><span id="buildRemoteSchemaRemoteRelationship"><span class="annot"><span class="annottext">buildRemoteSchemaRemoteRelationship :: forall (m :: * -&gt; *).
MonadWriter
  (Seq (Either InconsistentMetadata MetadataDependency)) m =&gt;
HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; RemoteSchemaName
-&gt; RemoteSchemaIntrospection
-&gt; Name
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; m (Maybe (RemoteFieldInfo Name))
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var hs-var">buildRemoteSchemaRemoteRelationship</span></a></span></span><span> </span><span id="local-6989586621690768298"><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768298"><span class="hs-identifier hs-var">allSources</span></a></span></span><span> </span><span id="local-6989586621690768297"><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690768297"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span></span><span> </span><span id="local-6989586621690768296"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span></span><span> </span><span id="local-6989586621690768295"><span class="annot"><span class="annottext">RemoteSchemaIntrospection
</span><a href="#local-6989586621690768295"><span class="hs-identifier hs-var">remoteSchemaIntrospection</span></a></span></span><span> </span><span id="local-6989586621690768294"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621690768294"><span class="hs-identifier hs-var">typeName</span></a></span></span><span> </span><span id="local-6989586621690768293"><span class="annot"><span class="annottext">rr :: RemoteRelationshipG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768293"><span class="hs-identifier hs-var">rr</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#RemoteRelationship"><span class="hs-identifier hs-type">RemoteRelationship</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690768290"><span id="local-6989586621690768291"><span class="annot"><span class="annottext">RelName
RemoteRelationshipDefinition
_rrDefinition :: forall definition. RemoteRelationshipG definition -&gt; definition
_rrName :: forall definition. RemoteRelationshipG definition -&gt; RelName
_rrDefinition :: RemoteRelationshipDefinition
_rrName :: RelName
</span><a href="Hasura.RQL.Types.Common.html#_rrDefinition"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768287"><span class="annot"><span class="annottext">metadataObject :: MetadataObject
</span><a href="#local-6989586621690768287"><span class="hs-identifier hs-var hs-var">metadataObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1215"></span><span>        </span><span class="annot"><span class="annottext">MetadataObjId -&gt; Value -&gt; MetadataObject
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObject"><span class="hs-identifier hs-var">MetadataObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; Name -&gt; RelName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MORemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">MORemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621690768294"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621690768291"><span class="hs-identifier hs-var">_rrName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1216"></span><span>          </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1217"></span><span>            </span><span class="annot"><span class="annottext">RemoteSchemaName
-&gt; Name
-&gt; RelName
-&gt; RemoteRelationshipDefinition
-&gt; CreateRemoteSchemaRemoteRelationship
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#CreateRemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">CreateRemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621690768294"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621690768291"><span class="hs-identifier hs-var">_rrName</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRelationshipDefinition
</span><a href="#local-6989586621690768290"><span class="hs-identifier hs-var">_rrDefinition</span></a></span><span>
</span><span id="line-1218"></span><span>      </span><span id="local-6989586621690768284"><span class="annot"><span class="annottext">schemaObj :: SchemaObjId
</span><a href="#local-6989586621690768284"><span class="hs-identifier hs-var hs-var">schemaObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; Name -&gt; RelName -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SORemoteSchemaRemoteRelationship"><span class="hs-identifier hs-var">SORemoteSchemaRemoteRelationship</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621690768294"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621690768291"><span class="hs-identifier hs-var">_rrName</span></a></span><span>
</span><span id="line-1219"></span><span>      </span><span id="local-6989586621690768282"><span class="annot"><span class="annottext">addRemoteRelationshipContext :: Text -&gt; Text
</span><a href="#local-6989586621690768282"><span class="hs-identifier hs-var hs-var">addRemoteRelationshipContext</span></a></span></span><span> </span><span id="local-6989586621690768281"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768281"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;in remote relationship&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621690768291"><span class="hs-identifier hs-var">_rrName</span></a></span><span> </span><span class="annot"><span class="annottext">forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690768281"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1220"></span><span>      </span><span class="hs-comment">-- buildRemoteFieldInfo only knows how to construct dependencies on the RHS of the join condition,</span><span>
</span><span id="line-1221"></span><span>      </span><span class="hs-comment">-- so the dependencies on the remote relationship on the LHS entity have to be computed here</span><span>
</span><span id="line-1222"></span><span>      </span><span id="local-6989586621690768280"><span class="annot"><span class="annottext">lhsDependency :: SchemaDependency
</span><a href="#local-6989586621690768280"><span class="hs-identifier hs-var hs-var">lhsDependency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1223"></span><span>        </span><span class="hs-comment">-- a direct dependency on the remote schema on which this is defined</span><span>
</span><span id="line-1224"></span><span>        </span><span class="annot"><span class="annottext">SchemaObjId -&gt; DependencyReason -&gt; SchemaDependency
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SchemaDependency"><span class="hs-identifier hs-var">SchemaDependency</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; SchemaObjId
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#SORemoteSchema"><span class="hs-identifier hs-var">SORemoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DependencyReason
</span><a href="Hasura.RQL.Types.SchemaCacheTypes.html#DRRemoteRelationship"><span class="hs-identifier hs-var">DRRemoteRelationship</span></a></span><span>
</span><span id="line-1225"></span><span>  </span><span class="annot"><span class="annottext">forall md (m :: * -&gt; *) a.
MonadWriter (Seq (Either InconsistentMetadata md)) m =&gt;
MetadataObject -&gt; ExceptT QErr m a -&gt; m (Maybe a)
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withRecordInconsistencyM"><span class="hs-identifier hs-var">withRecordInconsistencyM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768287"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; (Text -&gt; Text) -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#modifyErr"><span class="hs-identifier hs-var">modifyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621690768282"><span class="hs-identifier hs-var">addRemoteRelationshipContext</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1226"></span><span>    </span><span id="local-6989586621690768276"><span class="annot"><span class="annottext">HashMap FieldName Name
</span><a href="#local-6989586621690768276"><span class="hs-identifier hs-var">allowedLHSJoinFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
RemoteSchemaName
-&gt; RemoteSchemaIntrospection -&gt; Name -&gt; m (HashMap FieldName Name)
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#getRemoteSchemaEntityJoinColumns"><span class="hs-identifier hs-var">getRemoteSchemaEntityJoinColumns</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaIntrospection
</span><a href="#local-6989586621690768295"><span class="hs-identifier hs-var">remoteSchemaIntrospection</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621690768294"><span class="hs-identifier hs-var">typeName</span></a></span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621690768275"><span class="annot"><span class="annottext">RemoteFieldInfo Name
</span><a href="#local-6989586621690768275"><span class="hs-identifier hs-var">remoteField</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690768274"><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621690768274"><span class="hs-identifier hs-var">rhsDependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1228"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) lhsJoinField.
QErrM m =&gt;
LHSIdentifier
-&gt; HashMap FieldName lhsJoinField
-&gt; RemoteRelationshipG RemoteRelationshipDefinition
-&gt; HashMap SourceName (AnyBackend PartiallyResolvedSource)
-&gt; PartiallyResolvedRemoteSchemaMap
-&gt; m (RemoteFieldInfo lhsJoinField, Seq SchemaDependency)
</span><a href="Hasura.RQL.DDL.RemoteRelationship.html#buildRemoteFieldInfo"><span class="hs-identifier hs-var">buildRemoteFieldInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; LHSIdentifier
</span><a href="Hasura.RemoteSchema.SchemaCache.Types.html#remoteSchemaToLHSIdentifier"><span class="hs-identifier hs-var">remoteSchemaToLHSIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621690768296"><span class="hs-identifier hs-var">remoteSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName Name
</span><a href="#local-6989586621690768276"><span class="hs-identifier hs-var">allowedLHSJoinFields</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRelationshipG RemoteRelationshipDefinition
</span><a href="#local-6989586621690768293"><span class="hs-identifier hs-var">rr</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (AnyBackend PartiallyResolvedSource)
</span><a href="#local-6989586621690768298"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">PartiallyResolvedRemoteSchemaMap
</span><a href="#local-6989586621690768297"><span class="hs-identifier hs-var">remoteSchemaMap</span></a></span><span>
</span><span id="line-1229"></span><span>    </span><span class="annot"><span class="annottext">forall im (m :: * -&gt; *).
MonadWriter (Seq (Either im MetadataDependency)) m =&gt;
MetadataObject -&gt; SchemaObjId -&gt; Seq SchemaDependency -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#recordDependenciesM"><span class="hs-identifier hs-var">recordDependenciesM</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObject
</span><a href="#local-6989586621690768287"><span class="hs-identifier hs-var">metadataObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaObjId
</span><a href="#local-6989586621690768284"><span class="hs-identifier hs-var">schemaObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaDependency
</span><a href="#local-6989586621690768280"><span class="hs-identifier hs-var">lhsDependency</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Seq a -&gt; Seq a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">Seq.:&lt;|</span></a></span><span> </span><span class="annot"><span class="annottext">Seq SchemaDependency
</span><a href="#local-6989586621690768274"><span class="hs-identifier hs-var">rhsDependencies</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteFieldInfo Name
</span><a href="#local-6989586621690768275"><span class="hs-identifier hs-var">remoteField</span></a></span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span id="local-6989586621690768270"><span id="local-6989586621690768271"></span></span><span class="hs-keyword">data</span><span> </span><span id="BackendInfoAndSourceMetadata"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-var">BackendInfoAndSourceMetadata</span></a></span></span><span> </span><span id="local-6989586621690771359"><span class="annot"><a href="#local-6989586621690771359"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BackendInfoAndSourceMetadata"><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-var">BackendInfoAndSourceMetadata</span></a></span></span><span>
</span><span id="line-1233"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_bcasmBackendInfo"><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; BackendInfo b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmBackendInfo"><span class="hs-identifier hs-var hs-var">_bcasmBackendInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#BackendInfo"><span class="hs-identifier hs-type">BackendInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771359"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1234"></span><span>    </span><span id="_bcasmSourceMetadata"><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendInfoAndSourceMetadata b -&gt; SourceMetadata b
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#_bcasmSourceMetadata"><span class="hs-identifier hs-var hs-var">_bcasmSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690771359"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1235"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1236"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (b :: BackendType) x.
Rep (BackendInfoAndSourceMetadata b) x
-&gt; BackendInfoAndSourceMetadata b
forall (b :: BackendType) x.
BackendInfoAndSourceMetadata b
-&gt; Rep (BackendInfoAndSourceMetadata b) x
$cto :: forall (b :: BackendType) x.
Rep (BackendInfoAndSourceMetadata b) x
-&gt; BackendInfoAndSourceMetadata b
$cfrom :: forall (b :: BackendType) x.
BackendInfoAndSourceMetadata b
-&gt; Rep (BackendInfoAndSourceMetadata b) x
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span id="local-6989586621690768256"><span id="local-6989586621690768258"><span id="local-6989586621690768264"><span id="local-6989586621690770904"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690770904"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690770904"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span id="local-6989586621690768248"><span id="local-6989586621690768253"><span id="local-6989586621690770902"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690770902"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690770902"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#joinBackendInfosToSources"><span class="hs-identifier hs-type">joinBackendInfosToSources</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1243"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#BackendCache"><span class="hs-identifier hs-type">BackendCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1244"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1245"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">InsOrdHashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span id="joinBackendInfosToSources"><span class="annot"><span class="annottext">joinBackendInfosToSources :: BackendCache
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap
     SourceName (AnyBackend BackendInfoAndSourceMetadata)
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#joinBackendInfosToSources"><span class="hs-identifier hs-var hs-var">joinBackendInfosToSources</span></a></span></span><span> </span><span id="local-6989586621690768246"><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690768246"><span class="hs-identifier hs-var">backendInfos</span></a></span></span><span> </span><span id="local-6989586621690768245"><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690768245"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1247"></span><span>  </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall v1 v2 k.
(v1 -&gt; v2) -&gt; InsOrdHashMap k v1 -&gt; InsOrdHashMap k v2
</span><span class="hs-identifier hs-var">OMap.map</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap SourceName BackendSourceMetadata
</span><a href="#local-6989586621690768245"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690768243"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621690768243"><span class="hs-identifier hs-var">abSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1248"></span><span>    </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621690768243"><span class="hs-identifier hs-var">abSourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621690768234"><span id="local-6989586621690768233"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768233"><span class="hs-identifier hs-var">sourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690768234"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1249"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690768232"><span class="annot"><span class="annottext">_bcasmBackendInfo :: BackendInfo b
</span><a href="#local-6989586621690768232"><span class="hs-identifier hs-var hs-var">_bcasmBackendInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType). BackendInfoWrapper b -&gt; BackendInfo b
</span><a href="Hasura.RQL.Types.SchemaCache.html#unBackendInfoWrapper"><span class="hs-identifier hs-var">unBackendInfoWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
BackendMap i -&gt; Maybe (i b)
</span><a href="Hasura.SQL.BackendMap.html#lookup"><span class="hs-identifier hs-var">BackendMap.lookup</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690768234"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCache
</span><a href="#local-6989586621690768246"><span class="hs-identifier hs-var">backendInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>          </span><span id="local-6989586621690768228"><span class="annot"><span class="annottext">_bcasmSourceMetadata :: SourceMetadata b
</span><a href="#local-6989586621690768228"><span class="hs-identifier hs-var hs-var">_bcasmSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621690768233"><span class="hs-identifier hs-var">sourceMetadata</span></a></span><span>
</span><span id="line-1251"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690768234"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html#BackendInfoAndSourceMetadata"><span class="hs-identifier hs-type">BackendInfoAndSourceMetadata</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">BackendInfo b
SourceMetadata b
_bcasmSourceMetadata :: SourceMetadata b
_bcasmBackendInfo :: BackendInfo b
_bcasmSourceMetadata :: SourceMetadata b
_bcasmBackendInfo :: BackendInfo b
</span><a href="#local-6989586621690768228"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span class="hs-comment">{- Note [Keep invalidation keys for inconsistent objects]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After building the schema cache, we prune InvalidationKeys for objects
that no longer exist in the schema to avoid leaking memory for objects
that have been dropped. However, note that we *don&#8217;t* want to drop
keys for objects that are simply inconsistent!

Why? The object is still in the metadata, so next time we reload it,
we&#8217;ll reprocess that object. We want to reuse the cache if its
definition hasn&#8217;t changed, but if we dropped the invalidation key, it
will incorrectly be reprocessed (since the invalidation key changed
from present to absent). -}</span><span>
</span><span id="line-1265"></span></pre></body></html>