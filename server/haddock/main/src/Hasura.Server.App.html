<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Server.App</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier">APIResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier">JSONResp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier">RawResp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#CEConsoleType"><span class="hs-identifier">CEConsoleType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier">ConsoleRenderer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier">MonadVersionAPIWithExtraData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier">Handler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier">HandlerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier">hcReqHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#hcAppContext"><span class="hs-identifier">hcAppContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier">hcSchemaCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier">hcUser</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier">HasuraApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier">HasuraApp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier">MonadConfigApiHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier">AppContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier">boolToText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ceConsoleTypeIdentifier"><span class="hs-identifier">ceConsoleTypeIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier">configApiGetHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier">isAdminSecretSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier">mkGetHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier">mkSpockAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier">mkWaiApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier">onlyAdmin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier">renderHtmlTemplate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier">onlyWhenApiEnabled</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-983fe89ee2931c4434bb66f4f37161d06f149eae35d6419e24abb9ab0f7f9a20/share/doc/html/src/Control.Concurrent.Async.Lifted.Safe.html"><span class="hs-identifier">Control.Concurrent.Async.Lifted.Safe</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IOException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-31f5641d2c8ef5a0cf444a4277eaeb318e813205611870ab846fc8e7566b4ff7/share/doc/html/src/Control.Exception.Lifted.html"><span class="hs-identifier">Control.Exception.Lifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ErrorCall</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-31f5641d2c8ef5a0cf444a4277eaeb318e813205611870ab846fc8e7566b4ff7/share/doc/html/src/Control.Exception.Lifted.html#catch"><span class="hs-identifier">catch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mmorph-1.2.0-784197bc1c0df7d00fc39c619a4a0116868bfce1c6947c6f22f58b2dce1360b4/share/doc/html/src/Control.Monad.Morph.html"><span class="hs-identifier">Control.Monad.Morph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mmorph-1.2.0-784197bc1c0df7d00fc39c619a4a0116868bfce1c6947c6f22f58b2dce1360b4/share/doc/html/src/Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Stateless.html"><span class="hs-identifier">Control.Monad.Stateless</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Parser.Internal.html#json"><span class="hs-identifier">json</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Encoding.html"><span class="hs-identifier">Data.Aeson.Encoding</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Key.html"><span class="hs-identifier">Data.Aeson.Key</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.KeyMap.html"><span class="hs-identifier">Data.Aeson.KeyMap</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KM</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.html"><span class="hs-identifier">Data.Aeson.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Builder</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BB</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B8</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Char8</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/case-insensitive-1.2.1.0-6661b3b958513b697aa33f5d09f02e68e52c205d8730a11b51090e5cf1955271/share/doc/html/src/Data.CaseInsensitive.html"><span class="hs-identifier">Data.CaseInsensitive</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ci-info-0.1.0.0/opt/doc/html/ci-info/src/CI.html"><span class="hs-identifier">CI</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashMap.Strict.html"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-6d2f03d046561c7797987cbaffb3a08b741b1b35f4d107a24b2f923a3427aff1/share/doc/html/src/Data.Text.Conversions.html"><span class="hs-identifier">Data.Text.Conversions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-6d2f03d046561c7797987cbaffb3a08b741b1b35f4d107a24b2f923a3427aff1/share/doc/html/src/Data.Text.Conversions.html#convertText"><span class="hs-identifier">convertText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Lazy.html"><span class="hs-identifier">Data.Text.Lazy</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LT</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Lazy.Encoding.html"><span class="hs-identifier">Data.Text.Lazy.Encoding</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/GHC.Stats.Extended.html"><span class="hs-identifier">GHC.Stats.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RTS</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.App.State.html"><span class="hs-identifier">Hasura.App.State</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/dc-api-1.0.0/opt/doc/html/dc-api/src/Hasura.Backends.DataConnector.API.html"><span class="hs-identifier">Hasura.Backends.DataConnector.API</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/dc-api-1.0.0/opt/doc/html/dc-api/src/Hasura.Backends.DataConnector.API.html#openApiSchema"><span class="hs-identifier">openApiSchema</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.DataConnector.Agent.Client.html"><span class="hs-identifier">Hasura.Backends.DataConnector.Agent.Client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.DataConnector.Agent.Client.html#AgentLicenseKey"><span class="hs-identifier">AgentLicenseKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.Execute.Types</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.CredentialCache.html"><span class="hs-identifier">Hasura.CredentialCache</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.html"><span class="hs-identifier">Hasura.GraphQL.Execute</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.State</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Explain.html"><span class="hs-identifier">Hasura.GraphQL.Explain</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GE</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.html"><span class="hs-identifier">Hasura.GraphQL.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier">MonadExecutionLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier">MonadQueryLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GH</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GH</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WSServerApp</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Server</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.HTTP.html"><span class="hs-identifier">Hasura.HTTP</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier">MonadEventLogCleanup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Config</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html"><span class="hs-identifier">Hasura.RQL.Types.BackendType</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html"><span class="hs-identifier">Hasura.RQL.Types.Endpoint</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EP</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html"><span class="hs-identifier">Hasura.RQL.Types.Roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#adminRoleName"><span class="hs-identifier">adminRoleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Roles.html#roleNameToTxt"><span class="hs-identifier">roleNameToTxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Config.html"><span class="hs-identifier">Hasura.Server.API.Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.API.Config.html#runGetConfig"><span class="hs-identifier">runGetConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Metadata.html"><span class="hs-identifier">Hasura.Server.API.Metadata</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.PGDump.html"><span class="hs-identifier">Hasura.Server.API.PGDump</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PGD</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Query.html"><span class="hs-identifier">Hasura.Server.API.Query</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.V2Query.html"><span class="hs-identifier">Hasura.Server.API.V2Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2Q</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.AppStateRef.html"><span class="hs-identifier">Hasura.Server.AppStateRef</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier">AppStateRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier">getAppContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#getRebuildableSchemaCacheWithVersion"><span class="hs-identifier">getRebuildableSchemaCacheWithVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier">getSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#withSchemaCacheReadUpdate"><span class="hs-identifier">withSchemaCacheReadUpdate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier">AuthMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Compression.html"><span class="hs-identifier">Hasura.Server.Compression</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html"><span class="hs-identifier">Hasura.Server.Init</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html"><span class="hs-identifier">Hasura.Server.Limits</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Middleware.html"><span class="hs-identifier">Hasura.Server.Middleware</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Middleware.html#corsMiddleware"><span class="hs-identifier">corsMiddleware</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.OpenAPI.html"><span class="hs-identifier">Hasura.Server.OpenAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.OpenAPI.html#buildOpenAPI"><span class="hs-identifier">buildOpenAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Rest.html"><span class="hs-identifier">Hasura.Server.Rest</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html"><span class="hs-identifier">Hasura.Server.Utils</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Version.html"><span class="hs-identifier">Hasura.Server.Version</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Services.html"><span class="hs-identifier">Hasura.Services</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Session.html#ExtraUserInfo"><span class="hs-identifier">ExtraUserInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfo"><span class="hs-identifier">UserInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier">UserInfoM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#askUserInfo"><span class="hs-identifier">askUserInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier">MonadTrace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.html"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mime-types-0.1.1.0-c822281d87b53e94770c5fa75fc8e8efa613e43b02dfce92ea79328191230d7c/share/doc/html/src/Network.Mime.html"><span class="hs-identifier">Network.Mime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mime-types-0.1.1.0-c822281d87b53e94770c5fa75fc8e8efa613e43b02dfce92ea79328191230d7c/share/doc/html/src/Network.Mime.html#defaultMimeLookup"><span class="hs-identifier">defaultMimeLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Wai.Extended.html"><span class="hs-identifier">Network.Wai.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Wai</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Wai.Handler.WebSockets.Custom.html"><span class="hs-identifier">Network.Wai.Handler.WebSockets.Custom</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WSC</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isRelative</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">joinPath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">splitExtension</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeFileName</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Mem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">performMajorGC</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-93f2ed46e22c63a626e0d4152147170c3d5f8bca8a565d95e6bd12f130cd775b/share/doc/html/src/System.Metrics.html"><span class="hs-identifier">System.Metrics</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-json-0.1.0.7/opt/doc/html/ekg-json/src/System.Metrics.Json.html"><span class="hs-identifier">System.Metrics.Json</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mustache-2.4.1-0d67a9f56b5d7d0e0ecb1e9bcde9f7c196b5503c4fc5f4e7fee2397d9e223a63/share/doc/html/src/Text.Mustache.html"><span class="hs-identifier">Text.Mustache</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html"><span class="hs-identifier">Web.Spock.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#%3C%2F%2F%3E"><span class="hs-operator">(&lt;//&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html"><span class="hs-identifier">Web.Spock.Core</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spock</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">data</span><span> </span><span id="HandlerCtx"><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-var">HandlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HandlerCtx"><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-var">HandlerCtx</span></a></span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="hcAppContext"><span class="annot"><span class="annottext">HandlerCtx -&gt; AppContext
</span><a href="Hasura.Server.App.html#hcAppContext"><span class="hs-identifier hs-var hs-var">hcAppContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>    </span><span id="hcSchemaCache"><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var hs-var">hcSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>    </span><span id="hcUser"><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var hs-var">hcUser</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>    </span><span id="hcReqHeaders"><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var hs-var">hcReqHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Header.html#Header"><span class="hs-identifier hs-type">HTTP.Header</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span id="hcRequestId"><span class="annot"><span class="annottext">HandlerCtx -&gt; RequestId
</span><a href="Hasura.Server.App.html#hcRequestId"><span class="hs-identifier hs-var hs-var">hcRequestId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#RequestId"><span class="hs-identifier hs-type">RequestId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>    </span><span id="hcSourceIpAddress"><span class="annot"><span class="annottext">HandlerCtx -&gt; IpAddress
</span><a href="Hasura.Server.App.html#hcSourceIpAddress"><span class="hs-identifier hs-var hs-var">hcSourceIpAddress</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Wai.Extended.html#IpAddress"><span class="hs-identifier hs-type">Wai.IpAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>    </span><span id="hcLicenseKeyCache"><span class="annot"><span class="annottext">HandlerCtx -&gt; Maybe (CredentialCache AgentLicenseKey)
</span><a href="Hasura.Server.App.html#hcLicenseKeyCache"><span class="hs-identifier hs-var hs-var">hcLicenseKeyCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.CredentialCache.html#CredentialCache"><span class="hs-identifier hs-type">CredentialCache</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.DataConnector.Agent.Client.html#AgentLicenseKey"><span class="hs-identifier hs-type">AgentLicenseKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">newtype</span><span> </span><span id="Handler"><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span id="local-6989586621687724328"><span class="annot"><a href="#local-6989586621687724328"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687724329"><span class="annot"><a href="#local-6989586621687724329"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Handler"><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724328"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687724329"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621687724914"><span id="local-6989586621687724920"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b)
-&gt; (forall a b. a -&gt; Handler m b -&gt; Handler m a)
-&gt; Functor (Handler m)
forall a b. a -&gt; Handler m b -&gt; Handler m a
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Handler m b -&gt; Handler m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Handler m a -&gt; Handler m b
fmap :: forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Handler m b -&gt; Handler m a
&lt;$ :: forall a b. a -&gt; Handler m b -&gt; Handler m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>      </span><span id="local-6989586621687724932"><span id="local-6989586621687724938"><span id="local-6989586621687724943"><span id="local-6989586621687724948"><span id="local-6989586621687724953"><span class="annot"><span class="annottext">Functor (Handler m)
Functor (Handler m)
-&gt; (forall a. a -&gt; Handler m a)
-&gt; (forall a b. Handler m (a -&gt; b) -&gt; Handler m a -&gt; Handler m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; Handler m a -&gt; Handler m b -&gt; Handler m c)
-&gt; (forall a b. Handler m a -&gt; Handler m b -&gt; Handler m b)
-&gt; (forall a b. Handler m a -&gt; Handler m b -&gt; Handler m a)
-&gt; Applicative (Handler m)
forall a. a -&gt; Handler m a
forall a b. Handler m a -&gt; Handler m b -&gt; Handler m a
forall a b. Handler m a -&gt; Handler m b -&gt; Handler m b
forall a b. Handler m (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; Handler m a -&gt; Handler m b -&gt; Handler m c
forall {m :: * -&gt; *}. Monad m =&gt; Functor (Handler m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Handler m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; Handler m b -&gt; Handler m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; Handler m b -&gt; Handler m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Handler m a -&gt; Handler m b -&gt; Handler m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Handler m a
pure :: forall a. a -&gt; Handler m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
&lt;*&gt; :: forall a b. Handler m (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Handler m a -&gt; Handler m b -&gt; Handler m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; Handler m a -&gt; Handler m b -&gt; Handler m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; Handler m b -&gt; Handler m b
*&gt; :: forall a b. Handler m a -&gt; Handler m b -&gt; Handler m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; Handler m b -&gt; Handler m a
&lt;* :: forall a b. Handler m a -&gt; Handler m b -&gt; Handler m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>      </span><span id="local-6989586621687724967"><span id="local-6989586621687724973"><span id="local-6989586621687724978"><span class="annot"><span class="annottext">Applicative (Handler m)
Applicative (Handler m)
-&gt; (forall a b. Handler m a -&gt; (a -&gt; Handler m b) -&gt; Handler m b)
-&gt; (forall a b. Handler m a -&gt; Handler m b -&gt; Handler m b)
-&gt; (forall a. a -&gt; Handler m a)
-&gt; Monad (Handler m)
forall a. a -&gt; Handler m a
forall a b. Handler m a -&gt; Handler m b -&gt; Handler m b
forall a b. Handler m a -&gt; (a -&gt; Handler m b) -&gt; Handler m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (Handler m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Handler m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; Handler m b -&gt; Handler m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; (a -&gt; Handler m b) -&gt; Handler m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; (a -&gt; Handler m b) -&gt; Handler m b
&gt;&gt;= :: forall a b. Handler m a -&gt; (a -&gt; Handler m b) -&gt; Handler m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
Handler m a -&gt; Handler m b -&gt; Handler m b
&gt;&gt; :: forall a b. Handler m a -&gt; Handler m b -&gt; Handler m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Handler m a
return :: forall a. a -&gt; Handler m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>      </span><span id="local-6989586621687724990"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (forall a. IO a -&gt; Handler m a) -&gt; MonadIO (Handler m)
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (Handler m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; Handler m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; Handler m a
liftIO :: forall a. IO a -&gt; Handler m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621687725004"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (forall a. (a -&gt; Handler m a) -&gt; Handler m a)
-&gt; MonadFix (Handler m)
forall a. (a -&gt; Handler m a) -&gt; Handler m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
forall {m :: * -&gt; *}. MonadFix m =&gt; Monad (Handler m)
forall (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; Handler m a) -&gt; Handler m a
$cmfix :: forall (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; Handler m a) -&gt; Handler m a
mfix :: forall a. (a -&gt; Handler m a) -&gt; Handler m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>      </span><span id="local-6989586621687725013"><span id="local-6989586621687725027"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/transformers-base-0.4.6-1de63ecec87d43e153f479275f41d3572fba0d91d51b15b41bb219db570541e6/share/doc/html/src/Control.Monad.Base.html#MonadBase"><span class="hs-identifier hs-type">MonadBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725013"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>      </span><span id="local-6989586621687725038"><span id="local-6989586621687725044"><span id="local-6989586621687725051"><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725038"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>      </span><span id="local-6989586621687725064"><span id="local-6989586621687725070"><span id="local-6989586621687725075"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>      </span><span id="local-6989586621687725085"><span id="local-6989586621687725091"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>      </span><span id="local-6989586621687725103"><span id="local-6989586621687725109"><span id="local-6989586621687725114"><span id="local-6989586621687725119"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m (Maybe TraceContext)
Monad (Handler m)
-&gt; (forall a.
    TraceContext
    -&gt; SamplingPolicy -&gt; Text -&gt; Handler m a -&gt; Handler m a)
-&gt; (forall a. SpanId -&gt; Text -&gt; Handler m a -&gt; Handler m a)
-&gt; Handler m (Maybe TraceContext)
-&gt; (TraceMetadata -&gt; Handler m ())
-&gt; MonadTrace (Handler m)
TraceMetadata -&gt; Handler m ()
forall a. SpanId -&gt; Text -&gt; Handler m a -&gt; Handler m a
forall a.
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; Handler m a -&gt; Handler m a
forall (m :: * -&gt; *).
Monad m
-&gt; (forall a. TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m a -&gt; m a)
-&gt; (forall a. SpanId -&gt; Text -&gt; m a -&gt; m a)
-&gt; m (Maybe TraceContext)
-&gt; (TraceMetadata -&gt; m ())
-&gt; MonadTrace m
forall {m :: * -&gt; *}. MonadTrace m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadTrace m =&gt;
Handler m (Maybe TraceContext)
forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; Handler m ()
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; Handler m a -&gt; Handler m a
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; Handler m a -&gt; Handler m a
$cnewTraceWith :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; Handler m a -&gt; Handler m a
newTraceWith :: forall a.
TraceContext
-&gt; SamplingPolicy -&gt; Text -&gt; Handler m a -&gt; Handler m a
$cnewSpanWith :: forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
SpanId -&gt; Text -&gt; Handler m a -&gt; Handler m a
newSpanWith :: forall a. SpanId -&gt; Text -&gt; Handler m a -&gt; Handler m a
$ccurrentContext :: forall (m :: * -&gt; *).
MonadTrace m =&gt;
Handler m (Maybe TraceContext)
currentContext :: Handler m (Maybe TraceContext)
$cattachMetadata :: forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; Handler m ()
attachMetadata :: TraceMetadata -&gt; Handler m ()
</span><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadTrace</span></a></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>      </span><span id="local-6989586621687725132"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m AppEnv
Monad (Handler m) -&gt; Handler m AppEnv -&gt; HasAppEnv (Handler m)
forall (m :: * -&gt; *). Monad m -&gt; m AppEnv -&gt; HasAppEnv m
forall {m :: * -&gt; *}. HasAppEnv m =&gt; Monad (Handler m)
forall (m :: * -&gt; *). HasAppEnv m =&gt; Handler m AppEnv
$caskAppEnv :: forall (m :: * -&gt; *). HasAppEnv m =&gt; Handler m AppEnv
askAppEnv :: Handler m AppEnv
</span><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasAppEnv</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>      </span><span id="local-6989586621687725146"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m CacheStaticConfig
Monad (Handler m)
-&gt; Handler m CacheStaticConfig -&gt; HasCacheStaticConfig (Handler m)
forall (m :: * -&gt; *).
Monad m -&gt; m CacheStaticConfig -&gt; HasCacheStaticConfig m
forall {m :: * -&gt; *}. HasCacheStaticConfig m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
HasCacheStaticConfig m =&gt;
Handler m CacheStaticConfig
$caskCacheStaticConfig :: forall (m :: * -&gt; *).
HasCacheStaticConfig m =&gt;
Handler m CacheStaticConfig
askCacheStaticConfig :: Handler m CacheStaticConfig
</span><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasCacheStaticConfig</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>      </span><span id="local-6989586621687725160"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (FeatureFlag -&gt; Handler m Bool)
-&gt; HasFeatureFlagChecker (Handler m)
FeatureFlag -&gt; Handler m Bool
forall (m :: * -&gt; *).
Monad m -&gt; (FeatureFlag -&gt; m Bool) -&gt; HasFeatureFlagChecker m
forall {m :: * -&gt; *}. HasFeatureFlagChecker m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
HasFeatureFlagChecker m =&gt;
FeatureFlag -&gt; Handler m Bool
$ccheckFlag :: forall (m :: * -&gt; *).
HasFeatureFlagChecker m =&gt;
FeatureFlag -&gt; Handler m Bool
checkFlag :: FeatureFlag -&gt; Handler m Bool
</span><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasFeatureFlagChecker</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>      </span><span id="local-6989586621687725174"><span id="local-6989586621687725180"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m ResourceLimits
Monad (Handler m)
-&gt; Handler m ResourceLimits
-&gt; (RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; Handler m ResourceLimits)
-&gt; HasResourceLimits (Handler m)
RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; Handler m ResourceLimits
forall (m :: * -&gt; *).
Monad m
-&gt; m ResourceLimits
-&gt; (RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; m ResourceLimits)
-&gt; HasResourceLimits m
forall {m :: * -&gt; *}. HasResourceLimits m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
HasResourceLimits m =&gt;
Handler m ResourceLimits
forall (m :: * -&gt; *).
HasResourceLimits m =&gt;
RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; Handler m ResourceLimits
$caskHTTPHandlerLimit :: forall (m :: * -&gt; *).
HasResourceLimits m =&gt;
Handler m ResourceLimits
askHTTPHandlerLimit :: Handler m ResourceLimits
$caskGraphqlOperationLimit :: forall (m :: * -&gt; *).
HasResourceLimits m =&gt;
RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; Handler m ResourceLimits
askGraphqlOperationLimit :: RequestId -&gt; UserInfo -&gt; ApiLimit -&gt; Handler m ResourceLimits
</span><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">HasResourceLimits</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>      </span><span id="local-6989586621687725193"><span id="local-6989586621687725200"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m (SourceResolver ('Postgres 'Vanilla))
Handler m (SourceResolver 'MSSQL)
Monad (Handler m)
-&gt; Handler m (SourceResolver ('Postgres 'Vanilla))
-&gt; Handler m (SourceResolver 'MSSQL)
-&gt; MonadResolveSource (Handler m)
forall (m :: * -&gt; *).
Monad m
-&gt; m (SourceResolver ('Postgres 'Vanilla))
-&gt; m (SourceResolver 'MSSQL)
-&gt; MonadResolveSource m
forall {m :: * -&gt; *}. MonadResolveSource m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadResolveSource m =&gt;
Handler m (SourceResolver ('Postgres 'Vanilla))
forall (m :: * -&gt; *).
MonadResolveSource m =&gt;
Handler m (SourceResolver 'MSSQL)
$cgetPGSourceResolver :: forall (m :: * -&gt; *).
MonadResolveSource m =&gt;
Handler m (SourceResolver ('Postgres 'Vanilla))
getPGSourceResolver :: Handler m (SourceResolver ('Postgres 'Vanilla))
$cgetMSSQLSourceResolver :: forall (m :: * -&gt; *).
MonadResolveSource m =&gt;
Handler m (SourceResolver 'MSSQL)
getMSSQLSourceResolver :: Handler m (SourceResolver 'MSSQL)
</span><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadResolveSource</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>      </span><span id="local-6989586621687725214"><span id="local-6989586621687725220"><span id="local-6989586621687725225"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (UserInfo
    -&gt; ([Header], IpAddress)
    -&gt; AllowListStatus
    -&gt; SchemaCache
    -&gt; GQLReqUnparsed
    -&gt; RequestId
    -&gt; Handler m (Either QErr GQLReqParsed))
-&gt; (UserInfo
    -&gt; Value
    -&gt; SetGraphqlIntrospectionOptions
    -&gt; Handler m (Either QErr ExecutionStep))
-&gt; (UserInfo
    -&gt; RequestId
    -&gt; [GQLReqUnparsed]
    -&gt; SchemaCache
    -&gt; Handler m (Either QErr ()))
-&gt; MonadGQLExecutionCheck (Handler m)
UserInfo
-&gt; ([Header], IpAddress)
-&gt; AllowListStatus
-&gt; SchemaCache
-&gt; GQLReqUnparsed
-&gt; RequestId
-&gt; Handler m (Either QErr GQLReqParsed)
UserInfo
-&gt; Value
-&gt; SetGraphqlIntrospectionOptions
-&gt; Handler m (Either QErr ExecutionStep)
UserInfo
-&gt; RequestId
-&gt; [GQLReqUnparsed]
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
Monad m
-&gt; (UserInfo
    -&gt; ([Header], IpAddress)
    -&gt; AllowListStatus
    -&gt; SchemaCache
    -&gt; GQLReqUnparsed
    -&gt; RequestId
    -&gt; m (Either QErr GQLReqParsed))
-&gt; (UserInfo
    -&gt; Value
    -&gt; SetGraphqlIntrospectionOptions
    -&gt; m (Either QErr ExecutionStep))
-&gt; (UserInfo
    -&gt; RequestId
    -&gt; [GQLReqUnparsed]
    -&gt; SchemaCache
    -&gt; m (Either QErr ()))
-&gt; MonadGQLExecutionCheck m
forall {m :: * -&gt; *}. MonadGQLExecutionCheck m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadGQLExecutionCheck m =&gt;
UserInfo
-&gt; ([Header], IpAddress)
-&gt; AllowListStatus
-&gt; SchemaCache
-&gt; GQLReqUnparsed
-&gt; RequestId
-&gt; Handler m (Either QErr GQLReqParsed)
forall (m :: * -&gt; *).
MonadGQLExecutionCheck m =&gt;
UserInfo
-&gt; Value
-&gt; SetGraphqlIntrospectionOptions
-&gt; Handler m (Either QErr ExecutionStep)
forall (m :: * -&gt; *).
MonadGQLExecutionCheck m =&gt;
UserInfo
-&gt; RequestId
-&gt; [GQLReqUnparsed]
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
$ccheckGQLExecution :: forall (m :: * -&gt; *).
MonadGQLExecutionCheck m =&gt;
UserInfo
-&gt; ([Header], IpAddress)
-&gt; AllowListStatus
-&gt; SchemaCache
-&gt; GQLReqUnparsed
-&gt; RequestId
-&gt; Handler m (Either QErr GQLReqParsed)
checkGQLExecution :: UserInfo
-&gt; ([Header], IpAddress)
-&gt; AllowListStatus
-&gt; SchemaCache
-&gt; GQLReqUnparsed
-&gt; RequestId
-&gt; Handler m (Either QErr GQLReqParsed)
$cexecuteIntrospection :: forall (m :: * -&gt; *).
MonadGQLExecutionCheck m =&gt;
UserInfo
-&gt; Value
-&gt; SetGraphqlIntrospectionOptions
-&gt; Handler m (Either QErr ExecutionStep)
executeIntrospection :: UserInfo
-&gt; Value
-&gt; SetGraphqlIntrospectionOptions
-&gt; Handler m (Either QErr ExecutionStep)
$ccheckGQLBatchedReqs :: forall (m :: * -&gt; *).
MonadGQLExecutionCheck m =&gt;
UserInfo
-&gt; RequestId
-&gt; [GQLReqUnparsed]
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
checkGQLBatchedReqs :: UserInfo
-&gt; RequestId
-&gt; [GQLReqUnparsed]
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
</span><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">E.MonadGQLExecutionCheck</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>      </span><span id="local-6989586621687725238"><span id="local-6989586621687725244"><span id="local-6989586621687725249"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (SourceCache
    -&gt; TriggerLogCleanupConfig -&gt; Handler m (Either QErr EncJSON))
-&gt; (AnyBackend SourceInfo
    -&gt; TriggerName
    -&gt; AutoTriggerLogCleanupConfig
    -&gt; Handler m (Either QErr ()))
-&gt; (Logger Hasura
    -&gt; InsOrdHashMap SourceName BackendSourceMetadata
    -&gt; InsOrdHashMap SourceName BackendSourceMetadata
    -&gt; SchemaCache
    -&gt; Handler m (Either QErr ()))
-&gt; MonadEventLogCleanup (Handler m)
SourceCache
-&gt; TriggerLogCleanupConfig -&gt; Handler m (Either QErr EncJSON)
Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
Monad m
-&gt; (SourceCache
    -&gt; TriggerLogCleanupConfig -&gt; m (Either QErr EncJSON))
-&gt; (AnyBackend SourceInfo
    -&gt; TriggerName
    -&gt; AutoTriggerLogCleanupConfig
    -&gt; m (Either QErr ()))
-&gt; (Logger Hasura
    -&gt; InsOrdHashMap SourceName BackendSourceMetadata
    -&gt; InsOrdHashMap SourceName BackendSourceMetadata
    -&gt; SchemaCache
    -&gt; m (Either QErr ()))
-&gt; MonadEventLogCleanup m
forall {m :: * -&gt; *}. MonadEventLogCleanup m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
SourceCache
-&gt; TriggerLogCleanupConfig -&gt; Handler m (Either QErr EncJSON)
forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; Handler m (Either QErr ())
$crunLogCleaner :: forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
SourceCache
-&gt; TriggerLogCleanupConfig -&gt; Handler m (Either QErr EncJSON)
runLogCleaner :: SourceCache
-&gt; TriggerLogCleanupConfig -&gt; Handler m (Either QErr EncJSON)
$cgenerateCleanupSchedules :: forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; Handler m (Either QErr ())
generateCleanupSchedules :: AnyBackend SourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; Handler m (Either QErr ())
$cupdateTriggerCleanupSchedules :: forall (m :: * -&gt; *).
MonadEventLogCleanup m =&gt;
Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
updateTriggerCleanupSchedules :: Logger Hasura
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; InsOrdHashMap SourceName BackendSourceMetadata
-&gt; SchemaCache
-&gt; Handler m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadEventLogCleanup</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>      </span><span id="local-6989586621687725262"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (Logger Hasura -&gt; QueryLog -&gt; Handler m ())
-&gt; MonadQueryLog (Handler m)
Logger Hasura -&gt; QueryLog -&gt; Handler m ()
forall (m :: * -&gt; *).
Monad m -&gt; (Logger Hasura -&gt; QueryLog -&gt; m ()) -&gt; MonadQueryLog m
forall {m :: * -&gt; *}. MonadQueryLog m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadQueryLog m =&gt;
Logger Hasura -&gt; QueryLog -&gt; Handler m ()
$clogQueryLog :: forall (m :: * -&gt; *).
MonadQueryLog m =&gt;
Logger Hasura -&gt; QueryLog -&gt; Handler m ()
logQueryLog :: Logger Hasura -&gt; QueryLog -&gt; Handler m ()
</span><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadQueryLog</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>      </span><span id="local-6989586621687725276"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (Logger Hasura -&gt; ExecutionLog -&gt; Handler m ())
-&gt; MonadExecutionLog (Handler m)
Logger Hasura -&gt; ExecutionLog -&gt; Handler m ()
forall (m :: * -&gt; *).
Monad m
-&gt; (Logger Hasura -&gt; ExecutionLog -&gt; m ()) -&gt; MonadExecutionLog m
forall {m :: * -&gt; *}. MonadExecutionLog m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadExecutionLog m =&gt;
Logger Hasura -&gt; ExecutionLog -&gt; Handler m ()
$clogExecutionLog :: forall (m :: * -&gt; *).
MonadExecutionLog m =&gt;
Logger Hasura -&gt; ExecutionLog -&gt; Handler m ()
logExecutionLog :: Logger Hasura -&gt; ExecutionLog -&gt; Handler m ()
</span><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadExecutionLog</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>      </span><span id="local-6989586621687725290"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (QueryTagsAttributes
    -&gt; Maybe QueryTagsConfig -&gt; Tagged (Handler m) QueryTagsComment)
-&gt; MonadQueryTags (Handler m)
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (Handler m) QueryTagsComment
forall (m :: * -&gt; *).
Monad m
-&gt; (QueryTagsAttributes
    -&gt; Maybe QueryTagsConfig -&gt; Tagged m QueryTagsComment)
-&gt; MonadQueryTags m
forall {m :: * -&gt; *}. MonadQueryTags m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadQueryTags m =&gt;
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (Handler m) QueryTagsComment
$ccreateQueryTags :: forall (m :: * -&gt; *).
MonadQueryTags m =&gt;
QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (Handler m) QueryTagsComment
createQueryTags :: QueryTagsAttributes
-&gt; Maybe QueryTagsConfig -&gt; Tagged (Handler m) QueryTagsComment
</span><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadQueryTags</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>      </span><span id="local-6989586621687725304"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (ExecutionPlan
    -&gt; [QueryRootField UnpreparedValue]
    -&gt; Maybe CachedDirective
    -&gt; GQLReqParsed
    -&gt; UserInfo
    -&gt; [Header]
    -&gt; Handler m (Either QErr ([Header], CacheResult)))
-&gt; MonadExecuteQuery (Handler m)
ExecutionPlan
-&gt; [QueryRootField UnpreparedValue]
-&gt; Maybe CachedDirective
-&gt; GQLReqParsed
-&gt; UserInfo
-&gt; [Header]
-&gt; Handler m (Either QErr ([Header], CacheResult))
forall (m :: * -&gt; *).
Monad m
-&gt; (ExecutionPlan
    -&gt; [QueryRootField UnpreparedValue]
    -&gt; Maybe CachedDirective
    -&gt; GQLReqParsed
    -&gt; UserInfo
    -&gt; [Header]
    -&gt; m (Either QErr ([Header], CacheResult)))
-&gt; MonadExecuteQuery m
forall {m :: * -&gt; *}. MonadExecuteQuery m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadExecuteQuery m =&gt;
ExecutionPlan
-&gt; [QueryRootField UnpreparedValue]
-&gt; Maybe CachedDirective
-&gt; GQLReqParsed
-&gt; UserInfo
-&gt; [Header]
-&gt; Handler m (Either QErr ([Header], CacheResult))
$ccacheLookup :: forall (m :: * -&gt; *).
MonadExecuteQuery m =&gt;
ExecutionPlan
-&gt; [QueryRootField UnpreparedValue]
-&gt; Maybe CachedDirective
-&gt; GQLReqParsed
-&gt; UserInfo
-&gt; [Header]
-&gt; Handler m (Either QErr ([Header], CacheResult))
cacheLookup :: ExecutionPlan
-&gt; [QueryRootField UnpreparedValue]
-&gt; Maybe CachedDirective
-&gt; GQLReqParsed
-&gt; UserInfo
-&gt; [Header]
-&gt; Handler m (Either QErr ([Header], CacheResult))
</span><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">GH.MonadExecuteQuery</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>      </span><span id="local-6989586621687725318"><span id="local-6989586621687725324"><span id="local-6989586621687725329"><span class="annot"><span class="annottext">Monad (Handler m)
Monad (Handler m)
-&gt; (RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ()))
-&gt; (RQLMetadata -&gt; HandlerCtx -&gt; Handler m (Either QErr ()))
-&gt; (RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ()))
-&gt; MonadMetadataApiAuthorization (Handler m)
RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
RQLMetadata -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
Monad m
-&gt; (RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ()))
-&gt; (RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ()))
-&gt; (RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ()))
-&gt; MonadMetadataApiAuthorization m
forall {m :: * -&gt; *}.
MonadMetadataApiAuthorization m =&gt;
Monad (Handler m)
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
$cauthorizeV1QueryApi :: forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
$cauthorizeV1MetadataApi :: forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
$cauthorizeV2QueryApi :: forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; Handler m (Either QErr ())
</span><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMetadataApiAuthorization</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>      </span><span id="local-6989586621687725342"><span id="local-6989586621687725348"><span id="local-6989586621687725353"><span id="local-6989586621687725358"><span id="local-6989586621687725363"><span id="local-6989586621687725368"><span id="local-6989586621687725373"><span id="local-6989586621687725378"><span id="local-6989586621687725383"><span id="local-6989586621687725388"><span id="local-6989586621687725393"><span id="local-6989586621687725398"><span id="local-6989586621687725403"><span id="local-6989586621687725408"><span id="local-6989586621687725413"><span id="local-6989586621687725418"><span id="local-6989586621687725423"><span id="local-6989586621687725428"><span id="local-6989586621687725433"><span id="local-6989586621687725438"><span id="local-6989586621687725443"><span id="local-6989586621687725448"><span id="local-6989586621687725453"><span id="local-6989586621687725458"><span id="local-6989586621687725463"><span id="local-6989586621687725468"><span id="local-6989586621687725473"><span id="local-6989586621687725478"><span id="local-6989586621687725483"><span id="local-6989586621687725488"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m (Either QErr [ActionLogItem])
Handler m (Either QErr ())
Handler m (Either QErr MetadataDbId)
Handler m (Either QErr CatalogState)
Handler m (Either QErr MetadataWithResourceVersion)
Handler m (Either QErr MetadataResourceVersion)
Monad (Handler m)
-&gt; Handler m (Either QErr MetadataResourceVersion)
-&gt; Handler m (Either QErr MetadataWithResourceVersion)
-&gt; (MetadataResourceVersion
    -&gt; InstanceId
    -&gt; Handler
         m (Either QErr [(MetadataResourceVersion, CacheInvalidations)]))
-&gt; (MetadataResourceVersion
    -&gt; Metadata -&gt; Handler m (Either QErr MetadataResourceVersion))
-&gt; (MetadataResourceVersion
    -&gt; InstanceId -&gt; CacheInvalidations -&gt; Handler m (Either QErr ()))
-&gt; Handler m (Either QErr CatalogState)
-&gt; (CatalogStateType -&gt; Value -&gt; Handler m (Either QErr ()))
-&gt; (MetadataResourceVersion
    -&gt; Handler m (Either QErr (Maybe StoredIntrospection)))
-&gt; (StoredIntrospection
    -&gt; MetadataResourceVersion -&gt; Handler m (Either QErr ()))
-&gt; Handler m (Either QErr MetadataDbId)
-&gt; Handler m (Either QErr ())
-&gt; ([TriggerName] -&gt; Handler m (Either QErr [CronTriggerStats]))
-&gt; ([TriggerName]
    -&gt; Handler m (Either QErr ([CronEvent], [OneOffScheduledEvent])))
-&gt; ([CronEventSeed] -&gt; Handler m (Either QErr ()))
-&gt; (OneOffEvent -&gt; Handler m (Either QErr EventId))
-&gt; (Invocation 'ScheduledType
    -&gt; ScheduledEventType -&gt; Handler m (Either QErr ()))
-&gt; (EventId
    -&gt; ScheduledEventOp
    -&gt; ScheduledEventType
    -&gt; Handler m (Either QErr ()))
-&gt; (ScheduledEventType -&gt; [EventId] -&gt; Handler m (Either QErr Int))
-&gt; Handler m (Either QErr ())
-&gt; (ClearCronEvents -&gt; Handler m (Either QErr ()))
-&gt; (ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; Handler
         m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent])))
-&gt; (TriggerName
    -&gt; ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; Handler m (Either QErr (WithOptionalTotalCount [CronEvent])))
-&gt; (GetScheduledEventInvocations
    -&gt; Handler
         m
         (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation])))
-&gt; (EventId -&gt; ScheduledEventType -&gt; Handler m (Either QErr ()))
-&gt; (ActionName
    -&gt; SessionVariables
    -&gt; [Header]
    -&gt; Value
    -&gt; Handler m (Either QErr ActionId))
-&gt; Handler m (Either QErr [ActionLogItem])
-&gt; (ActionId -&gt; AsyncActionStatus -&gt; Handler m (Either QErr ()))
-&gt; (ActionId -&gt; Handler m (Either QErr ActionLogResponse))
-&gt; (ActionName -&gt; Handler m (Either QErr ()))
-&gt; (LockedActionIdArray -&gt; Handler m (Either QErr ()))
-&gt; MonadMetadataStorage (Handler m)
[TriggerName] -&gt; Handler m (Either QErr [CronTriggerStats])
[TriggerName]
-&gt; Handler m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
[CronEventSeed] -&gt; Handler m (Either QErr ())
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
EventId -&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; Handler m (Either QErr ())
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler m (Either QErr (WithOptionalTotalCount [CronEvent]))
ClearCronEvents -&gt; Handler m (Either QErr ())
GetScheduledEventInvocations
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
ScheduledEventType -&gt; [EventId] -&gt; Handler m (Either QErr Int)
OneOffEvent -&gt; Handler m (Either QErr EventId)
LockedActionIdArray -&gt; Handler m (Either QErr ())
ActionId -&gt; Handler m (Either QErr ActionLogResponse)
ActionId -&gt; AsyncActionStatus -&gt; Handler m (Either QErr ())
ActionName -&gt; Handler m (Either QErr ())
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; Handler m (Either QErr ActionId)
CatalogStateType -&gt; Value -&gt; Handler m (Either QErr ())
MetadataResourceVersion
-&gt; Handler m (Either QErr (Maybe StoredIntrospection))
MetadataResourceVersion
-&gt; InstanceId
-&gt; Handler
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; Handler m (Either QErr ())
MetadataResourceVersion
-&gt; Metadata -&gt; Handler m (Either QErr MetadataResourceVersion)
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
Monad m
-&gt; m (Either QErr MetadataResourceVersion)
-&gt; m (Either QErr MetadataWithResourceVersion)
-&gt; (MetadataResourceVersion
    -&gt; InstanceId
    -&gt; m (Either QErr [(MetadataResourceVersion, CacheInvalidations)]))
-&gt; (MetadataResourceVersion
    -&gt; Metadata -&gt; m (Either QErr MetadataResourceVersion))
-&gt; (MetadataResourceVersion
    -&gt; InstanceId -&gt; CacheInvalidations -&gt; m (Either QErr ()))
-&gt; m (Either QErr CatalogState)
-&gt; (CatalogStateType -&gt; Value -&gt; m (Either QErr ()))
-&gt; (MetadataResourceVersion
    -&gt; m (Either QErr (Maybe StoredIntrospection)))
-&gt; (StoredIntrospection
    -&gt; MetadataResourceVersion -&gt; m (Either QErr ()))
-&gt; m (Either QErr MetadataDbId)
-&gt; m (Either QErr ())
-&gt; ([TriggerName] -&gt; m (Either QErr [CronTriggerStats]))
-&gt; ([TriggerName]
    -&gt; m (Either QErr ([CronEvent], [OneOffScheduledEvent])))
-&gt; ([CronEventSeed] -&gt; m (Either QErr ()))
-&gt; (OneOffEvent -&gt; m (Either QErr EventId))
-&gt; (Invocation 'ScheduledType
    -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (EventId
    -&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ScheduledEventType -&gt; [EventId] -&gt; m (Either QErr Int))
-&gt; m (Either QErr ())
-&gt; (ClearCronEvents -&gt; m (Either QErr ()))
-&gt; (ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent])))
-&gt; (TriggerName
    -&gt; ScheduledEventPagination
    -&gt; [ScheduledEventStatus]
    -&gt; RowsCountOption
    -&gt; m (Either QErr (WithOptionalTotalCount [CronEvent])))
-&gt; (GetScheduledEventInvocations
    -&gt; m (Either
            QErr (WithOptionalTotalCount [ScheduledEventInvocation])))
-&gt; (EventId -&gt; ScheduledEventType -&gt; m (Either QErr ()))
-&gt; (ActionName
    -&gt; SessionVariables
    -&gt; [Header]
    -&gt; Value
    -&gt; m (Either QErr ActionId))
-&gt; m (Either QErr [ActionLogItem])
-&gt; (ActionId -&gt; AsyncActionStatus -&gt; m (Either QErr ()))
-&gt; (ActionId -&gt; m (Either QErr ActionLogResponse))
-&gt; (ActionName -&gt; m (Either QErr ()))
-&gt; (LockedActionIdArray -&gt; m (Either QErr ()))
-&gt; MonadMetadataStorage m
forall {m :: * -&gt; *}. MonadMetadataStorage m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr [ActionLogItem])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr MetadataDbId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr CatalogState)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr MetadataWithResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr MetadataResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; Handler m (Either QErr [CronTriggerStats])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName]
-&gt; Handler m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId -&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler m (Either QErr (WithOptionalTotalCount [CronEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
GetScheduledEventInvocations
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventType -&gt; [EventId] -&gt; Handler m (Either QErr Int)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
OneOffEvent -&gt; Handler m (Either QErr EventId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; Handler m (Either QErr ActionLogResponse)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; AsyncActionStatus -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; Handler m (Either QErr ActionId)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Handler m (Either QErr (Maybe StoredIntrospection))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId
-&gt; Handler
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; Handler m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Metadata -&gt; Handler m (Either QErr MetadataResourceVersion)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; Handler m (Either QErr ())
$cfetchMetadataResourceVersion :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr MetadataResourceVersion)
fetchMetadataResourceVersion :: Handler m (Either QErr MetadataResourceVersion)
$cfetchMetadata :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr MetadataWithResourceVersion)
fetchMetadata :: Handler m (Either QErr MetadataWithResourceVersion)
$cfetchMetadataNotifications :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId
-&gt; Handler
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
fetchMetadataNotifications :: MetadataResourceVersion
-&gt; InstanceId
-&gt; Handler
     m (Either QErr [(MetadataResourceVersion, CacheInvalidations)])
$csetMetadata :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Metadata -&gt; Handler m (Either QErr MetadataResourceVersion)
setMetadata :: MetadataResourceVersion
-&gt; Metadata -&gt; Handler m (Either QErr MetadataResourceVersion)
$cnotifySchemaCacheSync :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; Handler m (Either QErr ())
notifySchemaCacheSync :: MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; Handler m (Either QErr ())
$cgetCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr CatalogState)
getCatalogState :: Handler m (Either QErr CatalogState)
$csetCatalogState :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; Handler m (Either QErr ())
setCatalogState :: CatalogStateType -&gt; Value -&gt; Handler m (Either QErr ())
$cfetchSourceIntrospection :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
MetadataResourceVersion
-&gt; Handler m (Either QErr (Maybe StoredIntrospection))
fetchSourceIntrospection :: MetadataResourceVersion
-&gt; Handler m (Either QErr (Maybe StoredIntrospection))
$cstoreSourceIntrospection :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
StoredIntrospection
-&gt; MetadataResourceVersion -&gt; Handler m (Either QErr ())
storeSourceIntrospection :: StoredIntrospection
-&gt; MetadataResourceVersion -&gt; Handler m (Either QErr ())
$cgetMetadataDbUid :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr MetadataDbId)
getMetadataDbUid :: Handler m (Either QErr MetadataDbId)
$ccheckMetadataStorageHealth :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr ())
checkMetadataStorageHealth :: Handler m (Either QErr ())
$cgetDeprivedCronTriggerStats :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; Handler m (Either QErr [CronTriggerStats])
getDeprivedCronTriggerStats :: [TriggerName] -&gt; Handler m (Either QErr [CronTriggerStats])
$cgetScheduledEventsForDelivery :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName]
-&gt; Handler m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
getScheduledEventsForDelivery :: [TriggerName]
-&gt; Handler m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
$cinsertCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; Handler m (Either QErr ())
insertCronEvents :: [CronEventSeed] -&gt; Handler m (Either QErr ())
$cinsertOneOffScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
OneOffEvent -&gt; Handler m (Either QErr EventId)
insertOneOffScheduledEvent :: OneOffEvent -&gt; Handler m (Either QErr EventId)
$cinsertScheduledEventInvocation :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
insertScheduledEventInvocation :: Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
$csetScheduledEventOp :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; Handler m (Either QErr ())
setScheduledEventOp :: EventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; Handler m (Either QErr ())
$cunlockScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventType -&gt; [EventId] -&gt; Handler m (Either QErr Int)
unlockScheduledEvents :: ScheduledEventType -&gt; [EventId] -&gt; Handler m (Either QErr Int)
$cunlockAllLockedScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr ())
unlockAllLockedScheduledEvents :: Handler m (Either QErr ())
$cclearFutureCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; Handler m (Either QErr ())
clearFutureCronEvents :: ClearCronEvents -&gt; Handler m (Either QErr ())
$cgetOneOffScheduledEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
getOneOffScheduledEvents :: ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [OneOffScheduledEvent]))
$cgetCronEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler m (Either QErr (WithOptionalTotalCount [CronEvent]))
getCronEvents :: TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; Handler m (Either QErr (WithOptionalTotalCount [CronEvent]))
$cgetScheduledEventInvocations :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
GetScheduledEventInvocations
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
getScheduledEventInvocations :: GetScheduledEventInvocations
-&gt; Handler
     m (Either QErr (WithOptionalTotalCount [ScheduledEventInvocation]))
$cdeleteScheduledEvent :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
EventId -&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
deleteScheduledEvent :: EventId -&gt; ScheduledEventType -&gt; Handler m (Either QErr ())
$cinsertAction :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; Handler m (Either QErr ActionId)
insertAction :: ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; Handler m (Either QErr ActionId)
$cfetchUndeliveredActionEvents :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Handler m (Either QErr [ActionLogItem])
fetchUndeliveredActionEvents :: Handler m (Either QErr [ActionLogItem])
$csetActionStatus :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; AsyncActionStatus -&gt; Handler m (Either QErr ())
setActionStatus :: ActionId -&gt; AsyncActionStatus -&gt; Handler m (Either QErr ())
$cfetchActionResponse :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionId -&gt; Handler m (Either QErr ActionLogResponse)
fetchActionResponse :: ActionId -&gt; Handler m (Either QErr ActionLogResponse)
$cclearActionData :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ActionName -&gt; Handler m (Either QErr ())
clearActionData :: ActionName -&gt; Handler m (Either QErr ())
$csetProcessingActionLogsToPending :: forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; Handler m (Either QErr ())
setProcessingActionLogsToPending :: LockedActionIdArray -&gt; Handler m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMetadataStorage</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>      </span><span id="local-6989586621687725501"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m Manager
Monad (Handler m)
-&gt; Handler m Manager -&gt; ProvidesNetwork (Handler m)
forall (m :: * -&gt; *). Monad m -&gt; m Manager -&gt; ProvidesNetwork m
forall {m :: * -&gt; *}. ProvidesNetwork m =&gt; Monad (Handler m)
forall (m :: * -&gt; *). ProvidesNetwork m =&gt; Handler m Manager
$caskHTTPManager :: forall (m :: * -&gt; *). ProvidesNetwork m =&gt; Handler m Manager
askHTTPManager :: Handler m Manager
</span><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">ProvidesNetwork</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>      </span><span id="local-6989586621687725515"><span id="local-6989586621687725521"><span class="annot"><span class="annottext">Monad (Handler m)
Handler m (Maybe MaxTime)
Handler m (IO GranularPrometheusMetricsState)
Monad (Handler m)
-&gt; Handler m (Maybe MaxTime)
-&gt; Handler m (IO GranularPrometheusMetricsState)
-&gt; MonadGetPolicies (Handler m)
forall (m :: * -&gt; *).
Monad m
-&gt; m (Maybe MaxTime)
-&gt; m (IO GranularPrometheusMetricsState)
-&gt; MonadGetPolicies m
forall {m :: * -&gt; *}. MonadGetPolicies m =&gt; Monad (Handler m)
forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
Handler m (Maybe MaxTime)
forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
Handler m (IO GranularPrometheusMetricsState)
$crunGetApiTimeLimit :: forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
Handler m (Maybe MaxTime)
runGetApiTimeLimit :: Handler m (Maybe MaxTime)
$crunGetPrometheusMetricsGranularity :: forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
Handler m (IO GranularPrometheusMetricsState)
runGetPrometheusMetricsGranularity :: Handler m (IO GranularPrometheusMetricsState)
</span><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadGetPolicies</span></a></span></span></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621687725539"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; Handler m a
</span><a href="#local-6989586621687725539"><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (ExceptT QErr m) a -&gt; Handler m a
forall (m :: * -&gt; *) a.
ReaderT HandlerCtx (ExceptT QErr m) a -&gt; Handler m a
</span><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-var">Handler</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT HandlerCtx (ExceptT QErr m) a -&gt; Handler m a)
-&gt; (m a -&gt; ReaderT HandlerCtx (ExceptT QErr m) a)
-&gt; m a
-&gt; Handler m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m a -&gt; ReaderT HandlerCtx (ExceptT QErr m) a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT HandlerCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m a -&gt; ReaderT HandlerCtx (ExceptT QErr m) a)
-&gt; (m a -&gt; ExceptT QErr m a)
-&gt; m a
-&gt; ReaderT HandlerCtx (ExceptT QErr m) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; ExceptT QErr m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT QErr m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687724336"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687724336"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724336"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621687725549"><span class="annot"><span class="annottext">askUserInfo :: Handler m UserInfo
</span><a href="Hasura.RQL.Types.Session.html#askUserInfo"><span class="hs-identifier hs-var hs-var hs-var hs-var">askUserInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; Handler m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span id="local-6989586621687724340"><span id="local-6989586621687724341"><span class="annot"><a href="Hasura.Server.App.html#runHandler"><span class="hs-identifier hs-type">runHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724340"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724340"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724340"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724341"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724340"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724341"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-170"></span><span id="runHandler"><span class="annot"><span class="annottext">runHandler :: forall (m :: * -&gt; *) a.
(HasResourceLimits m, MonadBaseControl IO m) =&gt;
Logger Hasura -&gt; HandlerCtx -&gt; Handler m a -&gt; m (Either QErr a)
</span><a href="Hasura.Server.App.html#runHandler"><span class="hs-identifier hs-var hs-var">runHandler</span></a></span></span><span> </span><span id="local-6989586621687725580"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687725580"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687725581"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725581"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span id="local-6989586621687725582"><span class="annot"><span class="annottext">ReaderT HandlerCtx (ExceptT QErr m) a
</span><a href="#local-6989586621687725582"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621687725583"><span class="annot"><span class="annottext">ResourceLimits
</span><a href="#local-6989586621687725583"><span class="hs-identifier hs-var">handlerLimit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ResourceLimits
forall (m :: * -&gt; *). HasResourceLimits m =&gt; m ResourceLimits
</span><a href="Hasura.Server.Limits.html#askHTTPHandlerLimit"><span class="hs-identifier hs-var">askHTTPHandlerLimit</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="annottext">ExceptT QErr m a -&gt; m (Either QErr a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT HandlerCtx (ExceptT QErr m) a
-&gt; HandlerCtx -&gt; ExceptT QErr m a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceLimits
-&gt; forall (m :: * -&gt; *) a.
   (MonadBaseControl IO m, MonadError QErr m) =&gt;
   m a -&gt; m a
</span><a href="Hasura.Server.Limits.html#runResourceLimits"><span class="hs-identifier hs-var">runResourceLimits</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceLimits
</span><a href="#local-6989586621687725583"><span class="hs-identifier hs-var">handlerLimit</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT HandlerCtx (ExceptT QErr m) a
</span><a href="#local-6989586621687725582"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725581"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">m (Either QErr a)
-&gt; (ErrorCall -&gt; m (Either QErr a)) -&gt; m (Either QErr a)
forall (m :: * -&gt; *) e a.
(MonadBaseControl IO m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-31f5641d2c8ef5a0cf444a4277eaeb318e813205611870ab846fc8e7566b4ff7/share/doc/html/src/Control.Exception.Lifted.html#catch"><span class="hs-operator hs-var">`catch`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687725588"><span class="annot"><span class="annottext">errorCallWithLoc :: ErrorCall
</span><a href="#local-6989586621687725588"><span class="hs-identifier hs-var">errorCallWithLoc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ErrorCallWithLocation</span></span><span> </span><span id="local-6989586621687725590"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687725590"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall &#945;. IO &#945; -&gt; m &#945;
forall (b :: * -&gt; *) (m :: * -&gt; *) &#945;. MonadBase b m =&gt; b &#945; -&gt; m &#945;
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/transformers-base-0.4.6-1de63ecec87d43e153f479275f41d3572fba0d91d51b15b41bb219db570541e6/share/doc/html/src/Control.Monad.Base.html#liftBase"><span class="hs-identifier hs-var">liftBase</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687725580"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(UnhandledInternalErrorLog -&gt; IO ())
-&gt; UnhandledInternalErrorLog -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; UnhandledInternalErrorLog
</span><a href="Hasura.Logging.html#UnhandledInternalErrorLog"><span class="hs-identifier hs-var">L.UnhandledInternalErrorLog</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCall
</span><a href="#local-6989586621687725588"><span class="hs-identifier hs-var">errorCallWithLoc</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">Either QErr a -&gt; m (Either QErr a)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">(Either QErr a -&gt; m (Either QErr a))
-&gt; Either QErr a -&gt; m (Either QErr a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Either QErr a
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; Value -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw500WithDetail"><span class="hs-identifier hs-var">throw500WithDetail</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Internal Server Error&quot;</span></span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">(Value -&gt; Either QErr a) -&gt; Value -&gt; Either QErr a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;error&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Value
forall a. IsString a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687725590"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">data</span><span> </span><span id="APIResp"><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-var">APIResp</span></a></span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="JSONResp"><span class="annot"><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RawResp"><span class="annot"><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier hs-var">RawResp</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><span class="hs-comment">-- | API request handlers for different endpoints</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="APIHandler"><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-var">APIHandler</span></a></span></span><span> </span><span id="local-6989586621687725596"><span class="annot"><a href="#local-6989586621687725596"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687725597"><span class="annot"><a href="#local-6989586621687725597"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A simple GET request</span></span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621687724379"><span id="local-6989586621687724380"><span id="AHGet"><span class="annot"><a href="Hasura.Server.App.html#AHGet"><span class="hs-identifier hs-var">AHGet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724379"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724379"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724380"><span class="hs-identifier hs-type">void</span></a></span></span></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A simple POST request that expects a request body from which an 'a' can be extracted</span></span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621687725599"><span id="local-6989586621687725600"><span id="AHPost"><span class="annot"><a href="Hasura.Server.App.html#AHPost"><span class="hs-identifier hs-var">AHPost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687725599"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725600"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725600"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725599"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-comment">-- | A general GraphQL request (query or mutation) for which the content of the query</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- is made available to the handler for authentication.</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- This is a more specific version of the 'AHPost' constructor.</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621687725602"><span id="AHGraphQLRequest"><span class="annot"><a href="Hasura.Server.App.html#AHGraphQLRequest"><span class="hs-identifier hs-var">AHGraphQLRequest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687725602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-type">boolToText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-195"></span><span id="boolToText"><span class="annot"><span class="annottext">boolToText :: Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var hs-var">boolToText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool -&gt; Text
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;false&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-type">isAdminSecretSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-198"></span><span id="isAdminSecretSet"><span class="annot"><span class="annottext">isAdminSecretSet :: AuthMode -&gt; Text
</span><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-var hs-var">isAdminSecretSet</span></a></span></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="Hasura.Server.Auth.html#AMNoAuth"><span class="hs-identifier hs-var">AMNoAuth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-199"></span><span class="annot"><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-var">isAdminSecretSet</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="local-6989586621687724374"><span class="annot"><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-type">mkGetHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724374"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724374"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-202"></span><span id="mkGetHandler"><span class="annot"><span class="annottext">mkGetHandler :: forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var hs-var">mkGetHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *) void.
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m void
</span><a href="Hasura.Server.App.html#AHGet"><span class="hs-identifier hs-var">AHGet</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621687724381"><span id="local-6989586621687724382"><span class="annot"><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-type">mkPostHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724381"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724382"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724382"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724381"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-205"></span><span id="mkPostHandler"><span class="annot"><span class="annottext">mkPostHandler :: forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var hs-var">mkPostHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#AHPost"><span class="hs-identifier hs-var">AHPost</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span id="local-6989586621687724386"><span class="annot"><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-type">mkGQLRequestHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724386"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724386"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#ReqsText"><span class="hs-identifier hs-type">GH.ReqsText</span></a></span></span><span>
</span><span id="line-208"></span><span id="mkGQLRequestHandler"><span class="annot"><span class="annottext">mkGQLRequestHandler :: forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var hs-var">mkGQLRequestHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#AHGraphQLRequest"><span class="hs-identifier hs-var">AHGraphQLRequest</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span id="local-6989586621687724388"><span id="local-6989586621687724389"><span class="annot"><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-type">mkAPIRespHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621687724388"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724389"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724388"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724389"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724388"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-211"></span><span id="mkAPIRespHandler"><span class="annot"><span class="annottext">mkAPIRespHandler :: forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var hs-var">mkAPIRespHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp)
-&gt; (a -&gt; Handler m (HttpResponse EncJSON))
-&gt; a
-&gt; Handler m APIResp
forall a b. (a -&gt; b) -&gt; (a -&gt; a) -&gt; a -&gt; b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp)
 -&gt; (a -&gt; Handler m (HttpResponse EncJSON))
 -&gt; a
 -&gt; Handler m APIResp)
-&gt; ((HttpResponse EncJSON -&gt; APIResp)
    -&gt; Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp)
-&gt; (HttpResponse EncJSON -&gt; APIResp)
-&gt; (a -&gt; Handler m (HttpResponse EncJSON))
-&gt; a
-&gt; Handler m APIResp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; Handler m (HttpResponse EncJSON) -&gt; Handler m APIResp
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span id="local-6989586621687724394"><span id="local-6989586621687724395"><span id="local-6989586621687724396"><span class="annot"><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-type">mkGQLAPIRespHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621687724394"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724395"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724394"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724396"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724395"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724394"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687724396"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-217"></span><span id="mkGQLAPIRespHandler"><span class="annot"><span class="annottext">mkGQLAPIRespHandler :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var hs-var">mkGQLAPIRespHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
-&gt; (a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a
-&gt; Handler m (b, APIResp)
forall a b. (a -&gt; b) -&gt; (a -&gt; a) -&gt; a -&gt; b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
 -&gt; (a -&gt; Handler m (b, HttpResponse EncJSON))
 -&gt; a
 -&gt; Handler m (b, APIResp))
-&gt; ((HttpResponse EncJSON -&gt; APIResp)
    -&gt; Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
-&gt; (HttpResponse EncJSON -&gt; APIResp)
-&gt; (a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a
-&gt; Handler m (b, APIResp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((b, HttpResponse EncJSON) -&gt; (b, APIResp))
-&gt; Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp)
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(((b, HttpResponse EncJSON) -&gt; (b, APIResp))
 -&gt; Handler m (b, HttpResponse EncJSON) -&gt; Handler m (b, APIResp))
-&gt; ((HttpResponse EncJSON -&gt; APIResp)
    -&gt; (b, HttpResponse EncJSON) -&gt; (b, APIResp))
-&gt; (HttpResponse EncJSON -&gt; APIResp)
-&gt; Handler m (b, HttpResponse EncJSON)
-&gt; Handler m (b, APIResp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; (b, HttpResponse EncJSON) -&gt; (b, APIResp)
forall a b. (a -&gt; b) -&gt; (b, a) -&gt; (b, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-type">isMetadataEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-220"></span><span id="isMetadataEnabled"><span class="annot"><span class="annottext">isMetadataEnabled :: AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var hs-var">isMetadataEnabled</span></a></span></span><span> </span><span id="local-6989586621687725620"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725620"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#METADATA"><span class="hs-identifier hs-var">METADATA</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet API
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-identifier hs-var">acEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725620"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-type">isGraphQLEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-223"></span><span id="isGraphQLEnabled"><span class="annot"><span class="annottext">isGraphQLEnabled :: AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-var hs-var">isGraphQLEnabled</span></a></span></span><span> </span><span id="local-6989586621687725625"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725625"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#GRAPHQL"><span class="hs-identifier hs-var">GRAPHQL</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet API
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-identifier hs-var">acEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725625"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Hasura.Server.App.html#isPGDumpEnabled"><span class="hs-identifier hs-type">isPGDumpEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-226"></span><span id="isPGDumpEnabled"><span class="annot"><span class="annottext">isPGDumpEnabled :: AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isPGDumpEnabled"><span class="hs-identifier hs-var hs-var">isPGDumpEnabled</span></a></span></span><span> </span><span id="local-6989586621687725628"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725628"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#PGDUMP"><span class="hs-identifier hs-var">PGDUMP</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet API
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-identifier hs-var">acEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725628"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Hasura.Server.App.html#isConfigEnabled"><span class="hs-identifier hs-type">isConfigEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-229"></span><span id="isConfigEnabled"><span class="annot"><span class="annottext">isConfigEnabled :: AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isConfigEnabled"><span class="hs-identifier hs-var hs-var">isConfigEnabled</span></a></span></span><span> </span><span id="local-6989586621687725631"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725631"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#CONFIG"><span class="hs-identifier hs-var">CONFIG</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet API
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-identifier hs-var">acEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725631"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-type">isDeveloperAPIEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-232"></span><span id="isDeveloperAPIEnabled"><span class="annot"><span class="annottext">isDeveloperAPIEnabled :: AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var hs-var">isDeveloperAPIEnabled</span></a></span></span><span> </span><span id="local-6989586621687725634"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725634"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">API -&gt; HashSet API -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#DEVELOPER"><span class="hs-identifier hs-var">DEVELOPER</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet API -&gt; Bool) -&gt; HashSet API -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; HashSet API
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-identifier hs-var">acEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687725634"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- {-# SCC parseBody #-}</span><span>
</span><span id="line-235"></span><span id="local-6989586621687724403"><span id="local-6989586621687724405"><span class="annot"><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-type">parseBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724405"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687724403"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-236"></span><span id="parseBody"><span class="annot"><span class="annottext">parseBody :: forall a (m :: * -&gt; *).
(FromJSON a, MonadError QErr m) =&gt;
ByteString -&gt; m (Value, a)
</span><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-var hs-var">parseBody</span></a></span></span><span> </span><span id="local-6989586621687725649"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687725649"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] Value
forall a. FromJSON a =&gt; ByteString -&gt; Either [Char] a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.html#eitherDecode%27"><span class="hs-identifier hs-var">eitherDecode'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687725649"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687725651"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687725651"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m (Value, a)
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidJSON"><span class="hs-identifier hs-var">InvalidJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687725651"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687725655"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687725655"><span class="hs-identifier hs-var">jVal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687725655"><span class="hs-identifier hs-var">jVal</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (Value, a)) -&gt; m a -&gt; m (Value, a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; m a
forall a (m :: * -&gt; *). (FromJSON a, QErrM m) =&gt; Value -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#decodeValue"><span class="hs-identifier hs-var">decodeValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687725655"><span class="hs-identifier hs-var">jVal</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span id="local-6989586621687724418"><span class="annot"><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-type">onlyAdmin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724418"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724418"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-242"></span><span id="onlyAdmin"><span class="annot"><span class="annottext">onlyAdmin :: forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var hs-var">onlyAdmin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621687725669"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621687725669"><span class="hs-identifier hs-var">uRole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RoleName) -&gt; m RoleName
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">(UserInfo -&gt; RoleName)
-&gt; (HandlerCtx -&gt; UserInfo) -&gt; HandlerCtx -&gt; RoleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621687725669"><span class="hs-identifier hs-var">uRole</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; RoleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.RQL.Types.Roles.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#AccessDenied"><span class="hs-identifier hs-var">AccessDenied</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;You have to be an admin to access this endpoint&quot;</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span id="local-6989586621687724423"><span id="local-6989586621687724424"><span class="annot"><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-type">setHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724423"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Header.html#Header"><span class="hs-identifier hs-type">HTTP.Header</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionCtxT"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724424"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-248"></span><span id="setHeader"><span class="annot"><span class="annottext">setHeader :: forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var hs-var">setHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687725676"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621687725676"><span class="hs-identifier hs-var">headerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687725677"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687725677"><span class="hs-identifier hs-var">headerValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Text -&gt; Text -&gt; ActionCtxT ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#setHeader"><span class="hs-identifier hs-var">Spock.setHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; ByteString
forall s. CI s -&gt; s
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/case-insensitive-1.2.1.0-6661b3b958513b697aa33f5d09f02e68e52c205d8730a11b51090e5cf1955271/share/doc/html/src/Data.CaseInsensitive.Internal.html#original"><span class="hs-identifier hs-var">CI.original</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621687725676"><span class="hs-identifier hs-var">headerName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687725677"><span class="hs-identifier hs-var">headerValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><span class="hs-comment">-- | Typeclass representing the metadata API authorization effect</span></span><span>
</span><span id="line-252"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687724254"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadMetadataApiAuthorization"><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-var">MonadMetadataApiAuthorization</span></a></span></span><span> </span><span id="local-6989586621687724254"><span class="annot"><a href="#local-6989586621687724254"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>  </span><span id="authorizeV1QueryApi"><span class="annot"><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-type">authorizeV1QueryApi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><a href="Hasura.Server.API.Query.html#RQLQuery"><span class="hs-identifier hs-type">RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>  </span><span id="authorizeV1MetadataApi"><span class="annot"><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-type">authorizeV1MetadataApi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="Hasura.Server.API.Metadata.html#RQLMetadata"><span class="hs-identifier hs-type">RQLMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>  </span><span id="authorizeV2QueryApi"><span class="annot"><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-type">authorizeV2QueryApi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="Hasura.Server.API.V2Query.html#RQLQuery"><span class="hs-identifier hs-type">V2Q.RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687724257"><span id="local-6989586621687724258"><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621687724258"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621687725694"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; ReaderT r m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621687725695"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725695"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725696"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725696"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT r m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ReaderT r m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725695"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725696"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span id="local-6989586621687725700"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; ReaderT r m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span id="local-6989586621687725701"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687725701"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725702"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725702"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT r m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ReaderT r m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687725701"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725702"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span id="local-6989586621687725706"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; ReaderT r m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span id="local-6989586621687725707"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725707"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725708"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725708"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT r m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ReaderT r m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ReaderT r m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725707"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725708"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687724255"><span id="local-6989586621687724256"><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724255"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="#local-6989586621687724256"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724255"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-268"></span><span>  </span><span id="local-6989586621687725719"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; ExceptT e m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621687725720"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725720"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725721"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725721"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ExceptT e m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT e m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ExceptT e m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ExceptT e m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725720"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725721"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621687725725"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; ExceptT e m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span id="local-6989586621687725726"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687725726"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725727"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725727"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ExceptT e m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT e m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ExceptT e m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ExceptT e m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687725726"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725727"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621687725731"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; ExceptT e m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span id="local-6989586621687725732"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725732"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725733"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725733"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ExceptT e m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT e m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; ExceptT e m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; ExceptT e m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725732"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725733"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687724441"><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724441"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Monad.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724441"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-273"></span><span>  </span><span id="local-6989586621687725747"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; TraceT m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621687725748"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725748"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725749"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725749"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TraceT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; TraceT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725748"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725749"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span id="local-6989586621687725753"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata -&gt; HandlerCtx -&gt; TraceT m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span id="local-6989586621687725754"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687725754"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725755"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725755"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TraceT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; TraceT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687725754"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725755"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621687725759"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; TraceT m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span id="local-6989586621687725760"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725760"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621687725761"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725761"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TraceT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; TraceT m (Either QErr ()))
-&gt; m (Either QErr ()) -&gt; TraceT m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687725760"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687725761"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><span class="hs-comment">-- | The config API (/v1alpha1/config) handler</span></span><span>
</span><span id="line-278"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687724442"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadConfigApiHandler"><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-var">MonadConfigApiHandler</span></a></span></span><span> </span><span id="local-6989586621687724442"><span class="annot"><a href="#local-6989586621687724442"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>  </span><span id="runConfigApiHandler"><span class="annot"><a href="Hasura.Server.App.html#runConfigApiHandler"><span class="hs-identifier hs-type">runConfigApiHandler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621687724811"><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724811"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#SpockCtxT"><span class="hs-identifier hs-type">Spock.SpockCtxT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687724442"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-type">mkSpockAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724444"><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687724445"><span class="annot"><a href="#local-6989586621687724445"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621687724448"><span class="annot"><a href="#local-6989586621687724448"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724445"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724448"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>  </span><span class="annot"><span class="hs-comment">-- | `QErr` JSON encoder function</span></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Encoding.Internal.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="hs-comment">-- | `QErr` modifier</span></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionT"><span class="hs-identifier hs-type">Spock.ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span id="mkSpockAction"><span class="annot"><span class="annottext">mkSpockAction :: forall (m :: * -&gt; *) a impl.
(MonadIO m, MonadBaseControl IO m, HasAppEnv m, FromJSON a,
 UserAuthentication m, HttpLog m, HasResourceLimits m,
 MonadTrace m) =&gt;
AppStateRef impl
-&gt; (Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler m a
-&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-var hs-var">mkSpockAction</span></a></span></span><span> </span><span id="local-6989586621687725886"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687725886"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span id="local-6989586621687725887"><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="#local-6989586621687725887"><span class="hs-identifier hs-var">qErrEncoder</span></a></span></span><span> </span><span id="local-6989586621687725888"><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687725888"><span class="hs-identifier hs-var">qErrModifier</span></a></span></span><span> </span><span id="local-6989586621687725889"><span class="annot"><span class="annottext">APIHandler m a
</span><a href="#local-6989586621687725889"><span class="hs-identifier hs-var">apiHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687725891"><span id="local-6989586621687725892"><span id="local-6989586621687725893"><span id="local-6989586621687725894"><span id="local-6989586621687725895"><span id="local-6989586621687725896"><span id="local-6989586621687725897"><span id="local-6989586621687725898"><span id="local-6989586621687725899"><span id="local-6989586621687725900"><span id="local-6989586621687725901"><span id="local-6989586621687725902"><span id="local-6989586621687725903"><span id="local-6989586621687725904"><span id="local-6989586621687725905"><span id="local-6989586621687725906"><span id="local-6989586621687725907"><span id="local-6989586621687725908"><span id="local-6989586621687725909"><span id="local-6989586621687725910"><span id="local-6989586621687725911"><span id="local-6989586621687725912"><span id="local-6989586621687725913"><span id="local-6989586621687725914"><span id="local-6989586621687725915"><span id="local-6989586621687725916"><span id="local-6989586621687725917"><span id="local-6989586621687725918"><span id="local-6989586621687725919"><span id="local-6989586621687725920"><span id="local-6989586621687725921"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
</span><a href="#local-6989586621687725891"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv -&gt; ActionCtxT () m AppEnv
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687725955"><span id="local-6989586621687725956"><span id="local-6989586621687725957"><span id="local-6989586621687725958"><span id="local-6989586621687725959"><span id="local-6989586621687725960"><span id="local-6989586621687725961"><span id="local-6989586621687725962"><span id="local-6989586621687725963"><span id="local-6989586621687725964"><span id="local-6989586621687725965"><span id="local-6989586621687725966"><span id="local-6989586621687725967"><span id="local-6989586621687725968"><span id="local-6989586621687725969"><span id="local-6989586621687725970"><span id="local-6989586621687725971"><span id="local-6989586621687725972"><span id="local-6989586621687725973"><span id="local-6989586621687725974"><span class="annot"><span class="annottext">Environment
HashSet ExperimentalFeature
HashSet API
StreamQueriesOptions
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
CloseWebsocketsOnMetadataChangeStatus
ApolloFederationStatus
CorsPolicy
AuthMode
MetadataDefaults
ResponseInternalErrorsConfig
OptionalInterval
TelemetryStatus
AllowListStatus
ConsoleStatus
EventEngineCtx
acEnabledAPIs :: AppContext -&gt; HashSet API
acAuthMode :: AuthMode
acSQLGenCtx :: SQLGenCtx
acEnabledAPIs :: HashSet API
acEnableAllowlist :: AllowListStatus
acResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
acEnvironment :: Environment
acRemoteSchemaPermsCtx :: RemoteSchemaPermissions
acFunctionPermsCtx :: InferFunctionPermissions
acExperimentalFeatures :: HashSet ExperimentalFeature
acDefaultNamingConvention :: NamingCase
acMetadataDefaults :: MetadataDefaults
acLiveQueryOptions :: StreamQueriesOptions
acStreamQueryOptions :: StreamQueriesOptions
acCorsPolicy :: CorsPolicy
acConsoleStatus :: ConsoleStatus
acEnableTelemetry :: TelemetryStatus
acEventEngineCtx :: EventEngineCtx
acAsyncActionsFetchInterval :: OptionalInterval
acApolloFederationStatus :: ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: CloseWebsocketsOnMetadataChangeStatus
acAuthMode :: AppContext -&gt; AuthMode
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
acEnableAllowlist :: AppContext -&gt; AllowListStatus
acResponseInternalErrorsConfig :: AppContext -&gt; ResponseInternalErrorsConfig
acEnvironment :: AppContext -&gt; Environment
acRemoteSchemaPermsCtx :: AppContext -&gt; RemoteSchemaPermissions
acFunctionPermsCtx :: AppContext -&gt; InferFunctionPermissions
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
acDefaultNamingConvention :: AppContext -&gt; NamingCase
acMetadataDefaults :: AppContext -&gt; MetadataDefaults
acLiveQueryOptions :: AppContext -&gt; StreamQueriesOptions
acStreamQueryOptions :: AppContext -&gt; StreamQueriesOptions
acCorsPolicy :: AppContext -&gt; CorsPolicy
acConsoleStatus :: AppContext -&gt; ConsoleStatus
acEnableTelemetry :: AppContext -&gt; TelemetryStatus
acEventEngineCtx :: AppContext -&gt; EventEngineCtx
acAsyncActionsFetchInterval :: AppContext -&gt; OptionalInterval
acApolloFederationStatus :: AppContext -&gt; ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: AppContext -&gt; CloseWebsocketsOnMetadataChangeStatus
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; ActionCtxT () m AppContext
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; ActionCtxT () m AppContext)
-&gt; IO AppContext -&gt; ActionCtxT () m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687725886"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621687725995"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687725997"><span class="annot"><span class="annottext">origHeaders :: [Header]
</span><a href="#local-6989586621687725997"><span class="hs-identifier hs-var hs-var">origHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-306"></span><span>      </span><span id="local-6989586621687725999"><span class="annot"><span class="annottext">ipAddress :: IpAddress
</span><a href="#local-6989586621687725999"><span class="hs-identifier hs-var hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IpAddress
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Wai.Extended.html#getSourceFromFallback"><span class="hs-identifier hs-var">Wai.getSourceFromFallback</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-307"></span><span>      </span><span id="local-6989586621687726001"><span class="annot"><span class="annottext">pathInfo :: ByteString
</span><a href="#local-6989586621687726001"><span class="hs-identifier hs-var hs-var">pathInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#rawPathInfo"><span class="hs-identifier hs-var">Wai.rawPathInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-comment">-- Bytes are actually read from the socket here. Time this.</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621687726003"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621687726003"><span class="hs-identifier hs-var">ioWaitTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726004"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ByteString
-&gt; ActionCtxT () m (DiffTime, ByteString)
forall (m :: * -&gt; *) a. MonadIO m =&gt; m a -&gt; m (DiffTime, a)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#withElapsedTime"><span class="hs-identifier hs-var">withElapsedTime</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionCtxT () m ByteString
 -&gt; ActionCtxT () m (DiffTime, ByteString))
-&gt; ActionCtxT () m ByteString
-&gt; ActionCtxT () m (DiffTime, ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.html#strictRequestBody"><span class="hs-identifier hs-var">Wai.strictRequestBody</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621687726007"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726008"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687725997"><span class="hs-identifier hs-var">origHeaders</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span id="local-6989586621687726010"><span class="annot"><span class="annottext">TraceContext
</span><a href="#local-6989586621687726010"><span class="hs-identifier hs-var">tracingCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO TraceContext -&gt; ActionCtxT () m TraceContext
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- B3 TraceIds can have a length of either 64 bits (16 hex chars) or 128 bits</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- (32 hex chars). For 64-bit TraceIds, we pad them with zeros on the left to</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-comment">-- make them 128 bits long.</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726011"><span class="annot"><span class="annottext">traceIdMaybe :: Maybe TraceId
</span><a href="#local-6989586621687726011"><span class="hs-identifier hs-var hs-var">traceIdMaybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>          </span><span class="annot"><span class="annottext">HeaderName -&gt; [Header] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;X-B3-TraceId&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; (ByteString -&gt; Maybe TraceId) -&gt; Maybe TraceId
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687726013"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726013"><span class="hs-identifier hs-var">rawTraceId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-keyword">if</span><span>
</span><span id="line-320"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">Char8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726013"><span class="hs-identifier hs-var">rawTraceId</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>                  </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe TraceId
</span><a href="Hasura.Tracing.TraceId.html#traceIdFromHex"><span class="hs-identifier hs-var">Tracing.traceIdFromHex</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726013"><span class="hs-identifier hs-var">rawTraceId</span></a></span><span>
</span><span id="line-322"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">Char8.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726013"><span class="hs-identifier hs-var">rawTraceId</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>                  </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe TraceId
</span><a href="Hasura.Tracing.TraceId.html#traceIdFromHex"><span class="hs-identifier hs-var">Tracing.traceIdFromHex</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe TraceId) -&gt; ByteString -&gt; Maybe TraceId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; ByteString
</span><span class="hs-identifier hs-var">Char8.replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'0'</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726013"><span class="hs-identifier hs-var">rawTraceId</span></a></span><span>
</span><span id="line-324"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-325"></span><span>                  </span><span class="annot"><span class="annottext">Maybe TraceId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TraceId
</span><a href="#local-6989586621687726011"><span class="hs-identifier hs-var">traceIdMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687726017"><span class="annot"><span class="annottext">TraceId
</span><a href="#local-6989586621687726017"><span class="hs-identifier hs-var">traceId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>        </span><span id="local-6989586621687726018"><span class="annot"><span class="annottext">SpanId
</span><a href="#local-6989586621687726018"><span class="hs-identifier hs-var">freshSpanId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SpanId
forall (m :: * -&gt; *). MonadIO m =&gt; m SpanId
</span><a href="Hasura.Tracing.TraceId.html#randomSpanId"><span class="hs-identifier hs-var">Tracing.randomSpanId</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726020"><span class="annot"><span class="annottext">parentSpanId :: Maybe SpanId
</span><a href="#local-6989586621687726020"><span class="hs-identifier hs-var hs-var">parentSpanId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe SpanId
</span><a href="Hasura.Tracing.TraceId.html#spanIdFromHex"><span class="hs-identifier hs-var">Tracing.spanIdFromHex</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe SpanId) -&gt; Maybe ByteString -&gt; Maybe SpanId
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; [Header] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;X-B3-SpanId&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-331"></span><span>            </span><span id="local-6989586621687726023"><span class="annot"><span class="annottext">samplingState :: SamplingState
</span><a href="#local-6989586621687726023"><span class="hs-identifier hs-var hs-var">samplingState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; SamplingState
forall s. (IsString s, Eq s) =&gt; Maybe s -&gt; SamplingState
</span><a href="Hasura.Tracing.Sampling.html#samplingStateFromHeader"><span class="hs-identifier hs-var">Tracing.samplingStateFromHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; SamplingState)
-&gt; Maybe ByteString -&gt; SamplingState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; [Header] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;X-B3-Sampled&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">TraceContext -&gt; IO TraceContext
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TraceContext -&gt; IO TraceContext)
-&gt; TraceContext -&gt; IO TraceContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceId -&gt; SpanId -&gt; Maybe SpanId -&gt; SamplingState -&gt; TraceContext
</span><a href="Hasura.Tracing.Context.html#TraceContext"><span class="hs-identifier hs-var">Tracing.TraceContext</span></a></span><span> </span><span class="annot"><span class="annottext">TraceId
</span><a href="#local-6989586621687726017"><span class="hs-identifier hs-var">traceId</span></a></span><span> </span><span class="annot"><span class="annottext">SpanId
</span><a href="#local-6989586621687726018"><span class="hs-identifier hs-var">freshSpanId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SpanId
</span><a href="#local-6989586621687726020"><span class="hs-identifier hs-var">parentSpanId</span></a></span><span> </span><span class="annot"><span class="annottext">SamplingState
</span><a href="#local-6989586621687726023"><span class="hs-identifier hs-var">samplingState</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">Maybe TraceId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>        </span><span id="local-6989586621687726026"><span class="annot"><span class="annottext">TraceId
</span><a href="#local-6989586621687726026"><span class="hs-identifier hs-var">freshTraceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO TraceId
forall (m :: * -&gt; *). MonadIO m =&gt; m TraceId
</span><a href="Hasura.Tracing.TraceId.html#randomTraceId"><span class="hs-identifier hs-var">Tracing.randomTraceId</span></a></span><span>
</span><span id="line-335"></span><span>        </span><span id="local-6989586621687726028"><span class="annot"><span class="annottext">SpanId
</span><a href="#local-6989586621687726028"><span class="hs-identifier hs-var">freshSpanId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SpanId
forall (m :: * -&gt; *). MonadIO m =&gt; m SpanId
</span><a href="Hasura.Tracing.TraceId.html#randomSpanId"><span class="hs-identifier hs-var">Tracing.randomSpanId</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726029"><span class="annot"><span class="annottext">samplingState :: SamplingState
</span><a href="#local-6989586621687726029"><span class="hs-identifier hs-var hs-var">samplingState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; SamplingState
forall s. (IsString s, Eq s) =&gt; Maybe s -&gt; SamplingState
</span><a href="Hasura.Tracing.Sampling.html#samplingStateFromHeader"><span class="hs-identifier hs-var">Tracing.samplingStateFromHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; SamplingState)
-&gt; Maybe ByteString -&gt; SamplingState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; [Header] -&gt; Maybe ByteString
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;X-B3-Sampled&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><span class="annottext">TraceContext -&gt; IO TraceContext
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TraceContext -&gt; IO TraceContext)
-&gt; TraceContext -&gt; IO TraceContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceId -&gt; SpanId -&gt; Maybe SpanId -&gt; SamplingState -&gt; TraceContext
</span><a href="Hasura.Tracing.Context.html#TraceContext"><span class="hs-identifier hs-var">Tracing.TraceContext</span></a></span><span> </span><span class="annot"><span class="annottext">TraceId
</span><a href="#local-6989586621687726026"><span class="hs-identifier hs-var">freshTraceId</span></a></span><span> </span><span class="annot"><span class="annottext">SpanId
</span><a href="#local-6989586621687726028"><span class="hs-identifier hs-var">freshSpanId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SpanId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">SamplingState
</span><a href="#local-6989586621687726029"><span class="hs-identifier hs-var">samplingState</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687726030"><span class="hs-identifier hs-type">runTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724526"><span class="annot"><a href="#local-6989586621687724526"><span class="hs-identifier hs-type">m1</span></a></span></span><span> </span><span id="local-6989586621687724527"><span class="annot"><a href="#local-6989586621687724527"><span class="hs-identifier hs-type">a1</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724526"><span class="hs-identifier hs-type">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><a href="#local-6989586621687724526"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724527"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><a href="#local-6989586621687724526"><span class="hs-identifier hs-type">m1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724527"><span class="hs-identifier hs-type">a1</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621687726030"><span class="annot"><span class="annottext">runTrace :: forall (m1 :: * -&gt; *) a1. MonadTrace m1 =&gt; m1 a1 -&gt; m1 a1
</span><a href="#local-6989586621687726030"><span class="hs-identifier hs-var hs-var">runTrace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="annottext">TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m1 a1 -&gt; m1 a1
forall a. TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m1 a -&gt; m1 a
forall (m :: * -&gt; *) a.
MonadTrace m =&gt;
TraceContext -&gt; SamplingPolicy -&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Tracing.Class.html#newTraceWith"><span class="hs-identifier hs-var">Tracing.newTraceWith</span></a></span><span> </span><span class="annot"><span class="annottext">TraceContext
</span><a href="#local-6989586621687726010"><span class="hs-identifier hs-var">tracingCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="#local-6989586621687725907"><span class="hs-identifier hs-var">appEnvTraceSamplingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
forall a. IsString a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
</span><span class="hs-identifier hs-var">B8.unpack</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726001"><span class="hs-identifier hs-var">pathInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726036"><span class="annot"><span class="annottext">getInfo :: Maybe ReqsText
-&gt; ActionCtxT
     () m (UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
</span><a href="#local-6989586621687726036"><span class="hs-identifier hs-var hs-var">getInfo</span></a></span></span><span> </span><span id="local-6989586621687726037"><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621687726037"><span class="hs-identifier hs-var">parsedRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621687726038"><span class="annot"><span class="annottext">Either QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
</span><a href="#local-6989586621687726038"><span class="hs-identifier hs-var">authenticationResp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
-&gt; ActionCtxT
     ()
     m
     (Either QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; m (Either
        QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
forall (m :: * -&gt; *).
UserAuthentication m =&gt;
Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; m (Either
        QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
</span><a href="Hasura.Server.Auth.html#resolveUserInfo"><span class="hs-identifier hs-var">resolveUserInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687725896"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687725895"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621687725955"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621687726037"><span class="hs-identifier hs-var">parsedRequest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>        </span><span id="local-6989586621687726041"><span class="annot"><span class="annottext">(UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
</span><a href="#local-6989586621687726041"><span class="hs-identifier hs-var">authInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
-&gt; (QErr
    -&gt; ActionCtxT
         () m (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
-&gt; ActionCtxT
     () m (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeft"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
</span><a href="#local-6989586621687726038"><span class="hs-identifier hs-var">authenticationResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT
     () m (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
forall any ctx.
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT ctx m any
</span><a href="#local-6989586621687726043"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687725997"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; ExtraUserInfo
</span><a href="Hasura.RQL.Types.Session.html#ExtraUserInfo"><span class="hs-identifier hs-var">ExtraUserInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QErr
 -&gt; ActionCtxT
      () m (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo))
-&gt; (QErr -&gt; QErr)
-&gt; QErr
-&gt; ActionCtxT
     () m (UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687725888"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687726045"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726045"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726046"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726046"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726047"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726047"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UserInfo, Maybe UTCTime, [Header], ExtraUserInfo)
</span><a href="#local-6989586621687726041"><span class="hs-identifier hs-var">authInfo</span></a></span><span>
</span><span id="line-351"></span><span>        </span><span id="local-6989586621687726048"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726048"><span class="hs-identifier hs-var">appContext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; ActionCtxT () m AppContext
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; ActionCtxT () m AppContext)
-&gt; IO AppContext -&gt; ActionCtxT () m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687725886"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621687726049"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726049"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RebuildableSchemaCache -&gt; ActionCtxT () m RebuildableSchemaCache
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO RebuildableSchemaCache
 -&gt; ActionCtxT () m RebuildableSchemaCache)
-&gt; IO RebuildableSchemaCache
-&gt; ActionCtxT () m RebuildableSchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO RebuildableSchemaCache
forall impl. AppStateRef impl -&gt; IO RebuildableSchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getRebuildableSchemaCacheWithVersion"><span class="hs-identifier hs-var">getRebuildableSchemaCacheWithVersion</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687725886"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">(UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
-&gt; ActionCtxT
     () m (UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-354"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726045"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726046"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>            </span><span class="annot"><span class="annottext">AppContext
-&gt; RebuildableSchemaCache
-&gt; UserInfo
-&gt; [Header]
-&gt; RequestId
-&gt; IpAddress
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; HandlerCtx
</span><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-var">HandlerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726048"><span class="hs-identifier hs-var">appContext</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726049"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726045"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687725999"><span class="hs-identifier hs-var">ipAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621687725920"><span class="hs-identifier hs-var">appEnvLicenseKeyCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>            </span><span class="annot"><span class="annottext">RoleName -&gt; ResponseInternalErrorsConfig -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#shouldIncludeInternal"><span class="hs-identifier hs-var">shouldIncludeInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726045"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621687725959"><span class="hs-identifier hs-var">acResponseInternalErrorsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-358"></span><span>            </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726047"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="annottext">(forall a. m a -&gt; m a) -&gt; ActionT m () -&gt; ActionT m ()
forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
forall (m :: * -&gt; *) (n :: * -&gt; *) b.
Monad m =&gt;
(forall a. m a -&gt; n a) -&gt; ActionCtxT () m b -&gt; ActionCtxT () n b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mmorph-1.2.0-784197bc1c0df7d00fc39c619a4a0116868bfce1c6947c6f22f58b2dce1360b4/share/doc/html/src/Control.Monad.Morph.html#hoist"><span class="hs-identifier hs-var">hoist</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a. m a -&gt; m a
forall (m1 :: * -&gt; *) a1. MonadTrace m1 =&gt; m1 a1 -&gt; m1 a1
</span><a href="#local-6989586621687726030"><span class="hs-identifier hs-var">runTrace</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- Add the request ID to the tracing metadata so that we</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- can correlate requests and traces</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; ActionT m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionT m ()) -&gt; m () -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceMetadata -&gt; m ()
forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; m ()
</span><a href="Hasura.Tracing.Class.html#attachMetadata"><span class="hs-identifier hs-var">Tracing.attachMetadata</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RequestId -&gt; Text
</span><a href="Hasura.Server.Types.html#unRequestId"><span class="hs-identifier hs-var">unRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621687726054"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621687726054"><span class="hs-identifier hs-var">serviceTime</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687726055"><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726055"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726056"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726056"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726057"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726057"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726058"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726058"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726059"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687726059"><span class="hs-identifier hs-var">queryJSON</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726060"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726060"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT
  ()
  m
  (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
   Bool, Maybe Value, ExtraUserInfo)
-&gt; ActionCtxT
     ()
     m
     (DiffTime,
      (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
       Bool, Maybe Value, ExtraUserInfo))
forall (m :: * -&gt; *) a. MonadIO m =&gt; m a -&gt; m (DiffTime, a)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#withElapsedTime"><span class="hs-identifier hs-var">withElapsedTime</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionCtxT
   ()
   m
   (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
    Bool, Maybe Value, ExtraUserInfo)
 -&gt; ActionCtxT
      ()
      m
      (DiffTime,
       (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
        Bool, Maybe Value, ExtraUserInfo)))
-&gt; ActionCtxT
     ()
     m
     (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
      Bool, Maybe Value, ExtraUserInfo)
-&gt; ActionCtxT
     ()
     m
     (DiffTime,
      (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
       Bool, Maybe Value, ExtraUserInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">APIHandler m a
</span><a href="#local-6989586621687725889"><span class="hs-identifier hs-var">apiHandler</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-comment">-- in the case of a simple get/post we don't have to send the webhook anything</span><span>
</span><span id="line-368"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#AHGet"><span class="hs-identifier hs-type">AHGet</span></a></span><span> </span><span id="local-6989586621687726061"><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726061"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687726062"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726062"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726063"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726063"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726064"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687726064"><span class="hs-identifier hs-var">handlerState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726065"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726065"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726066"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726066"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT
     () m (UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
</span><a href="#local-6989586621687726036"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-370"></span><span>        </span><span id="local-6989586621687726067"><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726067"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either QErr (HttpLogGraphQLInfo, APIResp))
-&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr (HttpLogGraphQLInfo, APIResp))
 -&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp)))
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
-&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; HandlerCtx
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall (m :: * -&gt; *) a.
(HasResourceLimits m, MonadBaseControl IO m) =&gt;
Logger Hasura -&gt; HandlerCtx -&gt; Handler m a -&gt; m (Either QErr a)
</span><a href="Hasura.Server.App.html#runHandler"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687725896"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687726064"><span class="hs-identifier hs-var">handlerState</span></a></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726061"><span class="hs-identifier hs-var">handler</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><span class="annottext">(Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
 Bool, Maybe Value, ExtraUserInfo)
-&gt; ActionCtxT
     ()
     m
     (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
      Bool, Maybe Value, ExtraUserInfo)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726067"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726062"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726063"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726065"><span class="hs-identifier hs-var">includeInternal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726066"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#AHPost"><span class="hs-identifier hs-type">AHPost</span></a></span><span> </span><span id="local-6989586621687726068"><span class="annot"><span class="annottext">a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726068"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687726069"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726069"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726070"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726070"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726071"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687726071"><span class="hs-identifier hs-var">handlerState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726072"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726072"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726073"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726073"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT
     () m (UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
</span><a href="#local-6989586621687726036"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687726074"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687726074"><span class="hs-identifier hs-var">queryJSON</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726075"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687726075"><span class="hs-identifier hs-var">parsedReq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-375"></span><span>          </span><span class="annot"><span class="annottext">Except QErr (Value, a) -&gt; Either QErr (Value, a)
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Except QErr (Value, a)
forall a (m :: * -&gt; *).
(FromJSON a, MonadError QErr m) =&gt;
ByteString -&gt; m (Value, a)
</span><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-var">parseBody</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either QErr (Value, a)
-&gt; (QErr -&gt; ActionCtxT () m (Value, a))
-&gt; ActionCtxT () m (Value, a)
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687726077"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726077"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT () m (Value, a)
forall any ctx.
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT ctx m any
</span><a href="#local-6989586621687726043"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726069"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726072"><span class="hs-identifier hs-var">includeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687725997"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726073"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687725888"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726077"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>        </span><span id="local-6989586621687726078"><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726078"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either QErr (HttpLogGraphQLInfo, APIResp))
-&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr (HttpLogGraphQLInfo, APIResp))
 -&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp)))
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
-&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; HandlerCtx
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall (m :: * -&gt; *) a.
(HasResourceLimits m, MonadBaseControl IO m) =&gt;
Logger Hasura -&gt; HandlerCtx -&gt; Handler m a -&gt; m (Either QErr a)
</span><a href="Hasura.Server.App.html#runHandler"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687725896"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687726071"><span class="hs-identifier hs-var">handlerState</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp)
 -&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp)))
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726068"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687726075"><span class="hs-identifier hs-var">parsedReq</span></a></span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="annottext">(Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
 Bool, Maybe Value, ExtraUserInfo)
-&gt; ActionCtxT
     ()
     m
     (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
      Bool, Maybe Value, ExtraUserInfo)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726078"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726069"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726070"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726072"><span class="hs-identifier hs-var">includeInternal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687726074"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726073"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-comment">-- in this case we parse the request _first_ and then send the request to the webhook for auth</span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#AHGraphQLRequest"><span class="hs-identifier hs-type">AHGraphQLRequest</span></a></span><span> </span><span id="local-6989586621687726093"><span class="annot"><span class="annottext">ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726093"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687726094"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687726094"><span class="hs-identifier hs-var">queryJSON</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726095"><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621687726095"><span class="hs-identifier hs-var">parsedReq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">Except QErr (Value, ReqsText) -&gt; Either QErr (Value, ReqsText)
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Except QErr (Value, ReqsText)
forall a (m :: * -&gt; *).
(FromJSON a, MonadError QErr m) =&gt;
ByteString -&gt; m (Value, a)
</span><a href="Hasura.Server.App.html#parseBody"><span class="hs-identifier hs-var">parseBody</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either QErr (Value, ReqsText)
-&gt; (QErr -&gt; ActionCtxT () m (Value, ReqsText))
-&gt; ActionCtxT () m (Value, ReqsText)
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687726096"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726096"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-comment">-- if the request fails to parse, call the webhook without a request body</span><span>
</span><span id="line-384"></span><span>            </span><span class="hs-comment">-- TODO should we signal this to the webhook somehow?</span><span>
</span><span id="line-385"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621687726097"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726097"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726098"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726098"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT
     () m (UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
</span><a href="#local-6989586621687726036"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-386"></span><span>            </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT () m (Value, ReqsText)
forall any ctx.
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT ctx m any
</span><a href="#local-6989586621687726043"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726097"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687725997"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726098"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687725888"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726096"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621687726099"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726099"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726100"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726100"><span class="hs-identifier hs-var">authHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726101"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687726101"><span class="hs-identifier hs-var">handlerState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726102"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726102"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726103"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726103"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
-&gt; ActionCtxT
     () m (UserInfo, [Header], HandlerCtx, Bool, ExtraUserInfo)
</span><a href="#local-6989586621687726036"><span class="hs-identifier hs-var">getInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReqsText -&gt; Maybe ReqsText
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621687726095"><span class="hs-identifier hs-var">parsedReq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>        </span><span id="local-6989586621687726104"><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726104"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either QErr (HttpLogGraphQLInfo, APIResp))
-&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr (HttpLogGraphQLInfo, APIResp))
 -&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp)))
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
-&gt; ActionCtxT () m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; HandlerCtx
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall (m :: * -&gt; *) a.
(HasResourceLimits m, MonadBaseControl IO m) =&gt;
Logger Hasura -&gt; HandlerCtx -&gt; Handler m a -&gt; m (Either QErr a)
</span><a href="Hasura.Server.App.html#runHandler"><span class="hs-identifier hs-var">runHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687725896"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621687726101"><span class="hs-identifier hs-var">handlerState</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp)
 -&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp)))
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
-&gt; m (Either QErr (HttpLogGraphQLInfo, APIResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726093"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621687726095"><span class="hs-identifier hs-var">parsedReq</span></a></span><span>
</span><span id="line-390"></span><span>        </span><span class="annot"><span class="annottext">(Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
 Bool, Maybe Value, ExtraUserInfo)
-&gt; ActionCtxT
     ()
     m
     (Either QErr (HttpLogGraphQLInfo, APIResp), UserInfo, [Header],
      Bool, Maybe Value, ExtraUserInfo)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726104"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726099"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726100"><span class="hs-identifier hs-var">authHeaders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726102"><span class="hs-identifier hs-var">includeInternal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687726094"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726103"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-comment">-- https://opentelemetry.io/docs/reference/specification/trace/semantic_conventions/span-general/#general-identity-attributes</span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; ActionT m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionT m ()) -&gt; m () -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceMetadata -&gt; m ()
forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; m ()
</span><a href="Hasura.Tracing.Class.html#attachMetadata"><span class="hs-identifier hs-var">Tracing.attachMetadata</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;enduser.role&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; Text
</span><a href="Hasura.RQL.Types.Roles.html#roleNameToTxt"><span class="hs-identifier hs-var">roleNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(RoleName -&gt; Text) -&gt; RoleName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.RQL.Types.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726056"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-comment">-- apply the error modifier</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726105"><span class="annot"><span class="annottext">modResult :: Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726105"><span class="hs-identifier hs-var hs-var">modResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; QErr)
-&gt; Either QErr (HttpLogGraphQLInfo, APIResp)
-&gt; Either QErr (HttpLogGraphQLInfo, APIResp)
forall a a' b. (a -&gt; a') -&gt; Either a b -&gt; Either a' b
</span><a href="Hasura.Server.Utils.html#fmapL"><span class="hs-identifier hs-var">fmapL</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687725888"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726055"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">-- log and return result</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687726105"><span class="hs-identifier hs-var">modResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-400"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687726107"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726107"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionT m ()
forall any ctx.
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT ctx m any
</span><a href="#local-6989586621687726043"><span class="hs-identifier hs-var">logErrorAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726056"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687726059"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726058"><span class="hs-identifier hs-var">includeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726008"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726060"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726107"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-402"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687726108"><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="#local-6989586621687726108"><span class="hs-identifier hs-var">httpLogGraphQLInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726109"><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621687726109"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726110"><span class="annot"><span class="annottext">httpLogMetadata :: HttpLogMetadata m
</span><a href="#local-6989586621687726110"><span class="hs-identifier hs-var hs-var">httpLogMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
HttpLog m =&gt;
HttpLogGraphQLInfo -&gt; ExtraUserInfo -&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#buildHttpLogMetadata"><span class="hs-identifier hs-var">buildHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="#local-6989586621687726108"><span class="hs-identifier hs-var">httpLogGraphQLInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726060"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span>
</span><span id="line-404"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; APIResp
-&gt; Maybe (DiffTime, DiffTime)
-&gt; [Header]
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; ActionT m ()
forall {m :: * -&gt; *} {ctx} {b}.
(HasAppEnv m, MonadTrace m, HttpLog m, MonadIO m) =&gt;
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; APIResp
-&gt; Maybe (DiffTime, DiffTime)
-&gt; [Header]
-&gt; [Header]
-&gt; (CommonHttpLogMetadata, ExtraHttpLogMetadata m)
-&gt; ActionCtxT ctx m b
</span><a href="#local-6989586621687726112"><span class="hs-identifier hs-var">logSuccessAndResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo -&gt; Maybe UserInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726056"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726007"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687725995"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726004"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687726059"><span class="hs-identifier hs-var">queryJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621687726109"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DiffTime, DiffTime) -&gt; Maybe (DiffTime, DiffTime)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621687726003"><span class="hs-identifier hs-var">ioWaitTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621687726054"><span class="hs-identifier hs-var">serviceTime</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687725997"><span class="hs-identifier hs-var">origHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726057"><span class="hs-identifier hs-var">authHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">HttpLogMetadata m
</span><a href="#local-6989586621687726110"><span class="hs-identifier hs-var">httpLogMetadata</span></a></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><a href="#local-6989586621687726043"><span class="hs-identifier hs-type">logErrorAndResp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-407"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724537"><span class="annot"><a href="#local-6989586621687724537"><span class="hs-identifier hs-type">any</span></a></span></span><span> </span><span id="local-6989586621687724536"><span class="annot"><a href="#local-6989586621687724536"><span class="hs-identifier hs-type">ctx</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-409"></span><span>      </span><span class="annot"><a href="Hasura.Server.Types.html#RequestId"><span class="hs-identifier hs-type">RequestId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Wai.Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-411"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-412"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Header.html#Header"><span class="hs-identifier hs-type">HTTP.Header</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#ExtraUserInfo"><span class="hs-identifier hs-type">ExtraUserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>      </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionCtxT"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724536"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724537"><span class="hs-identifier hs-type">any</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621687726043"><span class="annot"><span class="annottext">logErrorAndResp :: forall any ctx.
Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Bool
-&gt; [Header]
-&gt; ExtraUserInfo
-&gt; QErr
-&gt; ActionCtxT ctx m any
</span><a href="#local-6989586621687726043"><span class="hs-identifier hs-var hs-var">logErrorAndResp</span></a></span></span><span> </span><span id="local-6989586621687726135"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621687726135"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span id="local-6989586621687726136"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726136"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621687726137"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726137"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621687726138"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621687726138"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621687726139"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726139"><span class="hs-identifier hs-var">includeInternal</span></a></span></span><span> </span><span id="local-6989586621687726140"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726140"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621687726141"><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726141"><span class="hs-identifier hs-var">extraUserInfo</span></a></span></span><span> </span><span id="local-6989586621687726142"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726142"><span class="hs-identifier hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687726143"><span id="local-6989586621687726144"><span id="local-6989586621687726145"><span id="local-6989586621687726146"><span id="local-6989586621687726147"><span id="local-6989586621687726148"><span id="local-6989586621687726149"><span id="local-6989586621687726150"><span id="local-6989586621687726151"><span id="local-6989586621687726152"><span id="local-6989586621687726153"><span id="local-6989586621687726154"><span id="local-6989586621687726155"><span id="local-6989586621687726156"><span id="local-6989586621687726157"><span id="local-6989586621687726158"><span id="local-6989586621687726159"><span id="local-6989586621687726160"><span id="local-6989586621687726161"><span id="local-6989586621687726162"><span id="local-6989586621687726163"><span id="local-6989586621687726164"><span id="local-6989586621687726165"><span id="local-6989586621687726166"><span id="local-6989586621687726167"><span id="local-6989586621687726168"><span id="local-6989586621687726169"><span id="local-6989586621687726170"><span id="local-6989586621687726171"><span id="local-6989586621687726172"><span id="local-6989586621687726173"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv -&gt; ActionCtxT ctx m AppEnv
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT ctx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726174"><span class="annot"><span class="annottext">httpLogMetadata :: HttpLogMetadata m
</span><a href="#local-6989586621687726174"><span class="hs-identifier hs-var hs-var">httpLogMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
HttpLog m =&gt;
HttpLogGraphQLInfo -&gt; ExtraUserInfo -&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#buildHttpLogMetadata"><span class="hs-identifier hs-var">buildHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687724444"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraUserInfo
</span><a href="#local-6989586621687726141"><span class="hs-identifier hs-var">extraUserInfo</span></a></span><span>
</span><span id="line-420"></span><span>          </span><span id="local-6989586621687726176"><span class="annot"><span class="annottext">jsonResponse :: ByteString
</span><a href="#local-6989586621687726176"><span class="hs-identifier hs-var hs-var">jsonResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
forall a. Encoding' a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Encoding.Internal.html#encodingToLazyByteString"><span class="hs-identifier hs-var">J.encodingToLazyByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; ByteString) -&gt; Encoding -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="#local-6989586621687725887"><span class="hs-identifier hs-var">qErrEncoder</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726139"><span class="hs-identifier hs-var">includeInternal</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726142"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-421"></span><span>          </span><span id="local-6989586621687726178"><span class="annot"><span class="annottext">contentLength :: Header
</span><a href="#local-6989586621687726178"><span class="hs-identifier hs-var hs-var">contentLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Length&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.toStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; ByteString
</span><span class="hs-identifier hs-var">BB.toLazyByteString</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; ByteString) -&gt; Builder -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Builder
</span><span class="hs-identifier hs-var">BB.int64Dec</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Builder) -&gt; Int64 -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">BL.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726176"><span class="hs-identifier hs-var">jsonResponse</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>          </span><span id="local-6989586621687726183"><span class="annot"><span class="annottext">allHeaders :: [Header]
</span><a href="#local-6989586621687726183"><span class="hs-identifier hs-var hs-var">allHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621687726178"><span class="hs-identifier hs-var">contentLength</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-comment">-- https://opentelemetry.io/docs/reference/specification/trace/semantic_conventions/http/#common-attributes</span><span>
</span><span id="line-424"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT ctx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT ctx m ()) -&gt; m () -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceMetadata -&gt; m ()
forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; m ()
</span><a href="Hasura.Tracing.Class.html#attachMetadata"><span class="hs-identifier hs-var">Tracing.attachMetadata</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http.response_content_length&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ByteString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621687726178"><span class="hs-identifier hs-var">contentLength</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT ctx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT ctx m ()) -&gt; m () -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var">logHttpError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687726148"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687726152"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621687726135"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726136"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726137"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621687726138"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726142"><span class="hs-identifier hs-var">qErr</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726140"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">HttpLogMetadata m
</span><a href="#local-6989586621687726174"><span class="hs-identifier hs-var">httpLogMetadata</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="annot"><span class="annottext">(Header -&gt; ActionCtxT ctx m ()) -&gt; [Header] -&gt; ActionCtxT ctx m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726183"><span class="hs-identifier hs-var">allHeaders</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#setStatus"><span class="hs-identifier hs-var">Spock.setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; ActionCtxT ctx m ()) -&gt; Status -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Status
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var">qeStatus</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687726142"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ActionCtxT ctx m any
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#lazyBytes"><span class="hs-identifier hs-var">Spock.lazyBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726176"><span class="hs-identifier hs-var">jsonResponse</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621687726112"><span class="annot"><span class="annottext">logSuccessAndResp :: Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; APIResp
-&gt; Maybe (DiffTime, DiffTime)
-&gt; [Header]
-&gt; [Header]
-&gt; (CommonHttpLogMetadata, ExtraHttpLogMetadata m)
-&gt; ActionCtxT ctx m b
</span><a href="#local-6989586621687726112"><span class="hs-identifier hs-var hs-var">logSuccessAndResp</span></a></span></span><span> </span><span id="local-6989586621687726244"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621687726244"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span id="local-6989586621687726245"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726245"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621687726246"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726246"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621687726247"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621687726247"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621687726248"><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621687726248"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621687726249"><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621687726249"><span class="hs-identifier hs-var">qTime</span></a></span></span><span> </span><span id="local-6989586621687726250"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726250"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span id="local-6989586621687726251"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726251"><span class="hs-identifier hs-var">authHdrs</span></a></span></span><span> </span><span id="local-6989586621687726252"><span class="annot"><span class="annottext">(CommonHttpLogMetadata, ExtraHttpLogMetadata m)
</span><a href="#local-6989586621687726252"><span class="hs-identifier hs-var">httpLoggingMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687726253"><span id="local-6989586621687726254"><span id="local-6989586621687726255"><span id="local-6989586621687726256"><span id="local-6989586621687726257"><span id="local-6989586621687726258"><span id="local-6989586621687726259"><span id="local-6989586621687726260"><span id="local-6989586621687726261"><span id="local-6989586621687726262"><span id="local-6989586621687726263"><span id="local-6989586621687726264"><span id="local-6989586621687726265"><span id="local-6989586621687726266"><span id="local-6989586621687726267"><span id="local-6989586621687726268"><span id="local-6989586621687726269"><span id="local-6989586621687726270"><span id="local-6989586621687726271"><span id="local-6989586621687726272"><span id="local-6989586621687726273"><span id="local-6989586621687726274"><span id="local-6989586621687726275"><span id="local-6989586621687726276"><span id="local-6989586621687726277"><span id="local-6989586621687726278"><span id="local-6989586621687726279"><span id="local-6989586621687726280"><span id="local-6989586621687726281"><span id="local-6989586621687726282"><span id="local-6989586621687726283"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv -&gt; ActionCtxT ctx m AppEnv
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT ctx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-432"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687726284"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726284"><span class="hs-identifier hs-var">respBytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726285"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726285"><span class="hs-identifier hs-var">respHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">APIResp
</span><a href="#local-6989586621687726248"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-433"></span><span>            </span><span class="annot"><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-type">JSONResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span id="local-6989586621687726287"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726287"><span class="hs-identifier hs-var">encJson</span></a></span></span><span> </span><span id="local-6989586621687726288"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726288"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EncJSON -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJToLBS"><span class="hs-identifier hs-var">encJToLBS</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726287"><span class="hs-identifier hs-var">encJson</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Header -&gt; [Header]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726288"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>            </span><span class="annot"><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier hs-type">RawResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span id="local-6989586621687726290"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726290"><span class="hs-identifier hs-var">rawBytes</span></a></span></span><span> </span><span id="local-6989586621687726291"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726291"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726290"><span class="hs-identifier hs-var">rawBytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726291"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621687726292"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726292"><span class="hs-identifier hs-var">compressedResp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726293"><span class="annot"><span class="annottext">EncodingType
</span><a href="#local-6989586621687726293"><span class="hs-identifier hs-var">encodingType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ByteString -&gt; (ByteString, EncodingType)
</span><a href="Hasura.Server.Compression.html#compressResponse"><span class="hs-identifier hs-var">compressResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726246"><span class="hs-identifier hs-var">waiReq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726284"><span class="hs-identifier hs-var">respBytes</span></a></span><span>
</span><span id="line-436"></span><span>          </span><span id="local-6989586621687726295"><span class="annot"><span class="annottext">encodingHeader :: [Header]
</span><a href="#local-6989586621687726295"><span class="hs-identifier hs-var hs-var">encodingHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Header -&gt; [Header]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompressionType -&gt; Header
</span><a href="Hasura.Server.Compression.html#contentEncodingHeader"><span class="hs-identifier hs-var">contentEncodingHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(CompressionType -&gt; Header) -&gt; EncodingType -&gt; Maybe Header
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EncodingType
</span><a href="#local-6989586621687726293"><span class="hs-identifier hs-var">encodingType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>          </span><span id="local-6989586621687726298"><span class="annot"><span class="annottext">reqIdHeader :: Header
</span><a href="#local-6989586621687726298"><span class="hs-identifier hs-var hs-var">reqIdHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
forall a. IsString a =&gt; a
</span><a href="Hasura.Server.Utils.html#requestIdHeader"><span class="hs-identifier hs-var">requestIdHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#txtToBs"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Text -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequestId -&gt; Text
</span><a href="Hasura.Server.Types.html#unRequestId"><span class="hs-identifier hs-var">unRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726245"><span class="hs-identifier hs-var">reqId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>          </span><span id="local-6989586621687726301"><span class="annot"><span class="annottext">contentLength :: Header
</span><a href="#local-6989586621687726301"><span class="hs-identifier hs-var hs-var">contentLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Length&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B8.toStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; ByteString
</span><span class="hs-identifier hs-var">BB.toLazyByteString</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; ByteString) -&gt; Builder -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Builder
</span><span class="hs-identifier hs-var">BB.int64Dec</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Builder) -&gt; Int64 -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">BL.length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726292"><span class="hs-identifier hs-var">compressedResp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>          </span><span id="local-6989586621687726302"><span class="annot"><span class="annottext">allRespHeaders :: [Header]
</span><a href="#local-6989586621687726302"><span class="hs-identifier hs-var hs-var">allRespHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621687726298"><span class="hs-identifier hs-var">reqIdHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621687726301"><span class="hs-identifier hs-var">contentLength</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726295"><span class="hs-identifier hs-var">encodingHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726285"><span class="hs-identifier hs-var">respHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header] -&gt; [Header]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726251"><span class="hs-identifier hs-var">authHdrs</span></a></span><span>
</span><span id="line-440"></span><span>      </span><span class="hs-comment">-- https://opentelemetry.io/docs/reference/specification/trace/semantic_conventions/http/#common-attributes</span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT ctx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT ctx m ()) -&gt; m () -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceMetadata -&gt; m ()
forall (m :: * -&gt; *). MonadTrace m =&gt; TraceMetadata -&gt; m ()
</span><a href="Hasura.Tracing.Class.html#attachMetadata"><span class="hs-identifier hs-var">Tracing.attachMetadata</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http.response_content_length&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#bsToTxt"><span class="hs-identifier hs-var">bsToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ByteString
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="#local-6989586621687726301"><span class="hs-identifier hs-var">contentLength</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT ctx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT ctx m ()) -&gt; m () -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; EncodingType
-&gt; [Header]
-&gt; (CommonHttpLogMetadata, ExtraHttpLogMetadata m)
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; EncodingType
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpSuccess"><span class="hs-identifier hs-var">logHttpSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687726258"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687726262"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621687726244"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726245"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726246"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621687726247"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726284"><span class="hs-identifier hs-var">respBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726292"><span class="hs-identifier hs-var">compressedResp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621687726249"><span class="hs-identifier hs-var">qTime</span></a></span><span> </span><span class="annot"><span class="annottext">EncodingType
</span><a href="#local-6989586621687726293"><span class="hs-identifier hs-var">encodingType</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726250"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">(CommonHttpLogMetadata, ExtraHttpLogMetadata m)
</span><a href="#local-6989586621687726252"><span class="hs-identifier hs-var">httpLoggingMetadata</span></a></span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><span class="annottext">(Header -&gt; ActionCtxT ctx m ()) -&gt; [Header] -&gt; ActionCtxT ctx m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726302"><span class="hs-identifier hs-var">allRespHeaders</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ActionCtxT ctx m b
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#lazyBytes"><span class="hs-identifier hs-var">Spock.lazyBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726292"><span class="hs-identifier hs-var">compressedResp</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span id="local-6989586621687724582"><span class="annot"><a href="Hasura.Server.App.html#v1QueryHandler"><span class="hs-identifier hs-type">v1QueryHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-448"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-450"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-454"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-457"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-459"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><a href="Hasura.Server.API.Query.html#RQLQuery"><span class="hs-identifier hs-type">RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><a href="#local-6989586621687724582"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-466"></span><span id="v1QueryHandler"><span class="annot"><span class="annottext">v1QueryHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m,
 MonadMetadataApiAuthorization m, MonadTrace m,
 MonadReader HandlerCtx m, MonadMetadataStorage m,
 MonadResolveSource m, HasAppEnv m, HasCacheStaticConfig m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesNetwork m,
 MonadGetPolicies m, UserInfoM m) =&gt;
((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1QueryHandler"><span class="hs-identifier hs-var hs-var">v1QueryHandler</span></a></span></span><span> </span><span id="local-6989586621687726348"><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
</span><a href="#local-6989586621687726348"><span class="hs-identifier hs-var">schemaCacheRefUpdater</span></a></span></span><span> </span><span id="local-6989586621687726349"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726349"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ())
-&gt; (HandlerCtx -&gt; m (Either QErr ())) -&gt; HandlerCtx -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var">authorizeV1QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726349"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; m ()) -&gt; m HandlerCtx -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m HandlerCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-468"></span><span>  </span><span id="local-6989586621687726352"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726352"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RebuildableSchemaCache) -&gt; m RebuildableSchemaCache
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var">hcSchemaCache</span></a></span><span>
</span><span id="line-469"></span><span>  </span><span id="local-6989586621687726353"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726353"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m EncJSON -&gt; m EncJSON -&gt; Bool -&gt; m EncJSON
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EncJSON, RebuildableSchemaCache) -&gt; EncJSON
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((EncJSON, RebuildableSchemaCache) -&gt; EncJSON)
-&gt; m (EncJSON, RebuildableSchemaCache) -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621687726355"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726352"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
</span><a href="#local-6989586621687726348"><span class="hs-identifier hs-var">schemaCacheRefUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621687726355"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m EncJSON) -&gt; Bool -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; Bool
</span><a href="Hasura.Server.API.Query.html#queryModifiesSchemaCache"><span class="hs-identifier hs-var">queryModifiesSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726349"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726353"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span>    </span><span id="local-6989586621687726355"><span class="annot"><span class="annottext">action :: RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621687726355"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span id="local-6989586621687726357"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726357"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>      </span><span id="local-6989586621687726358"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726358"><span class="hs-identifier hs-var">appContext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; AppContext) -&gt; m AppContext
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; AppContext
</span><a href="Hasura.Server.App.html#hcAppContext"><span class="hs-identifier hs-var">hcAppContext</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span class="annot"><span class="annottext">AppContext
-&gt; RebuildableSchemaCache
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, HasAppEnv m, HasCacheStaticConfig m,
 MonadTrace m, MonadBaseControl IO m, MonadMetadataStorage m,
 MonadResolveSource m, MonadQueryTags m, MonadEventLogCleanup m,
 ProvidesHasuraServices m, MonadGetPolicies m, UserInfoM m) =&gt;
AppContext
-&gt; RebuildableSchemaCache
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="Hasura.Server.API.Query.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726358"><span class="hs-identifier hs-var">appContext</span></a></span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726357"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726349"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="annot"><span class="hs-comment">-- | See Note [Explicitly passing AppStateRef]</span></span><span>
</span><span id="line-480"></span><span id="local-6989586621687724592"><span class="annot"><a href="Hasura.Server.App.html#v1MetadataHandler"><span class="hs-identifier hs-type">v1MetadataHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-type">HasFeatureFlagChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.html#WebsocketCloseOnMetadataChangeAction"><span class="hs-identifier hs-type">WS.WebsocketCloseOnMetadataChangeAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>  </span><span class="annot"><a href="Hasura.Server.API.Metadata.html#RQLMetadata"><span class="hs-identifier hs-type">RQLMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><a href="#local-6989586621687724592"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-501"></span><span id="v1MetadataHandler"><span class="annot"><span class="annottext">v1MetadataHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m,
 MonadReader HandlerCtx m, MonadTrace m, MonadMetadataStorage m,
 MonadResolveSource m, MonadMetadataApiAuthorization m,
 MonadEventLogCleanup m, HasAppEnv m, HasCacheStaticConfig m,
 HasFeatureFlagChecker m, ProvidesNetwork m, MonadGetPolicies m,
 UserInfoM m) =&gt;
((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; RQLMetadata
-&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1MetadataHandler"><span class="hs-identifier hs-var hs-var">v1MetadataHandler</span></a></span></span><span> </span><span id="local-6989586621687726403"><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
</span><a href="#local-6989586621687726403"><span class="hs-identifier hs-var">schemaCacheRefUpdater</span></a></span></span><span> </span><span id="local-6989586621687726404"><span class="annot"><span class="annottext">WebsocketCloseOnMetadataChangeAction
</span><a href="#local-6989586621687726404"><span class="hs-identifier hs-var">closeWebsocketsOnMetadataChangeAction</span></a></span></span><span> </span><span id="local-6989586621687726405"><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687726405"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m (HttpResponse EncJSON) -&gt; m (HttpResponse EncJSON)
forall (m :: * -&gt; *) a.
(MonadIO m, MonadTrace m) =&gt;
Text -&gt; m a -&gt; m a
</span><a href="Hasura.Tracing.Class.html#newSpan"><span class="hs-identifier hs-var">Tracing.newSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Metadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (HttpResponse EncJSON) -&gt; m (HttpResponse EncJSON))
-&gt; m (HttpResponse EncJSON) -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ())
-&gt; (HandlerCtx -&gt; m (Either QErr ())) -&gt; HandlerCtx -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLMetadata -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var">authorizeV1MetadataApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687726405"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; m ()) -&gt; m HandlerCtx -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m HandlerCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-503"></span><span>  </span><span id="local-6989586621687726407"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726407"><span class="hs-identifier hs-var">appContext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; AppContext) -&gt; m AppContext
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; AppContext
</span><a href="Hasura.Server.App.html#hcAppContext"><span class="hs-identifier hs-var">hcAppContext</span></a></span><span>
</span><span id="line-504"></span><span>  </span><span id="local-6989586621687726408"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726408"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
</span><a href="#local-6989586621687726403"><span class="hs-identifier hs-var">schemaCacheRefUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; (RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687726409"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726409"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>      </span><span class="annot"><span class="annottext">AppContext
-&gt; RebuildableSchemaCache
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; RQLMetadata
-&gt; m (EncJSON, RebuildableSchemaCache)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m, HasAppEnv m,
 HasCacheStaticConfig m, HasFeatureFlagChecker m, MonadTrace m,
 MonadMetadataStorage m, MonadResolveSource m,
 MonadEventLogCleanup m, ProvidesHasuraServices m,
 MonadGetPolicies m, UserInfoM m) =&gt;
AppContext
-&gt; RebuildableSchemaCache
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; RQLMetadata
-&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="Hasura.Server.API.Metadata.html#runMetadataQuery"><span class="hs-identifier hs-var">runMetadataQuery</span></a></span><span>
</span><span id="line-507"></span><span>        </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726407"><span class="hs-identifier hs-var">appContext</span></a></span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726409"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-509"></span><span>        </span><span class="annot"><span class="annottext">WebsocketCloseOnMetadataChangeAction
</span><a href="#local-6989586621687726404"><span class="hs-identifier hs-var">closeWebsocketsOnMetadataChangeAction</span></a></span><span>
</span><span id="line-510"></span><span>        </span><span class="annot"><span class="annottext">RQLMetadata
</span><a href="#local-6989586621687726405"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726408"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span id="local-6989586621687724598"><span class="annot"><a href="Hasura.Server.App.html#v2QueryHandler"><span class="hs-identifier hs-type">v2QueryHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-519"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-520"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-521"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Session.html#UserInfoM"><span class="hs-identifier hs-type">UserInfoM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-529"></span><span>  </span><span class="annot"><a href="Hasura.Server.API.V2Query.html#RQLQuery"><span class="hs-identifier hs-type">V2Q.RQLQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><a href="#local-6989586621687724598"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-531"></span><span id="v2QueryHandler"><span class="annot"><span class="annottext">v2QueryHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m,
 MonadMetadataApiAuthorization m, MonadTrace m,
 MonadReader HandlerCtx m, MonadMetadataStorage m,
 MonadResolveSource m, HasAppEnv m, HasCacheStaticConfig m,
 MonadQueryTags m, ProvidesNetwork m, UserInfoM m) =&gt;
((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v2QueryHandler"><span class="hs-identifier hs-var hs-var">v2QueryHandler</span></a></span></span><span> </span><span id="local-6989586621687726454"><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
</span><a href="#local-6989586621687726454"><span class="hs-identifier hs-var">schemaCacheRefUpdater</span></a></span></span><span> </span><span id="local-6989586621687726455"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726455"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m (HttpResponse EncJSON) -&gt; m (HttpResponse EncJSON)
forall (m :: * -&gt; *) a.
(MonadIO m, MonadTrace m) =&gt;
Text -&gt; m a -&gt; m a
</span><a href="Hasura.Tracing.Class.html#newSpan"><span class="hs-identifier hs-var">Tracing.newSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;v2 Query&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (HttpResponse EncJSON) -&gt; m (HttpResponse EncJSON))
-&gt; m (HttpResponse EncJSON) -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621687726456"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726456"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RebuildableSchemaCache) -&gt; m RebuildableSchemaCache
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var">hcSchemaCache</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ())
-&gt; (HandlerCtx -&gt; m (Either QErr ())) -&gt; HandlerCtx -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataApiAuthorization m =&gt;
RQLQuery -&gt; HandlerCtx -&gt; m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var">authorizeV2QueryApi</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726455"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; m ()) -&gt; m HandlerCtx -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m HandlerCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-534"></span><span>  </span><span id="local-6989586621687726457"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726457"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><span class="annottext">m EncJSON -&gt; m EncJSON -&gt; Bool -&gt; m EncJSON
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EncJSON, RebuildableSchemaCache) -&gt; EncJSON
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((EncJSON, RebuildableSchemaCache) -&gt; EncJSON)
-&gt; m (EncJSON, RebuildableSchemaCache) -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621687726458"><span class="hs-identifier hs-var">dbAction</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726456"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
-&gt; m EncJSON
</span><a href="#local-6989586621687726454"><span class="hs-identifier hs-var">schemaCacheRefUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621687726458"><span class="hs-identifier hs-var">dbAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; m EncJSON) -&gt; Bool -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RQLQuery -&gt; Bool
</span><a href="Hasura.Server.API.V2Query.html#queryModifiesSchema"><span class="hs-identifier hs-var">V2Q.queryModifiesSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726455"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-537"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726457"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-comment">-- Hit postgres</span><span>
</span><span id="line-540"></span><span>    </span><span id="local-6989586621687726458"><span class="annot"><span class="annottext">dbAction :: RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="#local-6989586621687726458"><span class="hs-identifier hs-var hs-var">dbAction</span></a></span></span><span> </span><span id="local-6989586621687726460"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726460"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>      </span><span id="local-6989586621687726461"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726461"><span class="hs-identifier hs-var">appContext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; AppContext) -&gt; m AppContext
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; AppContext
</span><a href="Hasura.Server.App.html#hcAppContext"><span class="hs-identifier hs-var">hcAppContext</span></a></span><span>
</span><span id="line-542"></span><span>      </span><span class="annot"><span class="annottext">AppContext
-&gt; RebuildableSchemaCache
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m, HasAppEnv m,
 HasCacheStaticConfig m, MonadTrace m, MonadMetadataStorage m,
 MonadResolveSource m, MonadQueryTags m, ProvidesHasuraServices m,
 UserInfoM m) =&gt;
AppContext
-&gt; RebuildableSchemaCache
-&gt; RQLQuery
-&gt; m (EncJSON, RebuildableSchemaCache)
</span><a href="Hasura.Server.API.V2Query.html#runQuery"><span class="hs-identifier hs-var">V2Q.runQuery</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687726461"><span class="hs-identifier hs-var">appContext</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726460"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621687726455"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span id="local-6989586621687724601"><span class="annot"><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-type">v1Alpha1GQHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-549"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-553"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-554"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-555"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-557"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.Types.html#GraphQLQueryType"><span class="hs-identifier hs-type">E.GraphQLQueryType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLBatchedReqs"><span class="hs-identifier hs-type">GH.GQLBatchedReqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GH.GQLReq</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLQueryText"><span class="hs-identifier hs-type">GH.GQLQueryText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-565"></span><span>  </span><span class="annot"><a href="#local-6989586621687724601"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-566"></span><span id="v1Alpha1GQHandler"><span class="annot"><span class="annottext">v1Alpha1GQHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var hs-var">v1Alpha1GQHandler</span></a></span></span><span> </span><span id="local-6989586621687726508"><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="#local-6989586621687726508"><span class="hs-identifier hs-var">queryType</span></a></span></span><span> </span><span id="local-6989586621687726509"><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621687726509"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-567"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687726510"><span id="local-6989586621687726511"><span id="local-6989586621687726512"><span id="local-6989586621687726513"><span id="local-6989586621687726514"><span id="local-6989586621687726515"><span id="local-6989586621687726516"><span id="local-6989586621687726517"><span id="local-6989586621687726518"><span id="local-6989586621687726519"><span id="local-6989586621687726520"><span id="local-6989586621687726521"><span id="local-6989586621687726522"><span id="local-6989586621687726523"><span id="local-6989586621687726524"><span id="local-6989586621687726525"><span id="local-6989586621687726526"><span id="local-6989586621687726527"><span id="local-6989586621687726528"><span id="local-6989586621687726529"><span id="local-6989586621687726530"><span id="local-6989586621687726531"><span id="local-6989586621687726532"><span id="local-6989586621687726533"><span id="local-6989586621687726534"><span id="local-6989586621687726535"><span id="local-6989586621687726536"><span id="local-6989586621687726537"><span id="local-6989586621687726538"><span id="local-6989586621687726539"><span id="local-6989586621687726540"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687726541"><span id="local-6989586621687726542"><span id="local-6989586621687726543"><span id="local-6989586621687726544"><span id="local-6989586621687726545"><span id="local-6989586621687726546"><span id="local-6989586621687726547"><span id="local-6989586621687726548"><span id="local-6989586621687726549"><span id="local-6989586621687726550"><span id="local-6989586621687726551"><span id="local-6989586621687726552"><span id="local-6989586621687726553"><span id="local-6989586621687726554"><span id="local-6989586621687726555"><span id="local-6989586621687726556"><span id="local-6989586621687726557"><span id="local-6989586621687726558"><span id="local-6989586621687726559"><span id="local-6989586621687726560"><span class="annot"><span class="annottext">Environment
HashSet ExperimentalFeature
HashSet API
StreamQueriesOptions
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
CloseWebsocketsOnMetadataChangeStatus
ApolloFederationStatus
CorsPolicy
AuthMode
MetadataDefaults
ResponseInternalErrorsConfig
OptionalInterval
TelemetryStatus
AllowListStatus
ConsoleStatus
EventEngineCtx
acEnabledAPIs :: AppContext -&gt; HashSet API
acAuthMode :: AppContext -&gt; AuthMode
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
acEnableAllowlist :: AppContext -&gt; AllowListStatus
acResponseInternalErrorsConfig :: AppContext -&gt; ResponseInternalErrorsConfig
acEnvironment :: AppContext -&gt; Environment
acRemoteSchemaPermsCtx :: AppContext -&gt; RemoteSchemaPermissions
acFunctionPermsCtx :: AppContext -&gt; InferFunctionPermissions
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
acDefaultNamingConvention :: AppContext -&gt; NamingCase
acMetadataDefaults :: AppContext -&gt; MetadataDefaults
acLiveQueryOptions :: AppContext -&gt; StreamQueriesOptions
acStreamQueryOptions :: AppContext -&gt; StreamQueriesOptions
acCorsPolicy :: AppContext -&gt; CorsPolicy
acConsoleStatus :: AppContext -&gt; ConsoleStatus
acEnableTelemetry :: AppContext -&gt; TelemetryStatus
acEventEngineCtx :: AppContext -&gt; EventEngineCtx
acAsyncActionsFetchInterval :: AppContext -&gt; OptionalInterval
acApolloFederationStatus :: AppContext -&gt; ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: AppContext -&gt; CloseWebsocketsOnMetadataChangeStatus
acAuthMode :: AuthMode
acSQLGenCtx :: SQLGenCtx
acEnabledAPIs :: HashSet API
acEnableAllowlist :: AllowListStatus
acResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
acEnvironment :: Environment
acRemoteSchemaPermsCtx :: RemoteSchemaPermissions
acFunctionPermsCtx :: InferFunctionPermissions
acExperimentalFeatures :: HashSet ExperimentalFeature
acDefaultNamingConvention :: NamingCase
acMetadataDefaults :: MetadataDefaults
acLiveQueryOptions :: StreamQueriesOptions
acStreamQueryOptions :: StreamQueriesOptions
acCorsPolicy :: CorsPolicy
acConsoleStatus :: ConsoleStatus
acEnableTelemetry :: TelemetryStatus
acEventEngineCtx :: EventEngineCtx
acAsyncActionsFetchInterval :: OptionalInterval
acApolloFederationStatus :: ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: CloseWebsocketsOnMetadataChangeStatus
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; AppContext) -&gt; m AppContext
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; AppContext
</span><a href="Hasura.Server.App.html#hcAppContext"><span class="hs-identifier hs-var">hcAppContext</span></a></span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621687726561"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726561"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621687726562"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687726562"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; SchemaCache)
-&gt; m RebuildableSchemaCache -&gt; m SchemaCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RebuildableSchemaCache) -&gt; m RebuildableSchemaCache
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var">hcSchemaCache</span></a></span><span>
</span><span id="line-571"></span><span>  </span><span id="local-6989586621687726564"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726564"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; [Header]) -&gt; m [Header]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var">hcReqHeaders</span></a></span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621687726565"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687726565"><span class="hs-identifier hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; IpAddress) -&gt; m IpAddress
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; IpAddress
</span><a href="Hasura.Server.App.html#hcSourceIpAddress"><span class="hs-identifier hs-var">hcSourceIpAddress</span></a></span><span>
</span><span id="line-573"></span><span>  </span><span id="local-6989586621687726566"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726566"><span class="hs-identifier hs-var">requestId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RequestId) -&gt; m RequestId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RequestId
</span><a href="Hasura.Server.App.html#hcRequestId"><span class="hs-identifier hs-var">hcRequestId</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span class="annot"><span class="annottext">Environment
-&gt; SQLGenCtx
-&gt; SchemaCache
-&gt; AllowListStatus
-&gt; ReadOnlyMode
-&gt; PrometheusMetrics
-&gt; Logger Hasura
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; RequestId
-&gt; ResponseInternalErrorsConfig
-&gt; UserInfo
-&gt; IpAddress
-&gt; [Header]
-&gt; GraphQLQueryType
-&gt; ReqsText
-&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m,
 MonadGQLExecutionCheck m, MonadQueryLog m, MonadExecutionLog m,
 MonadTrace m, MonadExecuteQuery m, MonadMetadataStorage m,
 MonadQueryTags m, HasResourceLimits m, ProvidesNetwork m) =&gt;
Environment
-&gt; SQLGenCtx
-&gt; SchemaCache
-&gt; AllowListStatus
-&gt; ReadOnlyMode
-&gt; PrometheusMetrics
-&gt; Logger Hasura
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; RequestId
-&gt; ResponseInternalErrorsConfig
-&gt; UserInfo
-&gt; IpAddress
-&gt; [Header]
-&gt; GraphQLQueryType
-&gt; ReqsText
-&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.GraphQL.Transport.HTTP.html#runGQBatched"><span class="hs-identifier hs-var">GH.runGQBatched</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687726546"><span class="hs-identifier hs-var">acEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621687726542"><span class="hs-identifier hs-var">acSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687726562"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AllowListStatus
</span><a href="#local-6989586621687726544"><span class="hs-identifier hs-var">acEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621687726521"><span class="hs-identifier hs-var">appEnvEnableReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621687726525"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687726515"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621687726539"><span class="hs-identifier hs-var">appEnvLicenseKeyCache</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687726566"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621687726545"><span class="hs-identifier hs-var">acResponseInternalErrorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687726561"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687726565"><span class="hs-identifier hs-var">ipAddress</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726564"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="#local-6989586621687726508"><span class="hs-identifier hs-var">queryType</span></a></span><span> </span><span class="annot"><span class="annottext">ReqsText
</span><a href="#local-6989586621687726509"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span id="local-6989586621687724605"><span class="annot"><a href="Hasura.Server.App.html#v1GQHandler"><span class="hs-identifier hs-type">v1GQHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-580"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-581"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-585"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-586"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-587"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-588"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-590"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-592"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLBatchedReqs"><span class="hs-identifier hs-type">GH.GQLBatchedReqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GH.GQLReq</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLQueryText"><span class="hs-identifier hs-type">GH.GQLQueryText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-593"></span><span>  </span><span class="annot"><a href="#local-6989586621687724605"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-594"></span><span id="v1GQHandler"><span class="annot"><span class="annottext">v1GQHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQHandler"><span class="hs-identifier hs-var hs-var">v1GQHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var">v1Alpha1GQHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="Hasura.GraphQL.Execute.Types.html#QueryHasura"><span class="hs-identifier hs-var">E.QueryHasura</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span id="local-6989586621687726598"><span class="annot"><a href="Hasura.Server.App.html#v1GQRelayHandler"><span class="hs-identifier hs-type">v1GQRelayHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-600"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-604"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLBatchedReqs"><span class="hs-identifier hs-type">GH.GQLBatchedReqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GH.GQLReq</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLQueryText"><span class="hs-identifier hs-type">GH.GQLQueryText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><a href="#local-6989586621687726598"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-614"></span><span id="v1GQRelayHandler"><span class="annot"><span class="annottext">v1GQRelayHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQRelayHandler"><span class="hs-identifier hs-var hs-var">v1GQRelayHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var">v1Alpha1GQHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="Hasura.GraphQL.Execute.Types.html#QueryRelay"><span class="hs-identifier hs-var">E.QueryRelay</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="annot"><a href="Hasura.Server.App.html#gqlExplainHandler"><span class="hs-identifier hs-type">gqlExplainHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724608"><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-622"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-623"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-626"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Explain.html#GQLExplain"><span class="hs-identifier hs-type">GE.GQLExplain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><a href="#local-6989586621687724608"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-type">HttpResponse</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span id="gqlExplainHandler"><span class="annot"><span class="annottext">gqlExplainHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m,
 MonadReader HandlerCtx m, MonadMetadataStorage m, MonadQueryTags m,
 MonadTrace m) =&gt;
GQLExplain -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#gqlExplainHandler"><span class="hs-identifier hs-var hs-var">gqlExplainHandler</span></a></span></span><span> </span><span id="local-6989586621687726655"><span class="annot"><span class="annottext">GQLExplain
</span><a href="#local-6989586621687726655"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-629"></span><span>  </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-630"></span><span>  </span><span id="local-6989586621687726656"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726656"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RebuildableSchemaCache) -&gt; m RebuildableSchemaCache
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var">hcSchemaCache</span></a></span><span>
</span><span id="line-631"></span><span>  </span><span id="local-6989586621687726657"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726657"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; [Header]) -&gt; m [Header]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var">hcReqHeaders</span></a></span><span>
</span><span id="line-632"></span><span>  </span><span id="local-6989586621687726658"><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621687726658"><span class="hs-identifier hs-var">licenseKeyCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; Maybe (CredentialCache AgentLicenseKey))
-&gt; m (Maybe (CredentialCache AgentLicenseKey))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; Maybe (CredentialCache AgentLicenseKey)
</span><a href="Hasura.Server.App.html#hcLicenseKeyCache"><span class="hs-identifier hs-var">hcLicenseKeyCache</span></a></span><span>
</span><span id="line-633"></span><span>  </span><span id="local-6989586621687726659"><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726659"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; [Header]
-&gt; GQLExplain
-&gt; m EncJSON
forall (m :: * -&gt; *).
(MonadError QErr m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadQueryTags m, MonadTrace m) =&gt;
SchemaCache
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; [Header]
-&gt; GQLExplain
-&gt; m EncJSON
</span><a href="Hasura.GraphQL.Explain.html#explainGQLQuery"><span class="hs-identifier hs-var">GE.explainGQLQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726656"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621687726658"><span class="hs-identifier hs-var">licenseKeyCache</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726657"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">GQLExplain
</span><a href="#local-6989586621687726655"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; m (HttpResponse EncJSON))
-&gt; HttpResponse EncJSON -&gt; m (HttpResponse EncJSON)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="#local-6989586621687726659"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span id="local-6989586621687724612"><span class="annot"><a href="Hasura.Server.App.html#v1Alpha1PGDumpHandler"><span class="hs-identifier hs-type">v1Alpha1PGDumpHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HandlerCtx"><span class="hs-identifier hs-type">HandlerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.API.PGDump.html#PGDumpReqBody"><span class="hs-identifier hs-type">PGD.PGDumpReqBody</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724612"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span></span><span>
</span><span id="line-637"></span><span id="v1Alpha1PGDumpHandler"><span class="annot"><span class="annottext">v1Alpha1PGDumpHandler :: forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadReader HandlerCtx m) =&gt;
PGDumpReqBody -&gt; m APIResp
</span><a href="Hasura.Server.App.html#v1Alpha1PGDumpHandler"><span class="hs-identifier hs-var hs-var">v1Alpha1PGDumpHandler</span></a></span></span><span> </span><span id="local-6989586621687726693"><span class="annot"><span class="annottext">PGDumpReqBody
</span><a href="#local-6989586621687726693"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-638"></span><span>  </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-639"></span><span>  </span><span id="local-6989586621687726694"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726694"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RebuildableSchemaCache) -&gt; m RebuildableSchemaCache
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var">hcSchemaCache</span></a></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726695"><span class="annot"><span class="annottext">sources :: SourceCache
</span><a href="#local-6989586621687726695"><span class="hs-identifier hs-var hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621687726694"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>      </span><span id="local-6989586621687726697"><span class="annot"><span class="annottext">sourceName :: SourceName
</span><a href="#local-6989586621687726697"><span class="hs-identifier hs-var hs-var">sourceName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody -&gt; SourceName
</span><a href="Hasura.Server.API.PGDump.html#prbSource"><span class="hs-identifier hs-var">PGD.prbSource</span></a></span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody
</span><a href="#local-6989586621687726693"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-642"></span><span>      </span><span id="local-6989586621687726699"><span class="annot"><span class="annottext">sourceConfig :: Maybe PGSourceConfig
</span><a href="#local-6989586621687726699"><span class="hs-identifier hs-var hs-var">sourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
HasTag b =&gt;
AnyBackend SourceInfo -&gt; Maybe (SourceConfig b)
</span><a href="Hasura.RQL.Types.Source.html#unsafeSourceConfiguration"><span class="hs-identifier hs-var">unsafeSourceConfiguration</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceInfo -&gt; Maybe PGSourceConfig)
-&gt; Maybe (AnyBackend SourceInfo) -&gt; Maybe PGSourceConfig
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceCache -&gt; Maybe (AnyBackend SourceInfo)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-8335dfa2c360fbc99338d79b59c29f0e55b38395ab008163a5f9c1bb67e3a4b4/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687726697"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621687726695"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-643"></span><span>  </span><span id="local-6989586621687726702"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621687726702"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-644"></span><span>    </span><span class="annot"><span class="annottext">(PGSourceConfig -&gt; ConnInfo)
-&gt; Maybe PGSourceConfig -&gt; Maybe ConnInfo
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PGSourceConfig -&gt; ConnInfo
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#_pscConnInfo"><span class="hs-identifier hs-var">_pscConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PGSourceConfig
</span><a href="#local-6989586621687726699"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span>
</span><span id="line-645"></span><span>      </span><span class="annot"><span class="annottext">Maybe ConnInfo -&gt; m ConnInfo -&gt; m ConnInfo
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ConnInfo
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;source &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621687726697"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>  </span><span id="local-6989586621687726707"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726707"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody -&gt; ConnInfo -&gt; m ByteString
forall (m :: * -&gt; *).
(MonadError QErr m, MonadIO m) =&gt;
PGDumpReqBody -&gt; ConnInfo -&gt; m ByteString
</span><a href="Hasura.Server.API.PGDump.html#execPGDump"><span class="hs-identifier hs-var">PGD.execPGDump</span></a></span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody
</span><a href="#local-6989586621687726693"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621687726702"><span class="hs-identifier hs-var">ci</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="annot"><span class="annottext">APIResp -&gt; m APIResp
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; m APIResp) -&gt; APIResp -&gt; m APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HttpResponse ByteString -&gt; APIResp
</span><a href="Hasura.Server.App.html#RawResp"><span class="hs-identifier hs-var">RawResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse ByteString -&gt; APIResp)
-&gt; HttpResponse ByteString -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Header] -&gt; HttpResponse ByteString
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726707"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#sqlHeader"><span class="hs-identifier hs-var">sqlHeader</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span id="local-6989586621687724628"><span class="annot"><a href="Hasura.Server.App.html#consoleAssetsHandler"><span class="hs-identifier hs-type">consoleAssetsHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724628"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724628"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-type">LoggingSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-654"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-655"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionT"><span class="hs-identifier hs-type">Spock.ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724628"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-656"></span><span id="consoleAssetsHandler"><span class="annot"><span class="annottext">consoleAssetsHandler :: forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura -&gt; LoggingSettings -&gt; Text -&gt; Text -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#consoleAssetsHandler"><span class="hs-identifier hs-var hs-var">consoleAssetsHandler</span></a></span></span><span> </span><span id="local-6989586621687726741"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687726741"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687726742"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687726742"><span class="hs-identifier hs-var">loggingSettings</span></a></span></span><span> </span><span id="local-6989586621687726743"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726743"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621687726744"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726744"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>  </span><span id="local-6989586621687726745"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726745"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726746"><span class="annot"><span class="annottext">reqHeaders :: [Header]
</span><a href="#local-6989586621687726746"><span class="hs-identifier hs-var hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687726745"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-comment">-- '..' in paths need not be handed as it is resolved in the url by</span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-comment">-- spock's routing. we get the expanded path.</span><span>
</span><span id="line-661"></span><span>  </span><span id="local-6989586621687726747"><span class="annot"><span class="annottext">Either IOException ByteString
</span><a href="#local-6989586621687726747"><span class="hs-identifier hs-var">eFileContents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><span class="annottext">IO (Either IOException ByteString)
-&gt; ActionCtxT () m (Either IOException ByteString)
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">(IO (Either IOException ByteString)
 -&gt; ActionCtxT () m (Either IOException ByteString))
-&gt; IO (Either IOException ByteString)
-&gt; ActionCtxT () m (Either IOException ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687726748"><span class="hs-identifier hs-var">validFilename</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO ()) -&gt; IOException -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IOException
</span><span class="hs-identifier hs-var">userError</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;invalid asset filename&quot;</span></span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BL.readFile</span></span><span>
</span><span id="line-666"></span><span>          </span><span class="annot"><span class="annottext">([Char] -&gt; IO ByteString) -&gt; [Char] -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">joinPath</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726743"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687726752"><span class="hs-identifier hs-var">pathStr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><span class="annottext">(IOException -&gt; ActionT m ())
-&gt; (ByteString -&gt; ActionT m ())
-&gt; Either IOException ByteString
-&gt; ActionT m ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Header] -&gt; IOException -&gt; ActionT m ()
forall (m :: * -&gt; *) a.
(MonadIO m, HttpLog m) =&gt;
[Header] -&gt; a -&gt; ActionT m ()
</span><a href="#local-6989586621687726754"><span class="hs-identifier hs-var">onError</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726746"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT m ()
</span><a href="#local-6989586621687726755"><span class="hs-identifier hs-var">onSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Either IOException ByteString
</span><a href="#local-6989586621687726747"><span class="hs-identifier hs-var">eFileContents</span></a></span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-669"></span><span>    </span><span id="local-6989586621687726752"><span class="annot"><span class="annottext">pathStr :: [Char]
</span><a href="#local-6989586621687726752"><span class="hs-identifier hs-var hs-var">pathStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726744"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621687726748"><span class="annot"><span class="annottext">validFilename :: Bool
</span><a href="#local-6989586621687726748"><span class="hs-identifier hs-var hs-var">validFilename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><span class="hs-identifier hs-var">isRelative</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687726752"><span class="hs-identifier hs-var">pathStr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;..&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.html#isInfixOf"><span class="hs-operator hs-var">`T.isInfixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726744"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>    </span><span id="local-6989586621687726755"><span class="annot"><span class="annottext">onSuccess :: ByteString -&gt; ActionT m ()
</span><a href="#local-6989586621687726755"><span class="hs-identifier hs-var hs-var">onSuccess</span></a></span></span><span> </span><span id="local-6989586621687726759"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726759"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>      </span><span class="annot"><span class="annottext">(Header -&gt; ActionT m ()) -&gt; [Header] -&gt; ActionT m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Header -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726760"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-673"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#lazyBytes"><span class="hs-identifier hs-var">Spock.lazyBytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726759"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span id="local-6989586621687724639"><span id="local-6989586621687724640"><span class="annot"><a href="#local-6989586621687726754"><span class="hs-identifier hs-type">onError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Header.html#Header"><span class="hs-identifier hs-type">HTTP.Header</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687724640"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionT"><span class="hs-identifier hs-type">Spock.ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724639"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-675"></span><span>    </span><span id="local-6989586621687726754"><span class="annot"><span class="annottext">onError :: forall (m :: * -&gt; *) a.
(MonadIO m, HttpLog m) =&gt;
[Header] -&gt; a -&gt; ActionT m ()
</span><a href="#local-6989586621687726754"><span class="hs-identifier hs-var hs-var">onError</span></a></span></span><span> </span><span id="local-6989586621687726767"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726767"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var">raiseGenericApiError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687726741"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687726742"><span class="hs-identifier hs-var">loggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726767"><span class="hs-identifier hs-var">hdrs</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionT m ()) -&gt; QErr -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err404"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; QErr) -&gt; Text -&gt; QErr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Couldn't find console asset &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726744"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-676"></span><span>    </span><span class="hs-comment">-- set gzip header if the filename ends with .gz</span><span>
</span><span id="line-677"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621687726770"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726770"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726771"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726771"><span class="hs-identifier hs-var">encHeader</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ([Char], [Char])
</span><span class="hs-identifier hs-var">splitExtension</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><span class="hs-identifier hs-var">takeFileName</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687726752"><span class="hs-identifier hs-var">pathStr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687726772"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687726772"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.gz&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687726772"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#gzipHeader"><span class="hs-identifier hs-var">gzipHeader</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="annottext">([Char], [Char])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726744"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621687726774"><span class="annot"><span class="annottext">mimeType :: ByteString
</span><a href="#local-6989586621687726774"><span class="hs-identifier hs-var hs-var">mimeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mime-types-0.1.1.0-c822281d87b53e94770c5fa75fc8e8efa613e43b02dfce92ea79328191230d7c/share/doc/html/src/Network.Mime.html#defaultMimeLookup"><span class="hs-identifier hs-var">defaultMimeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726770"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621687726760"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621687726760"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687726774"><span class="hs-identifier hs-var">mimeType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Header -&gt; [Header] -&gt; [Header]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687726771"><span class="hs-identifier hs-var">encHeader</span></a></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687724644"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ConsoleRenderer"><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-var">ConsoleRenderer</span></a></span></span><span> </span><span id="local-6989586621687724644"><span class="annot"><a href="#local-6989586621687724644"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ConsoleType"><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-var">ConsoleType</span></a></span></span><span> </span><span id="local-6989586621687724644"><span class="annot"><a href="#local-6989586621687724644"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-685"></span><span>  </span><span id="renderConsole"><span class="annot"><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-type">renderConsole</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-686"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-687"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-688"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#TelemetryStatus"><span class="hs-identifier hs-type">TelemetryStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-689"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-type">ConsoleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-692"></span><span>    </span><span class="annot"><a href="#local-6989586621687724644"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="hs-comment">-- TODO(awjchen): This is a kludge that will be removed when the entitlement service is fully implemented.</span><span>
</span><span id="line-695"></span><span class="hs-keyword">data</span><span> </span><span id="CEConsoleType"><span class="annot"><a href="Hasura.Server.App.html#CEConsoleType"><span class="hs-identifier hs-var">CEConsoleType</span></a></span></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="OSSConsole"><span class="annot"><a href="Hasura.Server.App.html#OSSConsole"><span class="hs-identifier hs-var">OSSConsole</span></a></span></span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ProLiteConsole"><span class="annot"><a href="Hasura.Server.App.html#ProLiteConsole"><span class="hs-identifier hs-var">ProLiteConsole</span></a></span></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="annot"><a href="Hasura.Server.App.html#ceConsoleTypeIdentifier"><span class="hs-identifier hs-type">ceConsoleTypeIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#CEConsoleType"><span class="hs-identifier hs-type">CEConsoleType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-700"></span><span id="ceConsoleTypeIdentifier"><span class="annot"><span class="annottext">ceConsoleTypeIdentifier :: CEConsoleType -&gt; [Char]
</span><a href="Hasura.Server.App.html#ceConsoleTypeIdentifier"><span class="hs-identifier hs-var hs-var">ceConsoleTypeIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-701"></span><span>  </span><span class="annot"><span class="annottext">CEConsoleType
</span><a href="Hasura.Server.App.html#OSSConsole"><span class="hs-identifier hs-var">OSSConsole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;oss&quot;</span></span><span>
</span><span id="line-702"></span><span>  </span><span class="annot"><span class="annottext">CEConsoleType
</span><a href="Hasura.Server.App.html#ProLiteConsole"><span class="hs-identifier hs-var">ProLiteConsole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;pro-lite&quot;</span></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621687724649"><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724649"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Monad.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724649"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ConsoleType"><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-var">ConsoleType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.Monad.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724649"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-type">ConsoleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724649"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span id="local-6989586621687726789"><span class="annot"><span class="annottext">renderConsole :: Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; ConsoleType (TraceT m)
-&gt; TraceT m (Either [Char] Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var hs-var hs-var hs-var">renderConsole</span></a></span></span><span> </span><span id="local-6989586621687726790"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726790"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621687726791"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621687726791"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621687726792"><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621687726792"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621687726793"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687726793"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621687726794"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687726794"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621687726795"><span class="annot"><span class="annottext">ConsoleType (TraceT m)
</span><a href="#local-6989586621687726795"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either [Char] Text) -&gt; TraceT m (Either [Char] Text)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; TraceT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either [Char] Text) -&gt; TraceT m (Either [Char] Text))
-&gt; m (Either [Char] Text) -&gt; TraceT m (Either [Char] Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; ConsoleType m
-&gt; m (Either [Char] Text)
forall (m :: * -&gt; *).
ConsoleRenderer m =&gt;
Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; ConsoleType m
-&gt; m (Either [Char] Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var">renderConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726790"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621687726791"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621687726792"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687726793"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687726794"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleType m
ConsoleType (TraceT m)
</span><a href="#local-6989586621687726795"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-comment">-- Type class to get any extra [Pair] for the version API</span><span>
</span><span id="line-709"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687724650"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadVersionAPIWithExtraData"><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier hs-var">MonadVersionAPIWithExtraData</span></a></span></span><span> </span><span id="local-6989586621687724650"><span class="annot"><a href="#local-6989586621687724650"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-710"></span><span>  </span><span id="getExtraDataForVersionAPI"><span class="annot"><a href="Hasura.Server.App.html#getExtraDataForVersionAPI"><span class="hs-identifier hs-type">getExtraDataForVersionAPI</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621687724650"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#Pair"><span class="hs-identifier hs-type">J.Pair</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="annot"><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier hs-type">renderHtmlTemplate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mustache-2.4.1-0d67a9f56b5d7d0e0ecb1e9bcde9f7c196b5503c4fc5f4e7fee2397d9e223a63/share/doc/html/src/Text.Mustache.Internal.Types.html#Template"><span class="hs-identifier hs-type">M.Template</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-713"></span><span id="renderHtmlTemplate"><span class="annot"><span class="annottext">renderHtmlTemplate :: Template -&gt; Value -&gt; Either [Char] Text
</span><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier hs-var hs-var">renderHtmlTemplate</span></a></span></span><span> </span><span id="local-6989586621687726798"><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621687726798"><span class="hs-identifier hs-var">template</span></a></span></span><span> </span><span id="local-6989586621687726799"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687726799"><span class="hs-identifier hs-var">jVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-714"></span><span>  </span><span class="annot"><span class="annottext">Either [Char] Text
-&gt; Either [Char] Text -&gt; Bool -&gt; Either [Char] Text
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Either [Char] Text
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621687726800"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either [Char] Text
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726801"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Either [Char] Text) -&gt; Bool -&gt; Either [Char] Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError]
</span><a href="#local-6989586621687726803"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-716"></span><span>    </span><span id="local-6989586621687726800"><span class="annot"><span class="annottext">errMsg :: [Char]
</span><a href="#local-6989586621687726800"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;template rendering failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[SubstitutionError]
</span><a href="#local-6989586621687726803"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621687726803"><span class="annot"><span class="annottext">[SubstitutionError]
</span><a href="#local-6989586621687726803"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726801"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726801"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Template -&gt; Value -&gt; ([SubstitutionError], Text)
forall k.
ToMustache k =&gt;
Template -&gt; k -&gt; ([SubstitutionError], Text)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/mustache-2.4.1-0d67a9f56b5d7d0e0ecb1e9bcde9f7c196b5503c4fc5f4e7fee2397d9e223a63/share/doc/html/src/Text.Mustache.Render.html#checkedSubstitute"><span class="hs-identifier hs-var">M.checkedSubstitute</span></a></span><span> </span><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621687726798"><span class="hs-identifier hs-var">template</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687726799"><span class="hs-identifier hs-var">jVal</span></a></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="annot"><span class="hs-comment">-- | Default implementation of the 'MonadConfigApiHandler'</span></span><span>
</span><span id="line-720"></span><span class="annot"><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier hs-type">configApiGetHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724660"><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687724661"><span class="annot"><a href="#local-6989586621687724661"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-725"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-726"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-730"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724661"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#SpockCtxT"><span class="hs-identifier hs-type">Spock.SpockCtxT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687724660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span id="configApiGetHandler"><span class="annot"><span class="annottext">configApiGetHandler :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadBaseControl IO m, HasAppEnv m,
 UserAuthentication m, HttpLog m, HasResourceLimits m,
 MonadTrace m) =&gt;
AppStateRef impl -&gt; SpockCtxT () m ()
</span><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier hs-var hs-var">configApiGetHandler</span></a></span></span><span> </span><span id="local-6989586621687726854"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687726854"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockCtxT () m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/config&quot;</span></span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockCtxT () m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isConfigEnabled"><span class="hs-identifier hs-var">isConfigEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687726854"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-735"></span><span>    </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687726856"><span id="local-6989586621687726857"><span id="local-6989586621687726858"><span id="local-6989586621687726859"><span id="local-6989586621687726860"><span id="local-6989586621687726861"><span id="local-6989586621687726862"><span id="local-6989586621687726863"><span id="local-6989586621687726864"><span id="local-6989586621687726865"><span id="local-6989586621687726866"><span id="local-6989586621687726867"><span id="local-6989586621687726868"><span id="local-6989586621687726869"><span id="local-6989586621687726870"><span id="local-6989586621687726871"><span id="local-6989586621687726872"><span id="local-6989586621687726873"><span id="local-6989586621687726874"><span id="local-6989586621687726875"><span id="local-6989586621687726876"><span id="local-6989586621687726877"><span id="local-6989586621687726878"><span id="local-6989586621687726879"><span id="local-6989586621687726880"><span id="local-6989586621687726881"><span id="local-6989586621687726882"><span id="local-6989586621687726883"><span id="local-6989586621687726884"><span id="local-6989586621687726885"><span id="local-6989586621687726886"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv -&gt; ActionCtxT () m AppEnv
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-737"></span><span>      </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687726887"><span id="local-6989586621687726888"><span id="local-6989586621687726889"><span id="local-6989586621687726890"><span id="local-6989586621687726891"><span id="local-6989586621687726892"><span id="local-6989586621687726893"><span id="local-6989586621687726894"><span id="local-6989586621687726895"><span id="local-6989586621687726896"><span id="local-6989586621687726897"><span id="local-6989586621687726898"><span id="local-6989586621687726899"><span id="local-6989586621687726900"><span id="local-6989586621687726901"><span id="local-6989586621687726902"><span id="local-6989586621687726903"><span id="local-6989586621687726904"><span id="local-6989586621687726905"><span id="local-6989586621687726906"><span class="annot"><span class="annottext">Environment
HashSet ExperimentalFeature
HashSet API
StreamQueriesOptions
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
CloseWebsocketsOnMetadataChangeStatus
ApolloFederationStatus
CorsPolicy
AuthMode
MetadataDefaults
ResponseInternalErrorsConfig
OptionalInterval
TelemetryStatus
AllowListStatus
ConsoleStatus
EventEngineCtx
acEnabledAPIs :: AppContext -&gt; HashSet API
acAuthMode :: AppContext -&gt; AuthMode
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
acEnableAllowlist :: AppContext -&gt; AllowListStatus
acResponseInternalErrorsConfig :: AppContext -&gt; ResponseInternalErrorsConfig
acEnvironment :: AppContext -&gt; Environment
acRemoteSchemaPermsCtx :: AppContext -&gt; RemoteSchemaPermissions
acFunctionPermsCtx :: AppContext -&gt; InferFunctionPermissions
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
acDefaultNamingConvention :: AppContext -&gt; NamingCase
acMetadataDefaults :: AppContext -&gt; MetadataDefaults
acLiveQueryOptions :: AppContext -&gt; StreamQueriesOptions
acStreamQueryOptions :: AppContext -&gt; StreamQueriesOptions
acCorsPolicy :: AppContext -&gt; CorsPolicy
acConsoleStatus :: AppContext -&gt; ConsoleStatus
acEnableTelemetry :: AppContext -&gt; TelemetryStatus
acEventEngineCtx :: AppContext -&gt; EventEngineCtx
acAsyncActionsFetchInterval :: AppContext -&gt; OptionalInterval
acApolloFederationStatus :: AppContext -&gt; ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: AppContext -&gt; CloseWebsocketsOnMetadataChangeStatus
acAuthMode :: AuthMode
acSQLGenCtx :: SQLGenCtx
acEnabledAPIs :: HashSet API
acEnableAllowlist :: AllowListStatus
acResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
acEnvironment :: Environment
acRemoteSchemaPermsCtx :: RemoteSchemaPermissions
acFunctionPermsCtx :: InferFunctionPermissions
acExperimentalFeatures :: HashSet ExperimentalFeature
acDefaultNamingConvention :: NamingCase
acMetadataDefaults :: MetadataDefaults
acLiveQueryOptions :: StreamQueriesOptions
acStreamQueryOptions :: StreamQueriesOptions
acCorsPolicy :: CorsPolicy
acConsoleStatus :: ConsoleStatus
acEnableTelemetry :: TelemetryStatus
acEventEngineCtx :: EventEngineCtx
acAsyncActionsFetchInterval :: OptionalInterval
acApolloFederationStatus :: ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: CloseWebsocketsOnMetadataChangeStatus
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; ActionCtxT () m AppContext
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; ActionCtxT () m AppContext)
-&gt; IO AppContext -&gt; ActionCtxT () m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687726854"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-738"></span><span>      </span><span id="local-6989586621687726907"><span class="annot"><span class="annottext">[(FeatureFlag, Text, Bool)]
</span><a href="#local-6989586621687726907"><span class="hs-identifier hs-var">featureFlagSettings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-739"></span><span>        </span><span class="annot"><span class="annottext">((FeatureFlag, Text) -&gt; ActionCtxT () m (FeatureFlag, Text, Bool))
-&gt; [(FeatureFlag, Text)]
-&gt; ActionCtxT () m [(FeatureFlag, Text, Bool)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-740"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687726909"><span class="annot"><span class="annottext">FeatureFlag
</span><a href="#local-6989586621687726909"><span class="hs-identifier hs-var">ff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687726910"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726910"><span class="hs-identifier hs-var">desc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FeatureFlag
</span><a href="#local-6989586621687726909"><span class="hs-identifier hs-var">ff</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687726910"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; (FeatureFlag, Text, Bool))
-&gt; ActionCtxT () m Bool
-&gt; ActionCtxT () m (FeatureFlag, Text, Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; ActionCtxT () m Bool
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckFeatureFlag -&gt; FeatureFlag -&gt; IO Bool
</span><a href="Hasura.Server.Init.FeatureFlag.html#runCheckFeatureFlag"><span class="hs-identifier hs-var">runCheckFeatureFlag</span></a></span><span> </span><span class="annot"><span class="annottext">CheckFeatureFlag
</span><a href="#local-6989586621687726884"><span class="hs-identifier hs-var">appEnvCheckFeatureFlag</span></a></span><span> </span><span class="annot"><span class="annottext">FeatureFlag
</span><a href="#local-6989586621687726909"><span class="hs-identifier hs-var">ff</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckFeatureFlag -&gt; [(FeatureFlag, Text)]
</span><a href="Hasura.Server.Init.FeatureFlag.html#listKnownFeatureFlags"><span class="hs-identifier hs-var">listKnownFeatureFlags</span></a></span><span> </span><span class="annot"><span class="annottext">CheckFeatureFlag
</span><a href="#local-6989586621687726884"><span class="hs-identifier hs-var">appEnvCheckFeatureFlag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>      </span><span class="annot"><span class="annottext">AppStateRef impl
-&gt; (Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler m ()
-&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a impl.
(MonadIO m, MonadBaseControl IO m, HasAppEnv m, FromJSON a,
 UserAuthentication m, HttpLog m, HasResourceLimits m,
 MonadTrace m) =&gt;
AppStateRef impl
-&gt; (Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler m a
-&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-var">mkSpockAction</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687726854"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-743"></span><span>        </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-744"></span><span>        </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-745"></span><span>          </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-746"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687726915"><span class="annot"><span class="annottext">res :: ServerConfig
</span><a href="#local-6989586621687726915"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-747"></span><span>                </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; AuthMode
-&gt; AllowListStatus
-&gt; StreamQueriesOptions
-&gt; StreamQueriesOptions
-&gt; Maybe Text
-&gt; HashSet ExperimentalFeature
-&gt; HashSet API
-&gt; NamingCase
-&gt; [(FeatureFlag, Text, Bool)]
-&gt; ApolloFederationStatus
-&gt; ServerConfig
</span><a href="Hasura.Server.API.Config.html#runGetConfig"><span class="hs-identifier hs-var">runGetConfig</span></a></span><span>
</span><span id="line-748"></span><span>                  </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621687726894"><span class="hs-identifier hs-var">acFunctionPermsCtx</span></a></span><span>
</span><span id="line-749"></span><span>                  </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621687726893"><span class="hs-identifier hs-var">acRemoteSchemaPermsCtx</span></a></span><span>
</span><span id="line-750"></span><span>                  </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621687726887"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span>
</span><span id="line-751"></span><span>                  </span><span class="annot"><span class="annottext">AllowListStatus
</span><a href="#local-6989586621687726890"><span class="hs-identifier hs-var">acEnableAllowlist</span></a></span><span>
</span><span id="line-752"></span><span>                  </span><span class="annot"><span class="annottext">StreamQueriesOptions
</span><a href="#local-6989586621687726898"><span class="hs-identifier hs-var">acLiveQueryOptions</span></a></span><span>
</span><span id="line-753"></span><span>                  </span><span class="annot"><span class="annottext">StreamQueriesOptions
</span><a href="#local-6989586621687726899"><span class="hs-identifier hs-var">acStreamQueryOptions</span></a></span><span>
</span><span id="line-754"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687726877"><span class="hs-identifier hs-var">appEnvConsoleAssetsDir</span></a></span><span>
</span><span id="line-755"></span><span>                  </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621687726895"><span class="hs-identifier hs-var">acExperimentalFeatures</span></a></span><span>
</span><span id="line-756"></span><span>                  </span><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621687726889"><span class="hs-identifier hs-var">acEnabledAPIs</span></a></span><span>
</span><span id="line-757"></span><span>                  </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621687726896"><span class="hs-identifier hs-var">acDefaultNamingConvention</span></a></span><span>
</span><span id="line-758"></span><span>                  </span><span class="annot"><span class="annottext">[(FeatureFlag, Text, Bool)]
</span><a href="#local-6989586621687726907"><span class="hs-identifier hs-var">featureFlagSettings</span></a></span><span>
</span><span id="line-759"></span><span>                  </span><span class="annot"><span class="annottext">ApolloFederationStatus
</span><a href="#local-6989586621687726905"><span class="hs-identifier hs-var">acApolloFederationStatus</span></a></span><span>
</span><span id="line-760"></span><span>          </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerConfig -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfig
</span><a href="#local-6989586621687726915"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="hs-keyword">data</span><span> </span><span id="HasuraApp"><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-var">HasuraApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HasuraApp"><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-var">HasuraApp</span></a></span></span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_hapApplication"><span class="annot"><span class="annottext">HasuraApp -&gt; Application
</span><a href="Hasura.Server.App.html#_hapApplication"><span class="hs-identifier hs-var hs-var">_hapApplication</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.html#Application"><span class="hs-identifier hs-type">Wai.Application</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-764"></span><span>    </span><span id="_hapAsyncActionSubscriptionState"><span class="annot"><span class="annottext">HasuraApp -&gt; AsyncActionSubscriptionState
</span><a href="Hasura.Server.App.html#_hapAsyncActionSubscriptionState"><span class="hs-identifier hs-var hs-var">_hapAsyncActionSubscriptionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.State.html#AsyncActionSubscriptionState"><span class="hs-identifier hs-type">ES.AsyncActionSubscriptionState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-765"></span><span>    </span><span id="_hapShutdownWsServer"><span class="annot"><span class="annottext">HasuraApp -&gt; IO ()
</span><a href="Hasura.Server.App.html#_hapShutdownWsServer"><span class="hs-identifier hs-var hs-var">_hapShutdownWsServer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="annot"><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier hs-type">mkWaiApp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724695"><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687724700"><span class="annot"><a href="#local-6989586621687724700"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-772"></span><span>    </span><span class="annot"><a href="Control.Monad.Stateless.html#MonadStateless"><span class="hs-identifier hs-type">MonadStateless</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/constraints-0.13.4-31797bdc29364f5c18ae31d75835697093db72e8ef8450e617cb16da521248b8/share/doc/html/src/Data.Constraint.Forall.html#Forall"><span class="hs-identifier hs-type">LA.Forall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-983fe89ee2931c4434bb66f4f37161d06f149eae35d6419e24abb9ab0f7f9a20/share/doc/html/src/Control.Concurrent.Async.Lifted.Safe.html#Pure"><span class="hs-identifier hs-type">LA.Pure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-775"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier hs-type">MonadVersionAPIWithExtraData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-776"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-778"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-779"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-type">HasFeatureFlagChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-780"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-781"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-782"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-784"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-785"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-786"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-788"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-789"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-790"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-791"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-792"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-795"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724700"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#SpockT"><span class="hs-identifier hs-type">Spock.SpockT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-798"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724700"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-799"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-type">ConsoleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-93f2ed46e22c63a626e0d4152147170c3d5f8bca8a565d95e6bd12f130cd775b/share/doc/html/src/System.Metrics.html#Store"><span class="hs-identifier hs-type">EKG.Store</span></a></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-93f2ed46e22c63a626e0d4152147170c3d5f8bca8a565d95e6bd12f130cd775b/share/doc/html/src/System.Metrics.html#EmptyMetrics"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-801"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSServerEnv"><span class="hs-identifier hs-type">WS.WSServerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724700"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-802"></span><span>  </span><span class="annot"><a href="#local-6989586621687724695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-type">HasuraApp</span></a></span><span>
</span><span id="line-803"></span><span id="mkWaiApp"><span class="annot"><span class="annottext">mkWaiApp :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadStateless IO m, Forall (Pure m),
 ConsoleRenderer m, MonadVersionAPIWithExtraData m, HttpLog m,
 HasAppEnv m, HasCacheStaticConfig m, HasFeatureFlagChecker m,
 UserAuthentication m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadWSLog m, MonadTrace m,
 MonadExecuteQuery m, HasResourceLimits m, MonadMetadataStorage m,
 MonadResolveSource m, MonadQueryTags m, MonadEventLogCleanup m,
 ProvidesNetwork m, MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; WSServerEnv impl
-&gt; m HasuraApp
</span><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier hs-var hs-var">mkWaiApp</span></a></span></span><span> </span><span id="local-6989586621687727001"><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621687727001"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621687727002"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727002"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span id="local-6989586621687727003"><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621687727003"><span class="hs-identifier hs-var">consoleType</span></a></span></span><span> </span><span id="local-6989586621687727004"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621687727004"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span> </span><span id="local-6989586621687727005"><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621687727005"><span class="hs-identifier hs-var">wsServerEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-804"></span><span>  </span><span id="local-6989586621687727006"><span class="annot"><span class="annottext">appEnv :: AppEnv
</span><a href="#local-6989586621687727006"><span class="hs-identifier hs-var">appEnv</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687727007"><span id="local-6989586621687727008"><span id="local-6989586621687727009"><span id="local-6989586621687727010"><span id="local-6989586621687727011"><span id="local-6989586621687727012"><span id="local-6989586621687727013"><span id="local-6989586621687727014"><span id="local-6989586621687727015"><span id="local-6989586621687727016"><span id="local-6989586621687727017"><span id="local-6989586621687727018"><span id="local-6989586621687727019"><span id="local-6989586621687727020"><span id="local-6989586621687727021"><span id="local-6989586621687727022"><span id="local-6989586621687727023"><span id="local-6989586621687727024"><span id="local-6989586621687727025"><span id="local-6989586621687727026"><span id="local-6989586621687727027"><span id="local-6989586621687727028"><span id="local-6989586621687727029"><span id="local-6989586621687727030"><span id="local-6989586621687727031"><span id="local-6989586621687727032"><span id="local-6989586621687727033"><span id="local-6989586621687727034"><span id="local-6989586621687727035"><span id="local-6989586621687727036"><span id="local-6989586621687727037"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-805"></span><span>  </span><span id="local-6989586621687727038"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621687727038"><span class="hs-identifier hs-var">spockApp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall c. ((forall a. m a -&gt; IO a) -&gt; IO c) -&gt; m c
forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application)
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727040"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621687727040"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-806"></span><span>    </span><span class="annot"><span class="annottext">IO Middleware -&gt; IO Application
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#spockAsApp"><span class="hs-identifier hs-var">Spock.spockAsApp</span></a></span><span>
</span><span id="line-807"></span><span>      </span><span class="annot"><span class="annottext">(IO Middleware -&gt; IO Application)
-&gt; IO Middleware -&gt; IO Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; IO a) -&gt; SpockT m () -&gt; IO Middleware
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall a. m a -&gt; IO a) -&gt; SpockT m () -&gt; IO Middleware
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#spockT"><span class="hs-identifier hs-var">Spock.spockT</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; IO a
forall a. m a -&gt; IO a
</span><a href="#local-6989586621687727040"><span class="hs-identifier hs-var">lowerIO</span></a></span><span>
</span><span id="line-808"></span><span>      </span><span class="annot"><span class="annottext">(SpockT m () -&gt; IO Middleware) -&gt; SpockT m () -&gt; IO Middleware
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; AppEnv
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; SpockT m ()
forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadBaseControl IO m, ConsoleRenderer m,
 MonadVersionAPIWithExtraData m, HttpLog m, HasAppEnv m,
 HasCacheStaticConfig m, HasFeatureFlagChecker m,
 UserAuthentication m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadTrace m, MonadExecuteQuery m,
 MonadMetadataStorage m, HasResourceLimits m, MonadResolveSource m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesNetwork m,
 MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; AppEnv
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; SpockT m ()
</span><a href="Hasura.Server.App.html#httpApp"><span class="hs-identifier hs-var">httpApp</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621687727001"><span class="hs-identifier hs-var">setupHook</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727002"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">AppEnv
</span><a href="#local-6989586621687727006"><span class="hs-identifier hs-var">appEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621687727003"><span class="hs-identifier hs-var">consoleType</span></a></span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621687727004"><span class="hs-identifier hs-var">ekgStore</span></a></span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><span class="annottext">(WebsocketCloseOnMetadataChangeAction -&gt; SpockT m ())
-&gt; WebsocketCloseOnMetadataChangeAction -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WSServer WSConnData -&gt; WebsocketCloseOnMetadataChangeAction
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#mkCloseWebsocketsOnMetadataChangeAction"><span class="hs-identifier hs-var">WS.mkCloseWebsocketsOnMetadataChangeAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; WSServer WSConnData
forall impl. WSServerEnv impl -&gt; WSServer WSConnData
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseServer"><span class="hs-identifier hs-var">WS._wseServer</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621687727005"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727046"><span class="annot"><span class="annottext">wsServerApp :: HasuraServerApp m
</span><a href="#local-6989586621687727046"><span class="hs-identifier hs-var hs-var">wsServerApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
-&gt; WSServerEnv impl
-&gt; WSConnectionInitTimeout
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; HasuraServerApp m
forall (m :: * -&gt; *) impl.
(MonadIO m, MonadBaseControl IO m, Forall (Pure m),
 UserAuthentication m, MonadGQLExecutionCheck m, MonadWSLog m,
 MonadQueryLog m, MonadExecutionLog m, MonadExecuteQuery m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m, MonadTrace m, MonadGetPolicies m) =&gt;
HashSet (EngineLogType Hasura)
-&gt; WSServerEnv impl
-&gt; WSConnectionInitTimeout
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; HasuraServerApp m
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerApp"><span class="hs-identifier hs-var">WS.createWSServerApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoggingSettings -&gt; HashSet (EngineLogType Hasura)
</span><a href="Hasura.Server.Logging.html#_lsEnabledLogTypes"><span class="hs-identifier hs-var">_lsEnabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727016"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621687727005"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621687727032"><span class="hs-identifier hs-var">appEnvWebSocketConnectionInitTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621687727036"><span class="hs-identifier hs-var">appEnvLicenseKeyCache</span></a></span><span>
</span><span id="line-812"></span><span>      </span><span id="local-6989586621687727049"><span class="annot"><span class="annottext">stopWSServer :: IO ()
</span><a href="#local-6989586621687727049"><span class="hs-identifier hs-var hs-var">stopWSServer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; IO ()
forall impl. WSServerEnv impl -&gt; IO ()
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#stopWSServerApp"><span class="hs-identifier hs-var">WS.stopWSServerApp</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621687727005"><span class="hs-identifier hs-var">wsServerEnv</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621687727051"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621687727051"><span class="hs-identifier hs-var">waiApp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall c. ((forall a. m a -&gt; IO a) -&gt; IO c) -&gt; m c
forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application)
-&gt; ((forall a. m a -&gt; IO a) -&gt; IO Application) -&gt; m Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727052"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621687727052"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-815"></span><span>    </span><span class="annot"><span class="annottext">Application -&gt; IO Application
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Application -&gt; IO Application) -&gt; Application -&gt; IO Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
-&gt; (IpAddress -&gt; PendingConnection -&gt; IO ()) -&gt; Middleware
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Wai.Handler.WebSockets.Custom.html#websocketsOr"><span class="hs-identifier hs-var">WSC.websocketsOr</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621687727030"><span class="hs-identifier hs-var">appEnvConnectionOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687727054"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687727054"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span id="local-6989586621687727055"><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621687727055"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; IO ()
forall a. m a -&gt; IO a
</span><a href="#local-6989586621687727052"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; IO ()) -&gt; m () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasuraServerApp m
</span><a href="#local-6989586621687727046"><span class="hs-identifier hs-var">wsServerApp</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687727054"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621687727055"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621687727038"><span class="hs-identifier hs-var">spockApp</span></a></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>  </span><span class="annot"><span class="annottext">HasuraApp -&gt; m HasuraApp
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HasuraApp -&gt; m HasuraApp) -&gt; HasuraApp -&gt; m HasuraApp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Application -&gt; AsyncActionSubscriptionState -&gt; IO () -&gt; HasuraApp
</span><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-var">HasuraApp</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621687727051"><span class="hs-identifier hs-var">waiApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubscriptionsState -&gt; AsyncActionSubscriptionState
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#_ssAsyncActions"><span class="hs-identifier hs-var">ES._ssAsyncActions</span></a></span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621687727024"><span class="hs-identifier hs-var">appEnvSubscriptionState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621687727049"><span class="hs-identifier hs-var">stopWSServer</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="annot"><a href="Hasura.Server.App.html#httpApp"><span class="hs-identifier hs-type">httpApp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724716"><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621687724717"><span class="annot"><a href="#local-6989586621687724717"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-b7641e5e6467aae2ffb36e8dd9c4b443e0d54b20f5b88407c4f64baad27c0cd1/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-825"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadVersionAPIWithExtraData"><span class="hs-identifier hs-type">MonadVersionAPIWithExtraData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-828"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Config.html#HasCacheStaticConfig"><span class="hs-identifier hs-type">HasCacheStaticConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-829"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html#HasFeatureFlagChecker"><span class="hs-identifier hs-type">HasFeatureFlagChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-830"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-831"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-832"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-833"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-834"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-835"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-836"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">GH.MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-839"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-841"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-842"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-843"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-844"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724717"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#SpockT"><span class="hs-identifier hs-type">Spock.SpockT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-847"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724717"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-849"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleType"><span class="hs-identifier hs-type">ConsoleType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-850"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-93f2ed46e22c63a626e0d4152147170c3d5f8bca8a565d95e6bd12f130cd775b/share/doc/html/src/System.Metrics.html#Store"><span class="hs-identifier hs-type">EKG.Store</span></a></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-93f2ed46e22c63a626e0d4152147170c3d5f8bca8a565d95e6bd12f130cd775b/share/doc/html/src/System.Metrics.html#EmptyMetrics"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.html#WebsocketCloseOnMetadataChangeAction"><span class="hs-identifier hs-type">WS.WebsocketCloseOnMetadataChangeAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-852"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#SpockT"><span class="hs-identifier hs-type">Spock.SpockT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span id="httpApp"><span class="annot"><span class="annottext">httpApp :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadBaseControl IO m, ConsoleRenderer m,
 MonadVersionAPIWithExtraData m, HttpLog m, HasAppEnv m,
 HasCacheStaticConfig m, HasFeatureFlagChecker m,
 UserAuthentication m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadExecutionLog m, MonadTrace m, MonadExecuteQuery m,
 MonadMetadataStorage m, HasResourceLimits m, MonadResolveSource m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesNetwork m,
 MonadGetPolicies m) =&gt;
(AppStateRef impl -&gt; SpockT m ())
-&gt; AppStateRef impl
-&gt; AppEnv
-&gt; ConsoleType m
-&gt; Store EmptyMetrics
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; SpockT m ()
</span><a href="Hasura.Server.App.html#httpApp"><span class="hs-identifier hs-var hs-var">httpApp</span></a></span></span><span> </span><span id="local-6989586621687727642"><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621687727642"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621687727643"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687727644"><span id="local-6989586621687727645"><span id="local-6989586621687727646"><span id="local-6989586621687727647"><span id="local-6989586621687727648"><span id="local-6989586621687727649"><span id="local-6989586621687727650"><span id="local-6989586621687727651"><span id="local-6989586621687727652"><span id="local-6989586621687727653"><span id="local-6989586621687727654"><span id="local-6989586621687727655"><span id="local-6989586621687727656"><span id="local-6989586621687727657"><span id="local-6989586621687727658"><span id="local-6989586621687727659"><span id="local-6989586621687727660"><span id="local-6989586621687727661"><span id="local-6989586621687727662"><span id="local-6989586621687727663"><span id="local-6989586621687727664"><span id="local-6989586621687727665"><span id="local-6989586621687727666"><span id="local-6989586621687727667"><span id="local-6989586621687727668"><span id="local-6989586621687727669"><span id="local-6989586621687727670"><span id="local-6989586621687727671"><span id="local-6989586621687727672"><span id="local-6989586621687727673"><span id="local-6989586621687727674"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
</span><a href="Hasura.App.State.html#appEnvPort"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621687727675"><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621687727675"><span class="hs-identifier hs-var">consoleType</span></a></span></span><span> </span><span id="local-6989586621687727676"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621687727676"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span> </span><span id="local-6989586621687727677"><span class="annot"><span class="annottext">WebsocketCloseOnMetadataChangeAction
</span><a href="#local-6989586621687727677"><span class="hs-identifier hs-var">closeWebsocketsOnMetadataChangeAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-comment">-- Additional spock action to run</span><span>
</span><span id="line-855"></span><span>  </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
</span><a href="#local-6989586621687727642"><span class="hs-identifier hs-var">setupHook</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-comment">-- cors middleware</span><span>
</span><span id="line-858"></span><span>  </span><span class="annot"><span class="annottext">Middleware -&gt; SpockT m ()
forall (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) ctx.
(RouteM t, Monad m) =&gt;
Middleware -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#middleware"><span class="hs-identifier hs-var">Spock.middleware</span></a></span><span>
</span><span id="line-859"></span><span>    </span><span class="annot"><span class="annottext">(Middleware -&gt; SpockT m ()) -&gt; Middleware -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO CorsPolicy -&gt; Middleware
</span><a href="Hasura.Server.Middleware.html#corsMiddleware"><span class="hs-identifier hs-var">corsMiddleware</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; CorsPolicy
</span><a href="Hasura.App.State.html#acCorsPolicy"><span class="hs-identifier hs-var">acCorsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; CorsPolicy) -&gt; IO AppContext -&gt; IO CorsPolicy
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-comment">-- API Console and Root Dir</span><span>
</span><span id="line-862"></span><span>  </span><span class="annot"><span class="annottext">SpockT m ()
</span><a href="#local-6989586621687727679"><span class="hs-identifier hs-var">serveApiConsole</span></a></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-comment">-- Local console assets for server and CLI consoles</span><span>
</span><span id="line-865"></span><span>  </span><span class="annot"><span class="annottext">SpockT m ()
</span><a href="#local-6989586621687727680"><span class="hs-identifier hs-var">serveApiConsoleAssets</span></a></span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-comment">-- Health check endpoint with logs</span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727681"><span class="annot"><span class="annottext">healthzAction :: ActionCtxT () m ()
</span><a href="#local-6989586621687727681"><span class="hs-identifier hs-var hs-var">healthzAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-869"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727683"><span class="annot"><span class="annottext">errorMsg :: Text
</span><a href="#local-6989586621687727683"><span class="hs-identifier hs-var hs-var">errorMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ERROR&quot;</span></span><span>
</span><span id="line-870"></span><span>        </span><span id="local-6989586621687727684"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727684"><span class="hs-identifier hs-var">isStrict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool)
-&gt; ActionCtxT () m (Maybe Bool) -&gt; ActionCtxT () m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m (Maybe Bool)
forall p (m :: * -&gt; *) ctx.
(FromHttpApiData p, MonadIO m) =&gt;
Text -&gt; ActionCtxT ctx m (Maybe p)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#param"><span class="hs-identifier hs-var">Spock.param</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;strict&quot;</span></span><span>
</span><span id="line-871"></span><span>        </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; ActionCtxT () m (Either QErr ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m (Either QErr ())
forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#checkMetadataStorageHealth"><span class="hs-identifier hs-var">checkMetadataStorageHealth</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m (Either QErr ())
-&gt; (Either QErr () -&gt; ActionCtxT () m ()) -&gt; ActionCtxT () m ()
forall a b.
ActionCtxT () m a -&gt; (a -&gt; ActionCtxT () m b) -&gt; ActionCtxT () m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-872"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687727688"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727688"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-873"></span><span>            </span><span class="hs-comment">-- error running the health check</span><span>
</span><span id="line-874"></span><span>            </span><span class="annot"><span class="annottext">QErr -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727689"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727688"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-875"></span><span>            </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#setStatus"><span class="hs-identifier hs-var">Spock.setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Status.html#status500"><span class="hs-identifier hs-var">HTTP.status500</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m () -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b.
ActionCtxT () m a -&gt; ActionCtxT () m b -&gt; ActionCtxT () m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#text"><span class="hs-identifier hs-var">Spock.text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727683"><span class="hs-identifier hs-var">errorMsg</span></a></span><span>
</span><span id="line-876"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-877"></span><span>            </span><span class="hs-comment">-- metadata storage is healthy</span><span>
</span><span id="line-878"></span><span>            </span><span id="local-6989586621687727692"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687727692"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; ActionCtxT () m SchemaCache
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SchemaCache -&gt; ActionCtxT () m SchemaCache)
-&gt; IO SchemaCache -&gt; ActionCtxT () m SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO SchemaCache
forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-879"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727693"><span class="annot"><span class="annottext">isInconsistent :: Bool
</span><a href="#local-6989586621687727693"><span class="hs-identifier hs-var hs-var">isInconsistent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata] -&gt; Bool) -&gt; [InconsistentMetadata] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687727692"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-880"></span><span>                </span><span id="local-6989586621687727696"><span class="annot"><span class="annottext">inconsistenciesMessage :: Text
</span><a href="#local-6989586621687727696"><span class="hs-identifier hs-var hs-var">inconsistenciesMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;inconsistent objects in schema&quot;</span></span><span>
</span><span id="line-881"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621687727697"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621687727697"><span class="hs-identifier hs-var">status</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687727698"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727698"><span class="hs-identifier hs-var">responseText</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-882"></span><span>              </span><span class="hs-keyword">if</span><span>
</span><span id="line-883"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727693"><span class="hs-identifier hs-var">isInconsistent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727684"><span class="hs-identifier hs-var">isStrict</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-884"></span><span>                    </span><span class="hs-comment">-- Inconsistencies exist and strict mode enabled. Report inconsistencies as ERROR with status 500.</span><span>
</span><span id="line-885"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727699"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621687727699"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ERROR: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727696"><span class="hs-identifier hs-var">inconsistenciesMessage</span></a></span><span>
</span><span id="line-886"></span><span>                    </span><span class="annot"><span class="annottext">QErr -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727689"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionCtxT () m ()) -&gt; QErr -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err500"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#InvalidConfiguration"><span class="hs-identifier hs-var">InvalidConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727699"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-887"></span><span>                    </span><span class="annot"><span class="annottext">(Status, Text) -&gt; ActionCtxT () m (Status, Text)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Status.html#status500"><span class="hs-identifier hs-var">HTTP.status500</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727699"><span class="hs-identifier hs-var">message</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727693"><span class="hs-identifier hs-var">isInconsistent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727684"><span class="hs-identifier hs-var">isStrict</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-889"></span><span>                    </span><span class="hs-comment">-- Inconsistencies exist and strict mode disabled. Warn inconsistencies with status 200.</span><span>
</span><span id="line-890"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727702"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621687727702"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WARN: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727696"><span class="hs-identifier hs-var">inconsistenciesMessage</span></a></span><span>
</span><span id="line-891"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727703"><span class="hs-identifier hs-var">logSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ActionCtxT () m ()) -&gt; Text -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Lazy.html#fromStrict"><span class="hs-identifier hs-var">LT.fromStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727702"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-892"></span><span>                    </span><span class="annot"><span class="annottext">(Status, Text) -&gt; ActionCtxT () m (Status, Text)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Status.html#status200"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727702"><span class="hs-identifier hs-var">message</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-894"></span><span>                    </span><span class="hs-comment">-- No inconsistencies in schema cache, report OK</span><span>
</span><span id="line-895"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727707"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621687727707"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;OK&quot;</span></span><span>
</span><span id="line-896"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727703"><span class="hs-identifier hs-var">logSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ActionCtxT () m ()) -&gt; Text -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Lazy.html#fromStrict"><span class="hs-identifier hs-var">LT.fromStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727707"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-897"></span><span>                    </span><span class="annot"><span class="annottext">(Status, Text) -&gt; ActionCtxT () m (Status, Text)
forall a. a -&gt; ActionCtxT () m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Status.html#status200"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727707"><span class="hs-identifier hs-var">message</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span>            </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#setStatus"><span class="hs-identifier hs-var">Spock.setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621687727697"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m () -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b.
ActionCtxT () m a -&gt; ActionCtxT () m b -&gt; ActionCtxT () m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#text"><span class="hs-identifier hs-var">Spock.text</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727698"><span class="hs-identifier hs-var">responseText</span></a></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;healthz&quot;</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
HVectElim '[] (ActionCtxT () m ())
</span><a href="#local-6989586621687727681"><span class="hs-identifier hs-var">healthzAction</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-comment">-- This is an alternative to `healthz` (See issue #6958)</span><span>
</span><span id="line-904"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;hasura/healthz&quot;</span></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
HVectElim '[] (ActionCtxT () m ())
</span><a href="#local-6989586621687727681"><span class="hs-identifier hs-var">healthzAction</span></a></span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/version&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-907"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727703"><span class="hs-identifier hs-var">logSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ActionCtxT () m ()) -&gt; Text -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
forall a b. (ToText a, FromText b) =&gt; a -&gt; b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-conversions-0.3.1.1-6d2f03d046561c7797987cbaffb3a08b741b1b35f4d107a24b2f923a3427aff1/share/doc/html/src/Data.Text.Conversions.html#convertText"><span class="hs-identifier hs-var">convertText</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span>
</span><span id="line-908"></span><span>    </span><span id="local-6989586621687727709"><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621687727709"><span class="hs-identifier hs-var">extraData</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [Pair] -&gt; ActionCtxT () m [Pair]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m [Pair] -&gt; ActionCtxT () m [Pair])
-&gt; m [Pair] -&gt; ActionCtxT () m [Pair]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m [Pair]
forall (m :: * -&gt; *). MonadVersionAPIWithExtraData m =&gt; m [Pair]
</span><a href="Hasura.Server.App.html#getExtraDataForVersionAPI"><span class="hs-identifier hs-var">getExtraDataForVersionAPI</span></a></span><span>
</span><span id="line-909"></span><span>    </span><span class="annot"><span class="annottext">Header -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#lazyBytes"><span class="hs-identifier hs-var">Spock.lazyBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ActionCtxT () m ())
-&gt; ByteString -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value) -&gt; [Pair] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;version&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Version -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Pair]
</span><a href="#local-6989586621687727709"><span class="hs-identifier hs-var">extraData</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621687727712"><span class="hs-identifier hs-type">customEndpointHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-913"></span><span>        </span><span class="annot"><a href="Hasura.Server.Rest.html#RestRequest"><span class="hs-identifier hs-type">RestRequest</span></a></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#SpockMethod"><span class="hs-identifier hs-type">Spock.SpockMethod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-914"></span><span>        </span><span class="annot"><a href="Hasura.Server.App.html#Handler"><span class="hs-identifier hs-type">Handler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLogGraphQLInfo"><span class="hs-identifier hs-type">HttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#APIResp"><span class="hs-identifier hs-type">APIResp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>      </span><span id="local-6989586621687727712"><span class="annot"><span class="annottext">customEndpointHandler :: RestRequest SpockMethod -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687727712"><span class="hs-identifier hs-var hs-var">customEndpointHandler</span></a></span></span><span> </span><span id="local-6989586621687727713"><span class="annot"><span class="annottext">RestRequest SpockMethod
</span><a href="#local-6989586621687727713"><span class="hs-identifier hs-var">restReq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-916"></span><span>        </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687727714"><span id="local-6989586621687727715"><span id="local-6989586621687727716"><span id="local-6989586621687727717"><span id="local-6989586621687727718"><span id="local-6989586621687727719"><span id="local-6989586621687727720"><span id="local-6989586621687727721"><span id="local-6989586621687727722"><span id="local-6989586621687727723"><span id="local-6989586621687727724"><span id="local-6989586621687727725"><span id="local-6989586621687727726"><span id="local-6989586621687727727"><span id="local-6989586621687727728"><span id="local-6989586621687727729"><span id="local-6989586621687727730"><span id="local-6989586621687727731"><span id="local-6989586621687727732"><span id="local-6989586621687727733"><span class="annot"><span class="annottext">Environment
HashSet ExperimentalFeature
HashSet API
StreamQueriesOptions
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
CloseWebsocketsOnMetadataChangeStatus
ApolloFederationStatus
CorsPolicy
AuthMode
MetadataDefaults
ResponseInternalErrorsConfig
OptionalInterval
TelemetryStatus
AllowListStatus
ConsoleStatus
EventEngineCtx
acEnabledAPIs :: AppContext -&gt; HashSet API
acAuthMode :: AppContext -&gt; AuthMode
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
acEnableAllowlist :: AppContext -&gt; AllowListStatus
acResponseInternalErrorsConfig :: AppContext -&gt; ResponseInternalErrorsConfig
acEnvironment :: AppContext -&gt; Environment
acRemoteSchemaPermsCtx :: AppContext -&gt; RemoteSchemaPermissions
acFunctionPermsCtx :: AppContext -&gt; InferFunctionPermissions
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
acDefaultNamingConvention :: AppContext -&gt; NamingCase
acMetadataDefaults :: AppContext -&gt; MetadataDefaults
acLiveQueryOptions :: AppContext -&gt; StreamQueriesOptions
acStreamQueryOptions :: AppContext -&gt; StreamQueriesOptions
acCorsPolicy :: AppContext -&gt; CorsPolicy
acConsoleStatus :: AppContext -&gt; ConsoleStatus
acEnableTelemetry :: AppContext -&gt; TelemetryStatus
acEventEngineCtx :: AppContext -&gt; EventEngineCtx
acAsyncActionsFetchInterval :: AppContext -&gt; OptionalInterval
acApolloFederationStatus :: AppContext -&gt; ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: AppContext -&gt; CloseWebsocketsOnMetadataChangeStatus
acAuthMode :: AuthMode
acSQLGenCtx :: SQLGenCtx
acEnabledAPIs :: HashSet API
acEnableAllowlist :: AllowListStatus
acResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
acEnvironment :: Environment
acRemoteSchemaPermsCtx :: RemoteSchemaPermissions
acFunctionPermsCtx :: InferFunctionPermissions
acExperimentalFeatures :: HashSet ExperimentalFeature
acDefaultNamingConvention :: NamingCase
acMetadataDefaults :: MetadataDefaults
acLiveQueryOptions :: StreamQueriesOptions
acStreamQueryOptions :: StreamQueriesOptions
acCorsPolicy :: CorsPolicy
acConsoleStatus :: ConsoleStatus
acEnableTelemetry :: TelemetryStatus
acEventEngineCtx :: EventEngineCtx
acAsyncActionsFetchInterval :: OptionalInterval
acApolloFederationStatus :: ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: CloseWebsocketsOnMetadataChangeStatus
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; Handler m AppContext
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; Handler m AppContext)
-&gt; IO AppContext -&gt; Handler m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-917"></span><span>        </span><span id="local-6989586621687727734"><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687727734"><span class="hs-identifier hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (EndpointTrie GQLQueryWithText)
-&gt; Handler m (EndpointTrie GQLQueryWithText)
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (EndpointTrie GQLQueryWithText)
 -&gt; Handler m (EndpointTrie GQLQueryWithText))
-&gt; IO (EndpointTrie GQLQueryWithText)
-&gt; Handler m (EndpointTrie GQLQueryWithText)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; EndpointTrie GQLQueryWithText
</span><a href="Hasura.RQL.Types.SchemaCache.html#scEndpoints"><span class="hs-identifier hs-var">scEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; EndpointTrie GQLQueryWithText)
-&gt; IO SchemaCache -&gt; IO (EndpointTrie GQLQueryWithText)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO SchemaCache
forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-918"></span><span>        </span><span id="local-6989586621687727736"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687727736"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache -&gt; SchemaCache)
-&gt; Handler m RebuildableSchemaCache -&gt; Handler m SchemaCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RebuildableSchemaCache)
-&gt; Handler m RebuildableSchemaCache
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.Server.App.html#hcSchemaCache"><span class="hs-identifier hs-var">hcSchemaCache</span></a></span><span>
</span><span id="line-919"></span><span>        </span><span id="local-6989586621687727737"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727737"><span class="hs-identifier hs-var">requestId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; RequestId) -&gt; Handler m RequestId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; RequestId
</span><a href="Hasura.Server.App.html#hcRequestId"><span class="hs-identifier hs-var">hcRequestId</span></a></span><span>
</span><span id="line-920"></span><span>        </span><span id="local-6989586621687727738"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687727738"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; UserInfo) -&gt; Handler m UserInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span>
</span><span id="line-921"></span><span>        </span><span id="local-6989586621687727739"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727739"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; [Header]) -&gt; Handler m [Header]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; [Header]
</span><a href="Hasura.Server.App.html#hcReqHeaders"><span class="hs-identifier hs-var">hcReqHeaders</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span id="local-6989586621687727740"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687727740"><span class="hs-identifier hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HandlerCtx -&gt; IpAddress) -&gt; Handler m IpAddress
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; IpAddress
</span><a href="Hasura.Server.App.html#hcSourceIpAddress"><span class="hs-identifier hs-var">hcSourceIpAddress</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>        </span><span id="local-6989586621687727741"><span class="annot"><span class="annottext">RestRequest EndpointMethod
</span><a href="#local-6989586621687727741"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-925"></span><span>          </span><span class="annot"><span class="annottext">RestRequest SpockMethod
</span><a href="#local-6989586621687727713"><span class="hs-identifier hs-var">restReq</span></a></span><span> </span><span class="annot"><span class="annottext">RestRequest SpockMethod
-&gt; (RestRequest SpockMethod
    -&gt; Handler m (RestRequest EndpointMethod))
-&gt; Handler m (RestRequest EndpointMethod)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(SpockMethod -&gt; Handler m EndpointMethod)
-&gt; RestRequest SpockMethod
-&gt; Handler m (RestRequest EndpointMethod)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; RestRequest a -&gt; f (RestRequest b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-926"></span><span>            </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#MethodStandard"><span class="hs-identifier hs-type">Spock.MethodStandard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#HttpMethod"><span class="hs-identifier hs-type">Spock.HttpMethod</span></a></span><span> </span><span id="local-6989586621687727745"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621687727745"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621687727745"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-927"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#GET"><span class="hs-identifier hs-var">Spock.GET</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod -&gt; Handler m EndpointMethod
forall a. a -&gt; Handler m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#GET"><span class="hs-identifier hs-var">EP.GET</span></a></span><span>
</span><span id="line-928"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#POST"><span class="hs-identifier hs-var">Spock.POST</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod -&gt; Handler m EndpointMethod
forall a. a -&gt; Handler m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#POST"><span class="hs-identifier hs-var">EP.POST</span></a></span><span>
</span><span id="line-929"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#PUT"><span class="hs-identifier hs-var">Spock.PUT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod -&gt; Handler m EndpointMethod
forall a. a -&gt; Handler m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#PUT"><span class="hs-identifier hs-var">EP.PUT</span></a></span><span>
</span><span id="line-930"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#DELETE"><span class="hs-identifier hs-var">Spock.DELETE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod -&gt; Handler m EndpointMethod
forall a. a -&gt; Handler m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#DELETE"><span class="hs-identifier hs-var">EP.DELETE</span></a></span><span>
</span><span id="line-931"></span><span>              </span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#PATCH"><span class="hs-identifier hs-var">Spock.PATCH</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointMethod -&gt; Handler m EndpointMethod
forall a. a -&gt; Handler m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EndpointMethod
</span><a href="Hasura.RQL.Types.Endpoint.html#PATCH"><span class="hs-identifier hs-var">EP.PATCH</span></a></span><span>
</span><span id="line-932"></span><span>              </span><span id="local-6989586621687727756"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621687727756"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; Handler m EndpointMethod
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Handler m EndpointMethod)
-&gt; Text -&gt; Handler m EndpointMethod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Method &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621687727756"><span class="hs-identifier hs-var">other</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not supported.&quot;</span></span><span>
</span><span id="line-933"></span><span>            </span><span class="annot"><span class="annottext">SpockMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; Handler m EndpointMethod
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#BadRequest"><span class="hs-identifier hs-var">BadRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Handler m EndpointMethod)
-&gt; Text -&gt; Handler m EndpointMethod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Nonstandard method not allowed for REST endpoints&quot;</span></span><span>
</span><span id="line-934"></span><span>        </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; (HttpLogGraphQLInfo, HttpResponse EncJSON)
-&gt; (HttpLogGraphQLInfo, APIResp)
forall a b.
(a -&gt; b) -&gt; (HttpLogGraphQLInfo, a) -&gt; (HttpLogGraphQLInfo, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">((HttpLogGraphQLInfo, HttpResponse EncJSON)
 -&gt; (HttpLogGraphQLInfo, APIResp))
-&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; SQLGenCtx
-&gt; SchemaCache
-&gt; AllowListStatus
-&gt; ReadOnlyMode
-&gt; PrometheusMetrics
-&gt; Logger Hasura
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; RequestId
-&gt; UserInfo
-&gt; [Header]
-&gt; IpAddress
-&gt; RestRequest EndpointMethod
-&gt; EndpointTrie GQLQueryWithText
-&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadTrace m, MonadBaseControl IO m,
 MonadGQLExecutionCheck m, MonadQueryLog m, MonadExecutionLog m,
 MonadExecuteQuery m, MonadMetadataStorage m, MonadQueryTags m,
 HasResourceLimits m, ProvidesNetwork m) =&gt;
Environment
-&gt; SQLGenCtx
-&gt; SchemaCache
-&gt; AllowListStatus
-&gt; ReadOnlyMode
-&gt; PrometheusMetrics
-&gt; Logger Hasura
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; RequestId
-&gt; UserInfo
-&gt; [Header]
-&gt; IpAddress
-&gt; RestRequest EndpointMethod
-&gt; EndpointTrie GQLQueryWithText
-&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.Rest.html#runCustomEndpoint"><span class="hs-identifier hs-var">runCustomEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687727719"><span class="hs-identifier hs-var">acEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621687727715"><span class="hs-identifier hs-var">acSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687727736"><span class="hs-identifier hs-var">schemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AllowListStatus
</span><a href="#local-6989586621687727717"><span class="hs-identifier hs-var">acEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621687727655"><span class="hs-identifier hs-var">appEnvEnableReadOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621687727659"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687727649"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621687727673"><span class="hs-identifier hs-var">appEnvLicenseKeyCache</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727737"><span class="hs-identifier hs-var">requestId</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687727738"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727739"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621687727740"><span class="hs-identifier hs-var">ipAddress</span></a></span><span> </span><span class="annot"><span class="annottext">RestRequest EndpointMethod
</span><a href="#local-6989586621687727741"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointTrie GQLQueryWithText
</span><a href="#local-6989586621687727734"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>  </span><span class="hs-comment">-- See Issue #291 for discussion around restified feature</span><span>
</span><span id="line-937"></span><span>  </span><span class="annot"><span class="annottext">Path (Append (Append '[] '[]) '[Text]) 'Closed
-&gt; HVectElim (Append (Append '[] '[]) '[Text]) (ActionCtxT () m ())
-&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#hookRouteAll"><span class="hs-identifier hs-var">Spock.hookRouteAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; Path '[] 'Open -&gt; Path (Append '[] '[]) 'Open
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;rest&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path (Append '[] '[]) 'Open
-&gt; Path '[Text] 'Closed
-&gt; Path (Append (Append '[] '[]) '[Text]) 'Closed
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/reroute-0.7.0.0-cbc77d4bca09b235f573879fc5ff2114ffbc793d23ef6527d138e3f6f6f1c1d4/share/doc/html/src/Web.Routing.Combinators.html#wildcard"><span class="hs-identifier hs-var">Spock.wildcard</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HVectElim (Append (Append '[] '[]) '[Text]) (ActionCtxT () m ())
 -&gt; SpockT m ())
-&gt; HVectElim (Append (Append '[] '[]) '[Text]) (ActionCtxT () m ())
-&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727762"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727762"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-938"></span><span>    </span><span id="local-6989586621687727763"><span class="annot"><span class="annottext">TraceMetadata
</span><a href="#local-6989586621687727763"><span class="hs-identifier hs-var">queryParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m TraceMetadata
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
ActionCtxT ctx m TraceMetadata
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#params"><span class="hs-identifier hs-var">Spock.params</span></a></span><span>
</span><span id="line-939"></span><span>    </span><span id="local-6989586621687727765"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727765"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ByteString
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#body"><span class="hs-identifier hs-var">Spock.body</span></a></span><span>
</span><span id="line-940"></span><span>    </span><span id="local-6989586621687727767"><span class="annot"><span class="annottext">SpockMethod
</span><a href="#local-6989586621687727767"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m SpockMethod
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m SpockMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#reqMethod"><span class="hs-identifier hs-var">Spock.reqMethod</span></a></span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">-- This is where we decode the json encoded body args. They</span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-comment">-- are treated as if they came from query arguments, but allow</span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-comment">-- us to pass non-scalar values.</span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727769"><span class="annot"><span class="annottext">bodyParams :: [(Text, Value)]
</span><a href="#local-6989586621687727769"><span class="hs-identifier hs-var hs-var">bodyParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.html#decodeStrict"><span class="hs-identifier hs-var">J.decodeStrict</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727765"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-946"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">J.Object</span></a></span><span> </span><span id="local-6989586621687727772"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621687727772"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pair -&gt; (Text, Value)) -&gt; [Pair] -&gt; [(Text, Value)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Key -&gt; Text) -&gt; Pair -&gt; (Text, Value)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Key.html#toText"><span class="hs-identifier hs-var">K.toText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; [(Text, Value)]) -&gt; [Pair] -&gt; [(Text, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Object -&gt; [Pair]
forall v. KeyMap v -&gt; [(Key, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.KeyMap.html#toList"><span class="hs-identifier hs-var">KM.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621687727772"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-947"></span><span>          </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-948"></span><span>        </span><span id="local-6989586621687727775"><span class="annot"><span class="annottext">allParams :: [(Text, Either Text Value)]
</span><a href="#local-6989586621687727775"><span class="hs-identifier hs-var hs-var">allParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text Value)
-&gt; (Text, Text) -&gt; (Text, Either Text Value)
forall a b. (a -&gt; b) -&gt; (Text, a) -&gt; (Text, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Value
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">((Text, Text) -&gt; (Text, Either Text Value))
-&gt; TraceMetadata -&gt; [(Text, Either Text Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TraceMetadata
</span><a href="#local-6989586621687727763"><span class="hs-identifier hs-var">queryParams</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Either Text Value)]
-&gt; [(Text, Either Text Value)] -&gt; [(Text, Either Text Value)]
forall a. [a] -&gt; [a] -&gt; [a]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Either Text Value)
-&gt; (Text, Value) -&gt; (Text, Either Text Value)
forall a b. (a -&gt; b) -&gt; (Text, a) -&gt; (Text, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Value
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((Text, Value) -&gt; (Text, Either Text Value))
-&gt; [(Text, Value)] -&gt; [(Text, Either Text Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Value)]
</span><a href="#local-6989586621687727769"><span class="hs-identifier hs-var">bodyParams</span></a></span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-951"></span><span>      </span><span class="hs-comment">-- TODO: Are we actually able to use mkGetHandler in this situation? POST handler seems to do some work that we might want to avoid.</span><span>
</span><span id="line-952"></span><span>      </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RestRequest SpockMethod -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
</span><a href="#local-6989586621687727712"><span class="hs-identifier hs-var">customEndpointHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
-&gt; SpockMethod
-&gt; [(Text, Either Text Value)]
-&gt; RestRequest SpockMethod
forall method.
Text -&gt; method -&gt; [(Text, Either Text Value)] -&gt; RestRequest method
</span><a href="Hasura.Server.Rest.html#RestRequest"><span class="hs-identifier hs-var">RestRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727762"><span class="hs-identifier hs-var">wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">SpockMethod
</span><a href="#local-6989586621687727767"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Either Text Value)]
</span><a href="#local-6989586621687727775"><span class="hs-identifier hs-var">allParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-comment">-- Note: we create a schema cache updater function, to restrict the access</span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-comment">-- to 'AppStateRef' inside the request handlers</span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727779"><span class="annot"><span class="annottext">schemaCacheUpdater :: (RebuildableSchemaCache
 -&gt; Handler m (EncJSON, RebuildableSchemaCache))
-&gt; Handler m EncJSON
</span><a href="#local-6989586621687727779"><span class="hs-identifier hs-var hs-var">schemaCacheUpdater</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; (RebuildableSchemaCache
    -&gt; Handler m (EncJSON, RebuildableSchemaCache))
-&gt; Handler m EncJSON
forall (m :: * -&gt; *) impl a.
(MonadIO m, MonadBaseControl IO m, MonadError QErr m) =&gt;
AppStateRef impl
-&gt; Logger Hasura
-&gt; Maybe (TVar Bool)
-&gt; (RebuildableSchemaCache -&gt; m (a, RebuildableSchemaCache))
-&gt; m a
</span><a href="Hasura.Server.AppStateRef.html#withSchemaCacheReadUpdate"><span class="hs-identifier hs-var">withSchemaCacheReadUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TVar Bool)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/graphql/explain&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-959"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
</span><a href="#local-6989586621687727782"><span class="hs-identifier hs-var">gqlExplainAction</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/graphql/explain&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-962"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m ()
</span><a href="#local-6989586621687727782"><span class="hs-identifier hs-var">gqlExplainAction</span></a></span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/query&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-966"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m RQLQuery -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-967"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m RQLQuery -&gt; ActionCtxT () m ())
-&gt; APIHandler m RQLQuery -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-968"></span><span>        </span><span class="annot"><span class="annottext">(RQLQuery -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m RQLQuery
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((RQLQuery -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m RQLQuery)
-&gt; (RQLQuery -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m RQLQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogGraphQLInfo, APIResp))
-&gt; Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (RQLQuery -&gt; Handler m APIResp)
-&gt; RQLQuery
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(RQLQuery -&gt; Handler m (HttpResponse EncJSON))
-&gt; RQLQuery -&gt; Handler m APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RebuildableSchemaCache
  -&gt; Handler m (EncJSON, RebuildableSchemaCache))
 -&gt; Handler m EncJSON)
-&gt; RQLQuery -&gt; Handler m (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m,
 MonadMetadataApiAuthorization m, MonadTrace m,
 MonadReader HandlerCtx m, MonadMetadataStorage m,
 MonadResolveSource m, HasAppEnv m, HasCacheStaticConfig m,
 MonadQueryTags m, MonadEventLogCleanup m, ProvidesNetwork m,
 MonadGetPolicies m, UserInfoM m) =&gt;
((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1QueryHandler"><span class="hs-identifier hs-var">v1QueryHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache
 -&gt; Handler m (EncJSON, RebuildableSchemaCache))
-&gt; Handler m EncJSON
</span><a href="#local-6989586621687727779"><span class="hs-identifier hs-var">schemaCacheUpdater</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/metadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-971"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-972"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m RQLMetadata -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-973"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m RQLMetadata -&gt; ActionCtxT () m ())
-&gt; APIHandler m RQLMetadata -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RQLMetadata -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m RQLMetadata
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span>
</span><span id="line-974"></span><span>      </span><span class="annot"><span class="annottext">((RQLMetadata -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m RQLMetadata)
-&gt; (RQLMetadata -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m RQLMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogGraphQLInfo, APIResp))
-&gt; Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>      </span><span class="annot"><span class="annottext">(Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (RQLMetadata -&gt; Handler m APIResp)
-&gt; RQLMetadata
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(RQLMetadata -&gt; Handler m (HttpResponse EncJSON))
-&gt; RQLMetadata -&gt; Handler m APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RebuildableSchemaCache
  -&gt; Handler m (EncJSON, RebuildableSchemaCache))
 -&gt; Handler m EncJSON)
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; RQLMetadata
-&gt; Handler m (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m,
 MonadReader HandlerCtx m, MonadTrace m, MonadMetadataStorage m,
 MonadResolveSource m, MonadMetadataApiAuthorization m,
 MonadEventLogCleanup m, HasAppEnv m, HasCacheStaticConfig m,
 HasFeatureFlagChecker m, ProvidesNetwork m, MonadGetPolicies m,
 UserInfoM m) =&gt;
((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; WebsocketCloseOnMetadataChangeAction
-&gt; RQLMetadata
-&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1MetadataHandler"><span class="hs-identifier hs-var">v1MetadataHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache
 -&gt; Handler m (EncJSON, RebuildableSchemaCache))
-&gt; Handler m EncJSON
</span><a href="#local-6989586621687727779"><span class="hs-identifier hs-var">schemaCacheUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">WebsocketCloseOnMetadataChangeAction
</span><a href="#local-6989586621687727677"><span class="hs-identifier hs-var">closeWebsocketsOnMetadataChangeAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v2/query&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-978"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-979"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m RQLQuery -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-980"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m RQLQuery -&gt; ActionCtxT () m ())
-&gt; APIHandler m RQLQuery -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RQLQuery -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m RQLQuery
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span>
</span><span id="line-981"></span><span>      </span><span class="annot"><span class="annottext">((RQLQuery -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m RQLQuery)
-&gt; (RQLQuery -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m RQLQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogGraphQLInfo, APIResp))
-&gt; Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span>      </span><span class="annot"><span class="annottext">(Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (RQLQuery -&gt; Handler m APIResp)
-&gt; RQLQuery
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(RQLQuery -&gt; Handler m (HttpResponse EncJSON))
-&gt; RQLQuery -&gt; Handler m APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RebuildableSchemaCache
  -&gt; Handler m (EncJSON, RebuildableSchemaCache))
 -&gt; Handler m EncJSON)
-&gt; RQLQuery -&gt; Handler m (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadBaseControl IO m,
 MonadMetadataApiAuthorization m, MonadTrace m,
 MonadReader HandlerCtx m, MonadMetadataStorage m,
 MonadResolveSource m, HasAppEnv m, HasCacheStaticConfig m,
 MonadQueryTags m, ProvidesNetwork m, UserInfoM m) =&gt;
((RebuildableSchemaCache -&gt; m (EncJSON, RebuildableSchemaCache))
 -&gt; m EncJSON)
-&gt; RQLQuery -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v2QueryHandler"><span class="hs-identifier hs-var">v2QueryHandler</span></a></span><span> </span><span class="annot"><span class="annottext">(RebuildableSchemaCache
 -&gt; Handler m (EncJSON, RebuildableSchemaCache))
-&gt; Handler m EncJSON
</span><a href="#local-6989586621687727779"><span class="hs-identifier hs-var">schemaCacheUpdater</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/pg_dump&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-985"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isPGDumpEnabled"><span class="hs-identifier hs-var">isPGDumpEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-986"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler m PGDumpReqBody
-&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-987"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m PGDumpReqBody -&gt; ActionCtxT () m ())
-&gt; APIHandler m PGDumpReqBody -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PGDumpReqBody -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m PGDumpReqBody
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span>
</span><span id="line-988"></span><span>      </span><span class="annot"><span class="annottext">((PGDumpReqBody -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m PGDumpReqBody)
-&gt; (PGDumpReqBody -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m PGDumpReqBody
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogGraphQLInfo, APIResp))
-&gt; Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>      </span><span class="annot"><span class="annottext">(Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (PGDumpReqBody -&gt; Handler m APIResp)
-&gt; PGDumpReqBody
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PGDumpReqBody -&gt; Handler m APIResp
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadReader HandlerCtx m) =&gt;
PGDumpReqBody -&gt; m APIResp
</span><a href="Hasura.Server.App.html#v1Alpha1PGDumpHandler"><span class="hs-identifier hs-var">v1Alpha1PGDumpHandler</span></a></span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span>  </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; SpockT m ()
forall impl. AppStateRef impl -&gt; SpockT m ()
forall (m :: * -&gt; *) impl.
MonadConfigApiHandler m =&gt;
AppStateRef impl -&gt; SpockCtxT () m ()
</span><a href="Hasura.Server.App.html#runConfigApiHandler"><span class="hs-identifier hs-var">runConfigApiHandler</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1alpha1/graphql&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-994"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-var">isGraphQLEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-995"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m ReqsText -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQErr"><span class="hs-identifier hs-var">GH.encodeGQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-996"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m ReqsText -&gt; ActionCtxT () m ())
-&gt; APIHandler m ReqsText -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var">mkGQLRequestHandler</span></a></span><span>
</span><span id="line-997"></span><span>      </span><span class="annot"><span class="annottext">((ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m ReqsText)
-&gt; (ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
-&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var">mkGQLAPIRespHandler</span></a></span><span>
</span><span id="line-998"></span><span>      </span><span class="annot"><span class="annottext">((ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
 -&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (ReqsText
    -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
-&gt; ReqsText
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
-&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
GraphQLQueryType
-&gt; ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1Alpha1GQHandler"><span class="hs-identifier hs-var">v1Alpha1GQHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GraphQLQueryType
</span><a href="Hasura.GraphQL.Execute.Types.html#QueryHasura"><span class="hs-identifier hs-var">E.QueryHasura</span></a></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1/graphql&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1001"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-var">isGraphQLEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1002"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m ReqsText -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQErr"><span class="hs-identifier hs-var">GH.encodeGQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687727784"><span class="hs-identifier hs-var">allMod200</span></a></span><span>
</span><span id="line-1003"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m ReqsText -&gt; ActionCtxT () m ())
-&gt; APIHandler m ReqsText -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var">mkGQLRequestHandler</span></a></span><span>
</span><span id="line-1004"></span><span>      </span><span class="annot"><span class="annottext">((ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m ReqsText)
-&gt; (ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
-&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var">mkGQLAPIRespHandler</span></a></span><span>
</span><span id="line-1005"></span><span>      </span><span class="annot"><span class="annottext">((ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
 -&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (ReqsText
    -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
-&gt; ReqsText
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQHandler"><span class="hs-identifier hs-var">v1GQHandler</span></a></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#post"><span class="hs-identifier hs-var">Spock.post</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;v1beta1/relay&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1008"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isGraphQLEnabled"><span class="hs-identifier hs-var">isGraphQLEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1009"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m ReqsText -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQErr"><span class="hs-identifier hs-var">GH.encodeGQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687727784"><span class="hs-identifier hs-var">allMod200</span></a></span><span>
</span><span id="line-1010"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m ReqsText -&gt; ActionCtxT () m ())
-&gt; APIHandler m ReqsText -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall (m :: * -&gt; *).
(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
</span><a href="Hasura.Server.App.html#mkGQLRequestHandler"><span class="hs-identifier hs-var">mkGQLRequestHandler</span></a></span><span>
</span><span id="line-1011"></span><span>      </span><span class="annot"><span class="annottext">((ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m ReqsText)
-&gt; (ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m ReqsText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
-&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; Handler m (b, HttpResponse EncJSON))
-&gt; a -&gt; Handler m (b, APIResp)
</span><a href="Hasura.Server.App.html#mkGQLAPIRespHandler"><span class="hs-identifier hs-var">mkGQLAPIRespHandler</span></a></span><span>
</span><span id="line-1012"></span><span>      </span><span class="annot"><span class="annottext">((ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
 -&gt; ReqsText -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (ReqsText
    -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON))
-&gt; ReqsText
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReqsText -&gt; Handler m (HttpLogGraphQLInfo, HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadTrace m, HasAppEnv m,
 MonadExecuteQuery m, MonadError QErr m, MonadReader HandlerCtx m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m) =&gt;
ReqsText -&gt; m (HttpLogGraphQLInfo, HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#v1GQRelayHandler"><span class="hs-identifier hs-var">v1GQRelayHandler</span></a></span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-comment">-- This exposes some simple RTS stats when we run with `+RTS -T`. We want</span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-comment">-- this to be available even when developer APIs are not compiled in, to</span><span>
</span><span id="line-1016"></span><span>  </span><span class="hs-comment">-- support benchmarking.</span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-comment">-- See: https://hackage.haskell.org/package/base/docs/GHC-Stats.html</span><span>
</span><span id="line-1018"></span><span>  </span><span id="local-6989586621687727785"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727785"><span class="hs-identifier hs-var">exposeRtsStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; SpockCtxT () m Bool
forall a. IO a -&gt; SpockCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO Bool
</span><span class="hs-identifier hs-var">RTS.getRTSStatsEnabled</span></span><span>
</span><span id="line-1019"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; SpockT m () -&gt; SpockT m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687727785"><span class="hs-identifier hs-var">exposeRtsStats</span></a></span><span> </span><span class="annot"><span class="annottext">(SpockT m () -&gt; SpockT m ()) -&gt; SpockT m () -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>    </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/rts_stats&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1021"></span><span>      </span><span class="hs-comment">-- This ensures the live_bytes and other counters from GCDetails are fresh:</span><span>
</span><span id="line-1022"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; ActionCtxT () m ()
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">performMajorGC</span></span><span>
</span><span id="line-1023"></span><span>      </span><span id="local-6989586621687727788"><span class="annot"><span class="annottext">RTSStats
</span><a href="#local-6989586621687727788"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO RTSStats -&gt; ActionCtxT () m RTSStats
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO RTSStats
</span><span class="hs-identifier hs-var">RTS.getRTSStats</span></span><span>
</span><span id="line-1024"></span><span>      </span><span class="annot"><span class="annottext">RTSStats -&gt; ActionCtxT () m ()
forall a (m :: * -&gt; *) ctx b.
(ToJSON a, MonadIO m) =&gt;
a -&gt; ActionCtxT ctx m b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#json"><span class="hs-identifier hs-var">Spock.json</span></a></span><span> </span><span class="annot"><span class="annottext">RTSStats
</span><a href="#local-6989586621687727788"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/ekg&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1027"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var">isDeveloperAPIEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1028"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1029"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-1030"></span><span>      </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1031"></span><span>        </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1032"></span><span>        </span><span id="local-6989586621687727791"><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621687727791"><span class="hs-identifier hs-var">respJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Sample -&gt; Handler m Sample
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Sample -&gt; Handler m Sample) -&gt; IO Sample -&gt; Handler m Sample
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics -&gt; IO Sample
forall (metrics :: Symbol -&gt; MetricType -&gt; * -&gt; *).
Store metrics -&gt; IO Sample
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-93f2ed46e22c63a626e0d4152147170c3d5f8bca8a565d95e6bd12f130cd775b/share/doc/html/src/System.Metrics.html#sampleAll"><span class="hs-identifier hs-var">EKG.sampleAll</span></a></span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621687727676"><span class="hs-identifier hs-var">ekgStore</span></a></span><span>
</span><span id="line-1033"></span><span>        </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; EncJSON) -&gt; Value -&gt; EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sample -&gt; Value
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-json-0.1.0.7/opt/doc/html/ekg-json/src/System.Metrics.Json.html#sampleToJson"><span class="hs-identifier hs-var">EKG.sampleToJson</span></a></span><span> </span><span class="annot"><span class="annottext">Sample
</span><a href="#local-6989586621687727791"><span class="hs-identifier hs-var">respJ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span>  </span><span class="hs-comment">-- This deprecated endpoint used to show the query plan cache pre-PDV.</span><span>
</span><span id="line-1036"></span><span>  </span><span class="hs-comment">-- Eventually this endpoint can be removed.</span><span>
</span><span id="line-1037"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/plan_cache&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1038"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var">isDeveloperAPIEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1039"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1040"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-1041"></span><span>      </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1042"></span><span>        </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1043"></span><span>        </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/subscriptions&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1046"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var">isDeveloperAPIEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1047"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1048"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-1049"></span><span>      </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1050"></span><span>        </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1051"></span><span>        </span><span id="local-6989586621687727795"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727795"><span class="hs-identifier hs-var">appCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; Handler m AppContext
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; Handler m AppContext)
-&gt; IO AppContext -&gt; Handler m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1052"></span><span>        </span><span id="local-6989586621687727796"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687727796"><span class="hs-identifier hs-var">respJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Value -&gt; Handler m Value
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Value -&gt; Handler m Value) -&gt; IO Value -&gt; Handler m Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; StreamQueriesOptions
-&gt; StreamQueriesOptions
-&gt; SubscriptionsState
-&gt; IO Value
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#dumpSubscriptionsState"><span class="hs-identifier hs-var">ES.dumpSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; StreamQueriesOptions
</span><a href="Hasura.App.State.html#acLiveQueryOptions"><span class="hs-identifier hs-var">acLiveQueryOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727795"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; StreamQueriesOptions
</span><a href="Hasura.App.State.html#acStreamQueryOptions"><span class="hs-identifier hs-var">acStreamQueryOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727795"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621687727661"><span class="hs-identifier hs-var">appEnvSubscriptionState</span></a></span><span>
</span><span id="line-1053"></span><span>        </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687727796"><span class="hs-identifier hs-var">respJ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span>
</span><span id="line-1055"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/subscriptions/extended&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1056"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var">isDeveloperAPIEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1057"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1058"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-1059"></span><span>      </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1060"></span><span>        </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1061"></span><span>        </span><span id="local-6989586621687727798"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727798"><span class="hs-identifier hs-var">appCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; Handler m AppContext
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; Handler m AppContext)
-&gt; IO AppContext -&gt; Handler m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1062"></span><span>        </span><span id="local-6989586621687727799"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687727799"><span class="hs-identifier hs-var">respJ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Value -&gt; Handler m Value
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Value -&gt; Handler m Value) -&gt; IO Value -&gt; Handler m Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; StreamQueriesOptions
-&gt; StreamQueriesOptions
-&gt; SubscriptionsState
-&gt; IO Value
</span><a href="Hasura.GraphQL.Execute.Subscription.State.html#dumpSubscriptionsState"><span class="hs-identifier hs-var">ES.dumpSubscriptionsState</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; StreamQueriesOptions
</span><a href="Hasura.App.State.html#acLiveQueryOptions"><span class="hs-identifier hs-var">acLiveQueryOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727798"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; StreamQueriesOptions
</span><a href="Hasura.App.State.html#acStreamQueryOptions"><span class="hs-identifier hs-var">acStreamQueryOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727798"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621687727661"><span class="hs-identifier hs-var">appEnvSubscriptionState</span></a></span><span>
</span><span id="line-1063"></span><span>        </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687727799"><span class="hs-identifier hs-var">respJ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;dev/dataconnector/schema&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1066"></span><span>    </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isDeveloperAPIEnabled"><span class="hs-identifier hs-var">isDeveloperAPIEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1067"></span><span>      </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1068"></span><span>      </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-1069"></span><span>      </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>        </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1071"></span><span>        </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenApi -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/dc-api-1.0.0/opt/doc/html/dc-api/src/Hasura.Backends.DataConnector.API.html#openApiSchema"><span class="hs-identifier hs-var">openApiSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span>  </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;api/swagger/json&quot;</span></span><span>
</span><span id="line-1074"></span><span>    </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><span class="annottext">(APIHandler m () -&gt; ActionCtxT () m ())
-&gt; APIHandler m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall (m :: * -&gt; *).
Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
</span><a href="Hasura.Server.App.html#mkGetHandler"><span class="hs-identifier hs-var">mkGetHandler</span></a></span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><span class="annottext">(Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ())
-&gt; Handler m (HttpLogGraphQLInfo, APIResp) -&gt; APIHandler m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1077"></span><span>      </span><span class="annot"><span class="annottext">Handler m ()
forall (m :: * -&gt; *).
(MonadError QErr m, MonadReader HandlerCtx m) =&gt;
m ()
</span><a href="Hasura.Server.App.html#onlyAdmin"><span class="hs-identifier hs-var">onlyAdmin</span></a></span><span>
</span><span id="line-1078"></span><span>      </span><span id="local-6989586621687727800"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687727800"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; Handler m SchemaCache
forall a. IO a -&gt; Handler m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SchemaCache -&gt; Handler m SchemaCache)
-&gt; IO SchemaCache -&gt; Handler m SchemaCache
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO SchemaCache
forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1079"></span><span>      </span><span id="local-6989586621687727801"><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621687727801"><span class="hs-identifier hs-var">json</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; Handler m OpenApi
forall (m :: * -&gt; *).
(MonadError QErr m, MonadFix m) =&gt;
SchemaCache -&gt; m OpenApi
</span><a href="Hasura.Server.OpenAPI.html#buildOpenAPI"><span class="hs-identifier hs-var">buildOpenAPI</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687727800"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-1080"></span><span>      </span><span class="annot"><span class="annottext">(HttpLogGraphQLInfo, APIResp)
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a. a -&gt; Handler m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HttpResponse EncJSON -&gt; APIResp
</span><a href="Hasura.Server.App.html#JSONResp"><span class="hs-identifier hs-var">JSONResp</span></a></span><span> </span><span class="annot"><span class="annottext">(HttpResponse EncJSON -&gt; APIResp)
-&gt; HttpResponse EncJSON -&gt; APIResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EncJSON -&gt; [Header] -&gt; HttpResponse EncJSON
forall a. a -&gt; [Header] -&gt; HttpResponse a
</span><a href="Hasura.HTTP.html#HttpResponse"><span class="hs-identifier hs-var">HttpResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenApi -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621687727801"><span class="hs-identifier hs-var">json</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span>  </span><span class="annot"><span class="annottext">[StdMethod] -&gt; (StdMethod -&gt; SpockT m ()) -&gt; SpockT m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#GET"><span class="hs-identifier hs-var">Spock.GET</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Method.html#POST"><span class="hs-identifier hs-var">Spock.POST</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((StdMethod -&gt; SpockT m ()) -&gt; SpockT m ())
-&gt; (StdMethod -&gt; SpockT m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727803"><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621687727803"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StdMethod -&gt; ([Text] -&gt; ActionCtxT () m ()) -&gt; SpockT m ()
forall (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) ctx.
(RouteM t, Monad m) =&gt;
StdMethod -&gt; ([Text] -&gt; ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#hookAny"><span class="hs-identifier hs-var">Spock.hookAny</span></a></span><span> </span><span class="annot"><span class="annottext">StdMethod
</span><a href="#local-6989586621687727803"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(([Text] -&gt; ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; ([Text] -&gt; ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1083"></span><span>    </span><span id="local-6989586621687727805"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727805"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727806"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621687727806"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727805"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1085"></span><span>        </span><span id="local-6989586621687727808"><span class="annot"><span class="annottext">qErr :: QErr
</span><a href="#local-6989586621687727808"><span class="hs-identifier hs-var hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err404"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;resource does not exist&quot;</span></span><span>
</span><span id="line-1086"></span><span>    </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var">raiseGenericApiError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727653"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727806"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727808"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1087"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1088"></span><span>    </span><span id="local-6989586621687727780"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621687727649"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>    </span><span id="local-6989586621687727703"><span class="annot"><span class="annottext">logSuccess :: Text -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727703"><span class="hs-identifier hs-var hs-var">logSuccess</span></a></span></span><span> </span><span id="local-6989586621687727809"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727809"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1091"></span><span>      </span><span id="local-6989586621687727810"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727810"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-1092"></span><span>      </span><span id="local-6989586621687727811"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727811"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.html#strictRequestBody"><span class="hs-identifier hs-var">Wai.strictRequestBody</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727810"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1093"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727812"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621687727812"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727810"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1094"></span><span>          </span><span id="local-6989586621687727813"><span class="annot"><span class="annottext">blMsg :: ByteString
</span><a href="#local-6989586621687727813"><span class="hs-identifier hs-var hs-var">blMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.Lazy.Encoding.html#encodeUtf8"><span class="hs-identifier hs-var">TL.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727809"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1095"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687727815"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727815"><span class="hs-identifier hs-var">reqId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687727816"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727816"><span class="hs-identifier hs-var">_newHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727812"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1096"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT () m ()) -&gt; m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; EncodingType
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; EncodingType
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpSuccess"><span class="hs-identifier hs-var">logHttpSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727653"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727815"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727810"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727811"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727813"><span class="hs-identifier hs-var">blMsg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727813"><span class="hs-identifier hs-var">blMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">EncodingType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727812"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span>    </span><span id="local-6989586621687727689"><span class="annot"><span class="annottext">logError :: QErr -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727689"><span class="hs-identifier hs-var hs-var">logError</span></a></span></span><span> </span><span id="local-6989586621687727818"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727818"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1099"></span><span>      </span><span id="local-6989586621687727819"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727819"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-1100"></span><span>      </span><span id="local-6989586621687727820"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727820"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.html#strictRequestBody"><span class="hs-identifier hs-var">Wai.strictRequestBody</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727819"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1101"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727821"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621687727821"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727819"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1102"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621687727822"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727822"><span class="hs-identifier hs-var">reqId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687727823"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727823"><span class="hs-identifier hs-var">_newHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727821"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1103"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionCtxT () m ()) -&gt; m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var">logHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727653"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727822"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727819"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727820"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727818"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727821"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><a href="#local-6989586621687727777"><span class="hs-identifier hs-type">spockAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1106"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724805"><span class="annot"><a href="#local-6989586621687724805"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1107"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724805"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1108"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Encoding.Internal.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1109"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1110"></span><span>      </span><span class="annot"><a href="Hasura.Server.App.html#APIHandler"><span class="hs-identifier hs-type">APIHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724805"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1111"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionT"><span class="hs-identifier hs-type">Spock.ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>    </span><span id="local-6989586621687727777"><span class="annot"><span class="annottext">spockAction :: forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var hs-var">spockAction</span></a></span></span><span> </span><span id="local-6989586621687727833"><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="#local-6989586621687727833"><span class="hs-identifier hs-var">qErrEncoder</span></a></span></span><span> </span><span id="local-6989586621687727834"><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687727834"><span class="hs-identifier hs-var">qErrModifier</span></a></span></span><span> </span><span id="local-6989586621687727835"><span class="annot"><span class="annottext">APIHandler m a
</span><a href="#local-6989586621687727835"><span class="hs-identifier hs-var">apiHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
-&gt; (Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler m a
-&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) a impl.
(MonadIO m, MonadBaseControl IO m, HasAppEnv m, FromJSON a,
 UserAuthentication m, HttpLog m, HasResourceLimits m,
 MonadTrace m) =&gt;
AppStateRef impl
-&gt; (Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr)
-&gt; APIHandler m a
-&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#mkSpockAction"><span class="hs-identifier hs-var">mkSpockAction</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="#local-6989586621687727833"><span class="hs-identifier hs-var">qErrEncoder</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
</span><a href="#local-6989586621687727834"><span class="hs-identifier hs-var">qErrModifier</span></a></span><span> </span><span class="annot"><span class="annottext">APIHandler m a
</span><a href="#local-6989586621687727835"><span class="hs-identifier hs-var">apiHandler</span></a></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-comment">-- all graphql errors should be of type 200</span><span>
</span><span id="line-1115"></span><span>    </span><span id="local-6989586621687727784"><span class="annot"><span class="annottext">allMod200 :: QErr -&gt; QErr
</span><a href="#local-6989586621687727784"><span class="hs-identifier hs-var hs-var">allMod200</span></a></span></span><span> </span><span id="local-6989586621687727836"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727836"><span class="hs-identifier hs-var">qe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727836"><span class="hs-identifier hs-var">qe</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">qeStatus :: Status
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var">qeStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Status.html#status200"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1116"></span><span>    </span><span id="local-6989586621687727782"><span class="annot"><span class="annottext">gqlExplainAction :: ActionCtxT () m ()
</span><a href="#local-6989586621687727782"><span class="hs-identifier hs-var hs-var">gqlExplainAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1117"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m GQLExplain -&gt; ActionCtxT () m ()
forall a.
FromJSON a =&gt;
(Bool -&gt; QErr -&gt; Encoding)
-&gt; (QErr -&gt; QErr) -&gt; APIHandler m a -&gt; ActionCtxT () m ()
</span><a href="#local-6989586621687727777"><span class="hs-identifier hs-var">spockAction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; QErr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1118"></span><span>        </span><span class="annot"><span class="annottext">(APIHandler m GQLExplain -&gt; ActionCtxT () m ())
-&gt; APIHandler m GQLExplain -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GQLExplain -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m GQLExplain
forall a (m :: * -&gt; *).
(a -&gt; Handler m (HttpLogGraphQLInfo, APIResp)) -&gt; APIHandler m a
</span><a href="Hasura.Server.App.html#mkPostHandler"><span class="hs-identifier hs-var">mkPostHandler</span></a></span><span>
</span><span id="line-1119"></span><span>        </span><span class="annot"><span class="annottext">((GQLExplain -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
 -&gt; APIHandler m GQLExplain)
-&gt; (GQLExplain -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; APIHandler m GQLExplain
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(APIResp -&gt; (HttpLogGraphQLInfo, APIResp))
-&gt; Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall a b. (a -&gt; b) -&gt; Handler m a -&gt; Handler m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpLogGraphQLInfo
</span><a href="Hasura.Server.Logging.html#emptyHttpLogGraphQLInfo"><span class="hs-identifier hs-var">emptyHttpLogGraphQLInfo</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>        </span><span class="annot"><span class="annottext">(Handler m APIResp -&gt; Handler m (HttpLogGraphQLInfo, APIResp))
-&gt; (GQLExplain -&gt; Handler m APIResp)
-&gt; GQLExplain
-&gt; Handler m (HttpLogGraphQLInfo, APIResp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(GQLExplain -&gt; Handler m (HttpResponse EncJSON))
-&gt; GQLExplain -&gt; Handler m APIResp
forall (m :: * -&gt; *) a.
Functor m =&gt;
(a -&gt; Handler m (HttpResponse EncJSON)) -&gt; a -&gt; Handler m APIResp
</span><a href="Hasura.Server.App.html#mkAPIRespHandler"><span class="hs-identifier hs-var">mkAPIRespHandler</span></a></span><span> </span><span class="annot"><span class="annottext">GQLExplain -&gt; Handler m (HttpResponse EncJSON)
forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m,
 MonadReader HandlerCtx m, MonadMetadataStorage m, MonadQueryTags m,
 MonadTrace m) =&gt;
GQLExplain -&gt; m (HttpResponse EncJSON)
</span><a href="Hasura.Server.App.html#gqlExplainHandler"><span class="hs-identifier hs-var">gqlExplainHandler</span></a></span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span>    </span><span id="local-6989586621687727679"><span class="annot"><span class="annottext">serveApiConsole :: SpockT m ()
</span><a href="#local-6989586621687727679"><span class="hs-identifier hs-var hs-var">serveApiConsole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1123"></span><span>      </span><span class="hs-comment">-- redirect / to /console</span><span>
</span><span id="line-1124"></span><span>      </span><span class="annot"><span class="annottext">Path '[] 'Open -&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/reroute-0.7.0.0-cbc77d4bca09b235f573879fc5ff2114ffbc793d23ef6527d138e3f6f6f1c1d4/share/doc/html/src/Web.Routing.Combinators.html#root"><span class="hs-identifier hs-var">Spock.root</span></a></span><span> </span><span class="annot"><span class="annottext">(HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ())
-&gt; HVectElim '[] (ActionCtxT () m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1125"></span><span>        </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687727838"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727838"><span class="hs-identifier hs-var">appCtx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConsoleStatus -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#isConsoleEnabled"><span class="hs-identifier hs-var">isConsoleEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; ConsoleStatus
</span><a href="Hasura.App.State.html#acConsoleStatus"><span class="hs-identifier hs-var">acConsoleStatus</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727838"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727838"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1126"></span><span>          </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#redirect"><span class="hs-identifier hs-var">Spock.redirect</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;console&quot;</span></span><span>
</span><span id="line-1127"></span><span>
</span><span id="line-1128"></span><span>      </span><span class="hs-comment">-- serve console html</span><span>
</span><span id="line-1129"></span><span>      </span><span class="annot"><span class="annottext">Path (Append '[] '[Text]) 'Closed
-&gt; HVectElim (Append '[] '[Text]) (ActionCtxT () m ())
-&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;console&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; Path '[Text] 'Closed -&gt; Path (Append '[] '[Text]) 'Closed
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/reroute-0.7.0.0-cbc77d4bca09b235f573879fc5ff2114ffbc793d23ef6527d138e3f6f6f1c1d4/share/doc/html/src/Web.Routing.Combinators.html#wildcard"><span class="hs-identifier hs-var">Spock.wildcard</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HVectElim (Append '[] '[Text]) (ActionCtxT () m ())
 -&gt; SpockT m ())
-&gt; HVectElim (Append '[] '[Text]) (ActionCtxT () m ())
-&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727841"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727841"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1130"></span><span>        </span><span class="annot"><span class="annottext">(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var">onlyWhenApiEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687727842"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727842"><span class="hs-identifier hs-var">appCtx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConsoleStatus -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#isConsoleEnabled"><span class="hs-identifier hs-var">isConsoleEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; ConsoleStatus
</span><a href="Hasura.App.State.html#acConsoleStatus"><span class="hs-identifier hs-var">acConsoleStatus</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727842"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="Hasura.Server.App.html#isMetadataEnabled"><span class="hs-identifier hs-var">isMetadataEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727842"><span class="hs-identifier hs-var">appCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionCtxT () m () -&gt; ActionCtxT () m ())
-&gt; ActionCtxT () m () -&gt; ActionCtxT () m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1131"></span><span>          </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687727843"><span id="local-6989586621687727844"><span id="local-6989586621687727845"><span id="local-6989586621687727846"><span id="local-6989586621687727847"><span id="local-6989586621687727848"><span id="local-6989586621687727849"><span id="local-6989586621687727850"><span id="local-6989586621687727851"><span id="local-6989586621687727852"><span id="local-6989586621687727853"><span id="local-6989586621687727854"><span id="local-6989586621687727855"><span id="local-6989586621687727856"><span id="local-6989586621687727857"><span id="local-6989586621687727858"><span id="local-6989586621687727859"><span id="local-6989586621687727860"><span id="local-6989586621687727861"><span id="local-6989586621687727862"><span class="annot"><span class="annottext">Environment
HashSet ExperimentalFeature
HashSet API
StreamQueriesOptions
NamingCase
RemoteSchemaPermissions
InferFunctionPermissions
SQLGenCtx
CloseWebsocketsOnMetadataChangeStatus
ApolloFederationStatus
CorsPolicy
AuthMode
MetadataDefaults
ResponseInternalErrorsConfig
OptionalInterval
TelemetryStatus
AllowListStatus
ConsoleStatus
EventEngineCtx
acEnabledAPIs :: AppContext -&gt; HashSet API
acAuthMode :: AppContext -&gt; AuthMode
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
acEnableAllowlist :: AppContext -&gt; AllowListStatus
acResponseInternalErrorsConfig :: AppContext -&gt; ResponseInternalErrorsConfig
acEnvironment :: AppContext -&gt; Environment
acRemoteSchemaPermsCtx :: AppContext -&gt; RemoteSchemaPermissions
acFunctionPermsCtx :: AppContext -&gt; InferFunctionPermissions
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
acDefaultNamingConvention :: AppContext -&gt; NamingCase
acMetadataDefaults :: AppContext -&gt; MetadataDefaults
acLiveQueryOptions :: AppContext -&gt; StreamQueriesOptions
acStreamQueryOptions :: AppContext -&gt; StreamQueriesOptions
acCorsPolicy :: AppContext -&gt; CorsPolicy
acConsoleStatus :: AppContext -&gt; ConsoleStatus
acEnableTelemetry :: AppContext -&gt; TelemetryStatus
acEventEngineCtx :: AppContext -&gt; EventEngineCtx
acAsyncActionsFetchInterval :: AppContext -&gt; OptionalInterval
acApolloFederationStatus :: AppContext -&gt; ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: AppContext -&gt; CloseWebsocketsOnMetadataChangeStatus
acAuthMode :: AuthMode
acSQLGenCtx :: SQLGenCtx
acEnabledAPIs :: HashSet API
acEnableAllowlist :: AllowListStatus
acResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
acEnvironment :: Environment
acRemoteSchemaPermsCtx :: RemoteSchemaPermissions
acFunctionPermsCtx :: InferFunctionPermissions
acExperimentalFeatures :: HashSet ExperimentalFeature
acDefaultNamingConvention :: NamingCase
acMetadataDefaults :: MetadataDefaults
acLiveQueryOptions :: StreamQueriesOptions
acStreamQueryOptions :: StreamQueriesOptions
acCorsPolicy :: CorsPolicy
acConsoleStatus :: ConsoleStatus
acEnableTelemetry :: TelemetryStatus
acEventEngineCtx :: EventEngineCtx
acAsyncActionsFetchInterval :: OptionalInterval
acApolloFederationStatus :: ApolloFederationStatus
acCloseWebsocketsOnMetadataChangeStatus :: CloseWebsocketsOnMetadataChangeStatus
</span><a href="Hasura.App.State.html#acEnabledAPIs"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; ActionCtxT () m AppContext
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; ActionCtxT () m AppContext)
-&gt; IO AppContext -&gt; ActionCtxT () m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727643"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1132"></span><span>          </span><span id="local-6989586621687727863"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727863"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-1133"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727864"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621687727864"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727863"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1134"></span><span>          </span><span id="local-6989586621687727865"><span class="annot"><span class="annottext">Either [Char] Text
</span><a href="#local-6989586621687727865"><span class="hs-identifier hs-var">consoleHtml</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either [Char] Text) -&gt; ActionCtxT () m (Either [Char] Text)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Either [Char] Text) -&gt; ActionCtxT () m (Either [Char] Text))
-&gt; m (Either [Char] Text) -&gt; ActionCtxT () m (Either [Char] Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; ConsoleType m
-&gt; m (Either [Char] Text)
forall (m :: * -&gt; *).
ConsoleRenderer m =&gt;
Text
-&gt; AuthMode
-&gt; TelemetryStatus
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; ConsoleType m
-&gt; m (Either [Char] Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var">renderConsole</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727841"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621687727843"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">TelemetryStatus
</span><a href="#local-6989586621687727858"><span class="hs-identifier hs-var">acEnableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687727665"><span class="hs-identifier hs-var">appEnvConsoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687727666"><span class="hs-identifier hs-var">appEnvConsoleSentryDsn</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleType m
</span><a href="#local-6989586621687727675"><span class="hs-identifier hs-var">consoleType</span></a></span><span>
</span><span id="line-1135"></span><span>          </span><span class="annot"><span class="annottext">([Char] -&gt; ActionCtxT () m ())
-&gt; (Text -&gt; ActionCtxT () m ())
-&gt; Either [Char] Text
-&gt; ActionCtxT () m ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var">raiseGenericApiError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727653"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727864"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; ActionCtxT () m ())
-&gt; ([Char] -&gt; QErr) -&gt; [Char] -&gt; ActionCtxT () m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#internalError"><span class="hs-identifier hs-var">internalError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; QErr) -&gt; ([Char] -&gt; Text) -&gt; [Char] -&gt; QErr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-c1b0bc5939db4f075c6a7688c6244ff9a6bf720cfcf4ace60cc230967ee3783b/share/doc/html/src/Data.Text.html#pack"><span class="hs-identifier hs-var">T.pack</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *) ctx a. MonadIO m =&gt; Text -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#html"><span class="hs-identifier hs-var">Spock.html</span></a></span><span> </span><span class="annot"><span class="annottext">Either [Char] Text
</span><a href="#local-6989586621687727865"><span class="hs-identifier hs-var">consoleHtml</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>    </span><span id="local-6989586621687727680"><span class="annot"><span class="annottext">serveApiConsoleAssets :: SpockT m ()
</span><a href="#local-6989586621687727680"><span class="hs-identifier hs-var hs-var">serveApiConsoleAssets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1138"></span><span>      </span><span class="hs-comment">-- serve static files if consoleAssetsDir is set</span><span>
</span><span id="line-1139"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text -&gt; (Text -&gt; SpockT m ()) -&gt; SpockT m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687727665"><span class="hs-identifier hs-var">appEnvConsoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">((Text -&gt; SpockT m ()) -&gt; SpockT m ())
-&gt; (Text -&gt; SpockT m ()) -&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727869"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727869"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1140"></span><span>        </span><span class="annot"><span class="annottext">Path (Append '[] '[Text]) 'Closed
-&gt; HVectElim (Append '[] '[Text]) (ActionCtxT () m ())
-&gt; SpockT m ()
forall (xs :: [*]) (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *)
       (ps :: PathState) ctx.
(HasRep xs, RouteM t, Monad m) =&gt;
Path xs ps -&gt; HVectElim xs (ActionCtxT ctx m ()) -&gt; t ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#get"><span class="hs-identifier hs-var">Spock.get</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path '[] 'Open
</span><span class="hs-string">&quot;console/assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">Path '[] 'Open
-&gt; Path '[Text] 'Closed -&gt; Path (Append '[] '[Text]) 'Closed
forall (as :: [*]) (bs :: [*]) (ps :: PathState).
Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Core.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Path '[Text] 'Closed
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/reroute-0.7.0.0-cbc77d4bca09b235f573879fc5ff2114ffbc793d23ef6527d138e3f6f6f1c1d4/share/doc/html/src/Web.Routing.Combinators.html#wildcard"><span class="hs-identifier hs-var">Spock.wildcard</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HVectElim (Append '[] '[Text]) (ActionCtxT () m ())
 -&gt; SpockT m ())
-&gt; HVectElim (Append '[] '[Text]) (ActionCtxT () m ())
-&gt; SpockT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687727870"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727870"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1141"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings -&gt; Text -&gt; Text -&gt; ActionCtxT () m ()
forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura -&gt; LoggingSettings -&gt; Text -&gt; Text -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#consoleAssetsHandler"><span class="hs-identifier hs-var">consoleAssetsHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727780"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727653"><span class="hs-identifier hs-var">appEnvLoggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727869"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687727870"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span class="hs-comment">-- an endpoint can be switched ON/OFF dynamically, hence serve the endpoint only</span><span>
</span><span id="line-1144"></span><span class="hs-comment">-- when it is enabled else throw HTTP Error 404</span><span>
</span><span id="line-1145"></span><span id="local-6989586621687724682"><span id="local-6989586621687724683"><span id="local-6989586621687724684"><span id="local-6989586621687724685"><span class="annot"><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-type">onlyWhenApiEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1146"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724682"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1147"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1148"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724683"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1149"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionCtxT"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724684"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724682"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724685"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1150"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionCtxT"><span class="hs-identifier hs-type">Spock.ActionCtxT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724684"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724682"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724685"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-1151"></span><span id="onlyWhenApiEnabled"><span class="annot"><span class="annottext">onlyWhenApiEnabled :: forall (m :: * -&gt; *) impl ctx b.
MonadIO m =&gt;
(AppContext -&gt; Bool)
-&gt; AppStateRef impl -&gt; ActionCtxT ctx m b -&gt; ActionCtxT ctx m b
</span><a href="Hasura.Server.App.html#onlyWhenApiEnabled"><span class="hs-identifier hs-var hs-var">onlyWhenApiEnabled</span></a></span></span><span> </span><span id="local-6989586621687727880"><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="#local-6989586621687727880"><span class="hs-identifier hs-var">isEnabled</span></a></span></span><span> </span><span id="local-6989586621687727881"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727881"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span id="local-6989586621687727882"><span class="annot"><span class="annottext">ActionCtxT ctx m b
</span><a href="#local-6989586621687727882"><span class="hs-identifier hs-var">endpointAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1152"></span><span>  </span><span id="local-6989586621687727883"><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727883"><span class="hs-identifier hs-var">appContext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; ActionCtxT ctx m AppContext
forall a. IO a -&gt; ActionCtxT ctx m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; ActionCtxT ctx m AppContext)
-&gt; IO AppContext -&gt; ActionCtxT ctx m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621687727881"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppContext -&gt; Bool
</span><a href="#local-6989586621687727880"><span class="hs-identifier hs-var">isEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">AppContext
</span><a href="#local-6989586621687727883"><span class="hs-identifier hs-var">appContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ActionCtxT ctx m b
</span><a href="#local-6989586621687727882"><span class="hs-identifier hs-var">endpointAction</span></a></span><span>
</span><span id="line-1155"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1156"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687727885"><span class="annot"><span class="annottext">qErr :: QErr
</span><a href="#local-6989586621687727885"><span class="hs-identifier hs-var hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err404"><span class="hs-identifier hs-var">err404</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;resource does not exist&quot;</span></span><span>
</span><span id="line-1157"></span><span>      </span><span class="annot"><span class="annottext">Status -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#setStatus"><span class="hs-identifier hs-var">Spock.setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; ActionCtxT ctx m ()) -&gt; Status -&gt; ActionCtxT ctx m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Status
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var">qeStatus</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727885"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1158"></span><span>      </span><span class="annot"><span class="annottext">Header -&gt; ActionCtxT ctx m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span>
</span><span id="line-1159"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; ActionCtxT ctx m b
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#lazyBytes"><span class="hs-identifier hs-var">Spock.lazyBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ActionCtxT ctx m b)
-&gt; (Encoding -&gt; ByteString) -&gt; Encoding -&gt; ActionCtxT ctx m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; ByteString
forall a. Encoding' a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.Encoding.Internal.html#encodingToLazyByteString"><span class="hs-identifier hs-var">J.encodingToLazyByteString</span></a></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; ActionCtxT ctx m b) -&gt; Encoding -&gt; ActionCtxT ctx m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QErr -&gt; Encoding
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#encodeQErr"><span class="hs-identifier hs-var">encodeQErr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727885"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span class="annot"><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-type">raiseGenericApiError</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687724643"><span class="annot"><a href="#local-6989586621687724643"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1163"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687724643"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724643"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1164"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1165"></span><span>  </span><span class="annot"><a href="Hasura.Server.Logging.html#LoggingSettings"><span class="hs-identifier hs-type">LoggingSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1166"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-types-0.12.3-12405da644063062afc64b14d7e0905b38c394abf41507dfeaf5482353a937da/share/doc/html/src/Network.HTTP.Types.Header.html#Header"><span class="hs-identifier hs-type">HTTP.Header</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1167"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1168"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.Wire.html#ActionT"><span class="hs-identifier hs-type">Spock.ActionT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687724643"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span id="raiseGenericApiError"><span class="annot"><span class="annottext">raiseGenericApiError :: forall (m :: * -&gt; *).
(MonadIO m, HttpLog m) =&gt;
Logger Hasura
-&gt; LoggingSettings -&gt; [Header] -&gt; QErr -&gt; ActionT m ()
</span><a href="Hasura.Server.App.html#raiseGenericApiError"><span class="hs-identifier hs-var hs-var">raiseGenericApiError</span></a></span></span><span> </span><span id="local-6989586621687727907"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727907"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687727908"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727908"><span class="hs-identifier hs-var">loggingSetting</span></a></span></span><span> </span><span id="local-6989586621687727909"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727909"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621687727910"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727910"><span class="hs-identifier hs-var">qErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1170"></span><span>  </span><span id="local-6989586621687727911"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727911"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ActionCtxT () m Request
forall (m :: * -&gt; *) ctx. MonadIO m =&gt; ActionCtxT ctx m Request
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#request"><span class="hs-identifier hs-var">Spock.request</span></a></span><span>
</span><span id="line-1171"></span><span>  </span><span id="local-6989586621687727912"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727912"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ActionCtxT () m ByteString
forall a. IO a -&gt; ActionCtxT () m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ActionCtxT () m ByteString)
-&gt; IO ByteString -&gt; ActionCtxT () m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.html#strictRequestBody"><span class="hs-identifier hs-var">Wai.strictRequestBody</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727911"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1172"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621687727913"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727913"><span class="hs-identifier hs-var">reqId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687727914"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727914"><span class="hs-identifier hs-var">_newHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Header] -&gt; m (RequestId, [Header])
</span><a href="Hasura.Server.Types.html#getRequestId"><span class="hs-identifier hs-var">getRequestId</span></a></span><span> </span><span class="annot"><span class="annottext">([Header] -&gt; ActionCtxT () m (RequestId, [Header]))
-&gt; [Header] -&gt; ActionCtxT () m (RequestId, [Header])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; [Header]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/wai-3.2.3-f937aba1f057bc79d453aadaaa8b8c7837c514d618c16f58125cd2d5375b27a9/share/doc/html/src/Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">Wai.requestHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727911"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1173"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; ActionT m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ActionCtxT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ActionT m ()) -&gt; m () -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
forall (m :: * -&gt; *).
HttpLog m =&gt;
Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; HttpLogMetadata m
-&gt; m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var">logHttpError</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687727907"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621687727908"><span class="hs-identifier hs-var">loggingSetting</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621687727913"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687727911"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687727912"><span class="hs-identifier hs-var">reqBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727910"><span class="hs-identifier hs-var">qErr</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687727909"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HttpLog m =&gt; HttpLogMetadata m
</span><a href="Hasura.Server.Logging.html#emptyHttpLogMetadata"><span class="hs-identifier hs-var">emptyHttpLogMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687724643"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1174"></span><span>  </span><span class="annot"><span class="annottext">Header -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Header -&gt; ActionCtxT ctx m ()
</span><a href="Hasura.Server.App.html#setHeader"><span class="hs-identifier hs-var">setHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Header
</span><a href="Hasura.Server.Utils.html#jsonHeader"><span class="hs-identifier hs-var">jsonHeader</span></a></span><span>
</span><span id="line-1175"></span><span>  </span><span class="annot"><span class="annottext">Status -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx.
MonadIO m =&gt;
Status -&gt; ActionCtxT ctx m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#setStatus"><span class="hs-identifier hs-var">Spock.setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">(Status -&gt; ActionT m ()) -&gt; Status -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Status
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeStatus"><span class="hs-identifier hs-var">qeStatus</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727910"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1176"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; ActionT m ()
forall (m :: * -&gt; *) ctx a.
MonadIO m =&gt;
ByteString -&gt; ActionCtxT ctx m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/Spock-core-0.14.0.1-ac70659497cb94be631c2ddc7dcd25c95cdc0de055ef3abf49e1acfb8bb80d84/share/doc/html/src/Web.Spock.Internal.CoreAction.html#lazyBytes"><span class="hs-identifier hs-var">Spock.lazyBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ActionT m ()) -&gt; ByteString -&gt; ActionT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-eb2865ffe23f31228547a6f32a9edc574ee6a6324e10506583c4975c7f9d4b7b/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687727910"><span class="hs-identifier hs-var">qErr</span></a></span><span>
</span><span id="line-1177"></span></pre></body></html>