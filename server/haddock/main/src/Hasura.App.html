<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Imported by 'server/src-exec/Main.hs'.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.App</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier">ExitCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier">DatabaseMigrationError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#DowngradeProcessError"><span class="hs-identifier">DowngradeProcessError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#MetadataCleanError"><span class="hs-identifier">MetadataCleanError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#MetadataExportError"><span class="hs-identifier">MetadataExportError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#SchemaCacheInitError"><span class="hs-identifier">SchemaCacheInitError</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier">ExitException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier">ExitException</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier">GlobalCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier">Loggers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier">PGMetadataStorageAppT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#runPGMetadataStorageAppT"><span class="hs-identifier">runPGMetadataStorageAppT</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier">ServeCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier">ServeCtx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#_scLoggers"><span class="hs-identifier">_scLoggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#_scMetadataDbPool"><span class="hs-identifier">_scMetadataDbPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.App.html#_scShutdownLatch"><span class="hs-identifier">_scShutdownLatch</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier">ShutdownLatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier">accessDeniedErrMsg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.App.html#flushLogger"><span class="hs-identifier">flushLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier">getCatalogStateTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initGlobalCtx"><span class="hs-identifier">initGlobalCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.App.html#initialiseServeCtx"><span class="hs-identifier">initialiseServeCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.App.html#migrateCatalogSchema"><span class="hs-identifier">migrateCatalogSchema</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier">mkLoggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier">mkPGLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Hasura.App.html#newShutdownLatch"><span class="hs-identifier">newShutdownLatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier">notifySchemaCacheSyncTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Hasura.App.html#parseArgs"><span class="hs-identifier">parseArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier">throwErrExit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier">throwErrJExit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Hasura.App.html#printJSON"><span class="hs-identifier">printJSON</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Hasura.App.html#printYaml"><span class="hs-identifier">printYaml</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Hasura.App.html#readTlsAllowlist"><span class="hs-identifier">readTlsAllowlist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier">resolvePostgresConnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Hasura.App.html#runHGEServer"><span class="hs-identifier">runHGEServer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier">setCatalogStateTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.App.html#shutdownGracefully"><span class="hs-identifier">shutdownGracefully</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Hasura.App.html#waitForShutdown"><span class="hs-identifier">waitForShutdown</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Hasura.App.html#shuttingDown"><span class="hs-identifier">shuttingDown</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exported for testing</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier">mkHGEServer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier">mkPgSourceResolver</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier">mkMSSQLSourceResolver</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async.Lifted.Safe</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Concurrent.Extended.html"><span class="hs-identifier">Control.Concurrent.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Concurrent.STM.TVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">readTVarIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">bracket_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">MonadCatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">MonadMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">MonadThrow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier">onException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Morph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hoist</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Monad.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">atomically</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Stateless.html"><span class="hs-identifier">Control.Monad.Stateless</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBaseControl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Trans.Managed.html"><span class="hs-identifier">Control.Monad.Trans.Managed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier">ManagedT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#allocate_"><span class="hs-identifier">allocate_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Retry</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Retry</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BC</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BLC</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Environment.html"><span class="hs-identifier">Data.Environment</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.FileEmbed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeRelativeToProject</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">Data.Time.Clock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Clock</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Yaml</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Y</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.MSSQL.Pool.html"><span class="hs-identifier">Database.MSSQL.Pool</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MSPool</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.AssertNF.CPP.html"><span class="hs-identifier">GHC.AssertNF.CPP</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html"><span class="hs-identifier">Hasura.Backends.MSSQL.Connection</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html"><span class="hs-identifier">Hasura.Eventing.Common</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.EventTrigger.html"><span class="hs-identifier">Hasura.Eventing.EventTrigger</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html"><span class="hs-identifier">Hasura.Eventing.ScheduledTrigger</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.html"><span class="hs-identifier">Hasura.GraphQL.Execute</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#ExecutionStep"><span class="hs-identifier">ExecutionStep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier">MonadGQLExecutionCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.html#checkQueryInAllowlist"><span class="hs-identifier">checkQueryInAllowlist</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Action.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Action</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Action.Subscription.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Action.Subscription</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Backend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EB</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Poll</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.html"><span class="hs-identifier">Hasura.GraphQL.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier">MonadQueryLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html"><span class="hs-identifier">Hasura.GraphQL.Schema.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Options</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#CacheStoreSuccess"><span class="hs-identifier">CacheStoreSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#CacheStoreSkipped"><span class="hs-identifier">CacheStoreSkipped</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier">MonadExecuteQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#toParsed"><span class="hs-identifier">toParsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Server</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Cache.Common</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Catalog.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Catalog</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html"><span class="hs-identifier">Hasura.RQL.Types.Allowlist</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Eventing.Backend</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Network.html"><span class="hs-identifier">Hasura.RQL.Types.Network</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ResizePool.html"><span class="hs-identifier">Hasura.RQL.Types.ResizePool</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html"><span class="hs-identifier">Hasura.SQL.Backend</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.API.Query.html"><span class="hs-identifier">Hasura.Server.API.Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.API.Query.html#requiresAdmin"><span class="hs-identifier">requiresAdmin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.App.html"><span class="hs-identifier">Hasura.Server.App</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.CheckUpdates.html"><span class="hs-identifier">Hasura.Server.CheckUpdates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.CheckUpdates.html#checkForUpdates"><span class="hs-identifier">checkForUpdates</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html"><span class="hs-identifier">Hasura.Server.Init</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html"><span class="hs-identifier">Hasura.Server.Limits</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Metrics.html"><span class="hs-identifier">Hasura.Server.Metrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier">ServerMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Migrate.html"><span class="hs-identifier">Hasura.Server.Migrate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Migrate.html#migrateCatalog"><span class="hs-identifier">migrateCatalog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html"><span class="hs-identifier">Hasura.Server.Prometheus</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html#PrometheusMetrics"><span class="hs-identifier">PrometheusMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="Hasura.Server.Prometheus.html#decWarpThreads"><span class="hs-identifier">decWarpThreads</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="Hasura.Server.Prometheus.html#incWarpThreads"><span class="hs-identifier">incWarpThreads</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html"><span class="hs-identifier">Hasura.Server.SchemaCacheRef</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier">SchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier">getSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#initialiseSchemaCacheRef"><span class="hs-identifier">initialiseSchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#logInconsistentMetadata"><span class="hs-identifier">logInconsistentMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaUpdate.html"><span class="hs-identifier">Hasura.Server.SchemaUpdate</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Telemetry.html"><span class="hs-identifier">Hasura.Server.Telemetry</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Version.html"><span class="hs-identifier">Hasura.Server.Version</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Blocklisting.html"><span class="hs-identifier">Network.HTTP.Client.Blocklisting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Blocklisting.html#Blocklist"><span class="hs-identifier">Blocklist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.CreateManager.html"><span class="hs-identifier">Network.HTTP.Client.CreateManager</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.CreateManager.html#mkHttpManager"><span class="hs-identifier">mkHttpManager</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Manager.html"><span class="hs-identifier">Network.HTTP.Client.Manager</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP.Client.Manager.html#HasHttpManagerM"><span class="hs-identifier">HasHttpManagerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP.Client.Transformable.html"><span class="hs-identifier">Network.HTTP.Client.Transformable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Warp</span></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Options.Applicative</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Refined</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unrefine</span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">System.Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">getEnvironment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Log.FastLogger</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FL</span></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Metrics</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG</span></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Metrics.Gauge</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG.Gauge</span></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Mustache.Compile</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Spock.Core</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spock</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">data</span><span> </span><span id="ExitCode"><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-var">ExitCode</span></a></span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- these are used during server initialization:</span><span>
</span><span id="line-165"></span><span>    </span><span id="InvalidEnvironmentVariableOptionsError"><span class="annot"><a href="Hasura.App.html#InvalidEnvironmentVariableOptionsError"><span class="hs-identifier hs-var">InvalidEnvironmentVariableOptionsError</span></a></span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="InvalidDatabaseConnectionParamsError"><span class="annot"><a href="Hasura.App.html#InvalidDatabaseConnectionParamsError"><span class="hs-identifier hs-var">InvalidDatabaseConnectionParamsError</span></a></span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AuthConfigurationError"><span class="annot"><a href="Hasura.App.html#AuthConfigurationError"><span class="hs-identifier hs-var">AuthConfigurationError</span></a></span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EventSubSystemError"><span class="annot"><a href="Hasura.App.html#EventSubSystemError"><span class="hs-identifier hs-var">EventSubSystemError</span></a></span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DatabaseMigrationError"><span class="annot"><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | used by MT because it initialises the schema cache only</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- these are used in app/Main.hs:</span><span>
</span><span id="line-172"></span><span>    </span><span id="SchemaCacheInitError"><span class="annot"><a href="Hasura.App.html#SchemaCacheInitError"><span class="hs-identifier hs-var">SchemaCacheInitError</span></a></span></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MetadataExportError"><span class="annot"><a href="Hasura.App.html#MetadataExportError"><span class="hs-identifier hs-var">MetadataExportError</span></a></span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MetadataCleanError"><span class="annot"><a href="Hasura.App.html#MetadataCleanError"><span class="hs-identifier hs-var">MetadataCleanError</span></a></span></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ExecuteProcessError"><span class="annot"><a href="Hasura.App.html#ExecuteProcessError"><span class="hs-identifier hs-var">ExecuteProcessError</span></a></span></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DowngradeProcessError"><span class="annot"><a href="Hasura.App.html#DowngradeProcessError"><span class="hs-identifier hs-var">DowngradeProcessError</span></a></span></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690649600"><span id="local-6989586621690649602"><span id="local-6989586621690649604"><span class="annot"><span class="annottext">Int -&gt; ExitCode -&gt; ShowS
[ExitCode] -&gt; ShowS
ExitCode -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ExitCode] -&gt; ShowS
$cshowList :: [ExitCode] -&gt; ShowS
show :: ExitCode -&gt; String
$cshow :: ExitCode -&gt; String
showsPrec :: Int -&gt; ExitCode -&gt; ShowS
$cshowsPrec :: Int -&gt; ExitCode -&gt; ShowS
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">data</span><span> </span><span id="ExitException"><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ExitException"><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="eeCode"><span class="annot"><span class="annottext">ExitException -&gt; ExitCode
</span><a href="Hasura.App.html#eeCode"><span class="hs-identifier hs-var hs-var">eeCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-181"></span><span>    </span><span id="eeMessage"><span class="annot"><span class="annottext">ExitException -&gt; ByteString
</span><a href="Hasura.App.html#eeMessage"><span class="hs-identifier hs-var hs-var">eeMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-type">BC.ByteString</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690649586"><span id="local-6989586621690649588"><span id="local-6989586621690649595"><span class="annot"><span class="annottext">Int -&gt; ExitException -&gt; ShowS
[ExitException] -&gt; ShowS
ExitException -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ExitException] -&gt; ShowS
$cshowList :: [ExitException] -&gt; ShowS
show :: ExitException -&gt; String
$cshow :: ExitException -&gt; String
showsPrec :: Int -&gt; ExitException -&gt; ShowS
$cshowsPrec :: Int -&gt; ExitException -&gt; ShowS
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649576"><span id="local-6989586621690649578"><span id="local-6989586621690649580"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-type">ExitException</span></a></span></span></span></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span id="local-6989586621690650631"><span class="annot"><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-type">throwErrExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650631"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690650630"><span class="annot"><a href="#local-6989586621690650630"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650631"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650630"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-188"></span><span id="throwErrExit"><span class="annot"><span class="annottext">throwErrExit :: forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var hs-var">throwErrExit</span></a></span></span><span> </span><span id="local-6989586621690649571"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621690649571"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; ByteString -&gt; ExitException
</span><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621690649571"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BC.pack</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span id="local-6989586621690650619"><span id="local-6989586621690650620"><span class="annot"><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-type">throwErrJExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621690650620"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650619"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690650618"><span class="annot"><a href="#local-6989586621690650618"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Hasura.App.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650620"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650619"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650618"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-191"></span><span id="throwErrJExit"><span class="annot"><span class="annottext">throwErrJExit :: forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var hs-var">throwErrJExit</span></a></span></span><span> </span><span id="local-6989586621690649562"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621690649562"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; ByteString -&gt; ExitException
</span><a href="Hasura.App.html#ExitException"><span class="hs-identifier hs-var">ExitException</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621690649562"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BLC.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">A.encode</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- TODO(SOLOMON): Move Into `Hasura.Server.Init`. Unable to do so</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- currently due `throwErrExit`.</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- | Parse cli arguments to graphql-engine executable.</span><span>
</span><span id="line-198"></span><span id="local-6989586621690650612"><span class="annot"><a href="Hasura.App.html#parseArgs"><span class="hs-identifier hs-type">parseArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650612"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-type">HGEOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650612"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-199"></span><span id="parseArgs"><span class="annot"><span class="annottext">parseArgs :: forall impl.
EnabledLogTypes impl =&gt;
IO (HGEOptions (ServeOptions impl))
</span><a href="Hasura.App.html#parseArgs"><span class="hs-identifier hs-var hs-var">parseArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621690649552"><span class="annot"><span class="annottext">HGEOptionsRaw (ServeOptionsRaw impl)
</span><a href="#local-6989586621690649552"><span class="hs-identifier hs-var">rawHGEOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. ParserInfo a -&gt; IO a
</span><span class="hs-identifier hs-var">execParser</span></span><span> </span><span class="annot"><span class="annottext">ParserInfo (HGEOptionsRaw (ServeOptionsRaw impl))
</span><a href="#local-6989586621690649550"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621690649549"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621690649549"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(String, String)]
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">getEnvironment</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690649548"><span class="annot"><span class="annottext">eitherOpts :: Either String (HGEOptions (ServeOptions impl))
</span><a href="#local-6989586621690649548"><span class="hs-identifier hs-var hs-var">eitherOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [(String, String)] -&gt; WithEnv a -&gt; Either String a
</span><a href="Hasura.Server.Init.Env.html#runWithEnv"><span class="hs-identifier hs-var">runWithEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621690649549"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
EnabledLogTypes impl =&gt;
HGEOptionsRaw (ServeOptionsRaw impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
</span><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-var">mkHGEOptions</span></a></span><span> </span><span class="annot"><span class="annottext">HGEOptionsRaw (ServeOptionsRaw impl)
</span><a href="#local-6989586621690649552"><span class="hs-identifier hs-var">rawHGEOpts</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either String (HGEOptions (ServeOptions impl))
</span><a href="#local-6989586621690649548"><span class="hs-identifier hs-var">eitherOpts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var">throwErrExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidEnvironmentVariableOptionsError"><span class="hs-identifier hs-var">InvalidEnvironmentVariableOptionsError</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621690649550"><span class="annot"><span class="annottext">opts :: ParserInfo (HGEOptionsRaw (ServeOptionsRaw impl))
</span><a href="#local-6989586621690649550"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">forall a. Parser a -&gt; InfoMod a -&gt; ParserInfo a
</span><span class="hs-identifier hs-var">info</span></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Parser (a -&gt; a)
</span><span class="hs-identifier hs-var">helper</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
EnabledLogTypes impl =&gt;
Parser (HGEOptionsRaw (ServeOptionsRaw impl))
</span><a href="Hasura.Server.Init.Arg.html#parseHgeOpts"><span class="hs-identifier hs-var">parseHgeOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall a. InfoMod a
</span><span class="hs-identifier hs-var">fullDesc</span></span><span>
</span><span id="line-209"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; InfoMod a
</span><span class="hs-identifier hs-var">header</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Hasura GraphQL Engine: Blazing fast, instant realtime GraphQL APIs on your DB with fine grained access control, also trigger webhooks on database events.&quot;</span></span><span>
</span><span id="line-210"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe Doc -&gt; InfoMod a
</span><span class="hs-identifier hs-var">footerDoc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="Hasura.Server.Init.Arg.html#mainCmdFooter"><span class="hs-identifier hs-var">mainCmdFooter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621690650578"><span id="local-6989586621690650579"><span class="annot"><a href="Hasura.App.html#printJSON"><span class="hs-identifier hs-type">printJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621690650579"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650578"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650579"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650578"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-216"></span><span id="printJSON"><span class="annot"><span class="annottext">printJSON :: forall a (m :: * -&gt; *). (ToJSON a, MonadIO m) =&gt; a -&gt; m ()
</span><a href="Hasura.App.html#printJSON"><span class="hs-identifier hs-var hs-var">printJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BLC.putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">A.encode</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="local-6989586621690649525"><span id="local-6989586621690649526"><span class="annot"><a href="Hasura.App.html#printYaml"><span class="hs-identifier hs-type">printYaml</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621690649526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649525"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690649526"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690649525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-219"></span><span id="printYaml"><span class="annot"><span class="annottext">printYaml :: forall a (m :: * -&gt; *). (ToJSON a, MonadIO m) =&gt; a -&gt; m ()
</span><a href="Hasura.App.html#printYaml"><span class="hs-identifier hs-var hs-var">printYaml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BC.putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">Y.encode</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier hs-type">mkPGLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span>
</span><span id="line-222"></span><span id="mkPGLogger"><span class="annot"><span class="annottext">mkPGLogger :: Logger Hasura -&gt; PGLogger
</span><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier hs-var hs-var">mkPGLogger</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621690649517"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690649517"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PLERetryMsg</span></a></span><span> </span><span id="local-6989586621690649515"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690649515"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690649517"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; PGLog
</span><a href="Hasura.Server.Logging.html#PGLog"><span class="hs-identifier hs-var">PGLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690649515"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Context required for all graphql-engine CLI commands</span><span>
</span><span id="line-226"></span><span class="hs-keyword">data</span><span> </span><span id="GlobalCtx"><span class="annot"><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier hs-var">GlobalCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="GlobalCtx"><span class="annot"><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier hs-var">GlobalCtx</span></a></span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_gcMetadataDbConnInfo"><span class="annot"><span class="annottext">GlobalCtx -&gt; ConnInfo
</span><a href="Hasura.App.html#_gcMetadataDbConnInfo"><span class="hs-identifier hs-var hs-var">_gcMetadataDbConnInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-comment">-- | --database-url option, @'UrlConf' is required to construct default source configuration</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- and optional retries</span><span>
</span><span id="line-230"></span><span>    </span><span id="_gcDefaultPostgresConnInfo"><span class="annot"><span class="annottext">GlobalCtx -&gt; (Maybe (UrlConf, ConnInfo), Maybe Int)
</span><a href="Hasura.App.html#_gcDefaultPostgresConnInfo"><span class="hs-identifier hs-var hs-var">_gcDefaultPostgresConnInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">UrlConf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="Hasura.App.html#readTlsAllowlist"><span class="hs-identifier hs-type">readTlsAllowlist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier hs-type">SchemaCacheRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Network.html#TlsAllow"><span class="hs-identifier hs-type">TlsAllow</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span id="readTlsAllowlist"><span class="annot"><span class="annottext">readTlsAllowlist :: SchemaCacheRef -&gt; IO [TlsAllow]
</span><a href="Hasura.App.html#readTlsAllowlist"><span class="hs-identifier hs-var hs-var">readTlsAllowlist</span></a></span></span><span> </span><span id="local-6989586621690649509"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690649509"><span class="hs-identifier hs-var">scRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [TlsAllow]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scTlsAllowlist"><span class="hs-identifier hs-var">scTlsAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690649509"><span class="hs-identifier hs-var">scRef</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span id="local-6989586621690650557"><span class="annot"><a href="Hasura.App.html#initGlobalCtx"><span class="hs-identifier hs-type">initGlobalCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650557"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- | the metadata DB URL</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-comment">-- | the user's DB URL</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">UrlConf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="#local-6989586621690650557"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier hs-type">GlobalCtx</span></a></span></span><span>
</span><span id="line-244"></span><span id="initGlobalCtx"><span class="annot"><span class="annottext">initGlobalCtx :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment
-&gt; Maybe String -&gt; PostgresConnInfo (Maybe UrlConf) -&gt; m GlobalCtx
</span><a href="Hasura.App.html#initGlobalCtx"><span class="hs-identifier hs-var hs-var">initGlobalCtx</span></a></span></span><span> </span><span id="local-6989586621690649494"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690649494"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621690649493"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621690649493"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span></span><span> </span><span id="local-6989586621690649492"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621690649492"><span class="hs-identifier hs-var">defaultPgConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span id="local-6989586621690649490"><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621690649490"><span class="hs-identifier hs-var">dbUrlConf</span></a></span></span><span> </span><span id="local-6989586621690649489"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690649489"><span class="hs-identifier hs-var">maybeRetries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621690649492"><span class="hs-identifier hs-var">defaultPgConnInfo</span></a></span><span>
</span><span id="line-246"></span><span>      </span><span id="local-6989586621690649488"><span class="annot"><span class="annottext">mkConnInfoFromSource :: UrlConf -&gt; m ConnInfo
</span><a href="#local-6989586621690649488"><span class="hs-identifier hs-var hs-var">mkConnInfoFromSource</span></a></span></span><span> </span><span id="local-6989586621690649487"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649487"><span class="hs-identifier hs-var">dbUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment -&gt; UrlConf -&gt; Maybe Int -&gt; m ConnInfo
</span><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-var">resolvePostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690649494"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649487"><span class="hs-identifier hs-var">dbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690649489"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621690649486"><span class="annot"><span class="annottext">mkConnInfoFromMDb :: String -&gt; ConnInfo
</span><a href="#local-6989586621690649486"><span class="hs-identifier hs-var hs-var">mkConnInfoFromMDb</span></a></span></span><span> </span><span id="local-6989586621690649485"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690649485"><span class="hs-identifier hs-var">mdbUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690649484"><span class="annot"><span class="annottext">retries :: Int
</span><a href="#local-6989586621690649484"><span class="hs-identifier hs-var hs-var">retries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690649489"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span>
</span><span id="line-251"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ConnDetails -&gt; ConnInfo
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690649484"><span class="hs-identifier hs-var">retries</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.CDDatabaseURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690649485"><span class="hs-identifier hs-var">mdbUrl</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621690649478"><span class="annot"><span class="annottext">mkGlobalCtx :: ConnInfo -&gt; Maybe (UrlConf, ConnInfo) -&gt; m GlobalCtx
</span><a href="#local-6989586621690649478"><span class="hs-identifier hs-var hs-var">mkGlobalCtx</span></a></span></span><span> </span><span id="local-6989586621690649477"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649477"><span class="hs-identifier hs-var">mdbConnInfo</span></a></span></span><span> </span><span id="local-6989586621690649476"><span class="annot"><span class="annottext">Maybe (UrlConf, ConnInfo)
</span><a href="#local-6989586621690649476"><span class="hs-identifier hs-var">sourceConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; (Maybe (UrlConf, ConnInfo), Maybe Int) -&gt; GlobalCtx
</span><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier hs-var">GlobalCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649477"><span class="hs-identifier hs-var">mdbConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (UrlConf, ConnInfo)
</span><a href="#local-6989586621690649476"><span class="hs-identifier hs-var">sourceConnInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690649489"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621690649493"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621690649490"><span class="hs-identifier hs-var">dbUrlConf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var">throwErrExit</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidDatabaseConnectionParamsError"><span class="hs-identifier hs-var">InvalidDatabaseConnectionParamsError</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Fatal Error: Either of --metadata-database-url or --database-url option expected&quot;</span></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-comment">-- If no metadata storage specified consider use default database as</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-comment">-- metadata storage</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690649475"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649475"><span class="hs-identifier hs-var">dbUrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>      </span><span id="local-6989586621690649474"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649474"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrlConf -&gt; m ConnInfo
</span><a href="#local-6989586621690649488"><span class="hs-identifier hs-var">mkConnInfoFromSource</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649475"><span class="hs-identifier hs-var">dbUrl</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">ConnInfo -&gt; Maybe (UrlConf, ConnInfo) -&gt; m GlobalCtx
</span><a href="#local-6989586621690649478"><span class="hs-identifier hs-var">mkGlobalCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649474"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649475"><span class="hs-identifier hs-var">dbUrl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649474"><span class="hs-identifier hs-var">connInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690649473"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690649473"><span class="hs-identifier hs-var">mdUrl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690649472"><span class="annot"><span class="annottext">mdConnInfo :: ConnInfo
</span><a href="#local-6989586621690649472"><span class="hs-identifier hs-var hs-var">mdConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ConnInfo
</span><a href="#local-6989586621690649486"><span class="hs-identifier hs-var">mkConnInfoFromMDb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690649473"><span class="hs-identifier hs-var">mdUrl</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><span class="annottext">ConnInfo -&gt; Maybe (UrlConf, ConnInfo) -&gt; m GlobalCtx
</span><a href="#local-6989586621690649478"><span class="hs-identifier hs-var">mkGlobalCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649472"><span class="hs-identifier hs-var">mdConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690649471"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690649471"><span class="hs-identifier hs-var">mdUrl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621690649470"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649470"><span class="hs-identifier hs-var">dbUrl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>      </span><span id="local-6989586621690649469"><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649469"><span class="hs-identifier hs-var">srcConnInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrlConf -&gt; m ConnInfo
</span><a href="#local-6989586621690649488"><span class="hs-identifier hs-var">mkConnInfoFromSource</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649470"><span class="hs-identifier hs-var">dbUrl</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690649468"><span class="annot"><span class="annottext">mdConnInfo :: ConnInfo
</span><a href="#local-6989586621690649468"><span class="hs-identifier hs-var hs-var">mdConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ConnInfo
</span><a href="#local-6989586621690649486"><span class="hs-identifier hs-var">mkConnInfoFromMDb</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690649471"><span class="hs-identifier hs-var">mdUrl</span></a></span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><span class="annottext">ConnInfo -&gt; Maybe (UrlConf, ConnInfo) -&gt; m GlobalCtx
</span><a href="#local-6989586621690649478"><span class="hs-identifier hs-var">mkGlobalCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649468"><span class="hs-identifier hs-var">mdConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649470"><span class="hs-identifier hs-var">dbUrl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649469"><span class="hs-identifier hs-var">srcConnInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">-- | Context required for the 'serve' CLI command.</span><span>
</span><span id="line-275"></span><span class="hs-keyword">data</span><span> </span><span id="ServeCtx"><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-var">ServeCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ServeCtx"><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-var">ServeCtx</span></a></span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_scHttpManager"><span class="annot"><span class="annottext">ServeCtx -&gt; Manager
</span><a href="Hasura.App.html#_scHttpManager"><span class="hs-identifier hs-var hs-var">_scHttpManager</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">HTTP.Manager</span></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>    </span><span id="_scInstanceId"><span class="annot"><span class="annottext">ServeCtx -&gt; InstanceId
</span><a href="Hasura.App.html#_scInstanceId"><span class="hs-identifier hs-var hs-var">_scInstanceId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">InstanceId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>    </span><span id="_scLoggers"><span class="annot"><span class="annottext">ServeCtx -&gt; Loggers
</span><a href="Hasura.App.html#_scLoggers"><span class="hs-identifier hs-var hs-var">_scLoggers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>    </span><span id="_scEnabledLogTypes"><span class="annot"><span class="annottext">ServeCtx -&gt; HashSet (EngineLogType Hasura)
</span><a href="Hasura.App.html#_scEnabledLogTypes"><span class="hs-identifier hs-var hs-var">_scEnabledLogTypes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EngineLogType"><span class="hs-identifier hs-type">EngineLogType</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>    </span><span id="_scMetadataDbPool"><span class="annot"><span class="annottext">ServeCtx -&gt; PGPool
</span><a href="Hasura.App.html#_scMetadataDbPool"><span class="hs-identifier hs-var hs-var">_scMetadataDbPool</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>    </span><span id="_scShutdownLatch"><span class="annot"><span class="annottext">ServeCtx -&gt; ShutdownLatch
</span><a href="Hasura.App.html#_scShutdownLatch"><span class="hs-identifier hs-var hs-var">_scShutdownLatch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-type">ShutdownLatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>    </span><span id="_scSchemaCache"><span class="annot"><span class="annottext">ServeCtx -&gt; RebuildableSchemaCache
</span><a href="Hasura.App.html#_scSchemaCache"><span class="hs-identifier hs-var hs-var">_scSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>    </span><span id="_scSchemaCacheRef"><span class="annot"><span class="annottext">ServeCtx -&gt; SchemaCacheRef
</span><a href="Hasura.App.html#_scSchemaCacheRef"><span class="hs-identifier hs-var hs-var">_scSchemaCacheRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hasura.Server.SchemaCacheRef.html#SchemaCacheRef"><span class="hs-identifier hs-type">SchemaCacheRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>    </span><span id="_scMetaVersionRef"><span class="annot"><span class="annottext">ServeCtx -&gt; TMVar MetadataResourceVersion
</span><a href="Hasura.App.html#_scMetaVersionRef"><span class="hs-identifier hs-var hs-var">_scMetaVersionRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-type">STM.TMVar</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- | Collection of the LoggerCtx, the regular Logger and the PGLogger</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- TODO (from master): better naming?</span><span>
</span><span id="line-289"></span><span class="hs-keyword">data</span><span> </span><span id="Loggers"><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-var">Loggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Loggers"><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-var">Loggers</span></a></span></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_lsLoggerCtx"><span class="annot"><span class="annottext">Loggers -&gt; LoggerCtx Hasura
</span><a href="Hasura.App.html#_lsLoggerCtx"><span class="hs-identifier hs-var hs-var">_lsLoggerCtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#LoggerCtx"><span class="hs-identifier hs-type">LoggerCtx</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-291"></span><span>    </span><span id="_lsLogger"><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.html#_lsLogger"><span class="hs-identifier hs-var hs-var">_lsLogger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-292"></span><span>    </span><span id="_lsPgLogger"><span class="annot"><span class="annottext">Loggers -&gt; PGLogger
</span><a href="Hasura.App.html#_lsPgLogger"><span class="hs-identifier hs-var hs-var">_lsPgLogger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | An application with Postgres database as a metadata storage</span><span>
</span><span id="line-296"></span><span class="hs-keyword">newtype</span><span> </span><span id="PGMetadataStorageAppT"><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-var">PGMetadataStorageAppT</span></a></span></span><span> </span><span id="local-6989586621690650537"><span class="annot"><a href="#local-6989586621690650537"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621690650536"><span class="annot"><a href="#local-6989586621690650536"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PGMetadataStorageAppT"><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-var">PGMetadataStorageAppT</span></a></span></span><span> </span><span class="hs-special">{</span><span id="runPGMetadataStorageAppT"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
PGMetadataStorageAppT m a -&gt; (PGPool, PGLogger) -&gt; m a
</span><a href="Hasura.App.html#runPGMetadataStorageAppT"><span class="hs-identifier hs-var hs-var">runPGMetadataStorageAppT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650536"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621690649449"><span id="local-6989586621690649454"><span class="annot"><span class="annottext">forall a b.
a -&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
forall a b.
(a -&gt; b) -&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b.
a -&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
fmap :: forall a b.
(a -&gt; b) -&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-299"></span><span>      </span><span id="local-6989586621690649422"><span id="local-6989586621690649426"><span id="local-6989586621690649430"><span id="local-6989586621690649434"><span id="local-6989586621690649439"><span class="annot"><span class="annottext">forall a. a -&gt; PGMetadataStorageAppT m a
forall a b.
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
forall a b.
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
forall a b.
PGMetadataStorageAppT m (a -&gt; b)
-&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b
-&gt; PGMetadataStorageAppT m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall {m :: * -&gt; *}.
Applicative m =&gt;
Functor (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) a.
Applicative m =&gt;
a -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
PGMetadataStorageAppT m (a -&gt; b)
-&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b
-&gt; PGMetadataStorageAppT m c
&lt;* :: forall a b.
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
$c&lt;* :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m a
*&gt; :: forall a b.
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
$c*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b
-&gt; PGMetadataStorageAppT m c
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b
-&gt; PGMetadataStorageAppT m c
&lt;*&gt; :: forall a b.
PGMetadataStorageAppT m (a -&gt; b)
-&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
PGMetadataStorageAppT m (a -&gt; b)
-&gt; PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m b
pure :: forall a. a -&gt; PGMetadataStorageAppT m a
$cpure :: forall (m :: * -&gt; *) a.
Applicative m =&gt;
a -&gt; PGMetadataStorageAppT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>      </span><span id="local-6989586621690649402"><span id="local-6989586621690649406"><span id="local-6989586621690649411"><span class="annot"><span class="annottext">forall a. a -&gt; PGMetadataStorageAppT m a
forall a b.
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
forall a b.
PGMetadataStorageAppT m a
-&gt; (a -&gt; PGMetadataStorageAppT m b) -&gt; PGMetadataStorageAppT m b
forall {m :: * -&gt; *}.
Monad m =&gt;
Applicative (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
PGMetadataStorageAppT m a
-&gt; (a -&gt; PGMetadataStorageAppT m b) -&gt; PGMetadataStorageAppT m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; PGMetadataStorageAppT m a
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; PGMetadataStorageAppT m a
&gt;&gt; :: forall a b.
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
PGMetadataStorageAppT m a
-&gt; PGMetadataStorageAppT m b -&gt; PGMetadataStorageAppT m b
&gt;&gt;= :: forall a b.
PGMetadataStorageAppT m a
-&gt; (a -&gt; PGMetadataStorageAppT m b) -&gt; PGMetadataStorageAppT m b
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
PGMetadataStorageAppT m a
-&gt; (a -&gt; PGMetadataStorageAppT m b) -&gt; PGMetadataStorageAppT m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>      </span><span id="local-6989586621690649392"><span class="annot"><span class="annottext">forall a. IO a -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {m :: * -&gt; *}. MonadIO m =&gt; Monad (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
IO a -&gt; PGMetadataStorageAppT m a
liftIO :: forall a. IO a -&gt; PGMetadataStorageAppT m a
$cliftIO :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
IO a -&gt; PGMetadataStorageAppT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>      </span><span id="local-6989586621690649381"><span class="annot"><span class="annottext">forall a.
(a -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
forall {m :: * -&gt; *}. MonadFix m =&gt; Monad (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
mfix :: forall a.
(a -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
$cmfix :: forall (m :: * -&gt; *) a.
MonadFix m =&gt;
(a -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>      </span><span id="local-6989586621690649366"><span class="annot"><span class="annottext">forall e a.
Exception e =&gt;
PGMetadataStorageAppT m a
-&gt; (e -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *).
MonadThrow m
-&gt; (forall e a. Exception e =&gt; m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
forall {m :: * -&gt; *}.
MonadCatch m =&gt;
MonadThrow (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
PGMetadataStorageAppT m a
-&gt; (e -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
catch :: forall e a.
Exception e =&gt;
PGMetadataStorageAppT m a
-&gt; (e -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
$ccatch :: forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
PGMetadataStorageAppT m a
-&gt; (e -&gt; PGMetadataStorageAppT m a) -&gt; PGMetadataStorageAppT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>      </span><span id="local-6989586621690649350"><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; PGMetadataStorageAppT m a
forall (m :: * -&gt; *).
Monad m -&gt; (forall e a. Exception e =&gt; e -&gt; m a) -&gt; MonadThrow m
forall {m :: * -&gt; *}.
MonadThrow m =&gt;
Monad (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; PGMetadataStorageAppT m a
throwM :: forall e a. Exception e =&gt; e -&gt; PGMetadataStorageAppT m a
$cthrowM :: forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; PGMetadataStorageAppT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>      </span><span id="local-6989586621690649328"><span id="local-6989586621690649332"><span id="local-6989586621690649337"><span class="annot"><span class="annottext">forall b.
((forall a. PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m a)
 -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m b
forall a b c.
PGMetadataStorageAppT m a
-&gt; (a -&gt; ExitCase b -&gt; PGMetadataStorageAppT m c)
-&gt; (a -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m (b, c)
forall {m :: * -&gt; *}.
MonadMask m =&gt;
MonadCatch (PGMetadataStorageAppT m)
forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m a)
 -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m b
forall (m :: * -&gt; *) a b c.
MonadMask m =&gt;
PGMetadataStorageAppT m a
-&gt; (a -&gt; ExitCase b -&gt; PGMetadataStorageAppT m c)
-&gt; (a -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m (b, c)
forall (m :: * -&gt; *).
MonadCatch m
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b. ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
generalBracket :: forall a b c.
PGMetadataStorageAppT m a
-&gt; (a -&gt; ExitCase b -&gt; PGMetadataStorageAppT m c)
-&gt; (a -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m (b, c)
$cgeneralBracket :: forall (m :: * -&gt; *) a b c.
MonadMask m =&gt;
PGMetadataStorageAppT m a
-&gt; (a -&gt; ExitCase b -&gt; PGMetadataStorageAppT m c)
-&gt; (a -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m (b, c)
uninterruptibleMask :: forall b.
((forall a. PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m a)
 -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m b
$cuninterruptibleMask :: forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m a)
 -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m b
mask :: forall b.
((forall a. PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m a)
 -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m b
$cmask :: forall (m :: * -&gt; *) b.
MonadMask m =&gt;
((forall a. PGMetadataStorageAppT m a -&gt; PGMetadataStorageAppT m a)
 -&gt; PGMetadataStorageAppT m b)
-&gt; PGMetadataStorageAppT m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMask</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>      </span><span id="local-6989586621690649317"><span class="annot"><span class="annottext">PGMetadataStorageAppT m Manager
forall (m :: * -&gt; *). Monad m -&gt; m Manager -&gt; HasHttpManagerM m
forall {m :: * -&gt; *}.
HasHttpManagerM m =&gt;
Monad (PGMetadataStorageAppT m)
forall (m :: * -&gt; *).
HasHttpManagerM m =&gt;
PGMetadataStorageAppT m Manager
askHttpManager :: PGMetadataStorageAppT m Manager
$caskHttpManager :: forall (m :: * -&gt; *).
HasHttpManagerM m =&gt;
PGMetadataStorageAppT m Manager
</span><a href="Network.HTTP.Client.Manager.html#C%3AHasHttpManagerM"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasHttpManagerM</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>      </span><span id="local-6989586621690649305"><span class="annot"><span class="annottext">PGMetadataStorageAppT m ServerConfigCtx
forall (m :: * -&gt; *).
Monad m -&gt; m ServerConfigCtx -&gt; HasServerConfigCtx m
forall {m :: * -&gt; *}.
HasServerConfigCtx m =&gt;
Monad (PGMetadataStorageAppT m)
forall (m :: * -&gt; *).
HasServerConfigCtx m =&gt;
PGMetadataStorageAppT m ServerConfigCtx
askServerConfigCtx :: PGMetadataStorageAppT m ServerConfigCtx
$caskServerConfigCtx :: forall (m :: * -&gt; *).
HasServerConfigCtx m =&gt;
PGMetadataStorageAppT m ServerConfigCtx
</span><a href="Hasura.Server.Types.html#C%3AHasServerConfigCtx"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">HasServerConfigCtx</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-308"></span><span>      </span><span id="local-6989586621690649285"><span id="local-6989586621690649289"><span id="local-6989586621690649294"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621690649266"><span id="local-6989586621690650408"><span class="annot"><span class="hs-identifier hs-type">MonadBase</span></span><span> </span><span class="annot"><a href="#local-6989586621690650408"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>      </span><span id="local-6989586621690649245"><span id="local-6989586621690649251"><span id="local-6989586621690650392"><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="#local-6989586621690650392"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690650537"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621690649235"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PGMetadataStorageAppT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a) -&gt; MonadTrans t
lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PGMetadataStorageAppT m a
$clift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; PGMetadataStorageAppT m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">MonadTrans</span></a></span></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span id="local-6989586621690650552"><span class="annot"><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-type">resolvePostgresConnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">UrlConf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ConnInfo</span></a></span></span><span>
</span><span id="line-320"></span><span id="resolvePostgresConnInfo"><span class="annot"><span class="annottext">resolvePostgresConnInfo :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Environment -&gt; UrlConf -&gt; Maybe Int -&gt; m ConnInfo
</span><a href="Hasura.App.html#resolvePostgresConnInfo"><span class="hs-identifier hs-var hs-var">resolvePostgresConnInfo</span></a></span></span><span> </span><span id="local-6989586621690649213"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690649213"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621690649212"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649212"><span class="hs-identifier hs-var">dbUrlConf</span></a></span></span><span> </span><span id="local-6989586621690649211"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690649211"><span class="hs-identifier hs-var">maybeRetries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>  </span><span id="local-6989586621690649210"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690649210"><span class="hs-identifier hs-var">dbUrlText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><span class="annottext">forall e a. Except e a -&gt; Either e a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExcept</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Environment -&gt; UrlConf -&gt; m Text
</span><a href="Hasura.RQL.Types.Common.html#resolveUrlConf"><span class="hs-identifier hs-var">resolveUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690649213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649212"><span class="hs-identifier hs-var">dbUrlConf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690649207"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690649207"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#InvalidDatabaseConnectionParamsError"><span class="hs-identifier hs-var">InvalidDatabaseConnectionParamsError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690649207"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ConnDetails -&gt; ConnInfo
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690649206"><span class="hs-identifier hs-var">retries</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.CDDatabaseURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690649210"><span class="hs-identifier hs-var">dbUrlText</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621690649206"><span class="annot"><span class="annottext">retries :: Int
</span><a href="#local-6989586621690649206"><span class="hs-identifier hs-var hs-var">retries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690649211"><span class="hs-identifier hs-var">maybeRetries</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | Initializes or migrates the catalog and returns the context required to start the server.</span><span>
</span><span id="line-329"></span><span id="local-6989586621690650379"><span class="annot"><a href="Hasura.App.html#initialiseServeCtx"><span class="hs-identifier hs-type">initialiseServeCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#ForkableMonadIO"><span class="hs-identifier hs-type">C.ForkableMonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650379"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-type">MonadCatch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650379"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier hs-type">GlobalCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier hs-type">ServerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650379"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-type">ServeCtx</span></a></span></span><span>
</span><span id="line-336"></span><span id="initialiseServeCtx"><span class="annot"><span class="annottext">initialiseServeCtx :: forall (m :: * -&gt; *).
(ForkableMonadIO m, MonadCatch m) =&gt;
Environment
-&gt; GlobalCtx
-&gt; ServeOptions Hasura
-&gt; ServerMetrics
-&gt; ManagedT m ServeCtx
</span><a href="Hasura.App.html#initialiseServeCtx"><span class="hs-identifier hs-var hs-var">initialiseServeCtx</span></a></span></span><span> </span><span id="local-6989586621690649124"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690649124"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><a href="Hasura.App.html#GlobalCtx"><span class="hs-identifier hs-type">GlobalCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690649122"><span id="local-6989586621690649123"><span class="annot"><span class="annottext">(Maybe (UrlConf, ConnInfo), Maybe Int)
ConnInfo
_gcDefaultPostgresConnInfo :: (Maybe (UrlConf, ConnInfo), Maybe Int)
_gcMetadataDbConnInfo :: ConnInfo
_gcDefaultPostgresConnInfo :: GlobalCtx -&gt; (Maybe (UrlConf, ConnInfo), Maybe Int)
_gcMetadataDbConnInfo :: GlobalCtx -&gt; ConnInfo
</span><a href="#local-6989586621690649122"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621690649121"><span class="annot"><span class="annottext">so :: ServeOptions Hasura
</span><a href="#local-6989586621690649121"><span class="hs-identifier hs-var">so</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690649079"><span id="local-6989586621690649080"><span id="local-6989586621690649081"><span id="local-6989586621690649082"><span id="local-6989586621690649083"><span id="local-6989586621690649084"><span id="local-6989586621690649085"><span id="local-6989586621690649086"><span id="local-6989586621690649087"><span id="local-6989586621690649088"><span id="local-6989586621690649089"><span id="local-6989586621690649090"><span id="local-6989586621690649091"><span id="local-6989586621690649092"><span id="local-6989586621690649093"><span id="local-6989586621690649094"><span id="local-6989586621690649095"><span id="local-6989586621690649096"><span id="local-6989586621690649097"><span id="local-6989586621690649098"><span id="local-6989586621690649099"><span id="local-6989586621690649100"><span id="local-6989586621690649101"><span id="local-6989586621690649102"><span id="local-6989586621690649103"><span id="local-6989586621690649104"><span id="local-6989586621690649105"><span id="local-6989586621690649106"><span id="local-6989586621690649107"><span id="local-6989586621690649108"><span id="local-6989586621690649109"><span id="local-6989586621690649110"><span id="local-6989586621690649111"><span id="local-6989586621690649112"><span id="local-6989586621690649113"><span id="local-6989586621690649114"><span id="local-6989586621690649115"><span id="local-6989586621690649116"><span id="local-6989586621690649117"><span id="local-6989586621690649118"><span id="local-6989586621690649119"><span class="annot"><span class="annottext">Bool
[JWTConfig]
Maybe Text
Maybe RoleName
Maybe NamingCase
Maybe AuthHook
HashSet (EngineLogType Hasura)
HashSet ExperimentalFeature
HashSet AdminSecretHash
HashSet API
ConnParams
TxIsolation
Refined NonNegative Int
Refined NonNegative Seconds
Refined NonNegative Milliseconds
Refined Positive Int
StreamQueriesOptions
RemoteSchemaPermissions
InferFunctionPermissions
DangerouslyCollapseBooleans
StringifyNumbers
LogLevel
CorsConfig
ExtensionsSchema
EventingMode
ReadOnlyMode
MaintenanceMode ()
MetadataQueryLoggingMode
HostPreference
ConnectionOptions
ResponseInternalErrorsConfig
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
soExtensionsSchema :: forall impl. ServeOptions impl -&gt; ExtensionsSchema
soDefaultNamingConvention :: forall impl. ServeOptions impl -&gt; Maybe NamingCase
soEnableMetadataQueryLogging :: forall impl. ServeOptions impl -&gt; MetadataQueryLoggingMode
soReadOnlyMode :: forall impl. ServeOptions impl -&gt; ReadOnlyMode
soEventingMode :: forall impl. ServeOptions impl -&gt; EventingMode
soWebSocketConnectionInitTimeout :: forall impl. ServeOptions impl -&gt; WSConnectionInitTimeout
soGracefulShutdownTimeout :: forall impl. ServeOptions impl -&gt; Refined NonNegative Seconds
soDevMode :: forall impl. ServeOptions impl -&gt; Bool
soEventsFetchBatchSize :: forall impl. ServeOptions impl -&gt; Refined NonNegative Int
soExperimentalFeatures :: forall impl. ServeOptions impl -&gt; HashSet ExperimentalFeature
soSchemaPollInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEnableMaintenanceMode :: forall impl. ServeOptions impl -&gt; MaintenanceMode ()
soInferFunctionPermissions :: forall impl. ServeOptions impl -&gt; InferFunctionPermissions
soWebSocketKeepAlive :: forall impl. ServeOptions impl -&gt; KeepAliveDelay
soConnectionOptions :: forall impl. ServeOptions impl -&gt; ConnectionOptions
soEnableRemoteSchemaPermissions :: forall impl. ServeOptions impl -&gt; RemoteSchemaPermissions
soAsyncActionsFetchInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEventsFetchInterval :: forall impl. ServeOptions impl -&gt; Refined NonNegative Milliseconds
soEventsHttpPoolSize :: forall impl. ServeOptions impl -&gt; Refined Positive Int
soResponseInternalErrorsConfig :: forall impl. ServeOptions impl -&gt; ResponseInternalErrorsConfig
soLogLevel :: forall impl. ServeOptions impl -&gt; LogLevel
soEnabledLogTypes :: forall impl. ServeOptions impl -&gt; HashSet (EngineLogType impl)
soEnableAllowlist :: forall impl. ServeOptions impl -&gt; Bool
soStreamingQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soLiveQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soEnabledAPIs :: forall impl. ServeOptions impl -&gt; HashSet API
soDangerousBooleanCollapse :: forall impl. ServeOptions impl -&gt; DangerouslyCollapseBooleans
soStringifyNum :: forall impl. ServeOptions impl -&gt; StringifyNumbers
soEnableTelemetry :: forall impl. ServeOptions impl -&gt; Bool
soConsoleSentryDsn :: forall impl. ServeOptions impl -&gt; Maybe Text
soConsoleAssetsDir :: forall impl. ServeOptions impl -&gt; Maybe Text
soEnableConsole :: forall impl. ServeOptions impl -&gt; Bool
soCorsConfig :: forall impl. ServeOptions impl -&gt; CorsConfig
soUnAuthRole :: forall impl. ServeOptions impl -&gt; Maybe RoleName
soJwtSecret :: forall impl. ServeOptions impl -&gt; [JWTConfig]
soAuthHook :: forall impl. ServeOptions impl -&gt; Maybe AuthHook
soAdminSecret :: forall impl. ServeOptions impl -&gt; HashSet AdminSecretHash
soTxIso :: forall impl. ServeOptions impl -&gt; TxIsolation
soConnParams :: forall impl. ServeOptions impl -&gt; ConnParams
soHost :: forall impl. ServeOptions impl -&gt; HostPreference
soPort :: forall impl. ServeOptions impl -&gt; Port
soExtensionsSchema :: ExtensionsSchema
soDefaultNamingConvention :: Maybe NamingCase
soEnableMetadataQueryLogging :: MetadataQueryLoggingMode
soReadOnlyMode :: ReadOnlyMode
soEventingMode :: EventingMode
soWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
soGracefulShutdownTimeout :: Refined NonNegative Seconds
soDevMode :: Bool
soEventsFetchBatchSize :: Refined NonNegative Int
soExperimentalFeatures :: HashSet ExperimentalFeature
soSchemaPollInterval :: OptionalInterval
soEnableMaintenanceMode :: MaintenanceMode ()
soInferFunctionPermissions :: InferFunctionPermissions
soWebSocketKeepAlive :: KeepAliveDelay
soConnectionOptions :: ConnectionOptions
soEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
soAsyncActionsFetchInterval :: OptionalInterval
soEventsFetchInterval :: Refined NonNegative Milliseconds
soEventsHttpPoolSize :: Refined Positive Int
soResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
soLogLevel :: LogLevel
soEnabledLogTypes :: HashSet (EngineLogType Hasura)
soEnableAllowlist :: Bool
soStreamingQueryOpts :: StreamQueriesOptions
soLiveQueryOpts :: StreamQueriesOptions
soEnabledAPIs :: HashSet API
soDangerousBooleanCollapse :: DangerouslyCollapseBooleans
soStringifyNum :: StringifyNumbers
soEnableTelemetry :: Bool
soConsoleSentryDsn :: Maybe Text
soConsoleAssetsDir :: Maybe Text
soEnableConsole :: Bool
soCorsConfig :: CorsConfig
soUnAuthRole :: Maybe RoleName
soJwtSecret :: [JWTConfig]
soAuthHook :: Maybe AuthHook
soAdminSecret :: HashSet AdminSecretHash
soTxIso :: TxIsolation
soConnParams :: ConnParams
soHost :: HostPreference
soPort :: Port
</span><a href="Hasura.Server.Init.Config.html#soExtensionsSchema"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621690649037"><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690649037"><span class="hs-identifier hs-var">serverMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621690649036"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690649036"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO InstanceId
</span><a href="Hasura.Server.Types.html#generateInstanceId"><span class="hs-identifier hs-var">generateInstanceId</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621690649034"><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621690649034"><span class="hs-identifier hs-var">latch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ShutdownLatch
</span><a href="Hasura.App.html#newShutdownLatch"><span class="hs-identifier hs-var">newShutdownLatch</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621690649033"><span class="annot"><span class="annottext">loggers :: Loggers
</span><a href="#local-6989586621690649033"><span class="hs-identifier hs-var">loggers</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span><span> </span><span id="local-6989586621690649032"><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690649032"><span class="hs-identifier hs-var">loggerCtx</span></a></span></span><span> </span><span id="local-6989586621690649031"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690649030"><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621690649030"><span class="hs-identifier hs-var">pgLogger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
HashSet (EngineLogType Hasura) -&gt; LogLevel -&gt; ManagedT m Loggers
</span><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier hs-var">mkLoggers</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621690649100"><span class="hs-identifier hs-var">soEnabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621690649099"><span class="hs-identifier hs-var">soLogLevel</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
</span><a href="#local-6989586621690649115"><span class="hs-identifier hs-var">soAdminSecret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621690649027"><span class="hs-identifier hs-type">errMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621690649027"><span class="annot"><span class="annottext">errMsg :: Text
</span><a href="#local-6989586621690649027"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;WARNING: No admin secret provided&quot;</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><a href="Hasura.Server.Logging.html#StartupLog"><span class="hs-identifier hs-type">StartupLog</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slLogLevel :: LogLevel
</span><a href="Hasura.Server.Logging.html#slLogLevel"><span class="hs-identifier hs-var">slLogLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-346"></span><span>          </span><span class="annot"><span class="annottext">slKind :: Text
</span><a href="Hasura.Server.Logging.html#slKind"><span class="hs-identifier hs-var">slKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no_admin_secret&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-347"></span><span>          </span><span class="annot"><span class="annottext">slInfo :: Value
</span><a href="Hasura.Server.Logging.html#slInfo"><span class="hs-identifier hs-var">slInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">A.toJSON</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690649027"><span class="hs-identifier hs-var">errMsg</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-comment">-- log serve options</span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
ToJSON (EngineLogType impl) =&gt;
ServeOptions impl -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#serveOptsToLog"><span class="hs-identifier hs-var">serveOptsToLog</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptions Hasura
</span><a href="#local-6989586621690649121"><span class="hs-identifier hs-var">so</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-comment">-- log postgres connection info</span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#connInfoToLog"><span class="hs-identifier hs-var">connInfoToLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649123"><span class="hs-identifier hs-var">_gcMetadataDbConnInfo</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621690649018"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690649018"><span class="hs-identifier hs-var">metadataDbPool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; ConnParams -&gt; PGLogger -&gt; IO PGPool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.initPGPool</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690649123"><span class="hs-identifier hs-var">_gcMetadataDbConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690649117"><span class="hs-identifier hs-var">soConnParams</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621690649030"><span class="hs-identifier hs-var">pgLogger</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690649016"><span class="annot"><span class="annottext">maybeDefaultSourceConfig :: Maybe PostgresConnConfiguration
</span><a href="#local-6989586621690649016"><span class="hs-identifier hs-var hs-var">maybeDefaultSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (UrlConf, ConnInfo), Maybe Int)
</span><a href="#local-6989586621690649122"><span class="hs-identifier hs-var">_gcDefaultPostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621690649014"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649014"><span class="hs-identifier hs-var">dbUrlConf</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690649013"><span class="annot"><span class="annottext">connSettings :: PostgresPoolSettings
</span><a href="#local-6989586621690649013"><span class="hs-identifier hs-var hs-var">connSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-360"></span><span>                </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresPoolSettings"><span class="hs-identifier hs-type">PostgresPoolSettings</span></a></span><span>
</span><span id="line-361"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_ppsMaxConnections :: Maybe Int
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsMaxConnections"><span class="hs-identifier hs-var">_ppsMaxConnections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams -&gt; Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">Q.cpConns</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690649117"><span class="hs-identifier hs-var">soConnParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-362"></span><span>                    </span><span class="annot"><span class="annottext">_ppsTotalMaxConnections :: Maybe Int
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsTotalMaxConnections"><span class="hs-identifier hs-var">_ppsTotalMaxConnections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-363"></span><span>                    </span><span class="annot"><span class="annottext">_ppsIdleTimeout :: Maybe Int
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsIdleTimeout"><span class="hs-identifier hs-var">_ppsIdleTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams -&gt; Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">Q.cpIdleTime</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690649117"><span class="hs-identifier hs-var">soConnParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-364"></span><span>                    </span><span class="annot"><span class="annottext">_ppsRetries :: Maybe Int
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsRetries"><span class="hs-identifier hs-var">_ppsRetries</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (UrlConf, ConnInfo), Maybe Int)
</span><a href="#local-6989586621690649122"><span class="hs-identifier hs-var">_gcDefaultPostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-365"></span><span>                    </span><span class="annot"><span class="annottext">_ppsPoolTimeout :: Maybe NominalDiffTime
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsPoolTimeout"><span class="hs-identifier hs-var">_ppsPoolTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnParams -&gt; Maybe NominalDiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690649117"><span class="hs-identifier hs-var">soConnParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-366"></span><span>                    </span><span class="annot"><span class="annottext">_ppsConnectionLifetime :: Maybe NominalDiffTime
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsConnectionLifetime"><span class="hs-identifier hs-var">_ppsConnectionLifetime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnParams -&gt; Maybe NominalDiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpMbLifetime</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690649117"><span class="hs-identifier hs-var">soConnParams</span></a></span><span>
</span><span id="line-367"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-368"></span><span>              </span><span id="local-6989586621690649000"><span class="annot"><span class="annottext">sourceConnInfo :: PostgresSourceConnInfo
</span><a href="#local-6989586621690649000"><span class="hs-identifier hs-var hs-var">sourceConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrlConf
-&gt; Maybe PostgresPoolSettings
-&gt; Bool
-&gt; TxIsolation
-&gt; Maybe (PGClientCerts CertVar CertVar)
-&gt; PostgresSourceConnInfo
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresSourceConnInfo"><span class="hs-identifier hs-var">PostgresSourceConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690649014"><span class="hs-identifier hs-var">dbUrlConf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresPoolSettings
</span><a href="#local-6989586621690649013"><span class="hs-identifier hs-var">connSettings</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnParams -&gt; Bool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpAllowPrepare</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690649117"><span class="hs-identifier hs-var">soConnParams</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621690649116"><span class="hs-identifier hs-var">soTxIso</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-369"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PostgresSourceConnInfo
-&gt; Maybe (NonEmpty PostgresSourceConnInfo)
-&gt; ExtensionsSchema
-&gt; PostgresConnConfiguration
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresConnConfiguration"><span class="hs-identifier hs-var">PostgresConnConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresSourceConnInfo
</span><a href="#local-6989586621690649000"><span class="hs-identifier hs-var">sourceConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#defaultPostgresExtensionsSchema"><span class="hs-identifier hs-var">defaultPostgresExtensionsSchema</span></a></span><span>
</span><span id="line-370"></span><span>      </span><span id="local-6989586621690648995"><span class="annot"><span class="annottext">optimizePermissionFilters :: OptimizePermissionFilters
</span><a href="#local-6989586621690648995"><span class="hs-identifier hs-var hs-var">optimizePermissionFilters</span></a></span></span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFOptimizePermissionFilters"><span class="hs-identifier hs-var">EFOptimizePermissionFilters</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690649088"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptimizePermissionFilters
</span><a href="Hasura.GraphQL.Schema.Options.html#OptimizePermissionFilters"><span class="hs-identifier hs-var">Options.OptimizePermissionFilters</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptimizePermissionFilters
</span><a href="Hasura.GraphQL.Schema.Options.html#Don%27tOptimizePermissionFilters"><span class="hs-identifier hs-var">Options.Don'tOptimizePermissionFilters</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>      </span><span id="local-6989586621690648990"><span class="annot"><span class="annottext">bigqueryStringNumericInput :: BigQueryStringNumericInput
</span><a href="#local-6989586621690648990"><span class="hs-identifier hs-var hs-var">bigqueryStringNumericInput</span></a></span></span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFBigQueryStringNumericInput"><span class="hs-identifier hs-var">EFBigQueryStringNumericInput</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690649088"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BigQueryStringNumericInput
</span><a href="Hasura.GraphQL.Schema.Options.html#EnableBigQueryStringNumericInput"><span class="hs-identifier hs-var">Options.EnableBigQueryStringNumericInput</span></a></span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BigQueryStringNumericInput
</span><a href="Hasura.GraphQL.Schema.Options.html#DisableBigQueryStringNumericInput"><span class="hs-identifier hs-var">Options.DisableBigQueryStringNumericInput</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span id="local-6989586621690648986"><span class="annot"><span class="annottext">sqlGenCtx :: SQLGenCtx
</span><a href="#local-6989586621690648986"><span class="hs-identifier hs-var hs-var">sqlGenCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; DangerouslyCollapseBooleans
-&gt; OptimizePermissionFilters
-&gt; BigQueryStringNumericInput
-&gt; SQLGenCtx
</span><a href="Hasura.RQL.Types.Common.html#SQLGenCtx"><span class="hs-identifier hs-var">SQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621690649106"><span class="hs-identifier hs-var">soStringifyNum</span></a></span><span> </span><span class="annot"><span class="annottext">DangerouslyCollapseBooleans
</span><a href="#local-6989586621690649105"><span class="hs-identifier hs-var">soDangerousBooleanCollapse</span></a></span><span> </span><span class="annot"><span class="annottext">OptimizePermissionFilters
</span><a href="#local-6989586621690648995"><span class="hs-identifier hs-var">optimizePermissionFilters</span></a></span><span> </span><span class="annot"><span class="annottext">BigQueryStringNumericInput
</span><a href="#local-6989586621690648990"><span class="hs-identifier hs-var">bigqueryStringNumericInput</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648984"><span class="annot"><span class="annottext">serverConfigCtx :: ServerConfigCtx
</span><a href="#local-6989586621690648984"><span class="hs-identifier hs-var hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; SQLGenCtx
-&gt; MaintenanceMode ()
-&gt; HashSet ExperimentalFeature
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; Maybe NamingCase
-&gt; ServerConfigCtx
</span><a href="Hasura.Server.Types.html#ServerConfigCtx"><span class="hs-identifier hs-var">ServerConfigCtx</span></a></span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621690649091"><span class="hs-identifier hs-var">soInferFunctionPermissions</span></a></span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621690649094"><span class="hs-identifier hs-var">soEnableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621690648986"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-384"></span><span>          </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621690649090"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span><span>
</span><span id="line-385"></span><span>          </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690649088"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span>
</span><span id="line-386"></span><span>          </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621690649083"><span class="hs-identifier hs-var">soEventingMode</span></a></span><span>
</span><span id="line-387"></span><span>          </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621690649082"><span class="hs-identifier hs-var">soReadOnlyMode</span></a></span><span>
</span><span id="line-388"></span><span>          </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621690649080"><span class="hs-identifier hs-var">soDefaultNamingConvention</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>  </span><span id="local-6989586621690648982"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648982"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. MonadCatch m =&gt; m a -&gt; m b -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var">onException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl. MonadIO m =&gt; LoggerCtx impl -&gt; m ()
</span><a href="Hasura.App.html#flushLogger"><span class="hs-identifier hs-var">flushLogger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690649032"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; PGPool
-&gt; Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
-&gt; Blocklist
-&gt; ServerConfigCtx
-&gt; SourceResolver ('Postgres 'Vanilla)
-&gt; SourceResolver 'MSSQL
-&gt; ExtensionsSchema
-&gt; m RebuildableSchemaCache
</span><a href="Hasura.App.html#migrateCatalogSchema"><span class="hs-identifier hs-var">migrateCatalogSchema</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690649124"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-394"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-395"></span><span>        </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690649018"><span class="hs-identifier hs-var">metadataDbPool</span></a></span><span>
</span><span id="line-396"></span><span>        </span><span class="annot"><span class="annottext">Maybe PostgresConnConfiguration
</span><a href="#local-6989586621690649016"><span class="hs-identifier hs-var">maybeDefaultSourceConfig</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690648984"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGLogger -&gt; SourceResolver ('Postgres 'Vanilla)
</span><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-var">mkPgSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621690649030"><span class="hs-identifier hs-var">pgLogger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-var">mkMSSQLSourceResolver</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621690649079"><span class="hs-identifier hs-var">soExtensionsSchema</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-comment">-- Start a background thread for listening schema sync events from other server instances,</span><span>
</span><span id="line-404"></span><span>  </span><span id="local-6989586621690648979"><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621690648979"><span class="hs-identifier hs-var">metaVersionRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO (TMVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-var">STM.newEmptyTMVarIO</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-comment">-- An interval of 0 indicates that no schema sync is required</span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621690649089"><span class="hs-identifier hs-var">soSchemaPollInterval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;schema-sync&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Schema sync disabled&quot;</span></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#Interval"><span class="hs-identifier hs-type">Interval</span></a></span><span> </span><span id="local-6989586621690648973"><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621690648973"><span class="hs-identifier hs-var">interval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;schema-sync&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Schema sync enabled. Polling at &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621690648973"><span class="hs-identifier hs-var">interval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
Logger Hasura
-&gt; PGPool
-&gt; InstanceId
-&gt; Refined NonNegative Milliseconds
-&gt; TMVar MetadataResourceVersion
-&gt; ManagedT m Thread
</span><a href="Hasura.Server.SchemaUpdate.html#startSchemaSyncListenerThread"><span class="hs-identifier hs-var">startSchemaSyncListenerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690649031"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690649018"><span class="hs-identifier hs-var">metadataDbPool</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690649036"><span class="hs-identifier hs-var">instanceId</span></a></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621690648973"><span class="hs-identifier hs-var">interval</span></a></span><span> </span><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621690648979"><span class="hs-identifier hs-var">metaVersionRef</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621690648969"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648969"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadIO m =&gt;
ServerMetrics -&gt; RebuildableSchemaCache -&gt; m SchemaCacheRef
</span><a href="Hasura.Server.SchemaCacheRef.html#initialiseSchemaCacheRef"><span class="hs-identifier hs-var">initialiseSchemaCacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690649037"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648982"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>  </span><span id="local-6989586621690648968"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648968"><span class="hs-identifier hs-var">srvMgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO [TlsAllow] -&gt; Blocklist -&gt; IO Manager
</span><a href="Network.HTTP.Client.CreateManager.html#mkHttpManager"><span class="hs-identifier hs-var">mkHttpManager</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO [TlsAllow]
</span><a href="Hasura.App.html#readTlsAllowlist"><span class="hs-identifier hs-var">readTlsAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648969"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><span class="annottext">Manager
-&gt; InstanceId
-&gt; Loggers
-&gt; HashSet (EngineLogType Hasura)
-&gt; PGPool
-&gt; ShutdownLatch
-&gt; RebuildableSchemaCache
-&gt; SchemaCacheRef
-&gt; TMVar MetadataResourceVersion
-&gt; ServeCtx
</span><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-var">ServeCtx</span></a></span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648968"><span class="hs-identifier hs-var">srvMgr</span></a></span><span>
</span><span id="line-420"></span><span>      </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690649036"><span class="hs-identifier hs-var">instanceId</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621690649033"><span class="hs-identifier hs-var">loggers</span></a></span><span>
</span><span id="line-422"></span><span>      </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621690649100"><span class="hs-identifier hs-var">soEnabledLogTypes</span></a></span><span>
</span><span id="line-423"></span><span>      </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690649018"><span class="hs-identifier hs-var">metadataDbPool</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621690649034"><span class="hs-identifier hs-var">latch</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648982"><span class="hs-identifier hs-var">rebuildableSchemaCache</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648969"><span class="hs-identifier hs-var">schemaCacheRef</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621690648979"><span class="hs-identifier hs-var">metaVersionRef</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span id="local-6989586621690650293"><span class="annot"><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier hs-type">mkLoggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650293"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650293"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EngineLogType"><span class="hs-identifier hs-type">EngineLogType</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#LogLevel"><span class="hs-identifier hs-type">LogLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-433"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650293"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span></span><span>
</span><span id="line-434"></span><span id="mkLoggers"><span class="annot"><span class="annottext">mkLoggers :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
HashSet (EngineLogType Hasura) -&gt; LogLevel -&gt; ManagedT m Loggers
</span><a href="Hasura.App.html#mkLoggers"><span class="hs-identifier hs-var hs-var">mkLoggers</span></a></span></span><span> </span><span id="local-6989586621690648960"><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621690648960"><span class="hs-identifier hs-var">enabledLogs</span></a></span></span><span> </span><span id="local-6989586621690648959"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621690648959"><span class="hs-identifier hs-var">logLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>  </span><span id="local-6989586621690648958"><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690648958"><span class="hs-identifier hs-var">loggerCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (io :: * -&gt; *) impl.
(MonadIO io, MonadBaseControl IO io) =&gt;
LoggerSettings
-&gt; HashSet (EngineLogType impl) -&gt; ManagedT io (LoggerCtx impl)
</span><a href="Hasura.Logging.html#mkLoggerCtx"><span class="hs-identifier hs-var">mkLoggerCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; LogLevel -&gt; LoggerSettings
</span><a href="Hasura.Logging.html#defaultLoggerSettings"><span class="hs-identifier hs-var">defaultLoggerSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621690648959"><span class="hs-identifier hs-var">logLevel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621690648960"><span class="hs-identifier hs-var">enabledLogs</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648955"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621690648955"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
ToJSON (EngineLogType impl) =&gt;
LoggerCtx impl -&gt; Logger impl
</span><a href="Hasura.Logging.html#mkLogger"><span class="hs-identifier hs-var">mkLogger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690648958"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span>
</span><span id="line-437"></span><span>      </span><span id="local-6989586621690648953"><span class="annot"><span class="annottext">pgLogger :: PGLogger
</span><a href="#local-6989586621690648953"><span class="hs-identifier hs-var hs-var">pgLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; PGLogger
</span><a href="Hasura.App.html#mkPGLogger"><span class="hs-identifier hs-var">mkPGLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648955"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura -&gt; Logger Hasura -&gt; PGLogger -&gt; Loggers
</span><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-var">Loggers</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690648958"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648955"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621690648953"><span class="hs-identifier hs-var">pgLogger</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-comment">-- | helper function to initialize or migrate the @hdb_catalog@ schema (used by pro as well)</span><span>
</span><span id="line-441"></span><span id="local-6989586621690650257"><span class="annot"><a href="Hasura.App.html#migrateCatalogSchema"><span class="hs-identifier hs-type">migrateCatalogSchema</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGPool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SourceConnConfiguration"><span class="hs-identifier hs-type">SourceConnConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><a href="Network.HTTP.Client.Blocklisting.html#Blocklist"><span class="hs-identifier hs-type">Blocklist</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#ServerConfigCtx"><span class="hs-identifier hs-type">ServerConfigCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#MSSQL"><span class="hs-identifier hs-type">MSSQL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><a href="Hasura.SQL.Types.html#ExtensionsSchema"><span class="hs-identifier hs-type">ExtensionsSchema</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><a href="#local-6989586621690650257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#RebuildableSchemaCache"><span class="hs-identifier hs-type">RebuildableSchemaCache</span></a></span></span><span>
</span><span id="line-453"></span><span id="migrateCatalogSchema"><span class="annot"><span class="annottext">migrateCatalogSchema :: forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; PGPool
-&gt; Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
-&gt; Blocklist
-&gt; ServerConfigCtx
-&gt; SourceResolver ('Postgres 'Vanilla)
-&gt; SourceResolver 'MSSQL
-&gt; ExtensionsSchema
-&gt; m RebuildableSchemaCache
</span><a href="Hasura.App.html#migrateCatalogSchema"><span class="hs-identifier hs-var hs-var">migrateCatalogSchema</span></a></span></span><span>
</span><span id="line-454"></span><span>  </span><span id="local-6989586621690648907"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648907"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-455"></span><span>  </span><span id="local-6989586621690648906"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648906"><span class="hs-identifier hs-var">logger</span></a></span></span><span>
</span><span id="line-456"></span><span>  </span><span id="local-6989586621690648905"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690648905"><span class="hs-identifier hs-var">pool</span></a></span></span><span>
</span><span id="line-457"></span><span>  </span><span id="local-6989586621690648904"><span class="annot"><span class="annottext">Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
</span><a href="#local-6989586621690648904"><span class="hs-identifier hs-var">defaultSourceConfig</span></a></span></span><span>
</span><span id="line-458"></span><span>  </span><span id="local-6989586621690648903"><span class="annot"><span class="annottext">Blocklist
</span><a href="#local-6989586621690648903"><span class="hs-identifier hs-var">blockList</span></a></span></span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621690648902"><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690648902"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span></span><span>
</span><span id="line-460"></span><span>  </span><span id="local-6989586621690648901"><span class="annot"><span class="annottext">SourceResolver ('Postgres 'Vanilla)
</span><a href="#local-6989586621690648901"><span class="hs-identifier hs-var">pgSourceResolver</span></a></span></span><span>
</span><span id="line-461"></span><span>  </span><span id="local-6989586621690648900"><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="#local-6989586621690648900"><span class="hs-identifier hs-var">mssqlSourceResolver</span></a></span></span><span>
</span><span id="line-462"></span><span>  </span><span id="local-6989586621690648899"><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621690648899"><span class="hs-identifier hs-var">extensionsSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621690648898"><span class="annot"><span class="annottext">Either QErr (MigrationResult, RebuildableSchemaCache)
</span><a href="#local-6989586621690648898"><span class="hs-identifier hs-var">initialiseResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-comment">-- TODO: should we allow the migration to happen during maintenance mode?</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-comment">-- Allowing this can be a sanity check, to see if the hdb_catalog in the</span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-comment">-- DB has been set correctly</span><span>
</span><span id="line-467"></span><span>      </span><span id="local-6989586621690648896"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621690648896"><span class="hs-identifier hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">Clock.getCurrentTime</span></a></span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621690648894"><span class="annot"><span class="annottext">MigrationResult
</span><a href="#local-6989586621690648894"><span class="hs-identifier hs-var">migrationResult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690648893"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690648893"><span class="hs-identifier hs-var">metadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-469"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadIO m, MonadBaseControl IO m, FromPGTxErr e,
 FromPGConnErr e) =&gt;
PGPool -&gt; TxMode -&gt; TxET e m a -&gt; ExceptT e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.runTx</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690648905"><span class="hs-identifier hs-var">pool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.Serializable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxAccess
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ReadWrite</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-470"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadTx m, MonadIO m, MonadBaseControl IO m) =&gt;
Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
-&gt; ExtensionsSchema
-&gt; MaintenanceMode ()
-&gt; UTCTime
-&gt; m (MigrationResult, Metadata)
</span><a href="Hasura.Server.Migrate.html#migrateCatalog"><span class="hs-identifier hs-var">migrateCatalog</span></a></span><span>
</span><span id="line-471"></span><span>            </span><span class="annot"><span class="annottext">Maybe (SourceConnConfiguration ('Postgres 'Vanilla))
</span><a href="#local-6989586621690648904"><span class="hs-identifier hs-var">defaultSourceConfig</span></a></span><span>
</span><span id="line-472"></span><span>            </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621690648899"><span class="hs-identifier hs-var">extensionsSchema</span></a></span><span>
</span><span id="line-473"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerConfigCtx -&gt; MaintenanceMode ()
</span><a href="Hasura.Server.Types.html#_sccMaintenanceMode"><span class="hs-identifier hs-var">_sccMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690648902"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>            </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621690648896"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648888"><span class="annot"><span class="annottext">tlsAllowList :: [TlsAllow]
</span><a href="#local-6989586621690648888"><span class="hs-identifier hs-var hs-var">tlsAllowList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Network -&gt; [TlsAllow]
</span><a href="Hasura.RQL.Types.Network.html#networkTlsAllowlist"><span class="hs-identifier hs-var">networkTlsAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Network
</span><a href="Hasura.RQL.Types.Metadata.html#_metaNetwork"><span class="hs-identifier hs-var">_metaNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690648893"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-476"></span><span>      </span><span id="local-6989586621690648885"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648885"><span class="hs-identifier hs-var">httpManager</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO [TlsAllow] -&gt; Blocklist -&gt; IO Manager
</span><a href="Network.HTTP.Client.CreateManager.html#mkHttpManager"><span class="hs-identifier hs-var">mkHttpManager</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[TlsAllow]
</span><a href="#local-6989586621690648888"><span class="hs-identifier hs-var">tlsAllowList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocklist
</span><a href="#local-6989586621690648903"><span class="hs-identifier hs-var">blockList</span></a></span><span>
</span><span id="line-477"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648884"><span class="annot"><span class="annottext">cacheBuildParams :: CacheBuildParams
</span><a href="#local-6989586621690648884"><span class="hs-identifier hs-var hs-var">cacheBuildParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-478"></span><span>            </span><span class="annot"><span class="annottext">Manager
-&gt; SourceResolver ('Postgres 'Vanilla)
-&gt; SourceResolver 'MSSQL
-&gt; ServerConfigCtx
-&gt; CacheBuildParams
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#CacheBuildParams"><span class="hs-identifier hs-var">CacheBuildParams</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648885"><span class="hs-identifier hs-var">httpManager</span></a></span><span> </span><span class="annot"><span class="annottext">SourceResolver ('Postgres 'Vanilla)
</span><a href="#local-6989586621690648901"><span class="hs-identifier hs-var">pgSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="#local-6989586621690648900"><span class="hs-identifier hs-var">mssqlSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690648902"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-479"></span><span>          </span><span id="local-6989586621690648882"><span class="annot"><span class="annottext">buildReason :: BuildReason
</span><a href="#local-6989586621690648882"><span class="hs-identifier hs-var hs-var">buildReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogSync"><span class="hs-identifier hs-var">CatalogSync</span></a></span><span>
</span><span id="line-480"></span><span>      </span><span id="local-6989586621690648880"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648880"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, MonadError QErr m) =&gt;
CacheBuildParams -&gt; CacheBuild a -&gt; m a
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#runCacheBuild"><span class="hs-identifier hs-var">runCacheBuild</span></a></span><span> </span><span class="annot"><span class="annottext">CacheBuildParams
</span><a href="#local-6989586621690648884"><span class="hs-identifier hs-var">cacheBuildParams</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-482"></span><span>          </span><span class="annot"><span class="annottext">BuildReason
-&gt; Logger Hasura
-&gt; Environment
-&gt; Metadata
-&gt; CacheBuild RebuildableSchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.html#buildRebuildableSchemaCacheWithReason"><span class="hs-identifier hs-var">buildRebuildableSchemaCacheWithReason</span></a></span><span> </span><span class="annot"><span class="annottext">BuildReason
</span><a href="#local-6989586621690648882"><span class="hs-identifier hs-var">buildReason</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648906"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648907"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621690648893"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MigrationResult
</span><a href="#local-6989586621690648894"><span class="hs-identifier hs-var">migrationResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648880"><span class="hs-identifier hs-var">schemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621690648877"><span class="annot"><span class="annottext">MigrationResult
</span><a href="#local-6989586621690648877"><span class="hs-identifier hs-var">migrationResult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690648876"><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648876"><span class="hs-identifier hs-var">schemaCache</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-486"></span><span>      </span><span class="annot"><span class="annottext">Either QErr (MigrationResult, RebuildableSchemaCache)
</span><a href="#local-6989586621690648898"><span class="hs-identifier hs-var">initialiseResult</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648875"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648875"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-487"></span><span>        </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span>
</span><span id="line-488"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648906"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-489"></span><span>          </span><span class="annot"><a href="Hasura.Server.Logging.html#StartupLog"><span class="hs-identifier hs-type">StartupLog</span></a></span><span>
</span><span id="line-490"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slLogLevel :: LogLevel
</span><a href="Hasura.Server.Logging.html#slLogLevel"><span class="hs-identifier hs-var">slLogLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-491"></span><span>              </span><span class="annot"><span class="annottext">slKind :: Text
</span><a href="Hasura.Server.Logging.html#slKind"><span class="hs-identifier hs-var">slKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;catalog_migrate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-492"></span><span>              </span><span class="annot"><span class="annottext">slInfo :: Value
</span><a href="Hasura.Server.Logging.html#slInfo"><span class="hs-identifier hs-var">slInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">A.toJSON</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648875"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-493"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-494"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648875"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648906"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">MigrationResult
</span><a href="#local-6989586621690648877"><span class="hs-identifier hs-var">migrationResult</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648876"><span class="hs-identifier hs-var">schemaCache</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">-- | A latch for the graceful shutdown of a server process.</span><span>
</span><span id="line-499"></span><span class="hs-keyword">newtype</span><span> </span><span id="ShutdownLatch"><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-var">ShutdownLatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ShutdownLatch"><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-var">ShutdownLatch</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unShutdownLatch"><span class="annot"><span class="annottext">ShutdownLatch -&gt; MVar ()
</span><a href="Hasura.App.html#unShutdownLatch"><span class="hs-identifier hs-var hs-var">unShutdownLatch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">C.MVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-comment">-- | Event triggers live in the user's DB and other events</span><span>
</span><span id="line-502"></span><span class="hs-comment">--  (cron, one-off and async actions)</span><span>
</span><span id="line-503"></span><span class="hs-comment">--   live in the metadata DB, so we need a way to differentiate the</span><span>
</span><span id="line-504"></span><span class="hs-comment">--   type of shutdown action</span><span>
</span><span id="line-505"></span><span class="hs-keyword">data</span><span> </span><span id="ShutdownAction"><span class="annot"><a href="Hasura.App.html#ShutdownAction"><span class="hs-identifier hs-var">ShutdownAction</span></a></span></span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EventTriggerShutdownAction"><span class="annot"><a href="Hasura.App.html#EventTriggerShutdownAction"><span class="hs-identifier hs-var">EventTriggerShutdownAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MetadataDBShutdownAction"><span class="annot"><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-var">MetadataDBShutdownAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="annot"><a href="Hasura.App.html#newShutdownLatch"><span class="hs-identifier hs-type">newShutdownLatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-type">ShutdownLatch</span></a></span><span>
</span><span id="line-510"></span><span id="newShutdownLatch"><span class="annot"><span class="annottext">newShutdownLatch :: IO ShutdownLatch
</span><a href="Hasura.App.html#newShutdownLatch"><span class="hs-identifier hs-var hs-var">newShutdownLatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; ShutdownLatch
</span><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-var">ShutdownLatch</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO (MVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">C.newEmptyMVar</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-comment">-- | Block the current thread, waiting on the latch.</span><span>
</span><span id="line-513"></span><span class="annot"><a href="Hasura.App.html#waitForShutdown"><span class="hs-identifier hs-type">waitForShutdown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-type">ShutdownLatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span id="waitForShutdown"><span class="annot"><span class="annottext">waitForShutdown :: ShutdownLatch -&gt; IO ()
</span><a href="Hasura.App.html#waitForShutdown"><span class="hs-identifier hs-var hs-var">waitForShutdown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">C.readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShutdownLatch -&gt; MVar ()
</span><a href="Hasura.App.html#unShutdownLatch"><span class="hs-identifier hs-var">unShutdownLatch</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-comment">-- | Initiate a graceful shutdown of the server associated with the provided</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- latch.</span><span>
</span><span id="line-518"></span><span class="annot"><a href="Hasura.App.html#shutdownGracefully"><span class="hs-identifier hs-type">shutdownGracefully</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-type">ShutdownLatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span id="shutdownGracefully"><span class="annot"><span class="annottext">shutdownGracefully :: ShutdownLatch -&gt; IO ()
</span><a href="Hasura.App.html#shutdownGracefully"><span class="hs-identifier hs-var hs-var">shutdownGracefully</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; a -&gt; IO Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">C.tryPutMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShutdownLatch -&gt; MVar ()
</span><a href="Hasura.App.html#unShutdownLatch"><span class="hs-identifier hs-var">unShutdownLatch</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- | Returns True if the latch is set for shutdown and vice-versa</span><span>
</span><span id="line-522"></span><span class="annot"><a href="Hasura.App.html#shuttingDown"><span class="hs-identifier hs-type">shuttingDown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.App.html#ShutdownLatch"><span class="hs-identifier hs-type">ShutdownLatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-523"></span><span id="shuttingDown"><span class="annot"><span class="annottext">shuttingDown :: ShutdownLatch -&gt; IO Bool
</span><a href="Hasura.App.html#shuttingDown"><span class="hs-identifier hs-var hs-var">shuttingDown</span></a></span></span><span> </span><span id="local-6989586621690648866"><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621690648866"><span class="hs-identifier hs-var">latch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. MVar a -&gt; IO Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">C.isEmptyMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShutdownLatch -&gt; MVar ()
</span><a href="Hasura.App.html#unShutdownLatch"><span class="hs-identifier hs-var">unShutdownLatch</span></a></span><span> </span><span class="annot"><span class="annottext">ShutdownLatch
</span><a href="#local-6989586621690648866"><span class="hs-identifier hs-var">latch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">-- | If an exception is encountered , flush the log buffer and</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- rethrow If we do not flush the log buffer on exception, then log lines</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- may be missed</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- See: https://github.com/hasura/graphql-engine/issues/4772</span><span>
</span><span id="line-529"></span><span id="local-6989586621690650258"><span id="local-6989586621690650259"><span class="annot"><a href="Hasura.App.html#flushLogger"><span class="hs-identifier hs-type">flushLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650259"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Logging.html#LoggerCtx"><span class="hs-identifier hs-type">LoggerCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650258"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621690650259"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-530"></span><span id="flushLogger"><span class="annot"><span class="annottext">flushLogger :: forall (m :: * -&gt; *) impl. MonadIO m =&gt; LoggerCtx impl -&gt; m ()
</span><a href="Hasura.App.html#flushLogger"><span class="hs-identifier hs-var hs-var">flushLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerSet -&gt; IO ()
</span><span class="hs-identifier hs-var">FL.flushLogStr</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. LoggerCtx impl -&gt; LoggerSet
</span><a href="Hasura.Logging.html#_lcLoggerSet"><span class="hs-identifier hs-var">_lcLoggerSet</span></a></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span class="hs-comment">-- | This function acts as the entrypoint for the graphql-engine webserver.</span><span>
</span><span id="line-533"></span><span class="hs-comment">--</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- Note: at the exit of this function, or in case of a graceful server shutdown</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- (SIGTERM, or more generally, whenever the shutdown latch is set),  we need to</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- make absolutely sure that we clean up any resources which were allocated during</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- server setup. In the case of a multitenant process, failure to do so can lead to</span><span>
</span><span id="line-538"></span><span class="hs-comment">-- resource leaks.</span><span>
</span><span id="line-539"></span><span class="hs-comment">--</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- To track these resources, we use the ManagedT monad, and attach finalizers at</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- the same point in the code where we allocate resources. If you fork a new</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- long-lived thread, or create a connection pool, or allocate any other</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- long-lived resource, make sure to pair the allocator  with its finalizer.</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- There are plenty of examples throughout the code. For example, see</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- 'C.forkManagedT'.</span><span>
</span><span id="line-546"></span><span class="hs-comment">--</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- Note also: the order in which the finalizers run can be important. Specifically,</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- we want the finalizers for the logger threads to run last, so that we retain as</span><span>
</span><span id="line-549"></span><span class="hs-comment">-- many &quot;thread stopping&quot; log messages as possible. The order in which the</span><span>
</span><span id="line-550"></span><span class="hs-comment">-- finalizers is run is determined by the order in which they are introduced in the</span><span>
</span><span id="line-551"></span><span class="hs-comment">-- code.</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-comment">{- HLINT ignore runHGEServer &quot;Avoid lambda&quot; -}</span><span>
</span><span id="line-554"></span><span class="annot"><a href="Hasura.App.html#runHGEServer"><span class="hs-identifier hs-type">runHGEServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690650204"><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621690650184"><span class="annot"><a href="#local-6989586621690650184"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-557"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadFix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-type">MonadMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><a href="Control.Monad.Stateless.html#MonadStateless"><span class="hs-identifier hs-type">MonadStateless</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LA.Forall</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LA.Pure</span></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-562"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-563"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-566"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-567"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-568"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-569"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-570"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-579"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650184"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-580"></span><span>  </span><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-type">ServeCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-comment">-- and mutations</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-comment">-- | start time</span><span>
</span><span id="line-584"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#SubscriptionPostPollHook"><span class="hs-identifier hs-type">ES.SubscriptionPostPollHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier hs-type">ServerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-587"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EKG.Store</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-comment">-- | A hook which can be called to indicate when the server is started succesfully</span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#PrometheusMetrics"><span class="hs-identifier hs-type">PrometheusMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-591"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650204"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span id="runHGEServer"><span class="annot"><span class="annottext">runHGEServer :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadMask m, MonadStateless IO m,
 Forall (Pure m), UserAuthentication (TraceT m), HttpLog m,
 ConsoleRenderer m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadWSLog m, MonadExecuteQuery m, HasReporter m,
 HasResourceLimits m, MonadMetadataStorage (MetadataStorageT m),
 MonadResolveSource m, MonadQueryTags m, MonadEventLogCleanup m) =&gt;
(ServerCtx -&gt; SpockT m ())
-&gt; Environment
-&gt; ServeOptions impl
-&gt; ServeCtx
-&gt; UTCTime
-&gt; Maybe SubscriptionPostPollHook
-&gt; ServerMetrics
-&gt; Store EmptyMetrics
-&gt; Maybe (IO ())
-&gt; PrometheusMetrics
-&gt; ManagedT m ()
</span><a href="Hasura.App.html#runHGEServer"><span class="hs-identifier hs-var hs-var">runHGEServer</span></a></span></span><span> </span><span id="local-6989586621690648773"><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621690648773"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621690648772"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648772"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621690648771"><span class="annot"><span class="annottext">ServeOptions impl
</span><a href="#local-6989586621690648771"><span class="hs-identifier hs-var">serveOptions</span></a></span></span><span> </span><span id="local-6989586621690648770"><span class="annot"><span class="annottext">ServeCtx
</span><a href="#local-6989586621690648770"><span class="hs-identifier hs-var">serveCtx</span></a></span></span><span> </span><span id="local-6989586621690648769"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621690648769"><span class="hs-identifier hs-var">initTime</span></a></span></span><span> </span><span id="local-6989586621690648768"><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621690648768"><span class="hs-identifier hs-var">postPollHook</span></a></span></span><span> </span><span id="local-6989586621690648767"><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648767"><span class="hs-identifier hs-var">serverMetrics</span></a></span></span><span> </span><span id="local-6989586621690648766"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621690648766"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span> </span><span id="local-6989586621690648765"><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621690648765"><span class="hs-identifier hs-var">startupStatusHook</span></a></span></span><span> </span><span id="local-6989586621690648764"><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648764"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>  </span><span id="local-6989586621690648763"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621690648763"><span class="hs-identifier hs-var">waiApplication</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-594"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadMask m, MonadStateless IO m,
 Forall (Pure m), UserAuthentication (TraceT m), HttpLog m,
 ConsoleRenderer m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadWSLog m, MonadExecuteQuery m, HasReporter m,
 HasResourceLimits m, MonadMetadataStorage (MetadataStorageT m),
 MonadResolveSource m, MonadQueryTags m, MonadEventLogCleanup m) =&gt;
(ServerCtx -&gt; SpockT m ())
-&gt; Environment
-&gt; ServeOptions impl
-&gt; ServeCtx
-&gt; Maybe SubscriptionPostPollHook
-&gt; ServerMetrics
-&gt; Store EmptyMetrics
-&gt; PrometheusMetrics
-&gt; ManagedT m Application
</span><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier hs-var">mkHGEServer</span></a></span><span> </span><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621690648773"><span class="hs-identifier hs-var">setupHook</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648772"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptions impl
</span><a href="#local-6989586621690648771"><span class="hs-identifier hs-var">serveOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ServeCtx
</span><a href="#local-6989586621690648770"><span class="hs-identifier hs-var">serveCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621690648768"><span class="hs-identifier hs-var">postPollHook</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648767"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621690648766"><span class="hs-identifier hs-var">ekgStore</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648764"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648762"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621690648762"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServeCtx -&gt; Loggers
</span><a href="Hasura.App.html#_scLoggers"><span class="hs-identifier hs-var">_scLoggers</span></a></span><span> </span><span class="annot"><span class="annottext">ServeCtx
</span><a href="#local-6989586621690648770"><span class="hs-identifier hs-var">serveCtx</span></a></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-comment">-- `startupStatusHook`: add `Service started successfully` message to config_status</span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-comment">-- table when a tenant starts up in multitenant</span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621690648761"><span class="hs-identifier hs-type">warpSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Warp.Settings</span></span><span>
</span><span id="line-600"></span><span>      </span><span id="local-6989586621690648761"><span class="annot"><span class="annottext">warpSettings :: Settings
</span><a href="#local-6989586621690648761"><span class="hs-identifier hs-var hs-var">warpSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setPort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; Int
</span><a href="Hasura.Server.Init.Config.html#_getPort"><span class="hs-identifier hs-var">_getPort</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl. ServeOptions impl -&gt; Port
</span><a href="Hasura.Server.Init.Config.html#soPort"><span class="hs-identifier hs-var">soPort</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptions impl
</span><a href="#local-6989586621690648771"><span class="hs-identifier hs-var">serveOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HostPreference -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setHost</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall impl. ServeOptions impl -&gt; HostPreference
</span><a href="Hasura.Server.Init.Config.html#soHost"><span class="hs-identifier hs-var">soHost</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptions impl
</span><a href="#local-6989586621690648771"><span class="hs-identifier hs-var">serveOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setGracefulShutdownTimeout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 30s graceful shutdown</span><span>
</span><span id="line-604"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setInstallShutdownHandler</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="#local-6989586621690648755"><span class="hs-identifier hs-var">shutdownHandler</span></a></span><span>
</span><span id="line-605"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setBeforeMainLoop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
</span><a href="#local-6989586621690648765"><span class="hs-identifier hs-var">startupStatusHook</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
</span><a href="#local-6989586621690648751"><span class="hs-identifier hs-var">setForkIOWithMetrics</span></a></span><span>
</span><span id="line-607"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><span class="hs-identifier hs-var">Warp.defaultSettings</span></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>      </span><span class="annot"><a href="#local-6989586621690648751"><span class="hs-identifier hs-type">setForkIOWithMetrics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Warp.Settings</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Warp.Settings</span></span><span>
</span><span id="line-610"></span><span>      </span><span id="local-6989586621690648751"><span class="annot"><span class="annottext">setForkIOWithMetrics :: Settings -&gt; Settings
</span><a href="#local-6989586621690648751"><span class="hs-identifier hs-var hs-var">setForkIOWithMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ())
-&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">Warp.setFork</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648748"><span class="annot"><span class="annottext">(forall a. IO a -&gt; IO a) -&gt; IO ()
</span><a href="#local-6989586621690648748"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-611"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-612"></span><span>          </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">C.forkIOWithUnmask</span></a></span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648746"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621690648746"><span class="hs-identifier hs-var">unmask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-614"></span><span>                </span><span class="annot"><span class="annottext">forall a b c. IO a -&gt; IO b -&gt; IO c -&gt; IO c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">bracket_</span></a></span><span>
</span><span id="line-615"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-616"></span><span>                      </span><span class="annot"><span class="annottext">Gauge -&gt; IO ()
</span><span class="hs-identifier hs-var">EKG.Gauge.inc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerMetrics -&gt; Gauge
</span><a href="Hasura.Server.Metrics.html#smWarpThreads"><span class="hs-identifier hs-var">smWarpThreads</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648767"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>                      </span><span class="annot"><span class="annottext">ConnectionsGauge -&gt; IO ()
</span><a href="Hasura.Server.Prometheus.html#incWarpThreads"><span class="hs-identifier hs-var">incWarpThreads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ConnectionsGauge
</span><a href="Hasura.Server.Prometheus.html#pmConnections"><span class="hs-identifier hs-var">pmConnections</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648764"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-620"></span><span>                      </span><span class="annot"><span class="annottext">Gauge -&gt; IO ()
</span><span class="hs-identifier hs-var">EKG.Gauge.dec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerMetrics -&gt; Gauge
</span><a href="Hasura.Server.Metrics.html#smWarpThreads"><span class="hs-identifier hs-var">smWarpThreads</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648767"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>                      </span><span class="annot"><span class="annottext">ConnectionsGauge -&gt; IO ()
</span><a href="Hasura.Server.Prometheus.html#decWarpThreads"><span class="hs-identifier hs-var">decWarpThreads</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ConnectionsGauge
</span><a href="Hasura.Server.Prometheus.html#pmConnections"><span class="hs-identifier hs-var">pmConnections</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648764"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a. IO a -&gt; IO a) -&gt; IO ()
</span><a href="#local-6989586621690648748"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621690648746"><span class="hs-identifier hs-var">unmask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>      </span><span class="annot"><a href="#local-6989586621690648755"><span class="hs-identifier hs-type">shutdownHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>      </span><span id="local-6989586621690648755"><span class="annot"><span class="annottext">shutdownHandler :: IO () -&gt; IO ()
</span><a href="#local-6989586621690648755"><span class="hs-identifier hs-var hs-var">shutdownHandler</span></a></span></span><span> </span><span id="local-6989586621690648741"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648741"><span class="hs-identifier hs-var">closeSocket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadBase IO m =&gt; Async a -&gt; m ()
</span><span class="hs-identifier hs-var">LA.link</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadBaseControl IO m, Forall (Pure m)) =&gt;
m a -&gt; m (Async a)
</span><span class="hs-identifier hs-var">LA.async</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-629"></span><span>          </span><span class="annot"><span class="annottext">ShutdownLatch -&gt; IO ()
</span><a href="Hasura.App.html#waitForShutdown"><span class="hs-identifier hs-var">waitForShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServeCtx -&gt; ShutdownLatch
</span><a href="Hasura.App.html#_scShutdownLatch"><span class="hs-identifier hs-var">_scShutdownLatch</span></a></span><span> </span><span class="annot"><span class="annottext">ServeCtx
</span><a href="#local-6989586621690648770"><span class="hs-identifier hs-var">serveCtx</span></a></span><span>
</span><span id="line-630"></span><span>          </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648762"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;gracefully shutting down server&quot;</span></span><span>
</span><span id="line-631"></span><span>          </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648741"><span class="hs-identifier hs-var">closeSocket</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>  </span><span id="local-6989586621690648737"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621690648737"><span class="hs-identifier hs-var">finishTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">Clock.getCurrentTime</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648736"><span class="annot"><span class="annottext">apiInitTime :: Double
</span><a href="#local-6989586621690648736"><span class="hs-identifier hs-var hs-var">apiInitTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">realToFrac</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; NominalDiffTime
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">Clock.diffUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621690648737"><span class="hs-identifier hs-var">finishTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621690648769"><span class="hs-identifier hs-var">initTime</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648762"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Double -&gt; StartupTimeInfo
</span><a href="Hasura.Server.Init.Logging.html#StartupTimeInfo"><span class="hs-identifier hs-var">StartupTimeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;starting API server&quot;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621690648736"><span class="hs-identifier hs-var">apiInitTime</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-comment">-- Here we block until the shutdown latch 'MVar' is filled, and then</span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-comment">-- shut down the server. Once this blocking call returns, we'll tidy up</span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-comment">-- any resources using the finalizers attached using 'ManagedT' above.</span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-comment">-- Structuring things using the shutdown latch in this way lets us decide</span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-comment">-- elsewhere exactly how we want to control shutdown.</span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Application -&gt; IO ()
</span><span class="hs-identifier hs-var">Warp.runSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621690648761"><span class="hs-identifier hs-var">warpSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621690648763"><span class="hs-identifier hs-var">waiApplication</span></a></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="hs-comment">-- | Part of a factorization of 'runHGEServer' to expose the constructed WAI</span><span>
</span><span id="line-646"></span><span class="hs-comment">-- application for testing purposes. See 'runHGEServer' for documentation.</span><span>
</span><span id="line-647"></span><span class="annot"><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier hs-type">mkHGEServer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621690650168"><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621690650167"><span class="annot"><a href="#local-6989586621690650167"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadFix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-651"></span><span>    </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-type">MonadMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><a href="Control.Monad.Stateless.html#MonadStateless"><span class="hs-identifier hs-type">MonadStateless</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-653"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LA.Forall</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LA.Pure</span></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-654"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-655"></span><span>    </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-656"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-657"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-659"></span><span>    </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-665"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-666"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-667"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.App.html#ServerCtx"><span class="hs-identifier hs-type">ServerCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spock.SpockT</span></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-671"></span><span>  </span><span class="annot"><a href="Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-672"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650167"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-type">ServeCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-comment">-- and mutations</span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Poll.Common.html#SubscriptionPostPollHook"><span class="hs-identifier hs-type">ES.SubscriptionPostPollHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier hs-type">ServerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EKG.Store</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EKG.EmptyMetrics</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#PrometheusMetrics"><span class="hs-identifier hs-type">PrometheusMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><a href="Control.Monad.Trans.Managed.html#ManagedT"><span class="hs-identifier hs-type">ManagedT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-681"></span><span id="mkHGEServer"><span class="annot"><span class="annottext">mkHGEServer :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFix m, MonadMask m, MonadStateless IO m,
 Forall (Pure m), UserAuthentication (TraceT m), HttpLog m,
 ConsoleRenderer m, MonadMetadataApiAuthorization m,
 MonadGQLExecutionCheck m, MonadConfigApiHandler m, MonadQueryLog m,
 MonadWSLog m, MonadExecuteQuery m, HasReporter m,
 HasResourceLimits m, MonadMetadataStorage (MetadataStorageT m),
 MonadResolveSource m, MonadQueryTags m, MonadEventLogCleanup m) =&gt;
(ServerCtx -&gt; SpockT m ())
-&gt; Environment
-&gt; ServeOptions impl
-&gt; ServeCtx
-&gt; Maybe SubscriptionPostPollHook
-&gt; ServerMetrics
-&gt; Store EmptyMetrics
-&gt; PrometheusMetrics
-&gt; ManagedT m Application
</span><a href="Hasura.App.html#mkHGEServer"><span class="hs-identifier hs-var hs-var">mkHGEServer</span></a></span></span><span> </span><span id="local-6989586621690648459"><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621690648459"><span class="hs-identifier hs-var">setupHook</span></a></span></span><span> </span><span id="local-6989586621690648458"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648458"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690648417"><span id="local-6989586621690648418"><span id="local-6989586621690648419"><span id="local-6989586621690648420"><span id="local-6989586621690648421"><span id="local-6989586621690648422"><span id="local-6989586621690648423"><span id="local-6989586621690648424"><span id="local-6989586621690648425"><span id="local-6989586621690648426"><span id="local-6989586621690648427"><span id="local-6989586621690648428"><span id="local-6989586621690648429"><span id="local-6989586621690648430"><span id="local-6989586621690648431"><span id="local-6989586621690648432"><span id="local-6989586621690648433"><span id="local-6989586621690648434"><span id="local-6989586621690648435"><span id="local-6989586621690648436"><span id="local-6989586621690648437"><span id="local-6989586621690648438"><span id="local-6989586621690648439"><span id="local-6989586621690648440"><span id="local-6989586621690648441"><span id="local-6989586621690648442"><span id="local-6989586621690648443"><span id="local-6989586621690648444"><span id="local-6989586621690648445"><span id="local-6989586621690648446"><span id="local-6989586621690648447"><span id="local-6989586621690648448"><span id="local-6989586621690648449"><span id="local-6989586621690648450"><span id="local-6989586621690648451"><span id="local-6989586621690648452"><span id="local-6989586621690648453"><span id="local-6989586621690648454"><span id="local-6989586621690648455"><span id="local-6989586621690648456"><span id="local-6989586621690648457"><span class="annot"><span class="annottext">Bool
[JWTConfig]
Maybe Text
Maybe RoleName
Maybe NamingCase
Maybe AuthHook
HashSet (EngineLogType impl)
HashSet ExperimentalFeature
HashSet AdminSecretHash
HashSet API
ConnParams
TxIsolation
Refined NonNegative Int
Refined NonNegative Seconds
Refined NonNegative Milliseconds
Refined Positive Int
StreamQueriesOptions
RemoteSchemaPermissions
InferFunctionPermissions
DangerouslyCollapseBooleans
StringifyNumbers
LogLevel
CorsConfig
ExtensionsSchema
EventingMode
ReadOnlyMode
MaintenanceMode ()
MetadataQueryLoggingMode
HostPreference
ConnectionOptions
ResponseInternalErrorsConfig
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
soExtensionsSchema :: ExtensionsSchema
soDefaultNamingConvention :: Maybe NamingCase
soEnableMetadataQueryLogging :: MetadataQueryLoggingMode
soReadOnlyMode :: ReadOnlyMode
soEventingMode :: EventingMode
soWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
soGracefulShutdownTimeout :: Refined NonNegative Seconds
soDevMode :: Bool
soEventsFetchBatchSize :: Refined NonNegative Int
soExperimentalFeatures :: HashSet ExperimentalFeature
soSchemaPollInterval :: OptionalInterval
soEnableMaintenanceMode :: MaintenanceMode ()
soInferFunctionPermissions :: InferFunctionPermissions
soWebSocketKeepAlive :: KeepAliveDelay
soConnectionOptions :: ConnectionOptions
soEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
soAsyncActionsFetchInterval :: OptionalInterval
soEventsFetchInterval :: Refined NonNegative Milliseconds
soEventsHttpPoolSize :: Refined Positive Int
soResponseInternalErrorsConfig :: ResponseInternalErrorsConfig
soLogLevel :: LogLevel
soEnabledLogTypes :: HashSet (EngineLogType impl)
soEnableAllowlist :: Bool
soStreamingQueryOpts :: StreamQueriesOptions
soLiveQueryOpts :: StreamQueriesOptions
soEnabledAPIs :: HashSet API
soDangerousBooleanCollapse :: DangerouslyCollapseBooleans
soStringifyNum :: StringifyNumbers
soEnableTelemetry :: Bool
soConsoleSentryDsn :: Maybe Text
soConsoleAssetsDir :: Maybe Text
soEnableConsole :: Bool
soCorsConfig :: CorsConfig
soUnAuthRole :: Maybe RoleName
soJwtSecret :: [JWTConfig]
soAuthHook :: Maybe AuthHook
soAdminSecret :: HashSet AdminSecretHash
soTxIso :: TxIsolation
soConnParams :: ConnParams
soHost :: HostPreference
soPort :: Port
soExtensionsSchema :: forall impl. ServeOptions impl -&gt; ExtensionsSchema
soDefaultNamingConvention :: forall impl. ServeOptions impl -&gt; Maybe NamingCase
soEnableMetadataQueryLogging :: forall impl. ServeOptions impl -&gt; MetadataQueryLoggingMode
soReadOnlyMode :: forall impl. ServeOptions impl -&gt; ReadOnlyMode
soEventingMode :: forall impl. ServeOptions impl -&gt; EventingMode
soWebSocketConnectionInitTimeout :: forall impl. ServeOptions impl -&gt; WSConnectionInitTimeout
soGracefulShutdownTimeout :: forall impl. ServeOptions impl -&gt; Refined NonNegative Seconds
soDevMode :: forall impl. ServeOptions impl -&gt; Bool
soEventsFetchBatchSize :: forall impl. ServeOptions impl -&gt; Refined NonNegative Int
soExperimentalFeatures :: forall impl. ServeOptions impl -&gt; HashSet ExperimentalFeature
soSchemaPollInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEnableMaintenanceMode :: forall impl. ServeOptions impl -&gt; MaintenanceMode ()
soInferFunctionPermissions :: forall impl. ServeOptions impl -&gt; InferFunctionPermissions
soWebSocketKeepAlive :: forall impl. ServeOptions impl -&gt; KeepAliveDelay
soConnectionOptions :: forall impl. ServeOptions impl -&gt; ConnectionOptions
soEnableRemoteSchemaPermissions :: forall impl. ServeOptions impl -&gt; RemoteSchemaPermissions
soAsyncActionsFetchInterval :: forall impl. ServeOptions impl -&gt; OptionalInterval
soEventsFetchInterval :: forall impl. ServeOptions impl -&gt; Refined NonNegative Milliseconds
soEventsHttpPoolSize :: forall impl. ServeOptions impl -&gt; Refined Positive Int
soResponseInternalErrorsConfig :: forall impl. ServeOptions impl -&gt; ResponseInternalErrorsConfig
soLogLevel :: forall impl. ServeOptions impl -&gt; LogLevel
soEnabledLogTypes :: forall impl. ServeOptions impl -&gt; HashSet (EngineLogType impl)
soEnableAllowlist :: forall impl. ServeOptions impl -&gt; Bool
soStreamingQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soLiveQueryOpts :: forall impl. ServeOptions impl -&gt; StreamQueriesOptions
soEnabledAPIs :: forall impl. ServeOptions impl -&gt; HashSet API
soDangerousBooleanCollapse :: forall impl. ServeOptions impl -&gt; DangerouslyCollapseBooleans
soStringifyNum :: forall impl. ServeOptions impl -&gt; StringifyNumbers
soEnableTelemetry :: forall impl. ServeOptions impl -&gt; Bool
soConsoleSentryDsn :: forall impl. ServeOptions impl -&gt; Maybe Text
soConsoleAssetsDir :: forall impl. ServeOptions impl -&gt; Maybe Text
soEnableConsole :: forall impl. ServeOptions impl -&gt; Bool
soCorsConfig :: forall impl. ServeOptions impl -&gt; CorsConfig
soUnAuthRole :: forall impl. ServeOptions impl -&gt; Maybe RoleName
soJwtSecret :: forall impl. ServeOptions impl -&gt; [JWTConfig]
soAuthHook :: forall impl. ServeOptions impl -&gt; Maybe AuthHook
soAdminSecret :: forall impl. ServeOptions impl -&gt; HashSet AdminSecretHash
soTxIso :: forall impl. ServeOptions impl -&gt; TxIsolation
soConnParams :: forall impl. ServeOptions impl -&gt; ConnParams
soHost :: forall impl. ServeOptions impl -&gt; HostPreference
soPort :: forall impl. ServeOptions impl -&gt; Port
</span><a href="#local-6989586621690648417"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hasura.App.html#ServeCtx"><span class="hs-identifier hs-type">ServeCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690648408"><span id="local-6989586621690648409"><span id="local-6989586621690648410"><span id="local-6989586621690648411"><span id="local-6989586621690648412"><span id="local-6989586621690648413"><span id="local-6989586621690648414"><span id="local-6989586621690648415"><span id="local-6989586621690648416"><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
PGPool
TMVar MetadataResourceVersion
Manager
InstanceId
RebuildableSchemaCache
SchemaCacheRef
ShutdownLatch
Loggers
_scMetaVersionRef :: TMVar MetadataResourceVersion
_scSchemaCacheRef :: SchemaCacheRef
_scSchemaCache :: RebuildableSchemaCache
_scShutdownLatch :: ShutdownLatch
_scMetadataDbPool :: PGPool
_scEnabledLogTypes :: HashSet (EngineLogType Hasura)
_scLoggers :: Loggers
_scInstanceId :: InstanceId
_scHttpManager :: Manager
_scMetaVersionRef :: ServeCtx -&gt; TMVar MetadataResourceVersion
_scSchemaCacheRef :: ServeCtx -&gt; SchemaCacheRef
_scSchemaCache :: ServeCtx -&gt; RebuildableSchemaCache
_scEnabledLogTypes :: ServeCtx -&gt; HashSet (EngineLogType Hasura)
_scInstanceId :: ServeCtx -&gt; InstanceId
_scHttpManager :: ServeCtx -&gt; Manager
_scShutdownLatch :: ServeCtx -&gt; ShutdownLatch
_scMetadataDbPool :: ServeCtx -&gt; PGPool
_scLoggers :: ServeCtx -&gt; Loggers
</span><a href="#local-6989586621690648408"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621690648407"><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621690648407"><span class="hs-identifier hs-var">postPollHook</span></a></span></span><span> </span><span id="local-6989586621690648406"><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648406"><span class="hs-identifier hs-var">serverMetrics</span></a></span></span><span> </span><span id="local-6989586621690648405"><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621690648405"><span class="hs-identifier hs-var">ekgStore</span></a></span></span><span> </span><span id="local-6989586621690648404"><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648404"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-comment">-- Comment this to enable expensive assertions from &quot;GHC.AssertNF&quot;. These</span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-comment">-- will log lines to STDOUT containing &quot;not in normal form&quot;. In the future we</span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-comment">-- could try to integrate this into our tests. For now this is a development</span><span>
</span><span id="line-685"></span><span>  </span><span class="hs-comment">-- tool.</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-comment">-- NOTE: be sure to compile WITHOUT code coverage, for this to work properly.</span><span>
</span><span id="line-688"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="GHC.AssertNF.CPP.html#disableAssertNF"><span class="hs-identifier hs-var">disableAssertNF</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648402"><span class="annot"><span class="annottext">optimizePermissionFilters :: OptimizePermissionFilters
</span><a href="#local-6989586621690648402"><span class="hs-identifier hs-var hs-var">optimizePermissionFilters</span></a></span></span><span>
</span><span id="line-691"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFOptimizePermissionFilters"><span class="hs-identifier hs-var">EFOptimizePermissionFilters</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690648426"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptimizePermissionFilters
</span><a href="Hasura.GraphQL.Schema.Options.html#OptimizePermissionFilters"><span class="hs-identifier hs-var">Options.OptimizePermissionFilters</span></a></span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptimizePermissionFilters
</span><a href="Hasura.GraphQL.Schema.Options.html#Don%27tOptimizePermissionFilters"><span class="hs-identifier hs-var">Options.Don'tOptimizePermissionFilters</span></a></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>      </span><span id="local-6989586621690648401"><span class="annot"><span class="annottext">bigqueryStringNumericInput :: BigQueryStringNumericInput
</span><a href="#local-6989586621690648401"><span class="hs-identifier hs-var hs-var">bigqueryStringNumericInput</span></a></span></span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ExperimentalFeature
</span><a href="Hasura.Server.Types.html#EFBigQueryStringNumericInput"><span class="hs-identifier hs-var">EFBigQueryStringNumericInput</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690648426"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BigQueryStringNumericInput
</span><a href="Hasura.GraphQL.Schema.Options.html#EnableBigQueryStringNumericInput"><span class="hs-identifier hs-var">Options.EnableBigQueryStringNumericInput</span></a></span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BigQueryStringNumericInput
</span><a href="Hasura.GraphQL.Schema.Options.html#DisableBigQueryStringNumericInput"><span class="hs-identifier hs-var">Options.DisableBigQueryStringNumericInput</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>      </span><span id="local-6989586621690648400"><span class="annot"><span class="annottext">sqlGenCtx :: SQLGenCtx
</span><a href="#local-6989586621690648400"><span class="hs-identifier hs-var hs-var">sqlGenCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; DangerouslyCollapseBooleans
-&gt; OptimizePermissionFilters
-&gt; BigQueryStringNumericInput
-&gt; SQLGenCtx
</span><a href="Hasura.RQL.Types.Common.html#SQLGenCtx"><span class="hs-identifier hs-var">SQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621690648444"><span class="hs-identifier hs-var">soStringifyNum</span></a></span><span> </span><span class="annot"><span class="annottext">DangerouslyCollapseBooleans
</span><a href="#local-6989586621690648443"><span class="hs-identifier hs-var">soDangerousBooleanCollapse</span></a></span><span> </span><span class="annot"><span class="annottext">OptimizePermissionFilters
</span><a href="#local-6989586621690648402"><span class="hs-identifier hs-var">optimizePermissionFilters</span></a></span><span> </span><span class="annot"><span class="annottext">BigQueryStringNumericInput
</span><a href="#local-6989586621690648401"><span class="hs-identifier hs-var">bigqueryStringNumericInput</span></a></span><span>
</span><span id="line-699"></span><span>      </span><span class="annot"><a href="Hasura.App.html#Loggers"><span class="hs-identifier hs-type">Loggers</span></a></span><span> </span><span id="local-6989586621690648399"><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690648399"><span class="hs-identifier hs-var">loggerCtx</span></a></span></span><span> </span><span id="local-6989586621690648398"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621690648414"><span class="hs-identifier hs-var">_scLoggers</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>  </span><span id="local-6989586621690648397"><span class="annot"><span class="annottext">Either Text AuthMode
</span><a href="#local-6989586621690648397"><span class="hs-identifier hs-var">authModeRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-702"></span><span>    </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-703"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(ForkableMonadIO m, HasReporter m) =&gt;
HashSet AdminSecretHash
-&gt; Maybe AuthHook
-&gt; [JWTConfig]
-&gt; Maybe RoleName
-&gt; Manager
-&gt; Logger Hasura
-&gt; ExceptT Text (ManagedT m) AuthMode
</span><a href="Hasura.Server.Auth.html#setupAuthMode"><span class="hs-identifier hs-var">setupAuthMode</span></a></span><span>
</span><span id="line-704"></span><span>        </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
</span><a href="#local-6989586621690648453"><span class="hs-identifier hs-var">soAdminSecret</span></a></span><span>
</span><span id="line-705"></span><span>        </span><span class="annot"><span class="annottext">Maybe AuthHook
</span><a href="#local-6989586621690648452"><span class="hs-identifier hs-var">soAuthHook</span></a></span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><span class="annottext">[JWTConfig]
</span><a href="#local-6989586621690648451"><span class="hs-identifier hs-var">soJwtSecret</span></a></span><span>
</span><span id="line-707"></span><span>        </span><span class="annot"><span class="annottext">Maybe RoleName
</span><a href="#local-6989586621690648450"><span class="hs-identifier hs-var">soUnAuthRole</span></a></span><span>
</span><span id="line-708"></span><span>        </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-709"></span><span>        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>  </span><span id="local-6989586621690648395"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690648395"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text AuthMode
</span><a href="#local-6989586621690648397"><span class="hs-identifier hs-var">authModeRes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; ExitCode -&gt; String -&gt; m a
</span><a href="Hasura.App.html#throwErrExit"><span class="hs-identifier hs-var">throwErrExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#AuthConfigurationError"><span class="hs-identifier hs-var">AuthConfigurationError</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span>  </span><span class="annot"><a href="Hasura.Server.App.html#HasuraApp"><span class="hs-identifier hs-type">HasuraApp</span></a></span><span> </span><span id="local-6989586621690648392"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621690648392"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span id="local-6989586621690648391"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span></span><span> </span><span id="local-6989586621690648390"><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621690648390"><span class="hs-identifier hs-var">actionSubState</span></a></span></span><span> </span><span id="local-6989586621690648389"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648389"><span class="hs-identifier hs-var">stopWsServer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. MonadCatch m =&gt; m a -&gt; m b -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/exceptions-0.10.4/src"><span class="hs-identifier hs-var">onException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) impl. MonadIO m =&gt; LoggerCtx impl -&gt; m ()
</span><a href="Hasura.App.html#flushLogger"><span class="hs-identifier hs-var">flushLogger</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690648399"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadFix m, MonadStateless IO m, Forall (Pure m),
 ConsoleRenderer m, HttpLog m, UserAuthentication (TraceT m),
 MonadMetadataApiAuthorization m, MonadGQLExecutionCheck m,
 MonadConfigApiHandler m, MonadQueryLog m, MonadWSLog m,
 HasReporter m, MonadExecuteQuery m, HasResourceLimits m,
 MonadMetadataStorage (MetadataStorageT m), MonadResolveSource m,
 MonadQueryTags m, MonadEventLogCleanup m) =&gt;
(ServerCtx -&gt; SpockT m ())
-&gt; Environment
-&gt; Logger Hasura
-&gt; SQLGenCtx
-&gt; Bool
-&gt; Manager
-&gt; AuthMode
-&gt; CorsConfig
-&gt; Bool
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; Bool
-&gt; InstanceId
-&gt; HashSet API
-&gt; StreamQueriesOptions
-&gt; StreamQueriesOptions
-&gt; ResponseInternalErrorsConfig
-&gt; Maybe SubscriptionPostPollHook
-&gt; SchemaCacheRef
-&gt; Store EmptyMetrics
-&gt; ServerMetrics
-&gt; PrometheusMetrics
-&gt; RemoteSchemaPermissions
-&gt; InferFunctionPermissions
-&gt; ConnectionOptions
-&gt; KeepAliveDelay
-&gt; MaintenanceMode ()
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; HashSet ExperimentalFeature
-&gt; HashSet (EngineLogType Hasura)
-&gt; WSConnectionInitTimeout
-&gt; MetadataQueryLoggingMode
-&gt; Maybe NamingCase
-&gt; m HasuraApp
</span><a href="Hasura.Server.App.html#mkWaiApp"><span class="hs-identifier hs-var">mkWaiApp</span></a></span><span>
</span><span id="line-717"></span><span>          </span><span class="annot"><span class="annottext">ServerCtx -&gt; SpockT m ()
</span><a href="#local-6989586621690648459"><span class="hs-identifier hs-var">setupHook</span></a></span><span>
</span><span id="line-718"></span><span>          </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648458"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-719"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-720"></span><span>          </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621690648400"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-721"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690648439"><span class="hs-identifier hs-var">soEnableAllowlist</span></a></span><span>
</span><span id="line-722"></span><span>          </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-723"></span><span>          </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690648395"><span class="hs-identifier hs-var">authMode</span></a></span><span>
</span><span id="line-724"></span><span>          </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621690648449"><span class="hs-identifier hs-var">soCorsConfig</span></a></span><span>
</span><span id="line-725"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690648448"><span class="hs-identifier hs-var">soEnableConsole</span></a></span><span>
</span><span id="line-726"></span><span>          </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690648447"><span class="hs-identifier hs-var">soConsoleAssetsDir</span></a></span><span>
</span><span id="line-727"></span><span>          </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690648446"><span class="hs-identifier hs-var">soConsoleSentryDsn</span></a></span><span>
</span><span id="line-728"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690648445"><span class="hs-identifier hs-var">soEnableTelemetry</span></a></span><span>
</span><span id="line-729"></span><span>          </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690648415"><span class="hs-identifier hs-var">_scInstanceId</span></a></span><span>
</span><span id="line-730"></span><span>          </span><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621690648442"><span class="hs-identifier hs-var">soEnabledAPIs</span></a></span><span>
</span><span id="line-731"></span><span>          </span><span class="annot"><span class="annottext">StreamQueriesOptions
</span><a href="#local-6989586621690648441"><span class="hs-identifier hs-var">soLiveQueryOpts</span></a></span><span>
</span><span id="line-732"></span><span>          </span><span class="annot"><span class="annottext">StreamQueriesOptions
</span><a href="#local-6989586621690648440"><span class="hs-identifier hs-var">soStreamingQueryOpts</span></a></span><span>
</span><span id="line-733"></span><span>          </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621690648436"><span class="hs-identifier hs-var">soResponseInternalErrorsConfig</span></a></span><span>
</span><span id="line-734"></span><span>          </span><span class="annot"><span class="annottext">Maybe SubscriptionPostPollHook
</span><a href="#local-6989586621690648407"><span class="hs-identifier hs-var">postPollHook</span></a></span><span>
</span><span id="line-735"></span><span>          </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648409"><span class="hs-identifier hs-var">_scSchemaCacheRef</span></a></span><span>
</span><span id="line-736"></span><span>          </span><span class="annot"><span class="annottext">Store EmptyMetrics
</span><a href="#local-6989586621690648405"><span class="hs-identifier hs-var">ekgStore</span></a></span><span>
</span><span id="line-737"></span><span>          </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648406"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span>
</span><span id="line-738"></span><span>          </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648404"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span>
</span><span id="line-739"></span><span>          </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621690648432"><span class="hs-identifier hs-var">soEnableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-740"></span><span>          </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621690648429"><span class="hs-identifier hs-var">soInferFunctionPermissions</span></a></span><span>
</span><span id="line-741"></span><span>          </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621690648431"><span class="hs-identifier hs-var">soConnectionOptions</span></a></span><span>
</span><span id="line-742"></span><span>          </span><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621690648430"><span class="hs-identifier hs-var">soWebSocketKeepAlive</span></a></span><span>
</span><span id="line-743"></span><span>          </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621690648428"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span><span>
</span><span id="line-744"></span><span>          </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621690648421"><span class="hs-identifier hs-var">soEventingMode</span></a></span><span>
</span><span id="line-745"></span><span>          </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621690648420"><span class="hs-identifier hs-var">soReadOnlyMode</span></a></span><span>
</span><span id="line-746"></span><span>          </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690648426"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span>
</span><span id="line-747"></span><span>          </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621690648413"><span class="hs-identifier hs-var">_scEnabledLogTypes</span></a></span><span>
</span><span id="line-748"></span><span>          </span><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621690648422"><span class="hs-identifier hs-var">soWebSocketConnectionInitTimeout</span></a></span><span>
</span><span id="line-749"></span><span>          </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621690648419"><span class="hs-identifier hs-var">soEnableMetadataQueryLogging</span></a></span><span>
</span><span id="line-750"></span><span>          </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621690648418"><span class="hs-identifier hs-var">soDefaultNamingConvention</span></a></span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648387"><span class="annot"><span class="annottext">serverConfigCtx :: ServerConfigCtx
</span><a href="#local-6989586621690648387"><span class="hs-identifier hs-var hs-var">serverConfigCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; RemoteSchemaPermissions
-&gt; SQLGenCtx
-&gt; MaintenanceMode ()
-&gt; HashSet ExperimentalFeature
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; Maybe NamingCase
-&gt; ServerConfigCtx
</span><a href="Hasura.Server.Types.html#ServerConfigCtx"><span class="hs-identifier hs-var">ServerConfigCtx</span></a></span><span>
</span><span id="line-754"></span><span>          </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621690648429"><span class="hs-identifier hs-var">soInferFunctionPermissions</span></a></span><span>
</span><span id="line-755"></span><span>          </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621690648432"><span class="hs-identifier hs-var">soEnableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-756"></span><span>          </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621690648400"><span class="hs-identifier hs-var">sqlGenCtx</span></a></span><span>
</span><span id="line-757"></span><span>          </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621690648428"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span><span>
</span><span id="line-758"></span><span>          </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621690648426"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span><span>
</span><span id="line-759"></span><span>          </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621690648421"><span class="hs-identifier hs-var">soEventingMode</span></a></span><span>
</span><span id="line-760"></span><span>          </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621690648420"><span class="hs-identifier hs-var">soReadOnlyMode</span></a></span><span>
</span><span id="line-761"></span><span>          </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621690648418"><span class="hs-identifier hs-var">soDefaultNamingConvention</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-comment">-- Log Warning if deprecated environment variables are used</span><span>
</span><span id="line-764"></span><span>  </span><span id="local-6989586621690648386"><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621690648386"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; Environment -&gt; SourceCache -&gt; IO ()
</span><a href="Hasura.Server.Logging.html#logDeprecatedEnvVars"><span class="hs-identifier hs-var">logDeprecatedEnvVars</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648458"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SourceCache
</span><a href="#local-6989586621690648386"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-comment">-- log inconsistent schema objects</span><span>
</span><span id="line-768"></span><span>  </span><span id="local-6989586621690648383"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690648383"><span class="hs-identifier hs-var">inconsObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; [InconsistentMetadata] -&gt; IO ()
</span><a href="Hasura.Server.SchemaCacheRef.html#logInconsistentMetadata"><span class="hs-identifier hs-var">logInconsistentMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621690648383"><span class="hs-identifier hs-var">inconsObjs</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-comment">-- NOTE: `newLogTVar` is being used to make sure that the metadata logger runs only once</span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-comment">--       while logging errors or any `inconsistent_metadata` logs.</span><span>
</span><span id="line-773"></span><span>  </span><span id="local-6989586621690648381"><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621690648381"><span class="hs-identifier hs-var">newLogTVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-comment">-- Start a background thread for processing schema sync event present in the '_sscSyncEventRef'</span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><span class="annottext">Thread
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(ForkableMonadIO m, MonadMetadataStorage (MetadataStorageT m),
 MonadResolveSource m) =&gt;
Logger Hasura
-&gt; Manager
-&gt; TMVar MetadataResourceVersion
-&gt; SchemaCacheRef
-&gt; InstanceId
-&gt; ServerConfigCtx
-&gt; TVar Bool
-&gt; ManagedT m Thread
</span><a href="Hasura.Server.SchemaUpdate.html#startSchemaSyncProcessorThread"><span class="hs-identifier hs-var">startSchemaSyncProcessorThread</span></a></span><span>
</span><span id="line-778"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-779"></span><span>      </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-780"></span><span>      </span><span class="annot"><span class="annottext">TMVar MetadataResourceVersion
</span><a href="#local-6989586621690648408"><span class="hs-identifier hs-var">_scMetaVersionRef</span></a></span><span>
</span><span id="line-781"></span><span>      </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span>
</span><span id="line-782"></span><span>      </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690648415"><span class="hs-identifier hs-var">_scInstanceId</span></a></span><span>
</span><span id="line-783"></span><span>      </span><span class="annot"><span class="annottext">ServerConfigCtx
</span><a href="#local-6989586621690648387"><span class="hs-identifier hs-var">serverConfigCtx</span></a></span><span>
</span><span id="line-784"></span><span>      </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621690648381"><span class="hs-identifier hs-var">newLogTVar</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>  </span><span id="local-6989586621690648378"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648378"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span class="annot"><span class="annottext">TVar (Set CronEventId)
-&gt; TVar (Set CronEventId)
-&gt; TVar (HashMap SourceName (Set CronEventId))
-&gt; TVar (Set CronEventId)
-&gt; LockedEventsCtx
</span><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-var">LockedEventsCtx</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-791"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (TVar a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">STM.newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="#local-6989586621690648421"><span class="hs-identifier hs-var">soEventingMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-795"></span><span>    </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingEnabled"><span class="hs-identifier hs-var">EventingEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-796"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura -&gt; LockedEventsCtx -&gt; SchemaCacheRef -&gt; ManagedT m ()
</span><a href="#local-6989586621690648375"><span class="hs-identifier hs-var">startEventTriggerPollerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648378"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span>
</span><span id="line-797"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; LockedEventsCtx
-&gt; SchemaCacheRef
-&gt; AsyncActionSubscriptionState
-&gt; ManagedT m ()
</span><a href="#local-6989586621690648374"><span class="hs-identifier hs-var">startAsyncActionsPollerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648378"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621690648390"><span class="hs-identifier hs-var">actionSubState</span></a></span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-comment">-- start a background thread to create new cron events</span><span>
</span><span id="line-800"></span><span>      </span><span id="local-6989586621690648373"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621690648373"><span class="hs-identifier hs-var">_cronEventsThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-801"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runCronEventsGenerator&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-802"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) void.
(MonadIO m, MonadMetadataStorage (MetadataStorageT m)) =&gt;
Logger Hasura -&gt; IO SchemaCache -&gt; m void
</span><a href="Hasura.Eventing.ScheduledTrigger.html#runCronEventsGenerator"><span class="hs-identifier hs-var">runCronEventsGenerator</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura -&gt; LockedEventsCtx -&gt; SchemaCacheRef -&gt; ManagedT m ()
</span><a href="#local-6989586621690648370"><span class="hs-identifier hs-var">startScheduledEventsPollerThread</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648378"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span>
</span><span id="line-805"></span><span>    </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingDisabled"><span class="hs-identifier hs-var">EventingDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-806"></span><span>      </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;server&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;starting in eventing disabled mode&quot;</span></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-comment">-- start a background thread to check for updates</span><span>
</span><span id="line-809"></span><span>  </span><span id="local-6989586621690648368"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621690648368"><span class="hs-identifier hs-var">_updateThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-810"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkForUpdates&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-811"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a void. LoggerCtx a -&gt; Manager -&gt; IO void
</span><a href="Hasura.Server.CheckUpdates.html#checkForUpdates"><span class="hs-identifier hs-var">checkForUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">LoggerCtx Hasura
</span><a href="#local-6989586621690648399"><span class="hs-identifier hs-var">loggerCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>  </span><span class="hs-comment">-- start a background thread for telemetry</span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621690648367"><span class="annot"><span class="annottext">Maybe Thread
</span><a href="#local-6989586621690648367"><span class="hs-identifier hs-var">_telemetryThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-815"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690648445"><span class="hs-identifier hs-var">soEnableTelemetry</span></a></span><span>
</span><span id="line-816"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;telemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Hasura.App.html#telemetryNotice"><span class="hs-identifier hs-var">telemetryNotice</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>        </span><span id="local-6989586621690648365"><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621690648365"><span class="hs-identifier hs-var">dbUid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-820"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MetadataStorageT m a -&gt; m (Either QErr a)
</span><a href="Hasura.Metadata.Class.html#runMetadataStorageT"><span class="hs-identifier hs-var">runMetadataStorageT</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m MetadataDbId
</span><a href="Hasura.Metadata.Class.html#getMetadataDbUid"><span class="hs-identifier hs-var">getMetadataDbUid</span></a></span><span>
</span><span id="line-821"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>        </span><span id="local-6989586621690648362"><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621690648362"><span class="hs-identifier hs-var">pgVersion</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-823"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadIO m, MonadBaseControl IO m, FromPGTxErr e,
 FromPGConnErr e) =&gt;
PGPool -&gt; TxMode -&gt; TxET e m a -&gt; ExceptT e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.runTx</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690648412"><span class="hs-identifier hs-var">_scMetadataDbPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ReadCommitted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr PGVersion
</span><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-var">getPgVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b.
(ToJSON a, MonadIO m) =&gt;
ExitCode -&gt; a -&gt; m b
</span><a href="Hasura.App.html#throwErrJExit"><span class="hs-identifier hs-var">throwErrJExit</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="Hasura.App.html#DatabaseMigrationError"><span class="hs-identifier hs-var">DatabaseMigrationError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>        </span><span id="local-6989586621690648359"><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621690648359"><span class="hs-identifier hs-var">telemetryThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-827"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runTelemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-828"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall void.
Logger Hasura
-&gt; Manager
-&gt; IO SchemaCache
-&gt; MetadataDbId
-&gt; InstanceId
-&gt; PGVersion
-&gt; IO void
</span><a href="Hasura.Server.Telemetry.html#runTelemetry"><span class="hs-identifier hs-var">runTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648398"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648391"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MetadataDbId
</span><a href="#local-6989586621690648365"><span class="hs-identifier hs-var">dbUid</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690648415"><span class="hs-identifier hs-var">_scInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">PGVersion
</span><a href="#local-6989586621690648362"><span class="hs-identifier hs-var">pgVersion</span></a></span><span>
</span><span id="line-829"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Thread
</span><a href="#local-6989586621690648359"><span class="hs-identifier hs-var">telemetryThread</span></a></span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-comment">-- These cleanup actions are not directly associated with any</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-comment">-- resource, but we still need to make sure we clean them up here.</span><span>
</span><span id="line-834"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; m b -&gt; ManagedT m ()
</span><a href="Control.Monad.Trans.Managed.html#allocate_"><span class="hs-identifier hs-var">allocate_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648389"><span class="hs-identifier hs-var">stopWsServer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621690648392"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-838"></span><span>    </span><span id="local-6989586621690648353"><span class="annot"><span class="annottext">isRetryRequired :: p -&gt; Either QErr b -&gt; m Bool
</span><a href="#local-6989586621690648353"><span class="hs-identifier hs-var hs-var">isRetryRequired</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690648352"><span class="annot"><span class="annottext">Either QErr b
</span><a href="#local-6989586621690648352"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-839"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr b
</span><a href="#local-6989586621690648352"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-840"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-841"></span><span>        </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621690648351"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648351"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Code
</span><a href="Hasura.Base.Error.html#qeCode"><span class="hs-identifier hs-var">qeCode</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648351"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#ConcurrentUpdate"><span class="hs-identifier hs-var">ConcurrentUpdate</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>    </span><span id="local-6989586621690648325"><span class="annot"><span class="annottext">prepareScheduledEvents :: Logger impl -&gt; m ()
</span><a href="#local-6989586621690648325"><span class="hs-identifier hs-var hs-var">prepareScheduledEvents</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621690648324"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a impl, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648324"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a impl, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648324"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scheduled_triggers&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;preparing data&quot;</span></span><span>
</span><span id="line-845"></span><span>      </span><span id="local-6989586621690648323"><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621690648323"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadIO m =&gt;
RetryPolicyM m
-&gt; (RetryStatus -&gt; b -&gt; m Bool) -&gt; (RetryStatus -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">Retry.retrying</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; RetryPolicyM m
</span><span class="hs-identifier hs-var">Retry.retryPolicyDefault</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {p} {b}.
Monad m =&gt;
p -&gt; Either QErr b -&gt; m Bool
</span><a href="#local-6989586621690648353"><span class="hs-identifier hs-var">isRetryRequired</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MetadataStorageT m a -&gt; m (Either QErr a)
</span><a href="Hasura.Metadata.Class.html#runMetadataStorageT"><span class="hs-identifier hs-var">runMetadataStorageT</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m ()
</span><a href="Hasura.Metadata.Class.html#unlockAllLockedScheduledEvents"><span class="hs-identifier hs-var">unlockAllLockedScheduledEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621690648323"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621690648319"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648319"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a impl, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648324"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scheduled_triggers&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648319"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span>    </span><span class="annot"><a href="#local-6989586621690648317"><span class="hs-identifier hs-type">getProcessingScheduledEventsCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621690648317"><span class="annot"><span class="annottext">getProcessingScheduledEventsCount :: LockedEventsCtx -&gt; IO Int
</span><a href="#local-6989586621690648317"><span class="hs-identifier hs-var hs-var">getProcessingScheduledEventsCount</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690648313"><span id="local-6989586621690648314"><span id="local-6989586621690648315"><span id="local-6989586621690648316"><span class="annot"><span class="annottext">TVar (Set CronEventId)
TVar (HashMap SourceName (Set CronEventId))
leActionEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leEvents :: LockedEventsCtx -&gt; TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leCronEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leActionEvents :: TVar (Set CronEventId)
leEvents :: TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: TVar (Set CronEventId)
leCronEvents :: TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>      </span><span id="local-6989586621690648308"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648308"><span class="hs-identifier hs-var">processingCronEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set CronEventId)
</span><a href="#local-6989586621690648316"><span class="hs-identifier hs-var">leCronEvents</span></a></span><span>
</span><span id="line-851"></span><span>      </span><span id="local-6989586621690648307"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648307"><span class="hs-identifier hs-var">processingOneOffEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set CronEventId)
</span><a href="#local-6989586621690648315"><span class="hs-identifier hs-var">leOneOffEvents</span></a></span><span>
</span><span id="line-852"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648307"><span class="hs-identifier hs-var">processingOneOffEvents</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648308"><span class="hs-identifier hs-var">processingCronEvents</span></a></span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span>    </span><span class="annot"><a href="#local-6989586621690648304"><span class="hs-identifier hs-type">shutdownEventTriggerEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-855"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#BackendSourceInfo"><span class="hs-identifier hs-type">BackendSourceInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-856"></span><span>      </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-857"></span><span>      </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-858"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>    </span><span id="local-6989586621690648304"><span class="annot"><span class="annottext">shutdownEventTriggerEvents :: [BackendSourceInfo] -&gt; Logger Hasura -&gt; LockedEventsCtx -&gt; IO ()
</span><a href="#local-6989586621690648304"><span class="hs-identifier hs-var hs-var">shutdownEventTriggerEvents</span></a></span></span><span> </span><span id="local-6989586621690648303"><span class="annot"><span class="annottext">[BackendSourceInfo]
</span><a href="#local-6989586621690648303"><span class="hs-identifier hs-var">sources</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621690648302"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648302"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690648298"><span id="local-6989586621690648299"><span id="local-6989586621690648300"><span id="local-6989586621690648301"><span class="annot"><span class="annottext">TVar (Set CronEventId)
TVar (HashMap SourceName (Set CronEventId))
leActionEvents :: TVar (Set CronEventId)
leEvents :: TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: TVar (Set CronEventId)
leCronEvents :: TVar (Set CronEventId)
leActionEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leEvents :: LockedEventsCtx -&gt; TVar (HashMap SourceName (Set CronEventId))
leOneOffEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
leCronEvents :: LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="#local-6989586621690648298"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-860"></span><span>      </span><span class="hs-comment">-- TODO: is this correct?</span><span>
</span><span id="line-861"></span><span>      </span><span class="hs-comment">-- event triggers should be tied to the life cycle of a source</span><span>
</span><span id="line-862"></span><span>      </span><span id="local-6989586621690648297"><span class="annot"><span class="annottext">HashMap SourceName (Set CronEventId)
</span><a href="#local-6989586621690648297"><span class="hs-identifier hs-var">lockedEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (HashMap SourceName (Set CronEventId))
</span><a href="#local-6989586621690648299"><span class="hs-identifier hs-var">leEvents</span></a></span><span>
</span><span id="line-863"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[BackendSourceInfo]
</span><a href="#local-6989586621690648303"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648295"><span class="annot"><span class="annottext">BackendSourceInfo
</span><a href="#local-6989586621690648295"><span class="hs-identifier hs-var">backendSourceInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-864"></span><span>        </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceInfo
</span><a href="#local-6989586621690648295"><span class="hs-identifier hs-var">backendSourceInfo</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621690648252"><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span id="local-6989586621690648250"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690648250"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span class="annot"><span class="annottext">TableCache b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunctionCache b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690648249"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690648249"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ResolvedSourceCustomization
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceInfo"><span class="hs-identifier hs-type">SourceInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690648252"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-865"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648248"><span class="annot"><span class="annottext">sourceNameText :: Text
</span><a href="#local-6989586621690648248"><span class="hs-identifier hs-var hs-var">sourceNameText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#sourceNameToText"><span class="hs-identifier hs-var">sourceNameToText</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690648250"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-866"></span><span>          </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_triggers&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unlocking events of source: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690648248"><span class="hs-identifier hs-var">sourceNameText</span></a></span><span>
</span><span id="line-867"></span><span>          </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690648250"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap SourceName (Set CronEventId)
</span><a href="#local-6989586621690648297"><span class="hs-identifier hs-var">lockedEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648245"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648245"><span class="hs-identifier hs-var">sourceLockedEvents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-868"></span><span>            </span><span class="hs-comment">-- No need to execute unlockEventsTx when events are not present</span><span>
</span><span id="line-869"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NE.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648245"><span class="hs-identifier hs-var">sourceLockedEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648243"><span class="annot"><span class="annottext">NESet CronEventId
</span><a href="#local-6989586621690648243"><span class="hs-identifier hs-var">nonEmptyLockedEvents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-870"></span><span>              </span><span id="local-6989586621690648242"><span class="annot"><span class="annottext">Either QErr Int
</span><a href="#local-6989586621690648242"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b.
MonadIO m =&gt;
RetryPolicyM m
-&gt; (RetryStatus -&gt; b -&gt; m Bool) -&gt; (RetryStatus -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">Retry.retrying</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; RetryPolicyM m
</span><span class="hs-identifier hs-var">Retry.retryPolicyDefault</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {p} {b}.
Monad m =&gt;
p -&gt; Either QErr b -&gt; m Bool
</span><a href="#local-6989586621690648353"><span class="hs-identifier hs-var">isRetryRequired</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadIO m) =&gt;
SourceConfig b -&gt; NESet CronEventId -&gt; m (Either QErr Int)
</span><a href="Hasura.RQL.Types.Eventing.Backend.html#unlockEventsInSource"><span class="hs-identifier hs-var">unlockEventsInSource</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621690648252"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621690648249"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">NESet CronEventId
</span><a href="#local-6989586621690648243"><span class="hs-identifier hs-var">nonEmptyLockedEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either QErr Int
</span><a href="#local-6989586621690648242"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-872"></span><span>                </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621690648240"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648240"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-873"></span><span>                  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-874"></span><span>                    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_trigger&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-875"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error while unlocking event trigger events of source: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690648248"><span class="hs-identifier hs-var">sourceNameText</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; error:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="Hasura.Base.Error.html#showQErr"><span class="hs-identifier hs-var">showQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648240"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-876"></span><span>                </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621690648238"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690648238"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-877"></span><span>                  </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-878"></span><span>                    </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_trigger&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-879"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690648238"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; events of source &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690648248"><span class="hs-identifier hs-var">sourceNameText</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; were successfully unlocked&quot;</span></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>    </span><span class="annot"><a href="#local-6989586621690648236"><span class="hs-identifier hs-type">shutdownAsyncActions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-882"></span><span>      </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-883"></span><span>      </span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650168"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>    </span><span id="local-6989586621690648236"><span class="annot"><span class="annottext">shutdownAsyncActions :: LockedEventsCtx -&gt; MetadataStorageT m ()
</span><a href="#local-6989586621690648236"><span class="hs-identifier hs-var hs-var">shutdownAsyncActions</span></a></span></span><span> </span><span id="local-6989586621690648235"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648235"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>      </span><span id="local-6989586621690648234"><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648234"><span class="hs-identifier hs-var">lockedActionEvents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-identifier hs-var">leActionEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648235"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span>
</span><span id="line-886"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
LockedActionIdArray -&gt; m ()
</span><a href="Hasura.Metadata.Class.html#setProcessingActionLogsToPending"><span class="hs-identifier hs-var">setProcessingActionLogsToPending</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CronEventId] -&gt; LockedActionIdArray
</span><a href="Hasura.RQL.Types.Action.html#LockedActionIdArray"><span class="hs-identifier hs-var">LockedActionIdArray</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set CronEventId
</span><a href="#local-6989586621690648234"><span class="hs-identifier hs-var">lockedActionEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-comment">-- This function is a helper function to do couple of things:</span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-comment">-- 1. When the value of the `graceful-shutdown-timeout` &gt; 0, we poll</span><span>
</span><span id="line-891"></span><span>    </span><span class="hs-comment">--    the in-flight events queue we maintain using the `processingEventsCountAction`</span><span>
</span><span id="line-892"></span><span>    </span><span class="hs-comment">--    number of in-flight processing events, in case of actions it is the</span><span>
</span><span id="line-893"></span><span>    </span><span class="hs-comment">--    actions which are in 'processing' state and in scheduled events</span><span>
</span><span id="line-894"></span><span>    </span><span class="hs-comment">--    it is the events which are in 'locked' state. The in-flight events queue is polled</span><span>
</span><span id="line-895"></span><span>    </span><span class="hs-comment">--    every 5 seconds until either the graceful shutdown time is exhausted</span><span>
</span><span id="line-896"></span><span>    </span><span class="hs-comment">--    or the number of in-flight processing events is 0.</span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-comment">-- 2. After step 1, we unlock all the events which were attempted to process by the current</span><span>
</span><span id="line-898"></span><span>    </span><span class="hs-comment">--    graphql-engine instance that are still in the processing</span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-comment">--    state. In actions, it means to set the status of such actions to 'pending'</span><span>
</span><span id="line-900"></span><span>    </span><span class="hs-comment">--    and in scheduled events, the status will be set to 'unlocked'.</span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><a href="#local-6989586621690648230"><span class="hs-identifier hs-type">waitForProcessingAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-902"></span><span>      </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-903"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-904"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-905"></span><span>      </span><span class="annot"><a href="Hasura.App.html#ShutdownAction"><span class="hs-identifier hs-type">ShutdownAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-906"></span><span>      </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-type">Seconds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-907"></span><span>      </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>    </span><span id="local-6989586621690648230"><span class="annot"><span class="annottext">waitForProcessingAction :: Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621690648230"><span class="hs-identifier hs-var hs-var">waitForProcessingAction</span></a></span></span><span> </span><span id="local-6989586621690648229"><span class="annot"><span class="annottext">l :: Logger Hasura
</span><a href="#local-6989586621690648229"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span id="local-6989586621690648228"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648228"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621690648227"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690648227"><span class="hs-identifier hs-var">actionType</span></a></span></span><span> </span><span id="local-6989586621690648226"><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621690648226"><span class="hs-identifier hs-var">processingEventsCountAction'</span></a></span></span><span> </span><span id="local-6989586621690648225"><span class="annot"><span class="annottext">ShutdownAction
</span><a href="#local-6989586621690648225"><span class="hs-identifier hs-var">shutdownAction</span></a></span></span><span> </span><span id="local-6989586621690648224"><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621690648224"><span class="hs-identifier hs-var">maxTimeout</span></a></span></span><span>
</span><span id="line-909"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621690648224"><span class="hs-identifier hs-var">maxTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShutdownAction
</span><a href="#local-6989586621690648225"><span class="hs-identifier hs-var">shutdownAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-911"></span><span>          </span><span class="annot"><a href="Hasura.App.html#EventTriggerShutdownAction"><span class="hs-identifier hs-type">EventTriggerShutdownAction</span></a></span><span> </span><span id="local-6989586621690648222"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648222"><span class="hs-identifier hs-var">userDBShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648222"><span class="hs-identifier hs-var">userDBShutdownAction</span></a></span><span>
</span><span id="line-912"></span><span>          </span><span class="annot"><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-type">MetadataDBShutdownAction</span></a></span><span> </span><span id="local-6989586621690648221"><span class="annot"><span class="annottext">MetadataStorageT IO ()
</span><a href="#local-6989586621690648221"><span class="hs-identifier hs-var">metadataDBShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-913"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MetadataStorageT m a -&gt; m (Either QErr a)
</span><a href="Hasura.Metadata.Class.html#runMetadataStorageT"><span class="hs-identifier hs-var">runMetadataStorageT</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataStorageT IO ()
</span><a href="#local-6989586621690648221"><span class="hs-identifier hs-var">metadataDBShutdownAction</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-914"></span><span>              </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621690648220"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648220"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-915"></span><span>                </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648228"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-916"></span><span>                  </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; LogLevel -&gt; Text -&gt; a -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericLog"><span class="hs-identifier hs-var">mkGenericLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690648227"><span class="hs-identifier hs-var">actionType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-917"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error while unlocking the processing  &quot;</span></span><span>
</span><span id="line-918"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690648227"><span class="hs-identifier hs-var">actionType</span></a></span><span>
</span><span id="line-919"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; err - &quot;</span></span><span>
</span><span id="line-920"></span><span>                      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="Hasura.Base.Error.html#showQErr"><span class="hs-identifier hs-var">showQErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648220"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-921"></span><span>              </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-923"></span><span>        </span><span id="local-6989586621690648219"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690648219"><span class="hs-identifier hs-var">processingEventsCount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621690648226"><span class="hs-identifier hs-var">processingEventsCountAction'</span></a></span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690648219"><span class="hs-identifier hs-var">processingEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-926"></span><span>            </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621690648228"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-927"></span><span>              </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690648227"><span class="hs-identifier hs-var">actionType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-928"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;All in-flight events have finished processing&quot;</span></span><span>
</span><span id="line-929"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690648219"><span class="hs-identifier hs-var">processingEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-930"></span><span>            </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">C.sleep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- sleep for 5 seconds and then repeat</span><span>
</span><span id="line-931"></span><span>            </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621690648230"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648229"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690648227"><span class="hs-identifier hs-var">actionType</span></a></span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621690648226"><span class="hs-identifier hs-var">processingEventsCountAction'</span></a></span><span> </span><span class="annot"><span class="annottext">ShutdownAction
</span><a href="#local-6989586621690648225"><span class="hs-identifier hs-var">shutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621690648224"><span class="hs-identifier hs-var">maxTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; Seconds
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">Seconds</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>    </span><span id="local-6989586621690648375"><span class="annot"><span class="annottext">startEventTriggerPollerThread :: Logger Hasura -&gt; LockedEventsCtx -&gt; SchemaCacheRef -&gt; ManagedT m ()
</span><a href="#local-6989586621690648375"><span class="hs-identifier hs-var hs-var">startEventTriggerPollerThread</span></a></span></span><span> </span><span id="local-6989586621690648215"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648215"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690648214"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648214"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span id="local-6989586621690648213"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648213"><span class="hs-identifier hs-var">cacheRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-934"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648212"><span class="annot"><span class="annottext">maxEventThreads :: Int
</span><a href="#local-6989586621690648212"><span class="hs-identifier hs-var hs-var">maxEventThreads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined Positive Int
</span><a href="#local-6989586621690648435"><span class="hs-identifier hs-var">soEventsHttpPoolSize</span></a></span><span>
</span><span id="line-935"></span><span>          </span><span id="local-6989586621690648211"><span class="annot"><span class="annottext">fetchInterval :: DiffTime
</span><a href="#local-6989586621690648211"><span class="hs-identifier hs-var hs-var">fetchInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Milliseconds -&gt; DiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">milliseconds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Milliseconds
</span><a href="#local-6989586621690648434"><span class="hs-identifier hs-var">soEventsFetchInterval</span></a></span><span>
</span><span id="line-936"></span><span>          </span><span id="local-6989586621690648209"><span class="annot"><span class="annottext">allSources :: [BackendSourceInfo]
</span><a href="#local-6989586621690648209"><span class="hs-identifier hs-var hs-var">allSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [v]
</span><span class="hs-identifier hs-var">HM.elems</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache -&gt; SchemaCache
</span><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#lastBuiltSchemaCache"><span class="hs-identifier hs-var">lastBuiltSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">RebuildableSchemaCache
</span><a href="#local-6989586621690648410"><span class="hs-identifier hs-var">_scSchemaCache</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Int
</span><a href="#local-6989586621690648425"><span class="hs-identifier hs-var">soEventsFetchBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621690648211"><span class="hs-identifier hs-var">fetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-939"></span><span>        </span><span class="hs-comment">-- Don't start the events poller thread when fetchBatchSize or fetchInterval is 0</span><span>
</span><span id="line-940"></span><span>        </span><span class="hs-comment">-- prepare event triggers data</span><span>
</span><span id="line-941"></span><span>        </span><span id="local-6989586621690648205"><span class="annot"><span class="annottext">EventEngineCtx
</span><a href="#local-6989586621690648205"><span class="hs-identifier hs-var">eventEngineCtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; DiffTime -&gt; Refined NonNegative Int -&gt; STM EventEngineCtx
</span><a href="Hasura.Eventing.EventTrigger.html#initEventEngineCtx"><span class="hs-identifier hs-var">initEventEngineCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690648212"><span class="hs-identifier hs-var">maxEventThreads</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621690648211"><span class="hs-identifier hs-var">fetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Int
</span><a href="#local-6989586621690648425"><span class="hs-identifier hs-var">soEventsFetchBatchSize</span></a></span><span>
</span><span id="line-942"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648203"><span class="annot"><span class="annottext">eventsGracefulShutdownAction :: IO ()
</span><a href="#local-6989586621690648203"><span class="hs-identifier hs-var hs-var">eventsGracefulShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-943"></span><span>              </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621690648230"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span>
</span><span id="line-944"></span><span>                </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648215"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-945"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;event_triggers&quot;</span></span><span>
</span><span id="line-946"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (HashMap SourceName (Set CronEventId))
</span><a href="Hasura.Eventing.Common.html#leEvents"><span class="hs-identifier hs-var">leEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648214"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; ShutdownAction
</span><a href="Hasura.App.html#EventTriggerShutdownAction"><span class="hs-identifier hs-var">EventTriggerShutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BackendSourceInfo] -&gt; Logger Hasura -&gt; LockedEventsCtx -&gt; IO ()
</span><a href="#local-6989586621690648304"><span class="hs-identifier hs-var">shutdownEventTriggerEvents</span></a></span><span> </span><span class="annot"><span class="annottext">[BackendSourceInfo]
</span><a href="#local-6989586621690648209"><span class="hs-identifier hs-var">allSources</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648215"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648214"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621690648423"><span class="hs-identifier hs-var">soGracefulShutdownTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>        </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648215"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; String -&gt; StartupLog
</span><a href="Hasura.Server.Init.Logging.html#mkGenericStrLog"><span class="hs-identifier hs-var">mkGenericStrLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_triggers&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;starting workers&quot;</span></span><span>
</span><span id="line-950"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-951"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String
-&gt; Logger Hasura
-&gt; ThreadShutdown m
-&gt; m (Forever m)
-&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedTWithGracefulShutdown"><span class="hs-identifier hs-var">C.forkManagedTWithGracefulShutdown</span></a></span><span>
</span><span id="line-952"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;processEventQueue&quot;</span></span><span>
</span><span id="line-953"></span><span>            </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648215"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-954"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). m () -&gt; ThreadShutdown m
</span><a href="Control.Concurrent.Extended.html#ThreadShutdown"><span class="hs-identifier hs-var">C.ThreadShutdown</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621690648203"><span class="hs-identifier hs-var">eventsGracefulShutdownAction</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, HasReporter m, MonadBaseControl IO m, Forall (Pure m),
 MonadMask m) =&gt;
Logger Hasura
-&gt; Manager
-&gt; IO SchemaCache
-&gt; EventEngineCtx
-&gt; LockedEventsCtx
-&gt; ServerMetrics
-&gt; EventTriggerMetrics
-&gt; MaintenanceMode ()
-&gt; m (Forever m)
</span><a href="Hasura.Eventing.EventTrigger.html#processEventQueue"><span class="hs-identifier hs-var">processEventQueue</span></a></span><span>
</span><span id="line-956"></span><span>              </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648215"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-957"></span><span>              </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-958"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648213"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span>              </span><span class="annot"><span class="annottext">EventEngineCtx
</span><a href="#local-6989586621690648205"><span class="hs-identifier hs-var">eventEngineCtx</span></a></span><span>
</span><span id="line-960"></span><span>              </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648214"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span>
</span><span id="line-961"></span><span>              </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621690648406"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span>
</span><span id="line-962"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; EventTriggerMetrics
</span><a href="Hasura.Server.Prometheus.html#pmEventTriggerMetrics"><span class="hs-identifier hs-var">pmEventTriggerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621690648404"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>              </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621690648428"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span>    </span><span id="local-6989586621690648374"><span class="annot"><span class="annottext">startAsyncActionsPollerThread :: Logger Hasura
-&gt; LockedEventsCtx
-&gt; SchemaCacheRef
-&gt; AsyncActionSubscriptionState
-&gt; ManagedT m ()
</span><a href="#local-6989586621690648374"><span class="hs-identifier hs-var hs-var">startAsyncActionsPollerThread</span></a></span></span><span> </span><span id="local-6989586621690648198"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648198"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690648197"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648197"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span id="local-6989586621690648196"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648196"><span class="hs-identifier hs-var">cacheRef</span></a></span></span><span> </span><span id="local-6989586621690648195"><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621690648195"><span class="hs-identifier hs-var">actionSubState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-966"></span><span>      </span><span class="hs-comment">-- start a background thread to handle async actions</span><span>
</span><span id="line-967"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621690648433"><span class="hs-identifier hs-var">soAsyncActionsFetchInterval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-968"></span><span>        </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#Skip"><span class="hs-identifier hs-var">Skip</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Don't start the poller thread</span><span>
</span><span id="line-969"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#Interval"><span class="hs-identifier hs-type">Interval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621690648194"><span class="annot"><span class="annottext">Milliseconds
</span><a href="#local-6989586621690648194"><span class="hs-identifier hs-var">sleepTime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-970"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648192"><span class="annot"><span class="annottext">label :: String
</span><a href="#local-6989586621690648192"><span class="hs-keyword hs-var hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;asyncActionsProcessor&quot;</span></span><span>
</span><span id="line-971"></span><span>              </span><span id="local-6989586621690648191"><span class="annot"><span class="annottext">asyncActionGracefulShutdownAction :: m ()
</span><a href="#local-6989586621690648191"><span class="hs-identifier hs-var hs-var">asyncActionGracefulShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-972"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648189"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621690648189"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-973"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621690648230"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span>
</span><span id="line-974"></span><span>                        </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648198"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-975"></span><span>                        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;async_actions&quot;</span></span><span>
</span><span id="line-976"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TVar a -&gt; IO a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-identifier hs-var">leActionEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648197"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-977"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataStorageT IO () -&gt; ShutdownAction
</span><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-var">MetadataDBShutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
</span><span class="hs-identifier hs-var">hoist</span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621690648189"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; MetadataStorageT m ()
</span><a href="#local-6989586621690648236"><span class="hs-identifier hs-var">shutdownAsyncActions</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648197"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621690648423"><span class="hs-identifier hs-var">soGracefulShutdownTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-983"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String
-&gt; Logger Hasura
-&gt; ThreadShutdown m
-&gt; m (Forever m)
-&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedTWithGracefulShutdown"><span class="hs-identifier hs-var">C.forkManagedTWithGracefulShutdown</span></a></span><span>
</span><span id="line-984"></span><span>              </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621690648192"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-985"></span><span>              </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648198"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-986"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). m () -&gt; ThreadShutdown m
</span><a href="Control.Concurrent.Extended.html#ThreadShutdown"><span class="hs-identifier hs-var">C.ThreadShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621690648191"><span class="hs-identifier hs-var">asyncActionGracefulShutdownAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span>              </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, Forall (Pure m), HasReporter m,
 MonadMetadataStorage (MetadataStorageT m)) =&gt;
Environment
-&gt; Logger Hasura
-&gt; IO SchemaCache
-&gt; TVar (Set CronEventId)
-&gt; Manager
-&gt; Milliseconds
-&gt; Maybe GQLQueryText
-&gt; m (Forever m)
</span><a href="Hasura.GraphQL.Execute.Action.html#asyncActionsProcessor"><span class="hs-identifier hs-var">asyncActionsProcessor</span></a></span><span>
</span><span id="line-988"></span><span>                </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648458"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-989"></span><span>                </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648198"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-990"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648196"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; TVar (Set CronEventId)
</span><a href="Hasura.Eventing.Common.html#leActionEvents"><span class="hs-identifier hs-var">leActionEvents</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648197"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span>                </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-993"></span><span>                </span><span class="annot"><span class="annottext">Milliseconds
</span><a href="#local-6989586621690648194"><span class="hs-identifier hs-var">sleepTime</span></a></span><span>
</span><span id="line-994"></span><span>                </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-comment">-- start a background thread to handle async action live queries</span><span>
</span><span id="line-997"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-998"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String -&gt; Logger Hasura -&gt; m Void -&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedT"><span class="hs-identifier hs-var">C.forkManagedT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;asyncActionSubscriptionsProcessor&quot;</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648198"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-999"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) void.
(MonadIO m, MonadMetadataStorage (MetadataStorageT m)) =&gt;
AsyncActionSubscriptionState -&gt; m void
</span><a href="Hasura.GraphQL.Execute.Action.Subscription.html#asyncActionSubscriptionsProcessor"><span class="hs-identifier hs-var">asyncActionSubscriptionsProcessor</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncActionSubscriptionState
</span><a href="#local-6989586621690648195"><span class="hs-identifier hs-var">actionSubState</span></a></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span>    </span><span id="local-6989586621690648370"><span class="annot"><span class="annottext">startScheduledEventsPollerThread :: Logger Hasura -&gt; LockedEventsCtx -&gt; SchemaCacheRef -&gt; ManagedT m ()
</span><a href="#local-6989586621690648370"><span class="hs-identifier hs-var hs-var">startScheduledEventsPollerThread</span></a></span></span><span> </span><span id="local-6989586621690648186"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648186"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690648185"><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648185"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span></span><span> </span><span id="local-6989586621690648184"><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648184"><span class="hs-identifier hs-var">cacheRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1002"></span><span>      </span><span class="hs-comment">-- prepare scheduled triggers</span><span>
</span><span id="line-1003"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {impl}.
(MonadIO m, ToEngineLog StartupLog impl,
 MonadMetadataStorage (MetadataStorageT m)) =&gt;
Logger impl -&gt; m ()
</span><a href="#local-6989586621690648325"><span class="hs-identifier hs-var">prepareScheduledEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648186"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>      </span><span class="hs-comment">-- start a background thread to deliver the scheduled events</span><span>
</span><span id="line-1006"></span><span>      </span><span class="hs-comment">-- _scheduledEventsThread &lt;- do</span><span>
</span><span id="line-1007"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648183"><span class="annot"><span class="annottext">scheduledEventsGracefulShutdownAction :: m ()
</span><a href="#local-6989586621690648183"><span class="hs-identifier hs-var hs-var">scheduledEventsGracefulShutdownAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1008"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) c.
MonadStateless b m =&gt;
((forall a. m a -&gt; b a) -&gt; b c) -&gt; m c
</span><a href="Control.Monad.Stateless.html#liftWithStateless"><span class="hs-identifier hs-var">liftWithStateless</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621690648182"><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621690648182"><span class="hs-identifier hs-var">lowerIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1009"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; String -&gt; IO Int -&gt; ShutdownAction -&gt; Seconds -&gt; IO ()
</span><a href="#local-6989586621690648230"><span class="hs-identifier hs-var">waitForProcessingAction</span></a></span><span>
</span><span id="line-1010"></span><span>                    </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648186"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1011"></span><span>                    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scheduled_events&quot;</span></span><span>
</span><span id="line-1012"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LockedEventsCtx -&gt; IO Int
</span><a href="#local-6989586621690648317"><span class="hs-identifier hs-var">getProcessingScheduledEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648185"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataStorageT IO () -&gt; ShutdownAction
</span><a href="Hasura.App.html#MetadataDBShutdownAction"><span class="hs-identifier hs-var">MetadataDBShutdownAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
</span><span class="hs-identifier hs-var">hoist</span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; IO a
</span><a href="#local-6989586621690648182"><span class="hs-identifier hs-var">lowerIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadMetadataStorage m =&gt; m ()
</span><a href="Hasura.Metadata.Class.html#unlockAllLockedScheduledEvents"><span class="hs-identifier hs-var">unlockAllLockedScheduledEvents</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (p :: k) x. Refined p x -&gt; x
</span><span class="hs-identifier hs-var">unrefine</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Seconds
</span><a href="#local-6989586621690648423"><span class="hs-identifier hs-var">soGracefulShutdownTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1019"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
ForkableMonadIO m =&gt;
String
-&gt; Logger Hasura
-&gt; ThreadShutdown m
-&gt; m (Forever m)
-&gt; ManagedT m Thread
</span><a href="Control.Concurrent.Extended.html#forkManagedTWithGracefulShutdown"><span class="hs-identifier hs-var">C.forkManagedTWithGracefulShutdown</span></a></span><span>
</span><span id="line-1020"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;processScheduledTriggers&quot;</span></span><span>
</span><span id="line-1021"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648186"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1022"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). m () -&gt; ThreadShutdown m
</span><a href="Control.Concurrent.Extended.html#ThreadShutdown"><span class="hs-identifier hs-var">C.ThreadShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621690648183"><span class="hs-identifier hs-var">scheduledEventsGracefulShutdownAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, HasReporter m,
 MonadMetadataStorage (MetadataStorageT m)) =&gt;
Environment
-&gt; Logger Hasura
-&gt; Manager
-&gt; IO SchemaCache
-&gt; LockedEventsCtx
-&gt; m (Forever m)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledTriggers"><span class="hs-identifier hs-var">processScheduledTriggers</span></a></span><span>
</span><span id="line-1024"></span><span>            </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690648458"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1025"></span><span>            </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648186"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1026"></span><span>            </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648416"><span class="hs-identifier hs-var">_scHttpManager</span></a></span><span>
</span><span id="line-1027"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCacheRef -&gt; IO SchemaCache
</span><a href="Hasura.Server.SchemaCacheRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCacheRef
</span><a href="#local-6989586621690648184"><span class="hs-identifier hs-var">cacheRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>            </span><span class="annot"><span class="annottext">LockedEventsCtx
</span><a href="#local-6989586621690648185"><span class="hs-identifier hs-var">lockedEventsCtx</span></a></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690648177"><span id="local-6989586621690650015"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650015"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Tracing.html#HasReporter"><span class="hs-identifier hs-type">Tracing.HasReporter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650015"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690650008"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650008"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690650008"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1033"></span><span>  </span><span id="local-6989586621690648166"><span class="annot"><span class="annottext">askHTTPHandlerLimit :: PGMetadataStorageAppT m ResourceLimits
</span><a href="Hasura.Server.Limits.html#askHTTPHandlerLimit"><span class="hs-identifier hs-var hs-var hs-var hs-var">askHTTPHandlerLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) a.
 (MonadBaseControl IO m, MonadError QErr m) =&gt;
 m a -&gt; m a)
-&gt; ResourceLimits
</span><a href="Hasura.Server.Limits.html#ResourceLimits"><span class="hs-identifier hs-var">ResourceLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1034"></span><span>  </span><span id="local-6989586621690648160"><span class="annot"><span class="annottext">askGraphqlOperationLimit :: RequestId
-&gt; PGMetadataStorageAppT m (UserInfo -&gt; ApiLimit -&gt; ResourceLimits)
</span><a href="Hasura.Server.Limits.html#askGraphqlOperationLimit"><span class="hs-identifier hs-var hs-var hs-var hs-var">askGraphqlOperationLimit</span></a></span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiLimit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) a.
 (MonadBaseControl IO m, MonadError QErr m) =&gt;
 m a -&gt; m a)
-&gt; ResourceLimits
</span><a href="Hasura.Server.Limits.html#ResourceLimits"><span class="hs-identifier hs-var">ResourceLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649994"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649994"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html#HttpLog"><span class="hs-identifier hs-type">HttpLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649994"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1037"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ExtraHttpLogMetadata"><span class="annot"><a href="Hasura.Server.Logging.html#ExtraHttpLogMetadata"><span class="hs-identifier hs-var">ExtraHttpLogMetadata</span></a></span></span><span> </span><span id="local-6989586621690649994"><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649994"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span>  </span><span id="local-6989586621690648146"><span class="annot"><span class="annottext">emptyExtraHttpLogMetadata :: ExtraHttpLogMetadata (PGMetadataStorageAppT m)
</span><a href="Hasura.Server.Logging.html#emptyExtraHttpLogMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">emptyExtraHttpLogMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span>  </span><span id="local-6989586621690648144"><span class="annot"><span class="annottext">buildExtraHttpLogMetadata :: ParameterizedQueryHashList
-&gt; ExtraHttpLogMetadata (PGMetadataStorageAppT m)
</span><a href="Hasura.Server.Logging.html#buildExtraHttpLogMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">buildExtraHttpLogMetadata</span></a></span></span><span> </span><span class="annot"><span class="annottext">ParameterizedQueryHashList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>  </span><span id="local-6989586621690648139"><span class="annot"><span class="annottext">logHttpError :: Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; [Header]
-&gt; PGMetadataStorageAppT m ()
</span><a href="Hasura.Server.Logging.html#logHttpError"><span class="hs-identifier hs-var hs-var hs-var hs-var">logHttpError</span></a></span></span><span> </span><span id="local-6989586621690648137"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648137"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690648136"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621690648136"><span class="hs-identifier hs-var">loggingSettings</span></a></span></span><span> </span><span id="local-6989586621690648135"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621690648135"><span class="hs-identifier hs-var">userInfoM</span></a></span></span><span> </span><span id="local-6989586621690648134"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621690648134"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621690648133"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621690648133"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621690648132"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621690648132"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621690648131"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648131"><span class="hs-identifier hs-var">qErr</span></a></span></span><span> </span><span id="local-6989586621690648130"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690648130"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1044"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648137"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1045"></span><span>      </span><span class="annot"><span class="annottext">HttpLogContext -&gt; HttpLogLine
</span><a href="Hasura.Server.Logging.html#mkHttpLog"><span class="hs-identifier hs-var">mkHttpLog</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1046"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; LoggingSettings
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; QErr
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogContext
</span><a href="Hasura.Server.Logging.html#mkHttpErrorLogContext"><span class="hs-identifier hs-var">mkHttpErrorLogContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621690648135"><span class="hs-identifier hs-var">userInfoM</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621690648136"><span class="hs-identifier hs-var">loggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621690648134"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621690648133"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621690648132"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621690648131"><span class="hs-identifier hs-var">qErr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690648130"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>  </span><span id="local-6989586621690648125"><span class="annot"><span class="annottext">logHttpSuccess :: Logger Hasura
-&gt; LoggingSettings
-&gt; Maybe UserInfo
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; ByteString
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; HttpLogMetadata (PGMetadataStorageAppT m)
-&gt; PGMetadataStorageAppT m ()
</span><a href="Hasura.Server.Logging.html#logHttpSuccess"><span class="hs-identifier hs-var hs-var hs-var hs-var">logHttpSuccess</span></a></span></span><span> </span><span id="local-6989586621690648123"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648123"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690648122"><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621690648122"><span class="hs-identifier hs-var">loggingSettings</span></a></span></span><span> </span><span id="local-6989586621690648121"><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621690648121"><span class="hs-identifier hs-var">userInfoM</span></a></span></span><span> </span><span id="local-6989586621690648120"><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621690648120"><span class="hs-identifier hs-var">reqId</span></a></span></span><span> </span><span id="local-6989586621690648119"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621690648119"><span class="hs-identifier hs-var">waiReq</span></a></span></span><span> </span><span id="local-6989586621690648118"><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621690648118"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span id="local-6989586621690648117"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621690648117"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span id="local-6989586621690648116"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621690648116"><span class="hs-identifier hs-var">compressedResponse</span></a></span></span><span> </span><span id="local-6989586621690648115"><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621690648115"><span class="hs-identifier hs-var">qTime</span></a></span></span><span> </span><span id="local-6989586621690648114"><span class="annot"><span class="annottext">Maybe CompressionType
</span><a href="#local-6989586621690648114"><span class="hs-identifier hs-var">cType</span></a></span></span><span> </span><span id="local-6989586621690648113"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690648113"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#CommonHttpLogMetadata"><span class="hs-identifier hs-type">CommonHttpLogMetadata</span></a></span><span> </span><span id="local-6989586621690648111"><span class="annot"><span class="annottext">RequestMode
</span><a href="#local-6989586621690648111"><span class="hs-identifier hs-var">rb</span></a></span></span><span> </span><span id="local-6989586621690648110"><span class="annot"><span class="annottext">Maybe (GQLBatchedReqs GQLBatchQueryOperationLog)
</span><a href="#local-6989586621690648110"><span class="hs-identifier hs-var">batchQueryOpLogs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1049"></span><span>    </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648123"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1050"></span><span>      </span><span class="annot"><span class="annottext">HttpLogContext -&gt; HttpLogLine
</span><a href="Hasura.Server.Logging.html#mkHttpLog"><span class="hs-identifier hs-var">mkHttpLog</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1051"></span><span>        </span><span class="annot"><span class="annottext">Maybe UserInfo
-&gt; LoggingSettings
-&gt; RequestId
-&gt; Request
-&gt; (ByteString, Maybe Value)
-&gt; Int64
-&gt; ByteString
-&gt; Maybe (DiffTime, DiffTime)
-&gt; Maybe CompressionType
-&gt; [Header]
-&gt; RequestMode
-&gt; Maybe (GQLBatchedReqs GQLBatchQueryOperationLog)
-&gt; HttpLogContext
</span><a href="Hasura.Server.Logging.html#mkHttpAccessLogContext"><span class="hs-identifier hs-var">mkHttpAccessLogContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UserInfo
</span><a href="#local-6989586621690648121"><span class="hs-identifier hs-var">userInfoM</span></a></span><span> </span><span class="annot"><span class="annottext">LoggingSettings
</span><a href="#local-6989586621690648122"><span class="hs-identifier hs-var">loggingSettings</span></a></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><a href="#local-6989586621690648120"><span class="hs-identifier hs-var">reqId</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621690648119"><span class="hs-identifier hs-var">waiReq</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString, Maybe Value)
</span><a href="#local-6989586621690648118"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/bytestring-0.11.3.1/src"><span class="hs-identifier hs-var">BL.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621690648117"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621690648116"><span class="hs-identifier hs-var">compressedResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DiffTime, DiffTime)
</span><a href="#local-6989586621690648115"><span class="hs-identifier hs-var">qTime</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CompressionType
</span><a href="#local-6989586621690648114"><span class="hs-identifier hs-var">cType</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690648113"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">RequestMode
</span><a href="#local-6989586621690648111"><span class="hs-identifier hs-var">rb</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GQLBatchedReqs GQLBatchQueryOperationLog)
</span><a href="#local-6989586621690648110"><span class="hs-identifier hs-var">batchQueryOpLogs</span></a></span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649979"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1054"></span><span>  </span><span id="local-6989586621690648093"><span class="annot"><span class="annottext">cacheLookup :: [RemoteSchemaInfo]
-&gt; [ActionsInfo]
-&gt; QueryCacheKey
-&gt; Maybe CachedDirective
-&gt; TraceT
     (ExceptT QErr (PGMetadataStorageAppT m)) ([Header], Maybe EncJSON)
</span><a href="Hasura.GraphQL.Transport.HTTP.html#cacheLookup"><span class="hs-identifier hs-var hs-var hs-var hs-var">cacheLookup</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RemoteSchemaInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[ActionsInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">QueryCacheKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe CachedDirective
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>  </span><span id="local-6989586621690648087"><span class="annot"><span class="annottext">cacheStore :: QueryCacheKey
-&gt; Maybe CachedDirective
-&gt; EncJSON
-&gt; TraceT
     (ExceptT QErr (PGMetadataStorageAppT m)) CacheStoreResponse
</span><a href="Hasura.GraphQL.Transport.HTTP.html#cacheStore"><span class="hs-identifier hs-var hs-var hs-var hs-var">cacheStore</span></a></span></span><span> </span><span class="annot"><span class="annottext">QueryCacheKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe CachedDirective
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">CacheStoreSuccess
</span><a href="Hasura.GraphQL.Transport.HTTP.html#CacheStoreSkipped"><span class="hs-identifier hs-var">CacheStoreSkipped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649970"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649970"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649970"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Tracing.html#TraceT"><span class="hs-identifier hs-type">Tracing.TraceT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649970"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1058"></span><span>  </span><span id="local-6989586621690648059"><span class="annot"><span class="annottext">resolveUserInfo :: Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; TraceT
     (PGMetadataStorageAppT m)
     (Either QErr (UserInfo, Maybe UTCTime, [Header]))
</span><a href="Hasura.Server.Auth.html#resolveUserInfo"><span class="hs-identifier hs-var hs-var hs-var hs-var">resolveUserInfo</span></a></span></span><span> </span><span id="local-6989586621690648057"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648057"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621690648056"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648056"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span id="local-6989586621690648055"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690648055"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621690648054"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690648054"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span id="local-6989586621690648053"><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621690648053"><span class="hs-identifier hs-var">reqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1059"></span><span>    </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, MonadError QErr m,
 MonadTrace m) =&gt;
Logger Hasura
-&gt; Manager
-&gt; [Header]
-&gt; AuthMode
-&gt; Maybe ReqsText
-&gt; m (UserInfo, Maybe UTCTime, [Header])
</span><a href="Hasura.Server.Auth.html#getUserInfoWithExpTime"><span class="hs-identifier hs-var">getUserInfoWithExpTime</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690648057"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621690648056"><span class="hs-identifier hs-var">manager</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690648055"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690648054"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ReqsText
</span><a href="#local-6989586621690648053"><span class="hs-identifier hs-var">reqs</span></a></span><span>
</span><span id="line-1060"></span><span>
</span><span id="line-1061"></span><span class="annot"><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-type">accessDeniedErrMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1062"></span><span id="accessDeniedErrMsg"><span class="annot"><span class="annottext">accessDeniedErrMsg :: Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var hs-var">accessDeniedErrMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1063"></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;restricted access : admin only&quot;</span></span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649952"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649952"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadMetadataApiAuthorization"><span class="hs-identifier hs-type">MonadMetadataApiAuthorization</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649952"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1066"></span><span>  </span><span id="local-6989586621690648033"><span class="annot"><span class="annottext">authorizeV1QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; PGMetadataStorageAppT m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1QueryApi</span></a></span></span><span> </span><span id="local-6989586621690648031"><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621690648031"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621690648030"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621690648030"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1067"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648029"><span class="annot"><span class="annottext">currRole :: RoleName
</span><a href="#local-6989586621690648029"><span class="hs-identifier hs-var hs-var">currRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621690648030"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span>
</span><span id="line-1068"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RQLQuery -&gt; Bool
</span><a href="Hasura.Server.API.Query.html#requiresAdmin"><span class="hs-identifier hs-var">requiresAdmin</span></a></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><a href="#local-6989586621690648031"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621690648029"><span class="hs-identifier hs-var">currRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.Session.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1069"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#AccessDenied"><span class="hs-identifier hs-var">AccessDenied</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var">accessDeniedErrMsg</span></a></span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span>  </span><span id="local-6989586621690648013"><span class="annot"><span class="annottext">authorizeV1MetadataApi :: RQLMetadata
-&gt; HandlerCtx -&gt; PGMetadataStorageAppT m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV1MetadataApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV1MetadataApi</span></a></span></span><span> </span><span class="annot"><span class="annottext">RQLMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690648011"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621690648011"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1072"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690648010"><span class="annot"><span class="annottext">currRole :: RoleName
</span><a href="#local-6989586621690648010"><span class="hs-identifier hs-var hs-var">currRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621690648011"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span>
</span><span id="line-1073"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621690648010"><span class="hs-identifier hs-var">currRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.Session.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1074"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#AccessDenied"><span class="hs-identifier hs-var">AccessDenied</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var">accessDeniedErrMsg</span></a></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>  </span><span id="local-6989586621690648002"><span class="annot"><span class="annottext">authorizeV2QueryApi :: RQLQuery -&gt; HandlerCtx -&gt; PGMetadataStorageAppT m (Either QErr ())
</span><a href="Hasura.Server.App.html#authorizeV2QueryApi"><span class="hs-identifier hs-var hs-var hs-var hs-var">authorizeV2QueryApi</span></a></span></span><span> </span><span class="annot"><span class="annottext">RQLQuery
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690648000"><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621690648000"><span class="hs-identifier hs-var">handlerCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1077"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690647999"><span class="annot"><span class="annottext">currRole :: RoleName
</span><a href="#local-6989586621690647999"><span class="hs-identifier hs-var hs-var">currRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; RoleName
</span><a href="Hasura.Session.html#_uiRole"><span class="hs-identifier hs-var">_uiRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx -&gt; UserInfo
</span><a href="Hasura.Server.App.html#hcUser"><span class="hs-identifier hs-var">hcUser</span></a></span><span> </span><span class="annot"><span class="annottext">HandlerCtx
</span><a href="#local-6989586621690648000"><span class="hs-identifier hs-var">handlerCtx</span></a></span><span>
</span><span id="line-1078"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621690647999"><span class="hs-identifier hs-var">currRole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="Hasura.Session.html#adminRoleName"><span class="hs-identifier hs-var">adminRoleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1079"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Base.Error.html#withPathK"><span class="hs-identifier hs-var">withPathK</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#AccessDenied"><span class="hs-identifier hs-var">AccessDenied</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.App.html#accessDeniedErrMsg"><span class="hs-identifier hs-var">accessDeniedErrMsg</span></a></span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649945"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649945"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#ConsoleRenderer"><span class="hs-identifier hs-type">ConsoleRenderer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649945"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1082"></span><span>  </span><span id="local-6989586621690647991"><span class="annot"><span class="annottext">renderConsole :: Text
-&gt; AuthMode
-&gt; Bool
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; PGMetadataStorageAppT m (Either String Text)
</span><a href="Hasura.Server.App.html#renderConsole"><span class="hs-identifier hs-var hs-var hs-var hs-var">renderConsole</span></a></span></span><span> </span><span id="local-6989586621690647989"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647989"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621690647988"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690647988"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span id="local-6989586621690647987"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647987"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span> </span><span id="local-6989586621690647986"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647986"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span id="local-6989586621690647985"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647985"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1083"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; AuthMode
-&gt; Bool
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; Either String Text
</span><a href="Hasura.App.html#mkConsoleHTML"><span class="hs-identifier hs-var">mkConsoleHTML</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647989"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690647988"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647987"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647986"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647985"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649936"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649936"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">MonadGQLExecutionCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649936"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1086"></span><span>  </span><span id="local-6989586621690647967"><span class="annot"><span class="annottext">checkGQLExecution :: UserInfo
-&gt; ([Header], IpAddress)
-&gt; Bool
-&gt; SchemaCache
-&gt; GQLReqUnparsed
-&gt; RequestId
-&gt; PGMetadataStorageAppT m (Either QErr GQLReqParsed)
</span><a href="Hasura.GraphQL.Execute.Common.html#checkGQLExecution"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkGQLExecution</span></a></span></span><span> </span><span id="local-6989586621690647965"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621690647965"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">([Header], IpAddress)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690647964"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647964"><span class="hs-identifier hs-var">enableAL</span></a></span></span><span> </span><span id="local-6989586621690647963"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690647963"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621690647962"><span class="annot"><span class="annottext">GQLReqUnparsed
</span><a href="#local-6989586621690647962"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1087"></span><span>    </span><span id="local-6989586621690647961"><span class="annot"><span class="annottext">GQLReqParsed
</span><a href="#local-6989586621690647961"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
GQLReqUnparsed -&gt; m GQLReqParsed
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#toParsed"><span class="hs-identifier hs-var">toParsed</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqUnparsed
</span><a href="#local-6989586621690647962"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-1088"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Bool
-&gt; AllowlistMode -&gt; UserInfo -&gt; GQLReqParsed -&gt; SchemaCache -&gt; m ()
</span><a href="Hasura.GraphQL.Execute.html#checkQueryInAllowlist"><span class="hs-identifier hs-var">checkQueryInAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647964"><span class="hs-identifier hs-var">enableAL</span></a></span><span> </span><span class="annot"><span class="annottext">AllowlistMode
</span><a href="Hasura.RQL.Types.Allowlist.html#AllowlistModeGlobalOnly"><span class="hs-identifier hs-var">AllowlistModeGlobalOnly</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621690647965"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqParsed
</span><a href="#local-6989586621690647961"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621690647963"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-1089"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqParsed
</span><a href="#local-6989586621690647961"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span>  </span><span id="local-6989586621690647958"><span class="annot"><span class="annottext">executeIntrospection :: UserInfo
-&gt; Value
-&gt; SetGraphqlIntrospectionOptions
-&gt; PGMetadataStorageAppT m (Either QErr ExecutionStep)
</span><a href="Hasura.GraphQL.Execute.Common.html#executeIntrospection"><span class="hs-identifier hs-var hs-var hs-var hs-var">executeIntrospection</span></a></span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690647956"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647956"><span class="hs-identifier hs-var">introspectionQuery</span></a></span></span><span> </span><span class="annot"><span class="annottext">SetGraphqlIntrospectionOptions
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1092"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ExecutionStep
</span><a href="Hasura.GraphQL.Execute.Backend.html#ExecStepRaw"><span class="hs-identifier hs-var">ExecStepRaw</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647956"><span class="hs-identifier hs-var">introspectionQuery</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>  </span><span id="local-6989586621690647951"><span class="annot"><span class="annottext">checkGQLBatchedReqs :: UserInfo
-&gt; RequestId
-&gt; [GQLReqUnparsed]
-&gt; SchemaCache
-&gt; PGMetadataStorageAppT m (Either QErr ())
</span><a href="Hasura.GraphQL.Execute.Common.html#checkGQLBatchedReqs"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkGQLBatchedReqs</span></a></span></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RequestId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GQLReqUnparsed]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649929"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649929"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649929"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.App.html#MonadConfigApiHandler"><span class="hs-identifier hs-type">MonadConfigApiHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649929"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1097"></span><span>  </span><span id="local-6989586621690647935"><span class="annot"><span class="annottext">runConfigApiHandler :: ServerCtx
-&gt; Maybe Text -&gt; SpockCtxT () (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Server.App.html#runConfigApiHandler"><span class="hs-identifier hs-var hs-var hs-var hs-var">runConfigApiHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, MonadBaseControl IO m, UserAuthentication (TraceT m),
 HttpLog m, HasReporter m, HasResourceLimits m) =&gt;
ServerCtx -&gt; Maybe Text -&gt; SpockCtxT () m ()
</span><a href="Hasura.Server.App.html#configApiGetHandler"><span class="hs-identifier hs-var">configApiGetHandler</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649924"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649924"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649924"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1100"></span><span>  </span><span id="local-6989586621690647922"><span class="annot"><span class="annottext">logQueryLog :: Logger Hasura -&gt; QueryLog -&gt; PGMetadataStorageAppT m ()
</span><a href="Hasura.GraphQL.Logging.html#logQueryLog"><span class="hs-identifier hs-var hs-var hs-var hs-var">logQueryLog</span></a></span></span><span> </span><span id="local-6989586621690647920"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690647920"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690647920"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649920"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649920"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649920"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1103"></span><span>  </span><span id="local-6989586621690647909"><span class="annot"><span class="annottext">logWSLog :: Logger Hasura -&gt; WSLog -&gt; PGMetadataStorageAppT m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#logWSLog"><span class="hs-identifier hs-var hs-var hs-var hs-var">logWSLog</span></a></span></span><span> </span><span id="local-6989586621690647907"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690647907"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621690647907"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649917"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649917"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#MonadResolveSource"><span class="hs-identifier hs-type">MonadResolveSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649917"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1106"></span><span>  </span><span id="local-6989586621690647895"><span class="annot"><span class="annottext">getPGSourceResolver :: PGMetadataStorageAppT m (SourceResolver ('Postgres 'Vanilla))
</span><a href="Hasura.RQL.Types.Source.html#getPGSourceResolver"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPGSourceResolver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PGLogger -&gt; SourceResolver ('Postgres 'Vanilla)
</span><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-var">mkPgSourceResolver</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-1107"></span><span>  </span><span id="local-6989586621690647891"><span class="annot"><span class="annottext">getMSSQLSourceResolver :: PGMetadataStorageAppT m (SourceResolver 'MSSQL)
</span><a href="Hasura.RQL.Types.Source.html#getMSSQLSourceResolver"><span class="hs-identifier hs-var hs-var hs-var hs-var">getMSSQLSourceResolver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SourceResolver 'MSSQL
</span><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-var">mkMSSQLSourceResolver</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649907"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649907"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Backend.html#MonadQueryTags"><span class="hs-identifier hs-type">EB.MonadQueryTags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649907"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1110"></span><span>  </span><span id="local-6989586621690647881"><span class="annot"><span class="annottext">createQueryTags :: QueryTagsAttributes
-&gt; Maybe QueryTagsConfig
-&gt; Tagged (PGMetadataStorageAppT m) QueryTagsComment
</span><a href="Hasura.GraphQL.Execute.Backend.html#createQueryTags"><span class="hs-identifier hs-var hs-var hs-var hs-var">createQueryTags</span></a></span></span><span> </span><span id="local-6989586621690647879"><span class="annot"><span class="annottext">QueryTagsAttributes
</span><a href="#local-6989586621690647879"><span class="hs-identifier hs-var">_attributes</span></a></span></span><span> </span><span id="local-6989586621690647878"><span class="annot"><span class="annottext">Maybe QueryTagsConfig
</span><a href="#local-6989586621690647878"><span class="hs-identifier hs-var">_qtSourceConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">QueryTagsComment
</span><a href="Hasura.QueryTags.html#emptyQueryTagsComment"><span class="hs-identifier hs-var">emptyQueryTagsComment</span></a></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690649899"><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649899"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649899"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1113"></span><span>  </span><span id="local-6989586621690647864"><span class="annot"><span class="annottext">runLogCleaner :: TriggerLogCleanupConfig
-&gt; PGMetadataStorageAppT m (Either QErr EncJSON)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#runLogCleaner"><span class="hs-identifier hs-var hs-var hs-var hs-var">runLogCleaner</span></a></span></span><span> </span><span class="annot"><span class="annottext">TriggerLogCleanupConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#NotSupported"><span class="hs-identifier hs-var">NotSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Event log cleanup feature is enterprise edition only&quot;</span></span><span>
</span><span id="line-1114"></span><span>  </span><span id="local-6989586621690647860"><span class="annot"><span class="annottext">generateCleanupSchedules :: BackendSourceInfo
-&gt; TriggerName
-&gt; AutoTriggerLogCleanupConfig
-&gt; PGMetadataStorageAppT m (Either QErr ())
</span><a href="Hasura.RQL.DDL.EventTrigger.html#generateCleanupSchedules"><span class="hs-identifier hs-var hs-var hs-var hs-var">generateCleanupSchedules</span></a></span></span><span> </span><span class="annot"><span class="annottext">BackendSourceInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AutoTriggerLogCleanupConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span id="local-6989586621690649896"><span id="local-6989586621690649897"><span class="annot"><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-type">runInSeparateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1117"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649897"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1118"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649896"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1119"></span><span>  </span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649897"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621690649896"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1120"></span><span id="runInSeparateTx"><span class="annot"><span class="annottext">runInSeparateTx :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var hs-var">runInSeparateTx</span></a></span></span><span> </span><span id="local-6989586621690647840"><span class="annot"><span class="annottext">TxE QErr a
</span><a href="#local-6989586621690647840"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1121"></span><span>  </span><span id="local-6989586621690647839"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690647839"><span class="hs-identifier hs-var">pool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/mtl-2.2.2/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span>
</span><span id="line-1122"></span><span>  </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) e a.
(MonadIO m, MonadBaseControl IO m, FromPGTxErr e,
 FromPGConnErr e) =&gt;
PGPool -&gt; TxMode -&gt; TxET e m a -&gt; ExceptT e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.runTx</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690647839"><span class="hs-identifier hs-var">pool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIsolation
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.RepeatableRead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxE QErr a
</span><a href="#local-6989586621690647840"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="annot"><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier hs-type">notifySchemaCacheSyncTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">InstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span id="notifySchemaCacheSyncTx"><span class="annot"><span class="annottext">notifySchemaCacheSyncTx :: MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; TxE QErr ()
</span><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier hs-var hs-var">notifySchemaCacheSyncTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span id="local-6989586621690647835"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621690647835"><span class="hs-identifier hs-var">resourceVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621690647834"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690647834"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span id="local-6989586621690647833"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690647833"><span class="hs-identifier hs-var">invalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1126"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.Discard</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1127"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-1128"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1129"></span><span>      </span><span class="annot"><span class="">[PG.sql|
      INSERT INTO hdb_catalog.hdb_schema_notifications(id, notification, resource_version, instance_id)
      VALUES (1, $1::json, $2, $3::uuid)
      ON CONFLICT (id) DO UPDATE SET
        notification = $1::json,
        resource_version = $2,
        instance_id = $3::uuid
    |]</span></span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; ViaJSON a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690647833"><span class="hs-identifier hs-var">invalidations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621690647835"><span class="hs-identifier hs-var">resourceVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690647834"><span class="hs-identifier hs-var">instanceId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1139"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span class="annot"><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier hs-type">getCatalogStateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#CatalogState"><span class="hs-identifier hs-type">CatalogState</span></a></span><span>
</span><span id="line-1142"></span><span id="getCatalogStateTx"><span class="annot"><span class="annottext">getCatalogStateTx :: TxE QErr CatalogState
</span><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier hs-var hs-var">getCatalogStateTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1143"></span><span>  </span><span class="annot"><span class="annottext">(Text, ViaJSON Value, ViaJSON Value) -&gt; CatalogState
</span><a href="#local-6989586621690647828"><span class="hs-identifier hs-var">mkCatalogState</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. SingleRow a -&gt; a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span>
</span><span id="line-1144"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-1145"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1146"></span><span>      </span><span class="annot"><span class="">[PG.sql|
    SELECT hasura_uuid::text, cli_state::json, console_state::json
      FROM hdb_catalog.hdb_version
  |]</span></span><span>
</span><span id="line-1150"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1153"></span><span>    </span><span id="local-6989586621690647828"><span class="annot"><span class="annottext">mkCatalogState :: (Text, ViaJSON Value, ViaJSON Value) -&gt; CatalogState
</span><a href="#local-6989586621690647828"><span class="hs-identifier hs-var hs-var">mkCatalogState</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621690647826"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647826"><span class="hs-identifier hs-var">dbId</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span id="local-6989586621690647825"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647825"><span class="hs-identifier hs-var">cliState</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span id="local-6989586621690647824"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647824"><span class="hs-identifier hs-var">consoleState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1154"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Value -&gt; CatalogState
</span><a href="Hasura.RQL.Types.Metadata.Common.html#CatalogState"><span class="hs-identifier hs-var">CatalogState</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647826"><span class="hs-identifier hs-var">dbId</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647825"><span class="hs-identifier hs-var">cliState</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647824"><span class="hs-identifier hs-var">consoleState</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span class="annot"><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier hs-type">setCatalogStateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#CatalogStateType"><span class="hs-identifier hs-type">CatalogStateType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span id="setCatalogStateTx"><span class="annot"><span class="annottext">setCatalogStateTx :: CatalogStateType -&gt; Value -&gt; TxE QErr ()
</span><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier hs-var hs-var">setCatalogStateTx</span></a></span></span><span> </span><span id="local-6989586621690647822"><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621690647822"><span class="hs-identifier hs-var">stateTy</span></a></span></span><span> </span><span id="local-6989586621690647821"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647821"><span class="hs-identifier hs-var">stateValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1158"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621690647822"><span class="hs-identifier hs-var">stateTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1159"></span><span>    </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="Hasura.RQL.Types.Metadata.Common.html#CSTCli"><span class="hs-identifier hs-var">CSTCli</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1160"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-1161"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1162"></span><span>        </span><span class="annot"><span class="">[PG.sql|
        UPDATE hdb_catalog.hdb_version
           SET cli_state = $1
      |]</span></span><span>
</span><span id="line-1166"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Identity a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Identity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; ViaJSON a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647821"><span class="hs-identifier hs-var">stateValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1167"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1168"></span><span>    </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="Hasura.RQL.Types.Metadata.Common.html#CSTConsole"><span class="hs-identifier hs-var">CSTConsole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1169"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-1170"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1171"></span><span>        </span><span class="annot"><span class="">[PG.sql|
        UPDATE hdb_catalog.hdb_version
           SET console_state = $1
      |]</span></span><span>
</span><span id="line-1175"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Identity a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Identity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; ViaJSON a
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647821"><span class="hs-identifier hs-var">stateValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1176"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span class="hs-comment">-- | Each of the function in the type class is executed in a totally separate transaction.</span><span>
</span><span id="line-1179"></span><span class="hs-comment">--</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- To learn more about why the instance is derived as following, see Note [Generic MetadataStorageT transformer]</span><span>
</span><span id="line-1181"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621690649851"><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649851"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621690649851"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1182"></span><span>  </span><span id="local-6989586621690647780"><span class="annot"><span class="annottext">fetchMetadataResourceVersion :: MetadataStorageT (PGMetadataStorageAppT m) MetadataResourceVersion
</span><a href="Hasura.Metadata.Class.html#fetchMetadataResourceVersion"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchMetadataResourceVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr MetadataResourceVersion
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#fetchMetadataResourceVersionFromCatalog"><span class="hs-identifier hs-var">fetchMetadataResourceVersionFromCatalog</span></a></span><span>
</span><span id="line-1183"></span><span>  </span><span id="local-6989586621690647776"><span class="annot"><span class="annottext">fetchMetadata :: MetadataStorageT
  (PGMetadataStorageAppT m) (Metadata, MetadataResourceVersion)
</span><a href="Hasura.Metadata.Class.html#fetchMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr (Metadata, MetadataResourceVersion)
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#fetchMetadataAndResourceVersionFromCatalog"><span class="hs-identifier hs-var">fetchMetadataAndResourceVersionFromCatalog</span></a></span><span>
</span><span id="line-1184"></span><span>  </span><span id="local-6989586621690647772"><span class="annot"><span class="annottext">fetchMetadataNotifications :: MetadataResourceVersion
-&gt; InstanceId
-&gt; MetadataStorageT
     (PGMetadataStorageAppT m)
     [(MetadataResourceVersion, CacheInvalidations)]
</span><a href="Hasura.Metadata.Class.html#fetchMetadataNotifications"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchMetadataNotifications</span></a></span></span><span> </span><span id="local-6989586621690647770"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690647770"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647769"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690647769"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; InstanceId
-&gt; TxE QErr [(MetadataResourceVersion, CacheInvalidations)]
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#fetchMetadataNotificationsFromCatalog"><span class="hs-identifier hs-var">fetchMetadataNotificationsFromCatalog</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690647770"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690647769"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1185"></span><span>  </span><span id="local-6989586621690647766"><span class="annot"><span class="annottext">setMetadata :: MetadataResourceVersion
-&gt; Metadata
-&gt; MetadataStorageT
     (PGMetadataStorageAppT m) MetadataResourceVersion
</span><a href="Hasura.Metadata.Class.html#setMetadata"><span class="hs-identifier hs-var hs-var hs-var hs-var">setMetadata</span></a></span></span><span> </span><span id="local-6989586621690647764"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690647764"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; Metadata -&gt; TxE QErr MetadataResourceVersion
</span><a href="Hasura.RQL.DDL.Schema.Catalog.html#setMetadataInCatalog"><span class="hs-identifier hs-var">setMetadataInCatalog</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690647764"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1186"></span><span>  </span><span id="local-6989586621690647761"><span class="annot"><span class="annottext">notifySchemaCacheSync :: MetadataResourceVersion
-&gt; InstanceId
-&gt; CacheInvalidations
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#notifySchemaCacheSync"><span class="hs-identifier hs-var hs-var hs-var hs-var">notifySchemaCacheSync</span></a></span></span><span> </span><span id="local-6989586621690647759"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690647759"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647758"><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690647758"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621690647757"><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690647757"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
-&gt; InstanceId -&gt; CacheInvalidations -&gt; TxE QErr ()
</span><a href="Hasura.App.html#notifySchemaCacheSyncTx"><span class="hs-identifier hs-var">notifySchemaCacheSyncTx</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621690647759"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceId
</span><a href="#local-6989586621690647758"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">CacheInvalidations
</span><a href="#local-6989586621690647757"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1187"></span><span>  </span><span id="local-6989586621690647755"><span class="annot"><span class="annottext">getCatalogState :: MetadataStorageT (PGMetadataStorageAppT m) CatalogState
</span><a href="Hasura.Metadata.Class.html#getCatalogState"><span class="hs-identifier hs-var hs-var hs-var hs-var">getCatalogState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr CatalogState
</span><a href="Hasura.App.html#getCatalogStateTx"><span class="hs-identifier hs-var">getCatalogStateTx</span></a></span><span>
</span><span id="line-1188"></span><span>  </span><span id="local-6989586621690647752"><span class="annot"><span class="annottext">setCatalogState :: CatalogStateType
-&gt; Value -&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#setCatalogState"><span class="hs-identifier hs-var hs-var hs-var hs-var">setCatalogState</span></a></span></span><span> </span><span id="local-6989586621690647750"><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621690647750"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647749"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647749"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CatalogStateType -&gt; Value -&gt; TxE QErr ()
</span><a href="Hasura.App.html#setCatalogStateTx"><span class="hs-identifier hs-var">setCatalogStateTx</span></a></span><span> </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621690647750"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647749"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1189"></span><span>
</span><span id="line-1190"></span><span>  </span><span id="local-6989586621690647747"><span class="annot"><span class="annottext">getMetadataDbUid :: MetadataStorageT (PGMetadataStorageAppT m) MetadataDbId
</span><a href="#local-6989586621690647747"><span class="hs-identifier hs-var hs-var hs-var hs-var">getMetadataDbUid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr MetadataDbId
</span><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-var">getDbId</span></a></span><span>
</span><span id="line-1191"></span><span>  </span><span id="local-6989586621690647743"><span class="annot"><span class="annottext">checkMetadataStorageHealth :: MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#checkMetadataStorageHealth"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkMetadataStorageHealth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadTx m =&gt; m ()
</span><a href="Hasura.Backends.Postgres.Connection.MonadTx.html#checkDbConnection"><span class="hs-identifier hs-var">checkDbConnection</span></a></span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span>  </span><span id="local-6989586621690647739"><span class="annot"><span class="annottext">getDeprivedCronTriggerStats :: [TriggerName]
-&gt; MetadataStorageT (PGMetadataStorageAppT m) [CronTriggerStats]
</span><a href="Hasura.Metadata.Class.html#getDeprivedCronTriggerStats"><span class="hs-identifier hs-var hs-var hs-var hs-var">getDeprivedCronTriggerStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName] -&gt; TxE QErr [CronTriggerStats]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getDeprivedCronTriggerStatsTx"><span class="hs-identifier hs-var">getDeprivedCronTriggerStatsTx</span></a></span><span>
</span><span id="line-1194"></span><span>  </span><span id="local-6989586621690647735"><span class="annot"><span class="annottext">getScheduledEventsForDelivery :: MetadataStorageT
  (PGMetadataStorageAppT m) ([CronEvent], [OneOffScheduledEvent])
</span><a href="Hasura.Metadata.Class.html#getScheduledEventsForDelivery"><span class="hs-identifier hs-var hs-var hs-var hs-var">getScheduledEventsForDelivery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr ([CronEvent], [OneOffScheduledEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsForDeliveryTx"><span class="hs-identifier hs-var">getScheduledEventsForDeliveryTx</span></a></span><span>
</span><span id="line-1195"></span><span>  </span><span id="local-6989586621690647731"><span class="annot"><span class="annottext">insertCronEvents :: [CronEventSeed] -&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#insertCronEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertCronEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEventSeed] -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsTx"><span class="hs-identifier hs-var">insertCronEventsTx</span></a></span><span>
</span><span id="line-1196"></span><span>  </span><span id="local-6989586621690647727"><span class="annot"><span class="annottext">insertOneOffScheduledEvent :: OneOffEvent
-&gt; MetadataStorageT (PGMetadataStorageAppT m) CronEventId
</span><a href="Hasura.Metadata.Class.html#insertOneOffScheduledEvent"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertOneOffScheduledEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OneOffEvent -&gt; TxE QErr CronEventId
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertOneOffScheduledEventTx"><span class="hs-identifier hs-var">insertOneOffScheduledEventTx</span></a></span><span>
</span><span id="line-1197"></span><span>  </span><span id="local-6989586621690647723"><span class="annot"><span class="annottext">insertScheduledEventInvocation :: Invocation 'ScheduledType
-&gt; ScheduledEventType
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#insertScheduledEventInvocation"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertScheduledEventInvocation</span></a></span></span><span> </span><span id="local-6989586621690647721"><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621690647721"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647720"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647720"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertInvocationTx"><span class="hs-identifier hs-var">insertInvocationTx</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621690647721"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647720"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1198"></span><span>  </span><span id="local-6989586621690647717"><span class="annot"><span class="annottext">setScheduledEventOp :: CronEventId
-&gt; ScheduledEventOp
-&gt; ScheduledEventType
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">setScheduledEventOp</span></a></span></span><span> </span><span id="local-6989586621690647715"><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621690647715"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647714"><span class="annot"><span class="annottext">ScheduledEventOp
</span><a href="#local-6989586621690647714"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621690647713"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647713"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#setScheduledEventOpTx"><span class="hs-identifier hs-var">setScheduledEventOpTx</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621690647715"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventOp
</span><a href="#local-6989586621690647714"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647713"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1199"></span><span>  </span><span id="local-6989586621690647710"><span class="annot"><span class="annottext">unlockScheduledEvents :: ScheduledEventType
-&gt; [CronEventId] -&gt; MetadataStorageT (PGMetadataStorageAppT m) Int
</span><a href="Hasura.Metadata.Class.html#unlockScheduledEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">unlockScheduledEvents</span></a></span></span><span> </span><span id="local-6989586621690647708"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647708"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647707"><span class="annot"><span class="annottext">[CronEventId]
</span><a href="#local-6989586621690647707"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType -&gt; [CronEventId] -&gt; TxE QErr Int
</span><a href="Hasura.Eventing.ScheduledTrigger.html#unlockScheduledEventsTx"><span class="hs-identifier hs-var">unlockScheduledEventsTx</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647708"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEventId]
</span><a href="#local-6989586621690647707"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1200"></span><span>  </span><span id="local-6989586621690647704"><span class="annot"><span class="annottext">unlockAllLockedScheduledEvents :: MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="#local-6989586621690647704"><span class="hs-identifier hs-var hs-var hs-var hs-var">unlockAllLockedScheduledEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#unlockAllLockedScheduledEventsTx"><span class="hs-identifier hs-var">unlockAllLockedScheduledEventsTx</span></a></span><span>
</span><span id="line-1201"></span><span>  </span><span id="local-6989586621690647701"><span class="annot"><span class="annottext">clearFutureCronEvents :: ClearCronEvents -&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#clearFutureCronEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">clearFutureCronEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ClearCronEvents -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#dropFutureCronEventsTx"><span class="hs-identifier hs-var">dropFutureCronEventsTx</span></a></span><span>
</span><span id="line-1202"></span><span>  </span><span id="local-6989586621690647697"><span class="annot"><span class="annottext">getOneOffScheduledEvents :: ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; MetadataStorageT
     (PGMetadataStorageAppT m)
     (WithOptionalTotalCount [OneOffScheduledEvent])
</span><a href="Hasura.Metadata.Class.html#getOneOffScheduledEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">getOneOffScheduledEvents</span></a></span></span><span> </span><span id="local-6989586621690647695"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621690647695"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647694"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621690647694"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621690647693"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621690647693"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [OneOffScheduledEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getOneOffScheduledEventsTx"><span class="hs-identifier hs-var">getOneOffScheduledEventsTx</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621690647695"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621690647694"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621690647693"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1203"></span><span>  </span><span id="local-6989586621690647690"><span class="annot"><span class="annottext">getCronEvents :: TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; MetadataStorageT
     (PGMetadataStorageAppT m) (WithOptionalTotalCount [CronEvent])
</span><a href="Hasura.Metadata.Class.html#getCronEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">getCronEvents</span></a></span></span><span> </span><span id="local-6989586621690647688"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690647688"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647687"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621690647687"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621690647686"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621690647686"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621690647685"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621690647685"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [CronEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getCronEventsTx"><span class="hs-identifier hs-var">getCronEventsTx</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621690647688"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621690647687"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621690647686"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621690647685"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1204"></span><span>  </span><span id="local-6989586621690647682"><span class="annot"><span class="annottext">getInvocations :: GetEventInvocations
-&gt; MetadataStorageT
     (PGMetadataStorageAppT m)
     (WithOptionalTotalCount [ScheduledEventInvocation])
</span><a href="Hasura.Metadata.Class.html#getInvocations"><span class="hs-identifier hs-var hs-var hs-var hs-var">getInvocations</span></a></span></span><span> </span><span id="local-6989586621690647680"><span class="annot"><span class="annottext">GetEventInvocations
</span><a href="#local-6989586621690647680"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GetEventInvocations
-&gt; TxE QErr (WithOptionalTotalCount [ScheduledEventInvocation])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getInvocationsTx"><span class="hs-identifier hs-var">getInvocationsTx</span></a></span><span> </span><span class="annot"><span class="annottext">GetEventInvocations
</span><a href="#local-6989586621690647680"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1205"></span><span>  </span><span id="local-6989586621690647677"><span class="annot"><span class="annottext">deleteScheduledEvent :: CronEventId
-&gt; ScheduledEventType
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#deleteScheduledEvent"><span class="hs-identifier hs-var hs-var hs-var hs-var">deleteScheduledEvent</span></a></span></span><span> </span><span id="local-6989586621690647675"><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621690647675"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647674"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647674"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#deleteScheduledEventTx"><span class="hs-identifier hs-var">deleteScheduledEventTx</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventId
</span><a href="#local-6989586621690647675"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621690647674"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span>  </span><span id="local-6989586621690647671"><span class="annot"><span class="annottext">insertAction :: ActionName
-&gt; SessionVariables
-&gt; [Header]
-&gt; Value
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ActionId
</span><a href="Hasura.Metadata.Class.html#insertAction"><span class="hs-identifier hs-var hs-var hs-var hs-var">insertAction</span></a></span></span><span> </span><span id="local-6989586621690647669"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690647669"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647668"><span class="annot"><span class="annottext">SessionVariables
</span><a href="#local-6989586621690647668"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621690647667"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690647667"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621690647666"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647666"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
-&gt; SessionVariables -&gt; [Header] -&gt; Value -&gt; TxE QErr ActionId
</span><a href="Hasura.GraphQL.Execute.Action.html#insertActionTx"><span class="hs-identifier hs-var">insertActionTx</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621690647669"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SessionVariables
</span><a href="#local-6989586621690647668"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621690647667"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621690647666"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1208"></span><span>  </span><span id="local-6989586621690647663"><span class="annot"><span class="annottext">fetchUndeliveredActionEvents :: MetadataStorageT (PGMetadataStorageAppT m) [ActionLogItem]
</span><a href="Hasura.Metadata.Class.html#fetchUndeliveredActionEvents"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchUndeliveredActionEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxE QErr [ActionLogItem]
</span><a href="Hasura.GraphQL.Execute.Action.html#fetchUndeliveredActionEventsTx"><span class="hs-identifier hs-var">fetchUndeliveredActionEventsTx</span></a></span><span>
</span><span id="line-1209"></span><span>  </span><span id="local-6989586621690647659"><span class="annot"><span class="annottext">setActionStatus :: ActionId
-&gt; AsyncActionStatus
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#setActionStatus"><span class="hs-identifier hs-var hs-var hs-var hs-var">setActionStatus</span></a></span></span><span> </span><span id="local-6989586621690647657"><span class="annot"><span class="annottext">ActionId
</span><a href="#local-6989586621690647657"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621690647656"><span class="annot"><span class="annottext">AsyncActionStatus
</span><a href="#local-6989586621690647656"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ActionId -&gt; AsyncActionStatus -&gt; TxE QErr ()
</span><a href="Hasura.GraphQL.Execute.Action.html#setActionStatusTx"><span class="hs-identifier hs-var">setActionStatusTx</span></a></span><span> </span><span class="annot"><span class="annottext">ActionId
</span><a href="#local-6989586621690647657"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncActionStatus
</span><a href="#local-6989586621690647656"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1210"></span><span>  </span><span id="local-6989586621690647653"><span class="annot"><span class="annottext">fetchActionResponse :: ActionId
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ActionLogResponse
</span><a href="Hasura.Metadata.Class.html#fetchActionResponse"><span class="hs-identifier hs-var hs-var hs-var hs-var">fetchActionResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ActionId -&gt; TxE QErr ActionLogResponse
</span><a href="Hasura.GraphQL.Execute.Action.html#fetchActionResponseTx"><span class="hs-identifier hs-var">fetchActionResponseTx</span></a></span><span>
</span><span id="line-1211"></span><span>  </span><span id="local-6989586621690647649"><span class="annot"><span class="annottext">clearActionData :: ActionName -&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="Hasura.Metadata.Class.html#clearActionData"><span class="hs-identifier hs-var hs-var hs-var hs-var">clearActionData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; TxE QErr ()
</span><a href="Hasura.GraphQL.Execute.Action.html#clearActionDataTx"><span class="hs-identifier hs-var">clearActionDataTx</span></a></span><span>
</span><span id="line-1212"></span><span>  </span><span id="local-6989586621690647645"><span class="annot"><span class="annottext">setProcessingActionLogsToPending :: LockedActionIdArray
-&gt; MetadataStorageT (PGMetadataStorageAppT m) ()
</span><a href="#local-6989586621690647645"><span class="hs-identifier hs-var hs-var hs-var hs-var">setProcessingActionLogsToPending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TxE QErr a -&gt; MetadataStorageT (PGMetadataStorageAppT m) a
</span><a href="Hasura.App.html#runInSeparateTx"><span class="hs-identifier hs-var">runInSeparateTx</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LockedActionIdArray -&gt; TxE QErr ()
</span><a href="Hasura.GraphQL.Execute.Action.html#setProcessingActionLogsToPendingTx"><span class="hs-identifier hs-var">setProcessingActionLogsToPendingTx</span></a></span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621690647623"><span id="local-6989586621690647625"><span id="local-6989586621690647627"><span id="local-6989586621690647629"><span id="local-6989586621690647631"><span id="local-6989586621690647633"><span id="local-6989586621690647635"><span id="local-6989586621690647637"><span id="local-6989586621690647639"><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorageQueryAPI"><span class="hs-identifier hs-type">MonadMetadataStorageQueryAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MetadataStorageT"><span class="hs-identifier hs-type">MetadataStorageT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.App.html#PGMetadataStorageAppT"><span class="hs-identifier hs-type">PGMetadataStorageAppT</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Cache.Common.html#CacheBuild"><span class="hs-identifier hs-type">CacheBuild</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span class="hs-comment">--- helper functions ---</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span class="annot"><a href="Hasura.App.html#mkConsoleHTML"><span class="hs-identifier hs-type">mkConsoleHTML</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html#AuthMode"><span class="hs-identifier hs-type">AuthMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1219"></span><span id="mkConsoleHTML"><span class="annot"><span class="annottext">mkConsoleHTML :: Text
-&gt; AuthMode
-&gt; Bool
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; Either String Text
</span><a href="Hasura.App.html#mkConsoleHTML"><span class="hs-identifier hs-var hs-var">mkConsoleHTML</span></a></span></span><span> </span><span id="local-6989586621690647620"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647620"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621690647619"><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690647619"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span id="local-6989586621690647618"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647618"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span> </span><span id="local-6989586621690647617"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647617"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span id="local-6989586621690647616"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647616"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1220"></span><span>  </span><span class="annot"><span class="annottext">Template -&gt; Value -&gt; Either String Text
</span><a href="Hasura.Server.App.html#renderHtmlTemplate"><span class="hs-identifier hs-var">renderHtmlTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621690647614"><span class="hs-identifier hs-var">consoleTmplt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1221"></span><span>    </span><span class="hs-comment">-- variables required to render the template</span><span>
</span><span id="line-1222"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">A.object</span></span><span>
</span><span id="line-1223"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;isAdminSecretSet&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">AuthMode -&gt; Text
</span><a href="Hasura.Server.App.html#isAdminSecretSet"><span class="hs-identifier hs-var">isAdminSecretSet</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621690647619"><span class="hs-identifier hs-var">authMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1224"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consolePath&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647610"><span class="hs-identifier hs-var">consolePath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1225"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;enableTelemetry&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647618"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1226"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;cdnAssets&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="Hasura.Server.App.html#boolToText"><span class="hs-identifier hs-var">boolToText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647617"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1227"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consoleSentryDsn&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621690647616"><span class="hs-identifier hs-var">consoleSentryDsn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1228"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;assetsVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.Server.Version.html#consoleAssetsVersion"><span class="hs-identifier hs-var">consoleAssetsVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1229"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;serverVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Hasura.Server.Version.html#currentVersion"><span class="hs-identifier hs-var">currentVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1230"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;consoleSentryDsn&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-1231"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1233"></span><span>    </span><span id="local-6989586621690647610"><span class="annot"><span class="annottext">consolePath :: Text
</span><a href="#local-6989586621690647610"><span class="hs-identifier hs-var hs-var">consolePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647620"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1234"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/console&quot;</span></span><span>
</span><span id="line-1235"></span><span>      </span><span id="local-6989586621690647605"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647605"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/console/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647605"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span>    </span><span id="local-6989586621690647614"><span class="annot"><span class="annottext">consoleTmplt :: Template
</span><a href="#local-6989586621690647614"><span class="hs-identifier hs-var hs-var">consoleTmplt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">makeRelativeToProject</span><span> </span><span class="hs-string">&quot;src-rsr/console.html&quot;</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">M.embedSingleTemplate</span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span class="annot"><a href="Hasura.App.html#telemetryNotice"><span class="hs-identifier hs-type">telemetryNotice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-1240"></span><span id="telemetryNotice"><span class="annot"><span class="annottext">telemetryNotice :: String
</span><a href="Hasura.App.html#telemetryNotice"><span class="hs-identifier hs-var hs-var">telemetryNotice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1241"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Help us improve Hasura! The graphql-engine server collects anonymized &quot;</span></span><span>
</span><span id="line-1242"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;usage stats which allows us to keep improving Hasura at warp speed. &quot;</span></span><span>
</span><span id="line-1243"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;To read more or opt-out, visit https://hasura.io/docs/latest/graphql/core/guides/telemetry.html&quot;</span></span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span class="annot"><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-type">mkPgSourceResolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-type">PG.PGLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span id="mkPgSourceResolver"><span class="annot"><span class="annottext">mkPgSourceResolver :: PGLogger -&gt; SourceResolver ('Postgres 'Vanilla)
</span><a href="Hasura.App.html#mkPgSourceResolver"><span class="hs-identifier hs-var hs-var">mkPgSourceResolver</span></a></span></span><span> </span><span id="local-6989586621690647599"><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621690647599"><span class="hs-identifier hs-var">pgLogger</span></a></span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621690647598"><span class="annot"><span class="annottext">SourceConnConfiguration ('Postgres 'Vanilla)
</span><a href="#local-6989586621690647598"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1247"></span><span>  </span><span id="local-6989586621690647597"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690647597"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">IO Environment
</span><a href="Data.Environment.html#getEnvironment"><span class="hs-identifier hs-var">Env.getEnvironment</span></a></span><span>
</span><span id="line-1248"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.Settings.html#PostgresSourceConnInfo"><span class="hs-identifier hs-type">PostgresSourceConnInfo</span></a></span><span> </span><span id="local-6989586621690647595"><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690647595"><span class="hs-identifier hs-var">urlConf</span></a></span></span><span> </span><span id="local-6989586621690647594"><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621690647594"><span class="hs-identifier hs-var">poolSettings</span></a></span></span><span> </span><span id="local-6989586621690647593"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647593"><span class="hs-identifier hs-var">allowPrepare</span></a></span></span><span> </span><span id="local-6989586621690647592"><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621690647592"><span class="hs-identifier hs-var">isoLevel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (PGClientCerts CertVar CertVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresConnConfiguration -&gt; PostgresSourceConnInfo
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccConnectionInfo"><span class="hs-identifier hs-var">_pccConnectionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration ('Postgres 'Vanilla)
</span><a href="#local-6989586621690647598"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-1249"></span><span>  </span><span class="hs-comment">-- If the user does not provide values for the pool settings, then use the default values</span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621690647590"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647590"><span class="hs-identifier hs-var">maxConns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690647589"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647589"><span class="hs-identifier hs-var">idleTimeout</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690647588"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647588"><span class="hs-identifier hs-var">retries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
-&gt; DefaultPostgresPoolSettings -&gt; (Int, Int, Int)
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#getDefaultPGPoolSettingIfNotExists"><span class="hs-identifier hs-var">getDefaultPGPoolSettingIfNotExists</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621690647594"><span class="hs-identifier hs-var">poolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">DefaultPostgresPoolSettings
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#defaultPostgresPoolSettings"><span class="hs-identifier hs-var">defaultPostgresPoolSettings</span></a></span><span>
</span><span id="line-1251"></span><span>  </span><span id="local-6989586621690647585"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647585"><span class="hs-identifier hs-var">urlText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Environment -&gt; UrlConf -&gt; m Text
</span><a href="Hasura.RQL.Types.Common.html#resolveUrlConf"><span class="hs-identifier hs-var">resolveUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690647597"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UrlConf
</span><a href="#local-6989586621690647595"><span class="hs-identifier hs-var">urlConf</span></a></span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690647584"><span class="annot"><span class="annottext">connInfo :: ConnInfo
</span><a href="#local-6989586621690647584"><span class="hs-identifier hs-var hs-var">connInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ConnDetails -&gt; ConnInfo
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.ConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647588"><span class="hs-identifier hs-var">retries</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ConnDetails
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.CDDatabaseURI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src"><span class="hs-identifier hs-var">txtToBs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621690647585"><span class="hs-identifier hs-var">urlText</span></a></span><span>
</span><span id="line-1253"></span><span>      </span><span id="local-6989586621690647583"><span class="annot"><span class="annottext">connParams :: ConnParams
</span><a href="#local-6989586621690647583"><span class="hs-identifier hs-var hs-var">connParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1254"></span><span>        </span><span class="annot"><span class="annottext">ConnParams
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.defaultConnParams</span></a></span><span>
</span><span id="line-1255"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpIdleTime :: Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpIdleTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647589"><span class="hs-identifier hs-var">idleTimeout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1256"></span><span>            </span><span class="annot"><span class="annottext">cpConns :: Int
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpConns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647590"><span class="hs-identifier hs-var">maxConns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1257"></span><span>            </span><span class="annot"><span class="annottext">cpAllowPrepare :: Bool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpAllowPrepare</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621690647593"><span class="hs-identifier hs-var">allowPrepare</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1258"></span><span>            </span><span class="annot"><span class="annottext">cpMbLifetime :: Maybe NominalDiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpMbLifetime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresPoolSettings -&gt; Maybe NominalDiffTime
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsConnectionLifetime"><span class="hs-identifier hs-var">_ppsConnectionLifetime</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621690647594"><span class="hs-identifier hs-var">poolSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1259"></span><span>            </span><span class="annot"><span class="annottext">cpTimeout :: Maybe NominalDiffTime
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">PG.cpTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PostgresPoolSettings -&gt; Maybe NominalDiffTime
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_ppsPoolTimeout"><span class="hs-identifier hs-var">_ppsPoolTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresPoolSettings
</span><a href="#local-6989586621690647594"><span class="hs-identifier hs-var">poolSettings</span></a></span><span>
</span><span id="line-1260"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1261"></span><span>  </span><span id="local-6989586621690647581"><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690647581"><span class="hs-identifier hs-var">pgPool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo -&gt; ConnParams -&gt; PGLogger -&gt; IO PGPool
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.2.4.20220919/pg-client-0.1.0/opt/doc/html/pg-client/src"><span class="hs-identifier hs-var">Q.initPGPool</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690647584"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621690647583"><span class="hs-identifier hs-var">connParams</span></a></span><span> </span><span class="annot"><span class="annottext">PGLogger
</span><a href="#local-6989586621690647599"><span class="hs-identifier hs-var">pgLogger</span></a></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690647580"><span class="annot"><span class="annottext">pgExecCtx :: PGExecCtx
</span><a href="#local-6989586621690647580"><span class="hs-identifier hs-var hs-var">pgExecCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIsolation -&gt; PGPool -&gt; ResizePoolStrategy -&gt; PGExecCtx
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#mkPGExecCtx"><span class="hs-identifier hs-var">mkPGExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621690647592"><span class="hs-identifier hs-var">isoLevel</span></a></span><span> </span><span class="annot"><span class="annottext">PGPool
</span><a href="#local-6989586621690647581"><span class="hs-identifier hs-var">pgPool</span></a></span><span> </span><span class="annot"><span class="annottext">ResizePoolStrategy
</span><a href="Hasura.RQL.Types.ResizePool.html#NeverResizePool"><span class="hs-identifier hs-var">NeverResizePool</span></a></span><span>
</span><span id="line-1263"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PGExecCtx
-&gt; ConnInfo
-&gt; Maybe (NonEmpty ConnInfo)
-&gt; IO ()
-&gt; ExtensionsSchema
-&gt; PGSourceConfig
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#PGSourceConfig"><span class="hs-identifier hs-var">PGSourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">PGExecCtx
</span><a href="#local-6989586621690647580"><span class="hs-identifier hs-var">pgExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ConnInfo
</span><a href="#local-6989586621690647584"><span class="hs-identifier hs-var">connInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnConfiguration -&gt; ExtensionsSchema
</span><a href="Hasura.Backends.Postgres.Connection.Settings.html#_pccExtensionsSchema"><span class="hs-identifier hs-var">_pccExtensionsSchema</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConnConfiguration ('Postgres 'Vanilla)
</span><a href="#local-6989586621690647598"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-1264"></span><span>
</span><span id="line-1265"></span><span class="annot"><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-type">mkMSSQLSourceResolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html#SourceResolver"><span class="hs-identifier hs-type">SourceResolver</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#MSSQL"><span class="hs-identifier hs-type">MSSQL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span id="mkMSSQLSourceResolver"><span class="annot"><span class="annottext">mkMSSQLSourceResolver :: SourceResolver 'MSSQL
</span><a href="Hasura.App.html#mkMSSQLSourceResolver"><span class="hs-identifier hs-var hs-var">mkMSSQLSourceResolver</span></a></span></span><span> </span><span id="local-6989586621690647575"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621690647575"><span class="hs-identifier hs-var">_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLConnConfiguration"><span class="hs-identifier hs-type">MSSQLConnConfiguration</span></a></span><span> </span><span id="local-6989586621690647573"><span class="annot"><span class="annottext">MSSQLConnectionInfo
</span><a href="#local-6989586621690647573"><span class="hs-identifier hs-var">connInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty MSSQLConnectionInfo)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1267"></span><span>  </span><span id="local-6989586621690647572"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690647572"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">IO Environment
</span><a href="Data.Environment.html#getEnvironment"><span class="hs-identifier hs-var">Env.getEnvironment</span></a></span><span>
</span><span id="line-1268"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLConnectionInfo"><span class="hs-identifier hs-type">MSSQLConnectionInfo</span></a></span><span> </span><span id="local-6989586621690647570"><span class="annot"><span class="annottext">InputConnectionString
</span><a href="#local-6989586621690647570"><span class="hs-identifier hs-var">iConnString</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLPoolSettings"><span class="hs-identifier hs-type">MSSQLPoolSettings</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621690647566"><span id="local-6989586621690647567"><span id="local-6989586621690647568"><span class="annot"><span class="annottext">Int
Maybe Int
_mpsIdleTimeout :: MSSQLPoolSettings -&gt; Int
_mpsTotalMaxConnections :: MSSQLPoolSettings -&gt; Maybe Int
_mpsMaxConnections :: MSSQLPoolSettings -&gt; Maybe Int
_mpsIdleTimeout :: Int
_mpsTotalMaxConnections :: Maybe Int
_mpsMaxConnections :: Maybe Int
</span><a href="Hasura.Backends.MSSQL.Connection.html#_mpsIdleTimeout"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MSSQLConnectionInfo
</span><a href="#local-6989586621690647573"><span class="hs-identifier hs-var">connInfo</span></a></span><span>
</span><span id="line-1269"></span><span>      </span><span id="local-6989586621690647562"><span class="annot"><span class="annottext">connOptions :: ConnectionOptions
</span><a href="#local-6989586621690647562"><span class="hs-identifier hs-var hs-var">connOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1270"></span><span>        </span><span class="annot"><a href="Database.MSSQL.Pool.html#ConnectionOptions"><span class="hs-identifier hs-type">MSPool.ConnectionOptions</span></a></span><span>
</span><span id="line-1271"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_coConnections :: Int
</span><a href="Database.MSSQL.Pool.html#_coConnections"><span class="hs-identifier hs-var">_coConnections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Hasura.Backends.MSSQL.Connection.html#defaultMSSQLMaxConnections"><span class="hs-identifier hs-var">defaultMSSQLMaxConnections</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621690647568"><span class="hs-identifier hs-var">_mpsMaxConnections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1272"></span><span>            </span><span class="annot"><span class="annottext">_coStripes :: Int
</span><a href="Database.MSSQL.Pool.html#_coStripes"><span class="hs-identifier hs-var">_coStripes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-1273"></span><span>            </span><span class="annot"><span class="annottext">_coIdleTime :: Int
</span><a href="Database.MSSQL.Pool.html#_coIdleTime"><span class="hs-identifier hs-var">_coIdleTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621690647566"><span class="hs-identifier hs-var">_mpsIdleTimeout</span></a></span><span>
</span><span id="line-1274"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621690647556"><span class="annot"><span class="annottext">ConnectionString
</span><a href="#local-6989586621690647556"><span class="hs-identifier hs-var">connString</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621690647555"><span class="annot"><span class="annottext">MSSQLPool
</span><a href="#local-6989586621690647555"><span class="hs-identifier hs-var">mssqlPool</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
(MonadIO m, QErrM m) =&gt;
InputConnectionString
-&gt; ConnectionOptions
-&gt; Environment
-&gt; m (ConnectionString, MSSQLPool)
</span><a href="Hasura.Backends.MSSQL.Connection.html#createMSSQLPool"><span class="hs-identifier hs-var">createMSSQLPool</span></a></span><span> </span><span class="annot"><span class="annottext">InputConnectionString
</span><a href="#local-6989586621690647570"><span class="hs-identifier hs-var">iConnString</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621690647562"><span class="hs-identifier hs-var">connOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621690647572"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1276"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621690647553"><span class="annot"><span class="annottext">mssqlExecCtx :: MSSQLExecCtx
</span><a href="#local-6989586621690647553"><span class="hs-identifier hs-var hs-var">mssqlExecCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MSSQLPool -&gt; ResizePoolStrategy -&gt; MSSQLExecCtx
</span><a href="Hasura.Backends.MSSQL.Connection.html#mkMSSQLExecCtx"><span class="hs-identifier hs-var">mkMSSQLExecCtx</span></a></span><span> </span><span class="annot"><span class="annottext">MSSQLPool
</span><a href="#local-6989586621690647555"><span class="hs-identifier hs-var">mssqlPool</span></a></span><span> </span><span class="annot"><span class="annottext">ResizePoolStrategy
</span><a href="Hasura.RQL.Types.ResizePool.html#NeverResizePool"><span class="hs-identifier hs-var">NeverResizePool</span></a></span><span>
</span><span id="line-1277"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///root/.ghcup/ghc/9.2.4/share/doc/ghc-9.2.4.20220919/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionString -&gt; MSSQLExecCtx -&gt; MSSQLSourceConfig
</span><a href="Hasura.Backends.MSSQL.Connection.html#MSSQLSourceConfig"><span class="hs-identifier hs-var">MSSQLSourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionString
</span><a href="#local-6989586621690647556"><span class="hs-identifier hs-var">connString</span></a></span><span> </span><span class="annot"><span class="annottext">MSSQLExecCtx
</span><a href="#local-6989586621690647553"><span class="hs-identifier hs-var">mssqlExecCtx</span></a></span><span>
</span><span id="line-1278"></span></pre></body></html>