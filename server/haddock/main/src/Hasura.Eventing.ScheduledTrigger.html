<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- = Scheduled Triggers</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- This module implements the functionality of invoking webhooks during specified</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- time events aka scheduled events. The scheduled events are the events generated</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- by the graphql-engine using the cron triggers or/and a scheduled event can</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- be created by the user at a specified time with the payload, webhook, headers</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- and the retry configuration. Scheduled events are modeled using rows in Postgres</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- with a @timestamp@ column.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- This module implements scheduling and delivery of scheduled</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- events:</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- 1. Scheduling a cron event involves creating new cron events. New</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- cron events are created based on the cron schedule and the number of</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- scheduled events that are already present in the scheduled events buffer.</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- The graphql-engine computes the new scheduled events and writes them to</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- the database.(Generator)</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- 2. Delivering a scheduled event involves reading undelivered scheduled events</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- from the database and delivering them to the webhook server. (Processor)</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- The rationale behind separating the event scheduling and event delivery</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- mechanism into two different threads is that the scheduling and delivering of</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- the scheduled events are not directly dependent on each other. The generator</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- will almost always try to create scheduled events which are supposed to be</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- delivered in the future (timestamp &gt; current_timestamp) and the processor</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- will fetch scheduled events of the past (timestamp &lt; current_timestamp). So,</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- the set of the scheduled events generated by the generator and the processor</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- will never be the same. The point here is that they're not correlated to each</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- other. They can be split into different threads for a better performance.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- == Implementation</span><span>
</span><span id="line-37"></span><span class="hs-comment">--</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- The scheduled triggers eventing is being implemented in the metadata storage.</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- All functions that make interaction to storage system are abstracted in</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- the @'MonadMetadataStorage' class.</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- During the startup, two threads are started:</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- 1. Generator: Fetches the list of scheduled triggers from cache and generates</span><span>
</span><span id="line-45"></span><span class="hs-comment">--    the scheduled events.</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">--     - Additional events will be generated only if there are fewer than 100</span><span>
</span><span id="line-48"></span><span class="hs-comment">--       scheduled events.</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">--     - The upcoming events timestamp will be generated using:</span><span>
</span><span id="line-51"></span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span class="hs-comment">--         - cron schedule of the scheduled trigger</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">--         - max timestamp of the scheduled events that already exist or</span><span>
</span><span id="line-55"></span><span class="hs-comment">--           current_timestamp(when no scheduled events exist)</span><span>
</span><span id="line-56"></span><span class="hs-comment">--</span><span>
</span><span id="line-57"></span><span class="hs-comment">--         - The timestamp of the scheduled events is stored with timezone because</span><span>
</span><span id="line-58"></span><span class="hs-comment">--           `SELECT NOW()` returns timestamp with timezone, so it's good to</span><span>
</span><span id="line-59"></span><span class="hs-comment">--           compare two things of the same type.</span><span>
</span><span id="line-60"></span><span class="hs-comment">--</span><span>
</span><span id="line-61"></span><span class="hs-comment">--     This effectively corresponds to doing an INSERT with values containing</span><span>
</span><span id="line-62"></span><span class="hs-comment">--     specific timestamp.</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- 2. Processor: Fetches the undelivered cron events and the scheduled events</span><span>
</span><span id="line-65"></span><span class="hs-comment">--    from the database and which have timestamp lesser than the</span><span>
</span><span id="line-66"></span><span class="hs-comment">--    current timestamp and then process them.</span><span>
</span><span id="line-67"></span><span class="hs-comment">--</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- - Consider and document ordering guarantees</span><span>
</span><span id="line-70"></span><span class="hs-comment">--   - do we have any in the presence of multiple hasura instances?</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- - If we have nothing useful to say about ordering, then consider processing</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   events asynchronously, so that a slow webhook doesn't cause everything</span><span>
</span><span id="line-73"></span><span class="hs-comment">--   subsequent to be delayed</span><span>
</span><span id="line-74"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Eventing.ScheduledTrigger</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#runCronEventsGenerator"><span class="hs-identifier">runCronEventsGenerator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledTriggers"><span class="hs-identifier">processScheduledTriggers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.Common.html#generateScheduleTimes"><span class="hs-identifier">generateScheduleTimes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEventSeed"><span class="hs-identifier">CronEventSeed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier">LockedEventsCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Cron trigger stats logger</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedCronTriggerStatsLogger"><span class="hs-identifier">createFetchedCronTriggerStatsLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedCronTriggersStatsLogger"><span class="hs-identifier">closeFetchedCronTriggersStatsLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Scheduled events stats logger</span></span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedScheduledEventsStatsLogger"><span class="hs-identifier">createFetchedScheduledEventsStatsLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedScheduledEventsStatsLogger"><span class="hs-identifier">closeFetchedScheduledEventsStatsLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Database interactions</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-comment">-- Following function names are similar to those present in</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- 'MonadMetadataStorage' type class. To avoid duplication,</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-comment">-- 'Tx' is suffixed to identify as database transactions</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getDeprivedCronTriggerStatsTx"><span class="hs-identifier">getDeprivedCronTriggerStatsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsForDeliveryTx"><span class="hs-identifier">getScheduledEventsForDeliveryTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertInvocationTx"><span class="hs-identifier">insertInvocationTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#setScheduledEventOpTx"><span class="hs-identifier">setScheduledEventOpTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#unlockScheduledEventsTx"><span class="hs-identifier">unlockScheduledEventsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#unlockAllLockedScheduledEventsTx"><span class="hs-identifier">unlockAllLockedScheduledEventsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsTx"><span class="hs-identifier">insertCronEventsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertOneOffScheduledEventTx"><span class="hs-identifier">insertOneOffScheduledEventTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#dropFutureCronEventsTx"><span class="hs-identifier">dropFutureCronEventsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getOneOffScheduledEventsTx"><span class="hs-identifier">getOneOffScheduledEventsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getCronEventsTx"><span class="hs-identifier">getCronEventsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#deleteScheduledEventTx"><span class="hs-identifier">deleteScheduledEventTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventInvocationsTx"><span class="hs-identifier">getScheduledEventInvocationsTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQuery"><span class="hs-identifier">getScheduledEventsInvocationsQuery</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQueryNoPagination"><span class="hs-identifier">getScheduledEventsInvocationsQueryNoPagination</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Export utility functions which are useful to build</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- SQLs for fetching data from metadata storage</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkScheduledEventStatusFilter"><span class="hs-identifier">mkScheduledEventStatusFilter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#scheduledTimeOrderBy"><span class="hs-identifier">scheduledTimeOrderBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#executeWithOptionalTotalCount"><span class="hs-identifier">executeWithOptionalTotalCount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkPaginationSelectExp"><span class="hs-identifier">mkPaginationSelectExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#withCount"><span class="hs-identifier">withCount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#invocationFieldExtractors"><span class="hs-identifier">invocationFieldExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkEventIdBoolExp"><span class="hs-identifier">mkEventIdBoolExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier">EventTables</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-d63f7c0774c9603306fb6be4536181f7e6facdd649f3f450b4e7dfd3d91cda94/share/doc/html/src/Control.Concurrent.Async.Lifted.html"><span class="hs-identifier">Control.Concurrent.Async.Lifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-d63f7c0774c9603306fb6be4536181f7e6facdd649f3f450b4e7dfd3d91cda94/share/doc/html/src/Control.Concurrent.Async.Lifted.html#forConcurrently_"><span class="hs-identifier">forConcurrently_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Concurrent.Extended.html"><span class="hs-identifier">Control.Concurrent.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#Forever"><span class="hs-identifier">Forever</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier">sleep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-c288f4ab3533e91c5d241152121e172474cc553aa524e32488a24b727cc130b5/share/doc/html/src/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-c288f4ab3533e91c5d241152121e172474cc553aa524e32488a24b727cc130b5/share/doc/html/src/Control.Lens.Fold.html#preview"><span class="hs-identifier">preview</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html"><span class="hs-identifier">Data.Environment</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/data-has-0.4.0.0-dac5c7adae74e1856a42108dcba181ae6d833a24d6271d4129aff0f1aaae2f5f/share/doc/html/src/Data.Has.html"><span class="hs-identifier">Data.Has</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Strict.html"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html"><span class="hs-identifier">Data.SerializableBlob</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SB</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#ToTxt"><span class="hs-identifier">ToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator">(&lt;&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-skinny-0.7.5-a1f7088607eba059f550a99fa13de2a463bdaa82fb887ceb54b59f16fecbb19a/share/doc/html/src/Data.These.html"><span class="hs-identifier">Data.These</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock</span></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.URL.Template.html"><span class="hs-identifier">Data.URL.Template</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.URL.Template.html#printTemplate"><span class="hs-identifier">printTemplate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.html"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Execute.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.Execute.Types</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.DML</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Types</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html"><span class="hs-identifier">Hasura.Eventing.Common</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.HTTP.html"><span class="hs-identifier">Hasura.Eventing.HTTP</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html"><span class="hs-identifier">Hasura.Eventing.ScheduledTrigger.Types</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.HTTP.html"><span class="hs-identifier">Hasura.HTTP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.HTTP.html#getHTTPExceptionStatus"><span class="hs-identifier">getHTTPExceptionStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#ResolveHeaderError"><span class="hs-identifier">ResolveHeaderError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#getHeaderInfosFromConfEither"><span class="hs-identifier">getHeaderInfosFromConfEither</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Webhook.Transform.html"><span class="hs-identifier">Hasura.RQL.DDL.Webhook.Transform</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.EventTrigger</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html"><span class="hs-identifier">Hasura.RQL.Types.Eventing</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.ScheduledTrigger</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Types.html"><span class="hs-identifier">Hasura.SQL.Types</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html"><span class="hs-identifier">Hasura.Server.Prometheus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#TriggersErrorLogLevelStatus"><span class="hs-identifier">TriggersErrorLogLevelStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html"><span class="hs-identifier">Network.HTTP.Client.Transformable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html"><span class="hs-identifier">Refined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html#unrefine"><span class="hs-identifier">unrefine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html"><span class="hs-identifier">System.Metrics.Prometheus.Counter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Prometheus.Counter</span></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/System.Timeout.Lifted.html"><span class="hs-identifier">System.Timeout.Lifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/System.Timeout.Lifted.html#timeout"><span class="hs-identifier">timeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-builder-0.6.7-f4a85772703867a466f6f7a936eb5266f793abadaae26843b4a066520ac361ae/share/doc/html/src/Text.Builder.html"><span class="hs-identifier">Text.Builder</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TB</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | runCronEventsGenerator makes sure that all the cron triggers</span><span>
</span><span id="line-172"></span><span class="hs-comment">--   have an adequate buffer of cron events.</span><span>
</span><span id="line-173"></span><span id="local-6989586621687721311"><span id="local-6989586621687721317"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#runCronEventsGenerator"><span class="hs-identifier hs-type">runCronEventsGenerator</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721311"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721311"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedCronTriggerStatsLogger"><span class="hs-identifier hs-type">FetchedCronTriggerStatsLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="#local-6989586621687721311"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721317"><span class="hs-identifier hs-type">void</span></a></span></span></span><span>
</span><span id="line-181"></span><span id="runCronEventsGenerator"><span class="annot"><span class="annottext">runCronEventsGenerator :: forall (m :: * -&gt; *) void.
(MonadIO m, MonadMetadataStorage m) =&gt;
Logger Hasura
-&gt; FetchedCronTriggerStatsLogger -&gt; IO SchemaCache -&gt; m void
</span><a href="Hasura.Eventing.ScheduledTrigger.html#runCronEventsGenerator"><span class="hs-identifier hs-var hs-var">runCronEventsGenerator</span></a></span></span><span> </span><span id="local-6989586621687722012"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722012"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687722013"><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
</span><a href="#local-6989586621687722013"><span class="hs-identifier hs-var">cronTriggerStatsLogger</span></a></span></span><span> </span><span id="local-6989586621687722014"><span class="annot"><span class="annottext">IO SchemaCache
</span><a href="#local-6989586621687722014"><span class="hs-identifier hs-var">getSC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m void
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m void) -&gt; m () -&gt; m void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621687722016"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687722016"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; m SchemaCache
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO SchemaCache
</span><a href="#local-6989586621687722014"><span class="hs-identifier hs-var">getSC</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">-- get cron triggers from cache</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722018"><span class="annot"><span class="annottext">cronTriggersCache :: HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722018"><span class="hs-identifier hs-var hs-var">cronTriggersCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; HashMap TriggerName CronTriggerInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scCronTriggers"><span class="hs-identifier hs-var">scCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621687722016"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo -&gt; Bool
forall k v. HashMap k v -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#null"><span class="hs-identifier hs-var">HashMap.null</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722018"><span class="hs-identifier hs-var">cronTriggersCache</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-comment">-- Poll the DB only when there's at-least one cron trigger present</span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-comment">-- in the schema cache</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-comment">-- get cron trigger stats from db</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-comment">-- When shutdown is initiated, we stop generating new cron events</span><span>
</span><span id="line-192"></span><span>      </span><span id="local-6989586621687722022"><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621687722022"><span class="hs-identifier hs-var">eitherRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m () -&gt; m (Either QErr ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m () -&gt; m (Either QErr ()))
-&gt; ExceptT QErr m () -&gt; m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>        </span><span id="local-6989586621687722024"><span class="annot"><span class="annottext">[CronTriggerStats]
</span><a href="#local-6989586621687722024"><span class="hs-identifier hs-var">deprivedCronTriggerStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m (Either QErr [CronTriggerStats])
-&gt; ExceptT QErr m [CronTriggerStats]
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT QErr m (Either QErr [CronTriggerStats])
 -&gt; ExceptT QErr m [CronTriggerStats])
-&gt; ExceptT QErr m (Either QErr [CronTriggerStats])
-&gt; ExceptT QErr m [CronTriggerStats]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TriggerName] -&gt; ExceptT QErr m (Either QErr [CronTriggerStats])
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName] -&gt; m (Either QErr [CronTriggerStats])
</span><a href="Hasura.Metadata.Class.html#getDeprivedCronTriggerStats"><span class="hs-identifier hs-var">getDeprivedCronTriggerStats</span></a></span><span> </span><span class="annot"><span class="annottext">([TriggerName] -&gt; ExceptT QErr m (Either QErr [CronTriggerStats]))
-&gt; [TriggerName] -&gt; ExceptT QErr m (Either QErr [CronTriggerStats])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo -&gt; [TriggerName]
forall k v. HashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#keys"><span class="hs-identifier hs-var">HashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722018"><span class="hs-identifier hs-var">cronTriggersCache</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-comment">-- Log fetched deprived cron trigger stats</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
-&gt; [CronTriggerStats] -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
FetchedCronTriggerStatsLogger -&gt; [CronTriggerStats] -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#logFetchedCronTriggersStats"><span class="hs-identifier hs-var">logFetchedCronTriggersStats</span></a></span><span> </span><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
</span><a href="#local-6989586621687722013"><span class="hs-identifier hs-var">cronTriggerStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">[CronTriggerStats]
</span><a href="#local-6989586621687722024"><span class="hs-identifier hs-var">deprivedCronTriggerStats</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-comment">-- join stats with cron triggers and produce @[(CronTriggerInfo, CronTriggerStats)]@</span><span>
</span><span id="line-197"></span><span>        </span><span id="local-6989586621687722029"><span class="annot"><span class="annottext">[(CronTriggerInfo, CronTriggerStats)]
</span><a href="#local-6989586621687722029"><span class="hs-identifier hs-var">cronTriggersForHydrationWithStats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-198"></span><span>          </span><span class="annot"><span class="annottext">[Maybe (CronTriggerInfo, CronTriggerStats)]
-&gt; [(CronTriggerInfo, CronTriggerStats)]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/witherable-0.4.2-c348fd1be527fbb040281c624d4766fb2c04c7e7f3be298bbe123b3357fb1136/share/doc/html/src/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span>
</span><span id="line-199"></span><span>            </span><span class="annot"><span class="annottext">([Maybe (CronTriggerInfo, CronTriggerStats)]
 -&gt; [(CronTriggerInfo, CronTriggerStats)])
-&gt; ExceptT QErr m [Maybe (CronTriggerInfo, CronTriggerStats)]
-&gt; ExceptT QErr m [(CronTriggerInfo, CronTriggerStats)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(CronTriggerStats
 -&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats)))
-&gt; [CronTriggerStats]
-&gt; ExceptT QErr m [Maybe (CronTriggerInfo, CronTriggerStats)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
-&gt; CronTriggerStats
-&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats))
</span><a href="#local-6989586621687722033"><span class="hs-identifier hs-var">withCronTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722018"><span class="hs-identifier hs-var">cronTriggersCache</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CronTriggerStats]
</span><a href="#local-6989586621687722024"><span class="hs-identifier hs-var">deprivedCronTriggerStats</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">[(CronTriggerInfo, CronTriggerStats)] -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadError QErr m) =&gt;
[(CronTriggerInfo, CronTriggerStats)] -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsFor"><span class="hs-identifier hs-var">insertCronEventsFor</span></a></span><span> </span><span class="annot"><span class="annottext">[(CronTriggerInfo, CronTriggerStats)]
</span><a href="#local-6989586621687722029"><span class="hs-identifier hs-var">cronTriggersForHydrationWithStats</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="annottext">Either QErr () -&gt; (QErr -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeft"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621687722022"><span class="hs-identifier hs-var">eitherRes</span></a></span><span> </span><span class="annot"><span class="annottext">((QErr -&gt; m ()) -&gt; m ()) -&gt; (QErr -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722012"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(ScheduledTriggerInternalErr -&gt; m ())
-&gt; (QErr -&gt; ScheduledTriggerInternalErr) -&gt; QErr -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ScheduledTriggerInternalErr
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledTriggerInternalErr"><span class="hs-identifier hs-var">ScheduledTriggerInternalErr</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- See discussion: https://github.com/hasura/graphql-engine-mono/issues/1001</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Minutes -&gt; DiffTime
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#minutes"><span class="hs-identifier hs-var">minutes</span></a></span><span> </span><span class="annot"><span class="annottext">Minutes
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621687722033"><span class="annot"><span class="annottext">withCronTrigger :: HashMap TriggerName CronTriggerInfo
-&gt; CronTriggerStats
-&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats))
</span><a href="#local-6989586621687722033"><span class="hs-identifier hs-var hs-var">withCronTrigger</span></a></span></span><span> </span><span id="local-6989586621687722040"><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722040"><span class="hs-identifier hs-var">cronTriggerCache</span></a></span></span><span> </span><span id="local-6989586621687722041"><span class="annot"><span class="annottext">CronTriggerStats
</span><a href="#local-6989586621687722041"><span class="hs-identifier hs-var">cronTriggerStat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TriggerName
-&gt; HashMap TriggerName CronTriggerInfo -&gt; Maybe CronTriggerInfo
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerStats -&gt; TriggerName
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#_ctsName"><span class="hs-identifier hs-var">_ctsName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerStats
</span><a href="#local-6989586621687722041"><span class="hs-identifier hs-var">cronTriggerStat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722040"><span class="hs-identifier hs-var">cronTriggerCache</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="annottext">Maybe CronTriggerInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722012"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="annottext">(ScheduledTriggerInternalErr -&gt; ExceptT QErr m ())
-&gt; ScheduledTriggerInternalErr -&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ScheduledTriggerInternalErr
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledTriggerInternalErr"><span class="hs-identifier hs-var">ScheduledTriggerInternalErr</span></a></span><span>
</span><span id="line-212"></span><span>            </span><span class="annot"><span class="annottext">(QErr -&gt; ScheduledTriggerInternalErr)
-&gt; QErr -&gt; ScheduledTriggerInternalErr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err500"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;could not find scheduled trigger in the schema cache&quot;</span></span><span>
</span><span id="line-213"></span><span>          </span><span class="annot"><span class="annottext">Maybe (CronTriggerInfo, CronTriggerStats)
-&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats))
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (CronTriggerInfo, CronTriggerStats)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687722046"><span class="annot"><span class="annottext">CronTriggerInfo
</span><a href="#local-6989586621687722046"><span class="hs-identifier hs-var">cronTrigger</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">Maybe (CronTriggerInfo, CronTriggerStats)
-&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats))
forall a. a -&gt; ExceptT QErr m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-216"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (CronTriggerInfo, CronTriggerStats)
 -&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats)))
-&gt; Maybe (CronTriggerInfo, CronTriggerStats)
-&gt; ExceptT QErr m (Maybe (CronTriggerInfo, CronTriggerStats))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CronTriggerInfo, CronTriggerStats)
-&gt; Maybe (CronTriggerInfo, CronTriggerStats)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerInfo
</span><a href="#local-6989586621687722046"><span class="hs-identifier hs-var">cronTrigger</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CronTriggerStats
</span><a href="#local-6989586621687722041"><span class="hs-identifier hs-var">cronTriggerStat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="local-6989586621687721373"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsFor"><span class="hs-identifier hs-type">insertCronEventsFor</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721373"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721373"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#CronTriggerStats"><span class="hs-identifier hs-type">CronTriggerStats</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><a href="#local-6989586621687721373"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-222"></span><span id="insertCronEventsFor"><span class="annot"><span class="annottext">insertCronEventsFor :: forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadError QErr m) =&gt;
[(CronTriggerInfo, CronTriggerStats)] -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsFor"><span class="hs-identifier hs-var hs-var">insertCronEventsFor</span></a></span></span><span> </span><span id="local-6989586621687722057"><span class="annot"><span class="annottext">[(CronTriggerInfo, CronTriggerStats)]
</span><a href="#local-6989586621687722057"><span class="hs-identifier hs-var">cronTriggersWithStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722058"><span class="annot"><span class="annottext">scheduledEvents :: [CronEventSeed]
</span><a href="#local-6989586621687722058"><span class="hs-identifier hs-var hs-var">scheduledEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((CronTriggerInfo, CronTriggerStats) -&gt; [CronEventSeed])
 -&gt; [(CronTriggerInfo, CronTriggerStats)] -&gt; [CronEventSeed])
-&gt; [(CronTriggerInfo, CronTriggerStats)]
-&gt; ((CronTriggerInfo, CronTriggerStats) -&gt; [CronEventSeed])
-&gt; [CronEventSeed]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((CronTriggerInfo, CronTriggerStats) -&gt; [CronEventSeed])
-&gt; [(CronTriggerInfo, CronTriggerStats)] -&gt; [CronEventSeed]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">[(CronTriggerInfo, CronTriggerStats)]
</span><a href="#local-6989586621687722057"><span class="hs-identifier hs-var">cronTriggersWithStats</span></a></span><span> </span><span class="annot"><span class="annottext">(((CronTriggerInfo, CronTriggerStats) -&gt; [CronEventSeed])
 -&gt; [CronEventSeed])
-&gt; ((CronTriggerInfo, CronTriggerStats) -&gt; [CronEventSeed])
-&gt; [CronEventSeed]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687722061"><span class="annot"><span class="annottext">CronTriggerInfo
</span><a href="#local-6989586621687722061"><span class="hs-identifier hs-var">cti</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722062"><span class="annot"><span class="annottext">CronTriggerStats
</span><a href="#local-6989586621687722062"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">UTCTime -&gt; CronTriggerInfo -&gt; [CronEventSeed]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#generateCronEventsFrom"><span class="hs-identifier hs-var">generateCronEventsFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerStats -&gt; UTCTime
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#_ctsMaxScheduledTime"><span class="hs-identifier hs-var">_ctsMaxScheduledTime</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerStats
</span><a href="#local-6989586621687722062"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CronTriggerInfo
</span><a href="#local-6989586621687722061"><span class="hs-identifier hs-var">cti</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[CronEventSeed]
</span><a href="#local-6989586621687722058"><span class="hs-identifier hs-var">scheduledEvents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621687722065"><span class="annot"><span class="annottext">[CronEventSeed]
</span><a href="#local-6989586621687722065"><span class="hs-identifier hs-var">events</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[CronEventSeed] -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[CronEventSeed] -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#insertCronEvents"><span class="hs-identifier hs-var">insertCronEvents</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEventSeed]
</span><a href="#local-6989586621687722065"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#generateCronEventsFrom"><span class="hs-identifier hs-type">generateCronEventsFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEventSeed"><span class="hs-identifier hs-type">CronEventSeed</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span id="generateCronEventsFrom"><span class="annot"><span class="annottext">generateCronEventsFrom :: UTCTime -&gt; CronTriggerInfo -&gt; [CronEventSeed]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#generateCronEventsFrom"><span class="hs-identifier hs-var hs-var">generateCronEventsFrom</span></a></span></span><span> </span><span id="local-6989586621687722067"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722067"><span class="hs-identifier hs-var">startTime</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722069"><span id="local-6989586621687722070"><span id="local-6989586621687722071"><span id="local-6989586621687722072"><span id="local-6989586621687722073"><span id="local-6989586621687722074"><span id="local-6989586621687722075"><span id="local-6989586621687722076"><span id="local-6989586621687722077"><span class="annot"><span class="annottext">[EventHeaderInfo]
Maybe Text
Maybe Value
Maybe RequestTransform
Maybe MetadataResponseTransform
CronSchedule
EnvRecord ResolvedWebhook
TriggerName
STRetryConf
ctiName :: TriggerName
ctiSchedule :: CronSchedule
ctiPayload :: Maybe Value
ctiRetryConf :: STRetryConf
ctiWebhookInfo :: EnvRecord ResolvedWebhook
ctiHeaders :: [EventHeaderInfo]
ctiComment :: Maybe Text
ctiRequestTransform :: Maybe RequestTransform
ctiResponseTransform :: Maybe MetadataResponseTransform
ctiName :: CronTriggerInfo -&gt; TriggerName
ctiSchedule :: CronTriggerInfo -&gt; CronSchedule
ctiPayload :: CronTriggerInfo -&gt; Maybe Value
ctiRetryConf :: CronTriggerInfo -&gt; STRetryConf
ctiWebhookInfo :: CronTriggerInfo -&gt; EnvRecord ResolvedWebhook
ctiHeaders :: CronTriggerInfo -&gt; [EventHeaderInfo]
ctiComment :: CronTriggerInfo -&gt; Maybe Text
ctiRequestTransform :: CronTriggerInfo -&gt; Maybe RequestTransform
ctiResponseTransform :: CronTriggerInfo -&gt; Maybe MetadataResponseTransform
</span><a href="#local-6989586621687722069"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><span class="annottext">(UTCTime -&gt; CronEventSeed) -&gt; [UTCTime] -&gt; [CronEventSeed]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; UTCTime -&gt; CronEventSeed
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEventSeed"><span class="hs-identifier hs-var">CronEventSeed</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722069"><span class="hs-identifier hs-var">ctiName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">([UTCTime] -&gt; [CronEventSeed]) -&gt; [UTCTime] -&gt; [CronEventSeed]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">-- generate next 100 events; see getDeprivedCronTriggerStatsTx:</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">UTCTime -&gt; Int -&gt; CronSchedule -&gt; [UTCTime]
</span><a href="Hasura.Eventing.Common.html#generateScheduleTimes"><span class="hs-identifier hs-var">generateScheduleTimes</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722067"><span class="hs-identifier hs-var">startTime</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">CronSchedule
</span><a href="#local-6989586621687722070"><span class="hs-identifier hs-var">ctiSchedule</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | `upperBoundScheduledEventTimeout` is the maximum amount of time</span><span>
</span><span id="line-237"></span><span class="hs-comment">--    a scheduled event can take to process. This function is intended</span><span>
</span><span id="line-238"></span><span class="hs-comment">--    to use with a timeout.</span><span>
</span><span id="line-239"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#upperBoundScheduledEventTimeout"><span class="hs-identifier hs-type">upperBoundScheduledEventTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span>
</span><span id="line-240"></span><span id="upperBoundScheduledEventTimeout"><span class="annot"><span class="annottext">upperBoundScheduledEventTimeout :: DiffTime
</span><a href="Hasura.Eventing.ScheduledTrigger.html#upperBoundScheduledEventTimeout"><span class="hs-identifier hs-var hs-var">upperBoundScheduledEventTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Minutes -&gt; DiffTime
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#minutes"><span class="hs-identifier hs-var">minutes</span></a></span><span> </span><span class="annot"><span class="annottext">Minutes
</span><span class="hs-number">30</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span id="local-6989586621687721405"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processCronEvents"><span class="hs-identifier hs-type">processCronEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721405"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-88628f48a025e46598ca658ea231eb27d6340417f49e950fbf8c438edb3ebbdc/share/doc/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">HTTP.Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEvent"><span class="hs-identifier hs-type">CronEvent</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEventId"><span class="hs-identifier hs-type">CronEventId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#TriggersErrorLogLevelStatus"><span class="hs-identifier hs-type">TriggersErrorLogLevelStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="#local-6989586621687721405"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-256"></span><span id="processCronEvents"><span class="annot"><span class="annottext">processCronEvents :: forall (m :: * -&gt; *).
(MonadIO m, MonadMetadataStorage m, MonadTrace m,
 MonadBaseControl IO m) =&gt;
Logger Hasura
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; [CronEvent]
-&gt; HashMap TriggerName CronTriggerInfo
-&gt; TVar (Set ScheduledEventId)
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processCronEvents"><span class="hs-identifier hs-var hs-var">processCronEvents</span></a></span></span><span> </span><span id="local-6989586621687722165"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722165"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687722166"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722166"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span id="local-6989586621687722167"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722167"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span></span><span> </span><span id="local-6989586621687722168"><span class="annot"><span class="annottext">[CronEvent]
</span><a href="#local-6989586621687722168"><span class="hs-identifier hs-var">cronEvents</span></a></span></span><span> </span><span id="local-6989586621687722169"><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722169"><span class="hs-identifier hs-var">cronTriggersInfo</span></a></span></span><span> </span><span id="local-6989586621687722170"><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722170"><span class="hs-identifier hs-var">lockedCronEvents</span></a></span></span><span> </span><span id="local-6989586621687722171"><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722171"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">-- save the locked cron events that have been fetched from the</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-comment">-- database, the events stored here will be unlocked in case a</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-comment">-- graceful shutdown is initiated in midst of processing these events</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">[ScheduledEventId] -&gt; TVar (Set ScheduledEventId) -&gt; m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
[ScheduledEventId] -&gt; TVar (Set ScheduledEventId) -&gt; m ()
</span><a href="Hasura.Eventing.Common.html#saveLockedEvents"><span class="hs-identifier hs-var">saveLockedEvents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CronEvent -&gt; ScheduledEventId)
-&gt; [CronEvent] -&gt; [ScheduledEventId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CronEvent -&gt; ScheduledEventId
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#_ceId"><span class="hs-identifier hs-var">_ceId</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEvent]
</span><a href="#local-6989586621687722168"><span class="hs-identifier hs-var">cronEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722170"><span class="hs-identifier hs-var">lockedCronEvents</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-comment">-- The `createdAt` of a cron event is the `created_at` of the cron trigger</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="annottext">[CronEvent] -&gt; (CronEvent -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, MonadBaseControl IO m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-d63f7c0774c9603306fb6be4536181f7e6facdd649f3f450b4e7dfd3d91cda94/share/doc/html/src/Control.Concurrent.Async.Lifted.html#forConcurrently_"><span class="hs-identifier hs-var">forConcurrently_</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEvent]
</span><a href="#local-6989586621687722168"><span class="hs-identifier hs-var">cronEvents</span></a></span><span> </span><span class="annot"><span class="annottext">((CronEvent -&gt; m ()) -&gt; m ()) -&gt; (CronEvent -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEvent"><span class="hs-identifier hs-type">CronEvent</span></a></span><span> </span><span id="local-6989586621687722175"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722175"><span class="hs-identifier hs-var">id'</span></a></span></span><span> </span><span id="local-6989586621687722176"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722176"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621687722177"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722177"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687722178"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722178"><span class="hs-identifier hs-var">tries</span></a></span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TriggerName
-&gt; HashMap TriggerName CronTriggerInfo -&gt; Maybe CronTriggerInfo
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722176"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722169"><span class="hs-identifier hs-var">cronTriggersInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">Maybe CronTriggerInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722179"><span class="hs-identifier hs-var">logInternalError</span></a></span><span>
</span><span id="line-266"></span><span>          </span><span class="annot"><span class="annottext">(QErr -&gt; m ()) -&gt; QErr -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err500"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span>
</span><span id="line-267"></span><span>          </span><span class="annot"><span class="annottext">(Text -&gt; QErr) -&gt; Text -&gt; QErr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;could not find cron trigger &quot;</span></span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722176"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-269"></span><span>          </span><span class="annot"><span class="annottext">TriggerName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; in the schema cache&quot;</span></span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CronTriggerInfo"><span class="hs-identifier hs-type">CronTriggerInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722180"><span id="local-6989586621687722181"><span id="local-6989586621687722182"><span id="local-6989586621687722183"><span id="local-6989586621687722184"><span id="local-6989586621687722185"><span id="local-6989586621687722186"><span id="local-6989586621687722187"><span id="local-6989586621687722188"><span class="annot"><span class="annottext">[EventHeaderInfo]
Maybe Text
Maybe Value
Maybe RequestTransform
Maybe MetadataResponseTransform
CronSchedule
EnvRecord ResolvedWebhook
TriggerName
STRetryConf
ctiName :: CronTriggerInfo -&gt; TriggerName
ctiSchedule :: CronTriggerInfo -&gt; CronSchedule
ctiPayload :: CronTriggerInfo -&gt; Maybe Value
ctiRetryConf :: CronTriggerInfo -&gt; STRetryConf
ctiWebhookInfo :: CronTriggerInfo -&gt; EnvRecord ResolvedWebhook
ctiHeaders :: CronTriggerInfo -&gt; [EventHeaderInfo]
ctiComment :: CronTriggerInfo -&gt; Maybe Text
ctiRequestTransform :: CronTriggerInfo -&gt; Maybe RequestTransform
ctiResponseTransform :: CronTriggerInfo -&gt; Maybe MetadataResponseTransform
ctiName :: TriggerName
ctiSchedule :: CronSchedule
ctiPayload :: Maybe Value
ctiRetryConf :: STRetryConf
ctiWebhookInfo :: EnvRecord ResolvedWebhook
ctiHeaders :: [EventHeaderInfo]
ctiComment :: Maybe Text
ctiRequestTransform :: Maybe RequestTransform
ctiResponseTransform :: Maybe MetadataResponseTransform
</span><a href="Hasura.RQL.Types.SchemaCache.html#ctiName"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722189"><span class="annot"><span class="annottext">payload :: ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722189"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>              </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe TriggerName
-&gt; UTCTime
-&gt; Value
-&gt; Maybe Text
-&gt; Maybe UTCTime
-&gt; Maybe RequestTransform
-&gt; Maybe MetadataResponseTransform
-&gt; ScheduledEventWebhookPayload
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledEventWebhookPayload"><span class="hs-identifier hs-var">ScheduledEventWebhookPayload</span></a></span><span>
</span><span id="line-273"></span><span>                </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722175"><span class="hs-identifier hs-var">id'</span></a></span><span>
</span><span id="line-274"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; Maybe TriggerName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722176"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722177"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-276"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value -&gt; Value
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687722182"><span class="hs-identifier hs-var">ctiPayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>                </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687722186"><span class="hs-identifier hs-var">ctiComment</span></a></span><span>
</span><span id="line-278"></span><span>                </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-279"></span><span>                </span><span class="annot"><span class="annottext">Maybe RequestTransform
</span><a href="#local-6989586621687722187"><span class="hs-identifier hs-var">ctiRequestTransform</span></a></span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><span class="annottext">Maybe MetadataResponseTransform
</span><a href="#local-6989586621687722188"><span class="hs-identifier hs-var">ctiResponseTransform</span></a></span><span>
</span><span id="line-281"></span><span>            </span><span id="local-6989586621687722193"><span class="annot"><span class="annottext">retryCtx :: RetryContext
</span><a href="#local-6989586621687722193"><span class="hs-identifier hs-var hs-var">retryCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; STRetryConf -&gt; RetryContext
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#RetryContext"><span class="hs-identifier hs-var">RetryContext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722178"><span class="hs-identifier hs-var">tries</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722183"><span class="hs-identifier hs-var">ctiRetryConf</span></a></span><span>
</span><span id="line-282"></span><span>            </span><span id="local-6989586621687722195"><span class="annot"><span class="annottext">eventProcessingTimeout :: DiffTime
</span><a href="#local-6989586621687722195"><span class="hs-identifier hs-var hs-var">eventProcessingTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; DiffTime
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="Hasura.Eventing.ScheduledTrigger.html#upperBoundScheduledEventTimeout"><span class="hs-identifier hs-var">upperBoundScheduledEventTimeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Refined NonNegative DiffTime -&gt; DiffTime
forall {k} (p :: k) x. Refined p x -&gt; x
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html#unrefine"><span class="hs-identifier hs-var">unrefine</span></a></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative DiffTime -&gt; DiffTime)
-&gt; Refined NonNegative DiffTime -&gt; DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STRetryConf -&gt; Refined NonNegative DiffTime
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#strcTimeoutSeconds"><span class="hs-identifier hs-var">strcTimeoutSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">(STRetryConf -&gt; Refined NonNegative DiffTime)
-&gt; STRetryConf -&gt; Refined NonNegative DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722183"><span class="hs-identifier hs-var">ctiRetryConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>            </span><span id="local-6989586621687722198"><span class="annot"><span class="annottext">processScheduledEventAction :: m (Either QErr ())
</span><a href="#local-6989586621687722198"><span class="hs-identifier hs-var hs-var">processScheduledEventAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>              </span><span class="annot"><span class="annottext">ExceptT QErr m () -&gt; m (Either QErr ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span>
</span><span id="line-285"></span><span>                </span><span class="annot"><span class="annottext">(ExceptT QErr m () -&gt; m (Either QErr ()))
-&gt; ExceptT QErr m () -&gt; m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
 -&gt; (Logger Hasura, Manager) -&gt; ExceptT QErr m ())
-&gt; (Logger Hasura, Manager)
-&gt; ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
-&gt; ExceptT QErr m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
-&gt; (Logger Hasura, Manager) -&gt; ExceptT QErr m ()
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722165"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722166"><span class="hs-identifier hs-var">httpMgr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>                </span><span class="annot"><span class="annottext">(ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
 -&gt; ExceptT QErr m ())
-&gt; ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
-&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
-&gt; ScheduledEventId
-&gt; [EventHeaderInfo]
-&gt; RetryContext
-&gt; ScheduledEventWebhookPayload
-&gt; EnvRecord ResolvedWebhook
-&gt; ScheduledEventType
-&gt; TriggersErrorLogLevelStatus
-&gt; ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
forall r (m :: * -&gt; *).
(MonadReader r m, Has Manager r, Has (Logger Hasura) r, MonadIO m,
 MonadTrace m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledTriggerMetrics
-&gt; ScheduledEventId
-&gt; [EventHeaderInfo]
-&gt; RetryContext
-&gt; ScheduledEventWebhookPayload
-&gt; EnvRecord ResolvedWebhook
-&gt; ScheduledEventType
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledEvent"><span class="hs-identifier hs-var">processScheduledEvent</span></a></span><span>
</span><span id="line-287"></span><span>                  </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722167"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span>
</span><span id="line-288"></span><span>                  </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722175"><span class="hs-identifier hs-var">id'</span></a></span><span>
</span><span id="line-289"></span><span>                  </span><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722185"><span class="hs-identifier hs-var">ctiHeaders</span></a></span><span>
</span><span id="line-290"></span><span>                  </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722193"><span class="hs-identifier hs-var">retryCtx</span></a></span><span>
</span><span id="line-291"></span><span>                  </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722189"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-292"></span><span>                  </span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722184"><span class="hs-identifier hs-var">ctiWebhookInfo</span></a></span><span>
</span><span id="line-293"></span><span>                  </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span>
</span><span id="line-294"></span><span>                  </span><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722171"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span id="local-6989586621687722202"><span class="annot"><span class="annottext">Maybe (Either QErr ())
</span><a href="#local-6989586621687722202"><span class="hs-identifier hs-var">eventProcessedMaybe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-296"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; m (Either QErr ()) -&gt; m (Maybe (Either QErr ()))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
Int -&gt; m a -&gt; m (Maybe a)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/System.Timeout.Lifted.html#timeout"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; Integer
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#diffTimeToMicroSeconds"><span class="hs-identifier hs-var">diffTimeToMicroSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621687722195"><span class="hs-identifier hs-var">eventProcessingTimeout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m (Maybe (Either QErr ())))
-&gt; m (Either QErr ()) -&gt; m (Maybe (Either QErr ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m (Either QErr ())
</span><a href="#local-6989586621687722198"><span class="hs-identifier hs-var">processScheduledEventAction</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Either QErr ())
</span><a href="#local-6989586621687722202"><span class="hs-identifier hs-var">eventProcessedMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-298"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Either QErr ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722204"><span class="annot"><span class="annottext">eventTimeoutMessage :: Text
</span><a href="#local-6989586621687722204"><span class="hs-identifier hs-var hs-var">eventTimeoutMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cron Scheduled event &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722175"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; of cron trigger &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722176"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; timed out while processing.&quot;</span></span><span>
</span><span id="line-300"></span><span>                </span><span id="local-6989586621687722205"><span class="annot"><span class="annottext">eventTimeoutError :: QErr
</span><a href="#local-6989586621687722205"><span class="hs-identifier hs-var hs-var">eventTimeoutError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err500"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#TimeoutErrorCode"><span class="hs-identifier hs-var">TimeoutErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722204"><span class="hs-identifier hs-var">eventTimeoutMessage</span></a></span><span>
</span><span id="line-301"></span><span>            </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722179"><span class="hs-identifier hs-var">logInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722205"><span class="hs-identifier hs-var">eventTimeoutError</span></a></span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><span class="annottext">ExceptT QErr m () -&gt; m (Either QErr ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr Any
-&gt; ScheduledTriggerMetrics
-&gt; ExceptT QErr m ()
forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processError"><span class="hs-identifier hs-var">processError</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722175"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722193"><span class="hs-identifier hs-var">retryCtx</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="#local-6989586621687722208"><span class="hs-identifier hs-var">mkErrorObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722204"><span class="hs-identifier hs-var">eventTimeoutMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; HTTPErr Any
forall (a :: TriggerTypes). String -&gt; HTTPErr a
</span><a href="Hasura.Eventing.HTTP.html#HOther"><span class="hs-identifier hs-var">HOther</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HTTPErr Any) -&gt; String -&gt; HTTPErr Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722204"><span class="hs-identifier hs-var">eventTimeoutMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722167"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>              </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; (Either QErr () -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either QErr () -&gt; (QErr -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722179"><span class="hs-identifier hs-var">logInternalError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687722211"><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621687722211"><span class="hs-identifier hs-var">finally</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either QErr () -&gt; (QErr -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onLeft"><span class="hs-identifier hs-var">onLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either QErr ()
</span><a href="#local-6989586621687722211"><span class="hs-identifier hs-var">finally</span></a></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722179"><span class="hs-identifier hs-var">logInternalError</span></a></span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; TVar (Set ScheduledEventId) -&gt; m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
ScheduledEventId -&gt; TVar (Set ScheduledEventId) -&gt; m ()
</span><a href="Hasura.Eventing.Common.html#removeEventFromLockedEvents"><span class="hs-identifier hs-var">removeEventFromLockedEvents</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722175"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722170"><span class="hs-identifier hs-var">lockedCronEvents</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621687722179"><span class="annot"><span class="annottext">logInternalError :: QErr -&gt; m ()
</span><a href="#local-6989586621687722179"><span class="hs-identifier hs-var hs-var">logInternalError</span></a></span></span><span> </span><span id="local-6989586621687722213"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722213"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ())
-&gt; (ScheduledTriggerInternalErr -&gt; IO ())
-&gt; ScheduledTriggerInternalErr
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722165"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(ScheduledTriggerInternalErr -&gt; m ())
-&gt; ScheduledTriggerInternalErr -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ScheduledTriggerInternalErr
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledTriggerInternalErr"><span class="hs-identifier hs-var">ScheduledTriggerInternalErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722213"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="#local-6989586621687722208"><span class="hs-identifier hs-type">mkErrorObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621687722208"><span class="annot"><span class="annottext">mkErrorObject :: Text -&gt; Value
</span><a href="#local-6989586621687722208"><span class="hs-identifier hs-var hs-var">mkErrorObject</span></a></span></span><span> </span><span id="local-6989586621687722214"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722214"><span class="hs-identifier hs-var">errorMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>      </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value) -&gt; [Pair] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;error&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722214"><span class="hs-identifier hs-var">errorMessage</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span id="local-6989586621687721477"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processOneOffScheduledEvents"><span class="hs-identifier hs-type">processOneOffScheduledEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721477"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721477"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721477"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721477"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-320"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-88628f48a025e46598ca658ea231eb27d6340417f49e950fbf8c438edb3ebbdc/share/doc/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">HTTP.Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffScheduledEvent"><span class="hs-identifier hs-type">OneOffScheduledEvent</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffScheduledEventId"><span class="hs-identifier hs-type">OneOffScheduledEventId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#TriggersErrorLogLevelStatus"><span class="hs-identifier hs-type">TriggersErrorLogLevelStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><a href="#local-6989586621687721477"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-327"></span><span id="processOneOffScheduledEvents"><span class="annot"><span class="annottext">processOneOffScheduledEvents :: forall (m :: * -&gt; *).
(MonadIO m, MonadTrace m, MonadMetadataStorage m,
 MonadBaseControl IO m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; [OneOffScheduledEvent]
-&gt; TVar (Set ScheduledEventId)
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processOneOffScheduledEvents"><span class="hs-identifier hs-var hs-var">processOneOffScheduledEvents</span></a></span></span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621687722284"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687722284"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621687722285"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722285"><span class="hs-identifier hs-var">logger</span></a></span></span><span>
</span><span id="line-330"></span><span>  </span><span id="local-6989586621687722286"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722286"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621687722287"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722287"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span></span><span>
</span><span id="line-332"></span><span>  </span><span id="local-6989586621687722288"><span class="annot"><span class="annottext">[OneOffScheduledEvent]
</span><a href="#local-6989586621687722288"><span class="hs-identifier hs-var">oneOffEvents</span></a></span></span><span>
</span><span id="line-333"></span><span>  </span><span id="local-6989586621687722289"><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722289"><span class="hs-identifier hs-var">lockedOneOffScheduledEvents</span></a></span></span><span>
</span><span id="line-334"></span><span>  </span><span id="local-6989586621687722290"><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722290"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">-- save the locked one-off events that have been fetched from the</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-comment">-- database, the events stored here will be unlocked in case a</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-comment">-- graceful shutdown is initiated in midst of processing these events</span><span>
</span><span id="line-338"></span><span>    </span><span class="annot"><span class="annottext">[ScheduledEventId] -&gt; TVar (Set ScheduledEventId) -&gt; m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
[ScheduledEventId] -&gt; TVar (Set ScheduledEventId) -&gt; m ()
</span><a href="Hasura.Eventing.Common.html#saveLockedEvents"><span class="hs-identifier hs-var">saveLockedEvents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OneOffScheduledEvent -&gt; ScheduledEventId)
-&gt; [OneOffScheduledEvent] -&gt; [ScheduledEventId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">OneOffScheduledEvent -&gt; ScheduledEventId
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#_ooseId"><span class="hs-identifier hs-var">_ooseId</span></a></span><span> </span><span class="annot"><span class="annottext">[OneOffScheduledEvent]
</span><a href="#local-6989586621687722288"><span class="hs-identifier hs-var">oneOffEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722289"><span class="hs-identifier hs-var">lockedOneOffScheduledEvents</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">[OneOffScheduledEvent] -&gt; (OneOffScheduledEvent -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, MonadBaseControl IO m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-d63f7c0774c9603306fb6be4536181f7e6facdd649f3f450b4e7dfd3d91cda94/share/doc/html/src/Control.Concurrent.Async.Lifted.html#forConcurrently_"><span class="hs-identifier hs-var">forConcurrently_</span></a></span><span> </span><span class="annot"><span class="annottext">[OneOffScheduledEvent]
</span><a href="#local-6989586621687722288"><span class="hs-identifier hs-var">oneOffEvents</span></a></span><span> </span><span class="annot"><span class="annottext">((OneOffScheduledEvent -&gt; m ()) -&gt; m ())
-&gt; (OneOffScheduledEvent -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffScheduledEvent"><span class="hs-identifier hs-type">OneOffScheduledEvent</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722293"><span id="local-6989586621687722294"><span id="local-6989586621687722295"><span id="local-6989586621687722296"><span id="local-6989586621687722297"><span id="local-6989586621687722298"><span id="local-6989586621687722299"><span id="local-6989586621687722300"><span id="local-6989586621687722301"><span id="local-6989586621687722302"><span id="local-6989586621687722303"><span id="local-6989586621687722304"><span id="local-6989586621687722305"><span class="annot"><span class="annottext">Int
[HeaderConf]
Maybe Text
Maybe Value
Maybe UTCTime
Maybe RequestTransform
Maybe MetadataResponseTransform
Text
UTCTime
ScheduledEventId
InputWebhook
STRetryConf
_ooseId :: OneOffScheduledEvent -&gt; ScheduledEventId
_ooseId :: ScheduledEventId
_ooseWebhookConf :: InputWebhook
_ooseScheduledTime :: UTCTime
_ooseRetryConf :: STRetryConf
_oosePayload :: Maybe Value
_ooseHeaderConf :: [HeaderConf]
_ooseStatus :: Text
_ooseTries :: Int
_ooseCreatedAt :: UTCTime
_ooseNextRetryAt :: Maybe UTCTime
_ooseComment :: Maybe Text
_ooseRequestTransform :: Maybe RequestTransform
_ooseResponseTransform :: Maybe MetadataResponseTransform
_ooseWebhookConf :: OneOffScheduledEvent -&gt; InputWebhook
_ooseScheduledTime :: OneOffScheduledEvent -&gt; UTCTime
_ooseRetryConf :: OneOffScheduledEvent -&gt; STRetryConf
_oosePayload :: OneOffScheduledEvent -&gt; Maybe Value
_ooseHeaderConf :: OneOffScheduledEvent -&gt; [HeaderConf]
_ooseStatus :: OneOffScheduledEvent -&gt; Text
_ooseTries :: OneOffScheduledEvent -&gt; Int
_ooseCreatedAt :: OneOffScheduledEvent -&gt; UTCTime
_ooseNextRetryAt :: OneOffScheduledEvent -&gt; Maybe UTCTime
_ooseComment :: OneOffScheduledEvent -&gt; Maybe Text
_ooseRequestTransform :: OneOffScheduledEvent -&gt; Maybe RequestTransform
_ooseResponseTransform :: OneOffScheduledEvent -&gt; Maybe MetadataResponseTransform
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#_ooseId"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QErr -&gt; m ()) -&gt; (() -&gt; m ()) -&gt; Either QErr () -&gt; m ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722319"><span class="hs-identifier hs-var">logInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either QErr () -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m () -&gt; m (Either QErr ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722321"><span class="annot"><span class="annottext">payload :: ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722321"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>              </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe TriggerName
-&gt; UTCTime
-&gt; Value
-&gt; Maybe Text
-&gt; Maybe UTCTime
-&gt; Maybe RequestTransform
-&gt; Maybe MetadataResponseTransform
-&gt; ScheduledEventWebhookPayload
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledEventWebhookPayload"><span class="hs-identifier hs-var">ScheduledEventWebhookPayload</span></a></span><span>
</span><span id="line-343"></span><span>                </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722293"><span class="hs-identifier hs-var">_ooseId</span></a></span><span>
</span><span id="line-344"></span><span>                </span><span class="annot"><span class="annottext">Maybe TriggerName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-345"></span><span>                </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722295"><span class="hs-identifier hs-var">_ooseScheduledTime</span></a></span><span>
</span><span id="line-346"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value -&gt; Value
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687722297"><span class="hs-identifier hs-var">_oosePayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>                </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687722303"><span class="hs-identifier hs-var">_ooseComment</span></a></span><span>
</span><span id="line-348"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722301"><span class="hs-identifier hs-var">_ooseCreatedAt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>                </span><span class="annot"><span class="annottext">Maybe RequestTransform
</span><a href="#local-6989586621687722304"><span class="hs-identifier hs-var">_ooseRequestTransform</span></a></span><span>
</span><span id="line-350"></span><span>                </span><span class="annot"><span class="annottext">Maybe MetadataResponseTransform
</span><a href="#local-6989586621687722305"><span class="hs-identifier hs-var">_ooseResponseTransform</span></a></span><span>
</span><span id="line-351"></span><span>            </span><span id="local-6989586621687722322"><span class="annot"><span class="annottext">retryCtx :: RetryContext
</span><a href="#local-6989586621687722322"><span class="hs-identifier hs-var hs-var">retryCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; STRetryConf -&gt; RetryContext
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#RetryContext"><span class="hs-identifier hs-var">RetryContext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722300"><span class="hs-identifier hs-var">_ooseTries</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722296"><span class="hs-identifier hs-var">_ooseRetryConf</span></a></span><span>
</span><span id="line-352"></span><span>            </span><span id="local-6989586621687722323"><span class="annot"><span class="annottext">resolvedWebhookInfoEither :: Either ResolveWebhookError ResolvedWebhook
</span><a href="#local-6989586621687722323"><span class="hs-identifier hs-var hs-var">resolvedWebhookInfoEither</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; InputWebhook -&gt; Either ResolveWebhookError ResolvedWebhook
</span><a href="Hasura.RQL.Types.Common.html#resolveWebhookEither"><span class="hs-identifier hs-var">resolveWebhookEither</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687722284"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">InputWebhook
</span><a href="#local-6989586621687722294"><span class="hs-identifier hs-var">_ooseWebhookConf</span></a></span><span>
</span><span id="line-353"></span><span>            </span><span id="local-6989586621687722325"><span class="annot"><span class="annottext">resolvedHeaderInfoEither :: Either ResolveHeaderError [EventHeaderInfo]
</span><a href="#local-6989586621687722325"><span class="hs-identifier hs-var hs-var">resolvedHeaderInfoEither</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; [HeaderConf] -&gt; Either ResolveHeaderError [EventHeaderInfo]
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getHeaderInfosFromConfEither"><span class="hs-identifier hs-var">getHeaderInfosFromConfEither</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687722284"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722298"><span class="hs-identifier hs-var">_ooseHeaderConf</span></a></span><span>
</span><span id="line-354"></span><span>            </span><span class="hs-comment">-- `webhookAndHeaderInfo` returns webhook and header info (and errors)</span><span>
</span><span id="line-355"></span><span>            </span><span id="local-6989586621687722326"><span class="annot"><span class="annottext">webhookAndHeaderInfo :: Either
  (These ResolveWebhookError ResolveHeaderError)
  (EnvRecord ResolvedWebhook, [EventHeaderInfo])
</span><a href="#local-6989586621687722326"><span class="hs-identifier hs-var hs-var">webhookAndHeaderInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either ResolveWebhookError ResolvedWebhook
</span><a href="#local-6989586621687722323"><span class="hs-identifier hs-var">resolvedWebhookInfoEither</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either ResolveHeaderError [EventHeaderInfo]
</span><a href="#local-6989586621687722325"><span class="hs-identifier hs-var">resolvedHeaderInfoEither</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687722327"><span class="annot"><span class="annottext">ResolvedWebhook
</span><a href="#local-6989586621687722327"><span class="hs-identifier hs-var">resolvedEventWebhookInfo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687722328"><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722328"><span class="hs-identifier hs-var">resolvedEventHeaderInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722329"><span class="annot"><span class="annottext">resolvedWebhookEnvRecord :: EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722329"><span class="hs-identifier hs-var hs-var">resolvedWebhookEnvRecord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ResolvedWebhook -&gt; EnvRecord ResolvedWebhook
forall a. Text -&gt; a -&gt; EnvRecord a
</span><a href="Hasura.RQL.Types.Common.html#EnvRecord"><span class="hs-identifier hs-var">EnvRecord</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputWebhook -&gt; Text
</span><a href="#local-6989586621687722331"><span class="hs-identifier hs-var">getTemplateFromUrl</span></a></span><span> </span><span class="annot"><span class="annottext">InputWebhook
</span><a href="#local-6989586621687722294"><span class="hs-identifier hs-var">_ooseWebhookConf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResolvedWebhook
</span><a href="#local-6989586621687722327"><span class="hs-identifier hs-var">resolvedEventWebhookInfo</span></a></span><span>
</span><span id="line-358"></span><span>                </span><span class="annot"><span class="annottext">(EnvRecord ResolvedWebhook, [EventHeaderInfo])
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722329"><span class="hs-identifier hs-var">resolvedWebhookEnvRecord</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722328"><span class="hs-identifier hs-var">resolvedEventHeaderInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722332"><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722332"><span class="hs-identifier hs-var">eventWebhookErrorVars</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(These ResolveWebhookError ResolveHeaderError
 -&gt; Either
      (These ResolveWebhookError ResolveHeaderError)
      (EnvRecord ResolvedWebhook, [EventHeaderInfo]))
-&gt; These ResolveWebhookError ResolveHeaderError
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError -&gt; These ResolveWebhookError ResolveHeaderError
forall a b. a -&gt; These a b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#This"><span class="hs-identifier hs-var">This</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722332"><span class="hs-identifier hs-var">eventWebhookErrorVars</span></a></span><span>
</span><span id="line-360"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">ResolvedWebhook
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722334"><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722334"><span class="hs-identifier hs-var">eventHeaderErrorVars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(These ResolveWebhookError ResolveHeaderError
 -&gt; Either
      (These ResolveWebhookError ResolveHeaderError)
      (EnvRecord ResolvedWebhook, [EventHeaderInfo]))
-&gt; These ResolveWebhookError ResolveHeaderError
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError -&gt; These ResolveWebhookError ResolveHeaderError
forall a b. b -&gt; These a b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#That"><span class="hs-identifier hs-var">That</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722334"><span class="hs-identifier hs-var">eventHeaderErrorVars</span></a></span><span>
</span><span id="line-361"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722336"><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722336"><span class="hs-identifier hs-var">eventWebhookErrors</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722337"><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722337"><span class="hs-identifier hs-var">eventHeaderErrorVars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(These ResolveWebhookError ResolveHeaderError
 -&gt; Either
      (These ResolveWebhookError ResolveHeaderError)
      (EnvRecord ResolvedWebhook, [EventHeaderInfo]))
-&gt; These ResolveWebhookError ResolveHeaderError
-&gt; Either
     (These ResolveWebhookError ResolveHeaderError)
     (EnvRecord ResolvedWebhook, [EventHeaderInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError
-&gt; ResolveHeaderError
-&gt; These ResolveWebhookError ResolveHeaderError
forall a b. a -&gt; b -&gt; These a b
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#These"><span class="hs-identifier hs-var">These</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722336"><span class="hs-identifier hs-var">eventWebhookErrors</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722337"><span class="hs-identifier hs-var">eventHeaderErrorVars</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (These ResolveWebhookError ResolveHeaderError)
  (EnvRecord ResolvedWebhook, [EventHeaderInfo])
</span><a href="#local-6989586621687722326"><span class="hs-identifier hs-var">webhookAndHeaderInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-363"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687722339"><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722339"><span class="hs-identifier hs-var">webhookEnvRecord</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722340"><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722340"><span class="hs-identifier hs-var">eventHeaderInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722341"><span class="annot"><span class="annottext">processScheduledEventAction :: ExceptT QErr m ()
</span><a href="#local-6989586621687722341"><span class="hs-identifier hs-var hs-var">processScheduledEventAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>                  </span><span class="annot"><span class="annottext">(ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
 -&gt; (Logger Hasura, Manager) -&gt; ExceptT QErr m ())
-&gt; (Logger Hasura, Manager)
-&gt; ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
-&gt; ExceptT QErr m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
-&gt; (Logger Hasura, Manager) -&gt; ExceptT QErr m ()
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722285"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722286"><span class="hs-identifier hs-var">httpMgr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                    </span><span class="annot"><span class="annottext">(ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
 -&gt; ExceptT QErr m ())
-&gt; ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
-&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
-&gt; ScheduledEventId
-&gt; [EventHeaderInfo]
-&gt; RetryContext
-&gt; ScheduledEventWebhookPayload
-&gt; EnvRecord ResolvedWebhook
-&gt; ScheduledEventType
-&gt; TriggersErrorLogLevelStatus
-&gt; ReaderT (Logger Hasura, Manager) (ExceptT QErr m) ()
forall r (m :: * -&gt; *).
(MonadReader r m, Has Manager r, Has (Logger Hasura) r, MonadIO m,
 MonadTrace m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledTriggerMetrics
-&gt; ScheduledEventId
-&gt; [EventHeaderInfo]
-&gt; RetryContext
-&gt; ScheduledEventWebhookPayload
-&gt; EnvRecord ResolvedWebhook
-&gt; ScheduledEventType
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledEvent"><span class="hs-identifier hs-var">processScheduledEvent</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722287"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722293"><span class="hs-identifier hs-var">_ooseId</span></a></span><span> </span><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722340"><span class="hs-identifier hs-var">eventHeaderInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722322"><span class="hs-identifier hs-var">retryCtx</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722321"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722339"><span class="hs-identifier hs-var">webhookEnvRecord</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722290"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>                </span><span id="local-6989586621687722343"><span class="annot"><span class="annottext">eventTimeout :: DiffTime
</span><a href="#local-6989586621687722343"><span class="hs-identifier hs-var hs-var">eventTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative DiffTime -&gt; DiffTime
forall {k} (p :: k) x. Refined p x -&gt; x
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html#unrefine"><span class="hs-identifier hs-var">unrefine</span></a></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative DiffTime -&gt; DiffTime)
-&gt; Refined NonNegative DiffTime -&gt; DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STRetryConf -&gt; Refined NonNegative DiffTime
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#strcTimeoutSeconds"><span class="hs-identifier hs-var">strcTimeoutSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">(STRetryConf -&gt; Refined NonNegative DiffTime)
-&gt; STRetryConf -&gt; Refined NonNegative DiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722296"><span class="hs-identifier hs-var">_ooseRetryConf</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-comment">-- Try to process the event with a timeout of min(`uppserBoundScheduledEventTimeout`, event's response timeout),</span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-comment">-- so that we're never blocked forever while processing a single event.</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-comment">-- If the request times out, then process it as an erroneous invocation and move on.</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; ExceptT QErr m () -&gt; ExceptT QErr m (Maybe ())
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
Int -&gt; m a -&gt; m (Maybe a)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/System.Timeout.Lifted.html#timeout"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; Integer
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#diffTimeToMicroSeconds"><span class="hs-identifier hs-var">diffTimeToMicroSeconds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; DiffTime
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="Hasura.Eventing.ScheduledTrigger.html#upperBoundScheduledEventTimeout"><span class="hs-identifier hs-var">upperBoundScheduledEventTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621687722343"><span class="hs-identifier hs-var">eventTimeout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT QErr m ()
</span><a href="#local-6989586621687722341"><span class="hs-identifier hs-var">processScheduledEventAction</span></a></span><span>
</span><span id="line-375"></span><span>              </span><span class="annot"><span class="annottext">ExceptT QErr m (Maybe ()) -&gt; ExceptT QErr m () -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#onNothingM"><span class="hs-operator hs-var">`onNothingM`</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-376"></span><span>                               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722345"><span class="annot"><span class="annottext">eventTimeoutMessage :: Text
</span><a href="#local-6989586621687722345"><span class="hs-identifier hs-var hs-var">eventTimeoutMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;One-off Scheduled event &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722293"><span class="hs-identifier hs-var">_ooseId</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; timed out while processing.&quot;</span></span><span>
</span><span id="line-377"></span><span>                                   </span><span id="local-6989586621687722346"><span class="annot"><span class="annottext">eventTimeoutError :: QErr
</span><a href="#local-6989586621687722346"><span class="hs-identifier hs-var hs-var">eventTimeoutError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err500"><span class="hs-identifier hs-var">err500</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#TimeoutErrorCode"><span class="hs-identifier hs-var">TimeoutErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722345"><span class="hs-identifier hs-var">eventTimeoutMessage</span></a></span><span>
</span><span id="line-378"></span><span>                               </span><span class="annot"><span class="annottext">m () -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT QErr m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ExceptT QErr m ()) -&gt; m () -&gt; ExceptT QErr m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722319"><span class="hs-identifier hs-var">logInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722346"><span class="hs-identifier hs-var">eventTimeoutError</span></a></span><span>
</span><span id="line-379"></span><span>                               </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr Any
-&gt; ScheduledTriggerMetrics
-&gt; ExceptT QErr m ()
forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processError"><span class="hs-identifier hs-var">processError</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722293"><span class="hs-identifier hs-var">_ooseId</span></a></span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722322"><span class="hs-identifier hs-var">retryCtx</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="#local-6989586621687722348"><span class="hs-identifier hs-var">mkErrorObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722345"><span class="hs-identifier hs-var">eventTimeoutMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; HTTPErr Any
forall (a :: TriggerTypes). String -&gt; HTTPErr a
</span><a href="Hasura.Eventing.HTTP.html#HOther"><span class="hs-identifier hs-var">HOther</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HTTPErr Any) -&gt; String -&gt; HTTPErr Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722345"><span class="hs-identifier hs-var">eventTimeoutMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722287"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span>
</span><span id="line-380"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; TVar (Set ScheduledEventId) -&gt; ExceptT QErr m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
ScheduledEventId -&gt; TVar (Set ScheduledEventId) -&gt; m ()
</span><a href="Hasura.Eventing.Common.html#removeEventFromLockedEvents"><span class="hs-identifier hs-var">removeEventFromLockedEvents</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722293"><span class="hs-identifier hs-var">_ooseId</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722289"><span class="hs-identifier hs-var">lockedOneOffScheduledEvents</span></a></span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722349"><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
</span><a href="#local-6989586621687722349"><span class="hs-identifier hs-var">envVarError</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-383"></span><span>            </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr Any
-&gt; ScheduledTriggerMetrics
-&gt; ExceptT QErr m ()
forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processError"><span class="hs-identifier hs-var">processError</span></a></span><span>
</span><span id="line-384"></span><span>              </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722293"><span class="hs-identifier hs-var">_ooseId</span></a></span><span>
</span><span id="line-385"></span><span>              </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722322"><span class="hs-identifier hs-var">retryCtx</span></a></span><span>
</span><span id="line-386"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-387"></span><span>              </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span>
</span><span id="line-388"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="#local-6989586621687722348"><span class="hs-identifier hs-var">mkErrorObject</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; Text -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error creating the request. &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError -&gt; Text
</span><a href="#local-6989586621687722350"><span class="hs-identifier hs-var">mkInvalidEnvVarErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">(These ResolveWebhookError ResolveHeaderError -&gt; Text)
-&gt; These ResolveWebhookError ResolveHeaderError -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
</span><a href="#local-6989586621687722349"><span class="hs-identifier hs-var">envVarError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; HTTPErr Any
forall (a :: TriggerTypes). String -&gt; HTTPErr a
</span><a href="Hasura.Eventing.HTTP.html#HOther"><span class="hs-identifier hs-var">HOther</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; HTTPErr Any) -&gt; String -&gt; HTTPErr Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Show.html#unpack"><span class="hs-identifier hs-var">T.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#qeError"><span class="hs-identifier hs-var">qeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError -&gt; Text
</span><a href="#local-6989586621687722350"><span class="hs-identifier hs-var">mkInvalidEnvVarErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
</span><a href="#local-6989586621687722349"><span class="hs-identifier hs-var">envVarError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>              </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722287"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>      </span><span id="local-6989586621687722319"><span class="annot"><span class="annottext">logInternalError :: QErr -&gt; m ()
</span><a href="#local-6989586621687722319"><span class="hs-identifier hs-var hs-var">logInternalError</span></a></span></span><span> </span><span id="local-6989586621687722354"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722354"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ())
-&gt; (ScheduledTriggerInternalErr -&gt; IO ())
-&gt; ScheduledTriggerInternalErr
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722285"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(ScheduledTriggerInternalErr -&gt; m ())
-&gt; ScheduledTriggerInternalErr -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ScheduledTriggerInternalErr
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledTriggerInternalErr"><span class="hs-identifier hs-var">ScheduledTriggerInternalErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722354"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-393"></span><span>      </span><span id="local-6989586621687722331"><span class="annot"><span class="annottext">getTemplateFromUrl :: InputWebhook -&gt; Text
</span><a href="#local-6989586621687722331"><span class="hs-identifier hs-var hs-var">getTemplateFromUrl</span></a></span></span><span> </span><span id="local-6989586621687722355"><span class="annot"><span class="annottext">InputWebhook
</span><a href="#local-6989586621687722355"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Template -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.URL.Template.html#printTemplate"><span class="hs-identifier hs-var">printTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">(Template -&gt; Text) -&gt; Template -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InputWebhook -&gt; Template
</span><a href="Hasura.RQL.Types.Common.html#unInputWebhook"><span class="hs-identifier hs-var">unInputWebhook</span></a></span><span> </span><span class="annot"><span class="annottext">InputWebhook
</span><a href="#local-6989586621687722355"><span class="hs-identifier hs-var">url</span></a></span><span>
</span><span id="line-394"></span><span>      </span><span id="local-6989586621687722350"><span class="annot"><span class="annottext">mkInvalidEnvVarErrMsg :: These ResolveWebhookError ResolveHeaderError -&gt; Text
</span><a href="#local-6989586621687722350"><span class="hs-identifier hs-var hs-var">mkInvalidEnvVarErrMsg</span></a></span></span><span> </span><span id="local-6989586621687722359"><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
</span><a href="#local-6989586621687722359"><span class="hs-identifier hs-var">envVarErrorValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The value for environment variables not found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError -&gt; Text
</span><a href="#local-6989586621687722360"><span class="hs-identifier hs-var">getInvalidEnvVarText</span></a></span><span> </span><span class="annot"><span class="annottext">These ResolveWebhookError ResolveHeaderError
</span><a href="#local-6989586621687722359"><span class="hs-identifier hs-var">envVarErrorValues</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>      </span><span class="annot"><a href="#local-6989586621687722348"><span class="hs-identifier hs-type">mkErrorObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-396"></span><span>      </span><span id="local-6989586621687722348"><span class="annot"><span class="annottext">mkErrorObject :: Text -&gt; Value
</span><a href="#local-6989586621687722348"><span class="hs-identifier hs-var hs-var">mkErrorObject</span></a></span></span><span> </span><span id="local-6989586621687722361"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722361"><span class="hs-identifier hs-var">errorMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-397"></span><span>        </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value) -&gt; [Pair] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;error&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722361"><span class="hs-identifier hs-var">errorMessage</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-398"></span><span>      </span><span class="annot"><a href="#local-6989586621687722360"><span class="hs-identifier hs-type">getInvalidEnvVarText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#These"><span class="hs-identifier hs-type">These</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#ResolveWebhookError"><span class="hs-identifier hs-type">ResolveWebhookError</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#ResolveHeaderError"><span class="hs-identifier hs-type">ResolveHeaderError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span id="local-6989586621687722360"><span class="annot"><span class="annottext">getInvalidEnvVarText :: These ResolveWebhookError ResolveHeaderError -&gt; Text
</span><a href="#local-6989586621687722360"><span class="hs-identifier hs-var hs-var">getInvalidEnvVarText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#This"><span class="hs-identifier hs-type">This</span></a></span><span> </span><span id="local-6989586621687722362"><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722362"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722362"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="annot"><a href="#local-6989586621687722360"><span class="hs-identifier hs-var">getInvalidEnvVarText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#That"><span class="hs-identifier hs-type">That</span></a></span><span> </span><span id="local-6989586621687722364"><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722364"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722364"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span class="annot"><a href="#local-6989586621687722360"><span class="hs-identifier hs-var">getInvalidEnvVarText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/these-1.1.1.1-5e95bd4cb5e997acb10a4856b5272f8c7fe8d35e09ec30fad9123f18a7887d21/share/doc/html/src/Data.These.html#These"><span class="hs-identifier hs-type">These</span></a></span><span> </span><span id="local-6989586621687722365"><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722365"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621687722366"><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722366"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveWebhookError
</span><a href="#local-6989586621687722365"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveHeaderError
</span><a href="#local-6989586621687722366"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span id="local-6989586621687721506"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledTriggers"><span class="hs-identifier hs-type">processScheduledTriggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721506"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721506"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721506"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721506"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-type">FetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-88628f48a025e46598ca658ea231eb27d6340417f49e950fbf8c438edb3ebbdc/share/doc/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">HTTP.Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#TriggersErrorLogLevelStatus"><span class="hs-identifier hs-type">TriggersErrorLogLevelStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><a href="#local-6989586621687721506"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.Extended.html#Forever"><span class="hs-identifier hs-type">Forever</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721506"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-418"></span><span id="processScheduledTriggers"><span class="annot"><span class="annottext">processScheduledTriggers :: forall (m :: * -&gt; *).
(MonadIO m, MonadTrace m, MonadMetadataStorage m,
 MonadBaseControl IO m) =&gt;
IO Environment
-&gt; Logger Hasura
-&gt; FetchedScheduledEventsStatsLogger
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; IO SchemaCache
-&gt; LockedEventsCtx
-&gt; TriggersErrorLogLevelStatus
-&gt; m (Forever m)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledTriggers"><span class="hs-identifier hs-var hs-var">processScheduledTriggers</span></a></span></span><span> </span><span id="local-6989586621687722402"><span class="annot"><span class="annottext">IO Environment
</span><a href="#local-6989586621687722402"><span class="hs-identifier hs-var">getEnvHook</span></a></span></span><span> </span><span id="local-6989586621687722403"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722403"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687722404"><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
</span><a href="#local-6989586621687722404"><span class="hs-identifier hs-var">statsLogger</span></a></span></span><span> </span><span id="local-6989586621687722405"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722405"><span class="hs-identifier hs-var">httpMgr</span></a></span></span><span> </span><span id="local-6989586621687722406"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722406"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span></span><span> </span><span id="local-6989586621687722407"><span class="annot"><span class="annottext">IO SchemaCache
</span><a href="#local-6989586621687722407"><span class="hs-identifier hs-var">getSC</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Eventing.Common.html#LockedEventsCtx"><span class="hs-identifier hs-type">LockedEventsCtx</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722409"><span id="local-6989586621687722410"><span id="local-6989586621687722411"><span id="local-6989586621687722412"><span class="annot"><span class="annottext">TVar (HashMap SourceName (Set ScheduledEventId))
TVar (Set ScheduledEventId)
leCronEvents :: TVar (Set ScheduledEventId)
leOneOffEvents :: TVar (Set ScheduledEventId)
leEvents :: TVar (HashMap SourceName (Set ScheduledEventId))
leActionEvents :: TVar (Set ScheduledEventId)
leCronEvents :: LockedEventsCtx -&gt; TVar (Set ScheduledEventId)
leOneOffEvents :: LockedEventsCtx -&gt; TVar (Set ScheduledEventId)
leEvents :: LockedEventsCtx -&gt; TVar (HashMap SourceName (Set ScheduledEventId))
leActionEvents :: LockedEventsCtx -&gt; TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722409"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621687722417"><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722417"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="annottext">Forever m -&gt; m (Forever m)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><span class="annottext">(Forever m -&gt; m (Forever m)) -&gt; Forever m -&gt; m (Forever m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; (() -&gt; m ()) -&gt; Forever m
forall (m :: * -&gt; *) a. a -&gt; (a -&gt; m a) -&gt; Forever m
</span><a href="Control.Concurrent.Extended.html#Forever"><span class="hs-identifier hs-var">Forever</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">((() -&gt; m ()) -&gt; Forever m) -&gt; (() -&gt; m ()) -&gt; Forever m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; () -&gt; m ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>      </span><span id="local-6989586621687722420"><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722420"><span class="hs-identifier hs-var">cronTriggersInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; HashMap TriggerName CronTriggerInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scCronTriggers"><span class="hs-identifier hs-var">scCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; HashMap TriggerName CronTriggerInfo)
-&gt; m SchemaCache -&gt; m (HashMap TriggerName CronTriggerInfo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO SchemaCache -&gt; m SchemaCache
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO SchemaCache
</span><a href="#local-6989586621687722407"><span class="hs-identifier hs-var">getSC</span></a></span><span>
</span><span id="line-423"></span><span>      </span><span id="local-6989586621687722421"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687722421"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Environment -&gt; m Environment
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO Environment
</span><a href="#local-6989586621687722402"><span class="hs-identifier hs-var">getEnvHook</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span class="annot"><span class="annottext">[TriggerName]
-&gt; m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
[TriggerName]
-&gt; m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
</span><a href="Hasura.Metadata.Class.html#getScheduledEventsForDelivery"><span class="hs-identifier hs-var">getScheduledEventsForDelivery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo -&gt; [TriggerName]
forall k v. HashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashMap.Internal.html#keys"><span class="hs-identifier hs-var">HashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722420"><span class="hs-identifier hs-var">cronTriggersInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Either QErr ([CronEvent], [OneOffScheduledEvent]))
-&gt; (Either QErr ([CronEvent], [OneOffScheduledEvent]) -&gt; m ())
-&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722423"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722423"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
</span><a href="#local-6989586621687722424"><span class="hs-identifier hs-var">logInternalError</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722423"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687722425"><span class="annot"><span class="annottext">[CronEvent]
</span><a href="#local-6989586621687722425"><span class="hs-identifier hs-var">cronEvents</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722426"><span class="annot"><span class="annottext">[OneOffScheduledEvent]
</span><a href="#local-6989586621687722426"><span class="hs-identifier hs-var">oneOffEvents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>          </span><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
-&gt; CronEventsCount -&gt; OneOffScheduledEventsCount -&gt; m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
FetchedScheduledEventsStatsLogger
-&gt; CronEventsCount -&gt; OneOffScheduledEventsCount -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#logFetchedScheduledEventsStats"><span class="hs-identifier hs-var">logFetchedScheduledEventsStats</span></a></span><span> </span><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
</span><a href="#local-6989586621687722404"><span class="hs-identifier hs-var">statsLogger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CronEventsCount
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#CronEventsCount"><span class="hs-identifier hs-var">CronEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CronEventsCount) -&gt; Int -&gt; CronEventsCount
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[CronEvent] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[CronEvent]
</span><a href="#local-6989586621687722425"><span class="hs-identifier hs-var">cronEvents</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; OneOffScheduledEventsCount
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#OneOffScheduledEventsCount"><span class="hs-identifier hs-var">OneOffScheduledEventsCount</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; OneOffScheduledEventsCount)
-&gt; Int -&gt; OneOffScheduledEventsCount
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[OneOffScheduledEvent] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[OneOffScheduledEvent]
</span><a href="#local-6989586621687722426"><span class="hs-identifier hs-var">oneOffEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; [CronEvent]
-&gt; HashMap TriggerName CronTriggerInfo
-&gt; TVar (Set ScheduledEventId)
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
forall (m :: * -&gt; *).
(MonadIO m, MonadMetadataStorage m, MonadTrace m,
 MonadBaseControl IO m) =&gt;
Logger Hasura
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; [CronEvent]
-&gt; HashMap TriggerName CronTriggerInfo
-&gt; TVar (Set ScheduledEventId)
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processCronEvents"><span class="hs-identifier hs-var">processCronEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722403"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722405"><span class="hs-identifier hs-var">httpMgr</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722406"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">[CronEvent]
</span><a href="#local-6989586621687722425"><span class="hs-identifier hs-var">cronEvents</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerInfo
</span><a href="#local-6989586621687722420"><span class="hs-identifier hs-var">cronTriggersInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722409"><span class="hs-identifier hs-var">leCronEvents</span></a></span><span> </span><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722417"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span><span>
</span><span id="line-429"></span><span>          </span><span class="annot"><span class="annottext">Environment
-&gt; Logger Hasura
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; [OneOffScheduledEvent]
-&gt; TVar (Set ScheduledEventId)
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
forall (m :: * -&gt; *).
(MonadIO m, MonadTrace m, MonadMetadataStorage m,
 MonadBaseControl IO m) =&gt;
Environment
-&gt; Logger Hasura
-&gt; Manager
-&gt; ScheduledTriggerMetrics
-&gt; [OneOffScheduledEvent]
-&gt; TVar (Set ScheduledEventId)
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processOneOffScheduledEvents"><span class="hs-identifier hs-var">processOneOffScheduledEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621687722421"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722403"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621687722405"><span class="hs-identifier hs-var">httpMgr</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722406"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">[OneOffScheduledEvent]
</span><a href="#local-6989586621687722426"><span class="hs-identifier hs-var">oneOffEvents</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set ScheduledEventId)
</span><a href="#local-6989586621687722410"><span class="hs-identifier hs-var">leOneOffEvents</span></a></span><span> </span><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722417"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-comment">-- NOTE: cron events are scheduled at times with minute resolution (as on</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-comment">-- unix), while one-off events can be set for arbitrary times. The sleep</span><span>
</span><span id="line-432"></span><span>      </span><span class="hs-comment">-- time here determines how overdue a scheduled event (cron or one-off)</span><span>
</span><span id="line-433"></span><span>      </span><span class="hs-comment">-- might be before we begin processing:</span><span>
</span><span id="line-434"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; IO ()
</span><a href="Control.Concurrent.Extended.html#sleep"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seconds -&gt; DiffTime
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#seconds"><span class="hs-identifier hs-var">seconds</span></a></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621687722424"><span class="annot"><span class="annottext">logInternalError :: QErr -&gt; m ()
</span><a href="#local-6989586621687722424"><span class="hs-identifier hs-var hs-var">logInternalError</span></a></span></span><span> </span><span id="local-6989586621687722432"><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722432"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ())
-&gt; (ScheduledTriggerInternalErr -&gt; IO ())
-&gt; ScheduledTriggerInternalErr
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722403"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(ScheduledTriggerInternalErr -&gt; m ())
-&gt; ScheduledTriggerInternalErr -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; ScheduledTriggerInternalErr
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledTriggerInternalErr"><span class="hs-identifier hs-var">ScheduledTriggerInternalErr</span></a></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621687722432"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span id="local-6989586621687721462"><span id="local-6989586621687721463"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledEvent"><span class="hs-identifier hs-type">processScheduledEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621687721462"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721463"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/data-has-0.4.0.0-dac5c7adae74e1856a42108dcba181ae6d833a24d6271d4129aff0f1aaae2f5f/share/doc/html/src/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-88628f48a025e46598ca658ea231eb27d6340417f49e950fbf8c438edb3ebbdc/share/doc/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">HTTP.Manager</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721462"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/data-has-0.4.0.0-dac5c7adae74e1856a42108dcba181ae6d833a24d6271d4129aff0f1aaae2f5f/share/doc/html/src/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687721462"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721463"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721463"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721463"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721463"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#EventHeaderInfo"><span class="hs-identifier hs-type">EventHeaderInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#RetryContext"><span class="hs-identifier hs-type">RetryContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledEventWebhookPayload"><span class="hs-identifier hs-type">ScheduledEventWebhookPayload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#EnvRecord"><span class="hs-identifier hs-type">EnvRecord</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#ResolvedWebhook"><span class="hs-identifier hs-type">ResolvedWebhook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-454"></span><span>  </span><span class="annot"><a href="Hasura.Server.Types.html#TriggersErrorLogLevelStatus"><span class="hs-identifier hs-type">TriggersErrorLogLevelStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-455"></span><span>  </span><span class="annot"><a href="#local-6989586621687721463"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-456"></span><span id="processScheduledEvent"><span class="annot"><span class="annottext">processScheduledEvent :: forall r (m :: * -&gt; *).
(MonadReader r m, Has Manager r, Has (Logger Hasura) r, MonadIO m,
 MonadTrace m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledTriggerMetrics
-&gt; ScheduledEventId
-&gt; [EventHeaderInfo]
-&gt; RetryContext
-&gt; ScheduledEventWebhookPayload
-&gt; EnvRecord ResolvedWebhook
-&gt; ScheduledEventType
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processScheduledEvent"><span class="hs-identifier hs-var hs-var">processScheduledEvent</span></a></span></span><span> </span><span id="local-6989586621687722532"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span></span><span> </span><span id="local-6989586621687722533"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722533"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722534"><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722534"><span class="hs-identifier hs-var">eventHeaders</span></a></span></span><span> </span><span id="local-6989586621687722535"><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722535"><span class="hs-identifier hs-var">retryCtx</span></a></span></span><span> </span><span id="local-6989586621687722536"><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621687722537"><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722537"><span class="hs-identifier hs-var">webhookUrl</span></a></span></span><span> </span><span id="local-6989586621687722538"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722538"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span id="local-6989586621687722539"><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722539"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><span class="annottext">SamplingPolicy -&gt; Text -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadIO m, MonadTrace m) =&gt;
SamplingPolicy -&gt; Text -&gt; m a -&gt; m a
</span><a href="Hasura.Tracing.Class.html#newTrace"><span class="hs-identifier hs-var">Tracing.newTrace</span></a></span><span> </span><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="Hasura.Tracing.Sampling.html#sampleAlways"><span class="hs-identifier hs-var">Tracing.sampleAlways</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722542"><span class="hs-identifier hs-var">traceNote</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621687722543"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722543"><span class="hs-identifier hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; m UTCTime
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722545"><span class="annot"><span class="annottext">retryConf :: STRetryConf
</span><a href="#local-6989586621687722545"><span class="hs-identifier hs-var hs-var">retryConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RetryContext -&gt; STRetryConf
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#_rctxConf"><span class="hs-identifier hs-var">_rctxConf</span></a></span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722535"><span class="hs-identifier hs-var">retryCtx</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span id="local-6989586621687722547"><span class="annot"><span class="annottext">scheduledTime :: UTCTime
</span><a href="#local-6989586621687722547"><span class="hs-identifier hs-var hs-var">scheduledTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload -&gt; UTCTime
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#sewpScheduledTime"><span class="hs-identifier hs-var">sewpScheduledTime</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; DiffTime
forall x y. (Duration x, Duration y) =&gt; x -&gt; y
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Data.Time.Clock.Units.html#convertDuration"><span class="hs-identifier hs-var">convertDuration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var">diffUTCTime</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722543"><span class="hs-identifier hs-var">currentTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722547"><span class="hs-identifier hs-var">scheduledTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>      </span><span class="annot"><span class="annottext">DiffTime -&gt; DiffTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative DiffTime -&gt; DiffTime
forall {k} (p :: k) x. Refined p x -&gt; x
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html#unrefine"><span class="hs-identifier hs-var">unrefine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRetryConf -&gt; Refined NonNegative DiffTime
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#strcToleranceSeconds"><span class="hs-identifier hs-var">strcToleranceSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722545"><span class="hs-identifier hs-var">retryConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; ScheduledEventType -&gt; m ()
forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId -&gt; ScheduledEventType -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processDead"><span class="hs-identifier hs-var">processDead</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722533"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722538"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722554"><span class="annot"><span class="annottext">timeoutSeconds :: Int
</span><a href="#local-6989586621687722554"><span class="hs-identifier hs-var hs-var">timeoutSeconds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Int
forall b. Integral b =&gt; DiffTime -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; Int) -&gt; DiffTime -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative DiffTime -&gt; DiffTime
forall {k} (p :: k) x. Refined p x -&gt; x
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html#unrefine"><span class="hs-identifier hs-var">unrefine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRetryConf -&gt; Refined NonNegative DiffTime
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#strcTimeoutSeconds"><span class="hs-identifier hs-var">strcTimeoutSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722545"><span class="hs-identifier hs-var">retryConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>            </span><span id="local-6989586621687722556"><span class="annot"><span class="annottext">httpTimeout :: ResponseTimeout
</span><a href="#local-6989586621687722556"><span class="hs-identifier hs-var hs-var">httpTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ResponseTimeout
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/http-client-0.7.13.1-88628f48a025e46598ca658ea231eb27d6340417f49e950fbf8c438edb3ebbdc/share/doc/html/src/Network.HTTP.Client.html#responseTimeoutMicro"><span class="hs-identifier hs-var">HTTP.responseTimeoutMicro</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722554"><span class="hs-identifier hs-var">timeoutSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000000</span></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621687722559"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687722559"><span class="hs-identifier hs-var">headers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722560"><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722560"><span class="hs-identifier hs-var">decodedHeaders</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EventHeaderInfo] -&gt; ([Header], [HeaderConf])
</span><a href="Hasura.Eventing.HTTP.html#prepareHeaders"><span class="hs-identifier hs-var">prepareHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">[EventHeaderInfo]
</span><a href="#local-6989586621687722534"><span class="hs-identifier hs-var">eventHeaders</span></a></span><span>
</span><span id="line-468"></span><span>            </span><span id="local-6989586621687722562"><span class="annot"><span class="annottext">extraLogCtx :: ExtraLogContext
</span><a href="#local-6989586621687722562"><span class="hs-identifier hs-var hs-var">extraLogCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Maybe TriggerName -&gt; ExtraLogContext
</span><a href="Hasura.Eventing.HTTP.html#ExtraLogContext"><span class="hs-identifier hs-var">ExtraLogContext</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722533"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload -&gt; Maybe TriggerName
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#sewpName"><span class="hs-identifier hs-var">sewpName</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>            </span><span id="local-6989586621687722565"><span class="annot"><span class="annottext">webhookReqBodyJson :: Value
</span><a href="#local-6989586621687722565"><span class="hs-identifier hs-var hs-var">webhookReqBodyJson</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-470"></span><span>            </span><span id="local-6989586621687722567"><span class="annot"><span class="annottext">webhookReqBody :: ByteString
</span><a href="#local-6989586621687722567"><span class="hs-identifier hs-var hs-var">webhookReqBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">J.encode</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722565"><span class="hs-identifier hs-var">webhookReqBodyJson</span></a></span><span>
</span><span id="line-471"></span><span>            </span><span id="local-6989586621687722569"><span class="annot"><span class="annottext">requestTransform :: Maybe RequestTransform
</span><a href="#local-6989586621687722569"><span class="hs-identifier hs-var hs-var">requestTransform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload -&gt; Maybe RequestTransform
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#sewpRequestTransform"><span class="hs-identifier hs-var">sewpRequestTransform</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-472"></span><span>            </span><span id="local-6989586621687722571"><span class="annot"><span class="annottext">responseTransform :: Maybe ResponseTransform
</span><a href="#local-6989586621687722571"><span class="hs-identifier hs-var hs-var">responseTransform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetadataResponseTransform -&gt; ResponseTransform
</span><a href="Hasura.RQL.DDL.Webhook.Transform.html#mkResponseTransform"><span class="hs-identifier hs-var">mkResponseTransform</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataResponseTransform -&gt; ResponseTransform)
-&gt; Maybe MetadataResponseTransform -&gt; Maybe ResponseTransform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload -&gt; Maybe MetadataResponseTransform
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#sewpResponseTransform"><span class="hs-identifier hs-var">sewpResponseTransform</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>        </span><span id="local-6989586621687722574"><span class="annot"><span class="annottext">Either
  (TransformableRequestError 'ScheduledType)
  (Request, HTTPResp 'ScheduledType)
</span><a href="#local-6989586621687722574"><span class="hs-identifier hs-var">eitherReqRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-475"></span><span>          </span><span class="annot"><span class="annottext">ExceptT
  (TransformableRequestError 'ScheduledType)
  m
  (Request, HTTPResp 'ScheduledType)
-&gt; m (Either
        (TransformableRequestError 'ScheduledType)
        (Request, HTTPResp 'ScheduledType))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span>
</span><span id="line-476"></span><span>            </span><span class="annot"><span class="annottext">(ExceptT
   (TransformableRequestError 'ScheduledType)
   m
   (Request, HTTPResp 'ScheduledType)
 -&gt; m (Either
         (TransformableRequestError 'ScheduledType)
         (Request, HTTPResp 'ScheduledType)))
-&gt; ExceptT
     (TransformableRequestError 'ScheduledType)
     m
     (Request, HTTPResp 'ScheduledType)
-&gt; m (Either
        (TransformableRequestError 'ScheduledType)
        (Request, HTTPResp 'ScheduledType))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Header]
-&gt; ResponseTimeout
-&gt; ByteString
-&gt; Maybe RequestTransform
-&gt; ResolvedWebhook
-&gt; ExceptT
     (TransformableRequestError 'ScheduledType) m RequestDetails
forall (a :: TriggerTypes) (m :: * -&gt; *).
MonadError (TransformableRequestError a) m =&gt;
[Header]
-&gt; ResponseTimeout
-&gt; ByteString
-&gt; Maybe RequestTransform
-&gt; ResolvedWebhook
-&gt; m RequestDetails
</span><a href="Hasura.Eventing.HTTP.html#mkRequest"><span class="hs-identifier hs-var">mkRequest</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621687722559"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseTimeout
</span><a href="#local-6989586621687722556"><span class="hs-identifier hs-var">httpTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621687722567"><span class="hs-identifier hs-var">webhookReqBody</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RequestTransform
</span><a href="#local-6989586621687722569"><span class="hs-identifier hs-var">requestTransform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook -&gt; ResolvedWebhook
forall a. EnvRecord a -&gt; a
</span><a href="Hasura.RQL.Types.Common.html#_envVarValue"><span class="hs-identifier hs-var">_envVarValue</span></a></span><span> </span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722537"><span class="hs-identifier hs-var">webhookUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>            </span><span class="annot"><span class="annottext">ExceptT (TransformableRequestError 'ScheduledType) m RequestDetails
-&gt; (RequestDetails
    -&gt; ExceptT
         (TransformableRequestError 'ScheduledType)
         m
         (Request, HTTPResp 'ScheduledType))
-&gt; ExceptT
     (TransformableRequestError 'ScheduledType)
     m
     (Request, HTTPResp 'ScheduledType)
forall a b.
ExceptT (TransformableRequestError 'ScheduledType) m a
-&gt; (a -&gt; ExceptT (TransformableRequestError 'ScheduledType) m b)
-&gt; ExceptT (TransformableRequestError 'ScheduledType) m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687722577"><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722577"><span class="hs-identifier hs-var">reqDetails</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-478"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722578"><span class="annot"><span class="annottext">request :: Request
</span><a href="#local-6989586621687722578"><span class="hs-identifier hs-var hs-var">request</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestDetails -&gt; Request
</span><a href="Hasura.Eventing.HTTP.html#extractRequest"><span class="hs-identifier hs-var">extractRequest</span></a></span><span> </span><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722577"><span class="hs-identifier hs-var">reqDetails</span></a></span><span>
</span><span id="line-479"></span><span>                  </span><span id="local-6989586621687722580"><span class="annot"><span class="annottext">logger :: Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
-&gt; RequestDetails
-&gt; ExceptT (TransformableRequestError 'ScheduledType) m ()
</span><a href="#local-6989586621687722580"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687722581"><span class="annot"><span class="annottext">Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
</span><a href="#local-6989586621687722581"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621687722582"><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722582"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>                    </span><span class="annot"><span class="annottext">Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
-&gt; ExtraLogContext
-&gt; RequestDetails
-&gt; Text
-&gt; [HeaderConf]
-&gt; TriggersErrorLogLevelStatus
-&gt; ExceptT (TransformableRequestError 'ScheduledType) m ()
forall r (m :: * -&gt; *).
(MonadReader r m, Has (Logger Hasura) r, MonadIO m) =&gt;
Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
-&gt; ExtraLogContext
-&gt; RequestDetails
-&gt; Text
-&gt; [HeaderConf]
-&gt; TriggersErrorLogLevelStatus
-&gt; m ()
</span><a href="Hasura.Eventing.HTTP.html#logHTTPForST"><span class="hs-identifier hs-var">logHTTPForST</span></a></span><span> </span><span class="annot"><span class="annottext">Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
</span><a href="#local-6989586621687722581"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExtraLogContext
</span><a href="#local-6989586621687722562"><span class="hs-identifier hs-var">extraLogCtx</span></a></span><span> </span><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722582"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook -&gt; Text
forall a. EnvRecord a -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#_envVarName"><span class="hs-identifier hs-var">_envVarName</span></a></span><span> </span><span class="annot"><span class="annottext">EnvRecord ResolvedWebhook
</span><a href="#local-6989586621687722537"><span class="hs-identifier hs-var">webhookUrl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722560"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">TriggersErrorLogLevelStatus
</span><a href="#local-6989586621687722539"><span class="hs-identifier hs-var">triggersErrorLogLevelStatus</span></a></span><span>
</span><span id="line-481"></span><span>                    </span><span class="annot"><span class="annottext">IO () -&gt; ExceptT (TransformableRequestError 'ScheduledType) m ()
forall a.
IO a -&gt; ExceptT (TransformableRequestError 'ScheduledType) m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ExceptT (TransformableRequestError 'ScheduledType) m ())
-&gt; IO () -&gt; ExceptT (TransformableRequestError 'ScheduledType) m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
</span><a href="#local-6989586621687722581"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-483"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722585"><span class="annot"><span class="annottext">HTTPErr 'ScheduledType
</span><a href="#local-6989586621687722585"><span class="hs-identifier hs-var">_err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621687722586"><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><a href="#local-6989586621687722586"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-485"></span><span>                          </span><span class="annot"><span class="annottext">Counter -&gt; Int64 -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#add"><span class="hs-identifier hs-var">Prometheus.Counter.add</span></a></span><span>
</span><span id="line-486"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmScheduledTriggerBytesReceived"><span class="hs-identifier hs-var">stmScheduledTriggerBytesReceived</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HTTPResp 'ScheduledType -&gt; Int64
forall (a :: TriggerTypes). HTTPResp a -&gt; Int64
</span><a href="Hasura.Eventing.HTTP.html#hrsSize"><span class="hs-identifier hs-var">hrsSize</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><a href="#local-6989586621687722586"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#RequestDetails"><span class="hs-identifier hs-type">RequestDetails</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722591"><span class="annot"><span class="annottext">Int64
_rdOriginalSize :: Int64
_rdOriginalSize :: RequestDetails -&gt; Int64
</span><a href="#local-6989586621687722591"><span class="hs-identifier hs-var hs-var">_rdOriginalSize</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722593"><span class="annot"><span class="annottext">Maybe Int64
_rdTransformedSize :: Maybe Int64
_rdTransformedSize :: RequestDetails -&gt; Maybe Int64
</span><a href="#local-6989586621687722593"><span class="hs-identifier hs-var hs-var">_rdTransformedSize</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722582"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-489"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Counter -&gt; Int64 -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#add"><span class="hs-identifier hs-var">Prometheus.Counter.add</span></a></span><span>
</span><span id="line-490"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmScheduledTriggerBytesSent"><span class="hs-identifier hs-var">stmScheduledTriggerBytesSent</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Maybe Int64 -&gt; Int64
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621687722591"><span class="hs-identifier hs-var">_rdOriginalSize</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int64
</span><a href="#local-6989586621687722593"><span class="hs-identifier hs-var">_rdTransformedSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722538"><span class="hs-identifier hs-var">type'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
</span><a href="#local-6989586621687722581"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-493"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722596"><span class="annot"><span class="annottext">HTTPErr 'ScheduledType
</span><a href="#local-6989586621687722596"><span class="hs-identifier hs-var">_err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmCronEventsInvocationTotalFailure"><span class="hs-identifier hs-var">stmCronEventsInvocationTotalFailure</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmCronEventsInvocationTotalSuccess"><span class="hs-identifier hs-var">stmCronEventsInvocationTotalSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621687722600"><span class="annot"><span class="annottext">HTTPErr 'ScheduledType
</span><a href="#local-6989586621687722600"><span class="hs-identifier hs-var">_err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmOneOffEventsInvocationTotalFailure"><span class="hs-identifier hs-var">stmOneOffEventsInvocationTotalFailure</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmOneOffEventsInvocationTotalSuccess"><span class="hs-identifier hs-var">stmOneOffEventsInvocationTotalSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>                  </span><span id="local-6989586621687722603"><span class="annot"><span class="annottext">sessionVars :: Maybe SessionVariables
</span><a href="#local-6989586621687722603"><span class="hs-identifier hs-var hs-var">sessionVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestDetails -&gt; Maybe SessionVariables
</span><a href="Hasura.Eventing.HTTP.html#_rdSessionVars"><span class="hs-identifier hs-var">_rdSessionVars</span></a></span><span> </span><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722577"><span class="hs-identifier hs-var">reqDetails</span></a></span><span>
</span><span id="line-498"></span><span>              </span><span id="local-6989586621687722605"><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><a href="#local-6989586621687722605"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RequestDetails
-&gt; Maybe ResponseTransform
-&gt; Maybe SessionVariables
-&gt; (Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
    -&gt; RequestDetails
    -&gt; ExceptT (TransformableRequestError 'ScheduledType) m ())
-&gt; ExceptT
     (TransformableRequestError 'ScheduledType)
     m
     (HTTPResp 'ScheduledType)
forall r (m :: * -&gt; *) (a :: TriggerTypes).
(MonadReader r m, MonadError (TransformableRequestError a) m,
 Has Manager r, Has (Logger Hasura) r, MonadIO m, MonadTrace m) =&gt;
RequestDetails
-&gt; Maybe ResponseTransform
-&gt; Maybe SessionVariables
-&gt; (Either (HTTPErr a) (HTTPResp a) -&gt; RequestDetails -&gt; m ())
-&gt; m (HTTPResp a)
</span><a href="Hasura.Eventing.HTTP.html#invokeRequest"><span class="hs-identifier hs-var">invokeRequest</span></a></span><span> </span><span class="annot"><span class="annottext">RequestDetails
</span><a href="#local-6989586621687722577"><span class="hs-identifier hs-var">reqDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ResponseTransform
</span><a href="#local-6989586621687722571"><span class="hs-identifier hs-var">responseTransform</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SessionVariables
</span><a href="#local-6989586621687722603"><span class="hs-identifier hs-var">sessionVars</span></a></span><span> </span><span class="annot"><span class="annottext">Either (HTTPErr 'ScheduledType) (HTTPResp 'ScheduledType)
-&gt; RequestDetails
-&gt; ExceptT (TransformableRequestError 'ScheduledType) m ()
</span><a href="#local-6989586621687722580"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-499"></span><span>              </span><span class="annot"><span class="annottext">(Request, HTTPResp 'ScheduledType)
-&gt; ExceptT
     (TransformableRequestError 'ScheduledType)
     m
     (Request, HTTPResp 'ScheduledType)
forall a.
a -&gt; ExceptT (TransformableRequestError 'ScheduledType) m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687722578"><span class="hs-identifier hs-var">request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><a href="#local-6989586621687722605"><span class="hs-identifier hs-var">resp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (TransformableRequestError 'ScheduledType)
  (Request, HTTPResp 'ScheduledType)
</span><a href="#local-6989586621687722574"><span class="hs-identifier hs-var">eitherReqRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-501"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687722607"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687722607"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722608"><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><a href="#local-6989586621687722608"><span class="hs-identifier hs-var">resp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-502"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722609"><span class="annot"><span class="annottext">reqBody :: Value
</span><a href="#local-6989586621687722609"><span class="hs-identifier hs-var hs-var">reqBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value -&gt; Value
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; Value) -&gt; Maybe Value -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Getting (First ByteString) Request ByteString
-&gt; Request -&gt; Maybe ByteString
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lens-5.2.2-c288f4ab3533e91c5d241152121e172474cc553aa524e32488a24b727cc130b5/share/doc/html/src/Control.Lens.Fold.html#preview"><span class="hs-identifier hs-var">preview</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RequestBody -&gt; Const (First ByteString) RequestBody)
-&gt; Request -&gt; Const (First ByteString) Request
Lens' Request RequestBody
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html#body"><span class="hs-identifier hs-var">HTTP.body</span></a></span><span> </span><span class="annot"><span class="annottext">((RequestBody -&gt; Const (First ByteString) RequestBody)
 -&gt; Request -&gt; Const (First ByteString) Request)
-&gt; ((ByteString -&gt; Const (First ByteString) ByteString)
    -&gt; RequestBody -&gt; Const (First ByteString) RequestBody)
-&gt; Getting (First ByteString) Request ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Const (First ByteString) ByteString)
-&gt; RequestBody -&gt; Const (First ByteString) RequestBody
Prism' RequestBody ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html#_RequestBodyLBS"><span class="hs-identifier hs-var">HTTP._RequestBodyLBS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621687722607"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; (ByteString -&gt; Maybe Value) -&gt; Maybe Value
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html#decode"><span class="hs-identifier hs-var">J.decode</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-503"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPResp 'ScheduledType
-&gt; ScheduledTriggerMetrics
-&gt; m ()
forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadMetadataStorage m, MonadError QErr m, MonadIO m) =&gt;
ScheduledEventId
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPResp a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processSuccess"><span class="hs-identifier hs-var">processSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722533"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722560"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722538"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722609"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp 'ScheduledType
</span><a href="#local-6989586621687722608"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span>
</span><span id="line-504"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HTTPError"><span class="hs-identifier hs-type">HTTPError</span></a></span><span> </span><span id="local-6989586621687722615"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722615"><span class="hs-identifier hs-var">reqBody</span></a></span></span><span> </span><span id="local-6989586621687722616"><span class="annot"><span class="annottext">HTTPErr 'ScheduledType
</span><a href="#local-6989586621687722616"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr 'ScheduledType
-&gt; ScheduledTriggerMetrics
-&gt; m ()
forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processError"><span class="hs-identifier hs-var">processError</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722533"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722535"><span class="hs-identifier hs-var">retryCtx</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722560"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722538"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722615"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPErr 'ScheduledType
</span><a href="#local-6989586621687722616"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722532"><span class="hs-identifier hs-var">scheduledTriggerMetrics</span></a></span><span>
</span><span id="line-505"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Eventing.HTTP.html#TransformationError"><span class="hs-identifier hs-type">TransformationError</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687722618"><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621687722618"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>            </span><span class="hs-comment">-- Log The Transformation Error</span><span>
</span><span id="line-507"></span><span>            </span><span id="local-6989586621687722619"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722619"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(r -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Logger Hasura
forall a t. Has a t =&gt; t -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/data-has-0.4.0.0-dac5c7adae74e1856a42108dcba181ae6d833a24d6271d4129aff0f1aaae2f5f/share/doc/html/src/Data.Has.html#getter"><span class="hs-identifier hs-var">getter</span></a></span><span>
</span><span id="line-508"></span><span>            </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">L.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621687722619"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(UnstructuredLog -&gt; m ()) -&gt; UnstructuredLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; SerializableBlob -&gt; UnstructuredLog
</span><a href="Hasura.Logging.html#UnstructuredLog"><span class="hs-identifier hs-var">L.UnstructuredLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelError"><span class="hs-identifier hs-var">L.LevelError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; SerializableBlob
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html#fromLBS"><span class="hs-identifier hs-var">SB.fromLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; SerializableBlob) -&gt; ByteString -&gt; SerializableBlob
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">J.encode</span></a></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621687722618"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-comment">-- Set event state to Error</span><span>
</span><span id="line-511"></span><span>            </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var">setScheduledEventOp</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722533"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventStatus -&gt; ScheduledEventOp
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpStatus"><span class="hs-identifier hs-var">SEOpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#SESError"><span class="hs-identifier hs-var">SESError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722538"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-513"></span><span>    </span><span id="local-6989586621687722542"><span class="annot"><span class="annottext">traceNote :: Text
</span><a href="#local-6989586621687722542"><span class="hs-identifier hs-var hs-var">traceNote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Scheduled trigger&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TriggerName -&gt; Text) -&gt; Maybe TriggerName -&gt; Text
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Maybe a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (TriggerName -&gt; Text) -&gt; TriggerName -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload -&gt; Maybe TriggerName
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#sewpName"><span class="hs-identifier hs-var">sewpName</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventWebhookPayload
</span><a href="#local-6989586621687722536"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span id="local-6989586621687721469"><span id="local-6989586621687721470"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processError"><span class="hs-identifier hs-type">processError</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721469"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721469"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721469"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-520"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#RetryContext"><span class="hs-identifier hs-type">RetryContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Headers.html#HeaderConf"><span class="hs-identifier hs-type">HeaderConf</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-523"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HTTPErr"><span class="hs-identifier hs-type">HTTPErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721470"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-526"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-527"></span><span>  </span><span class="annot"><a href="#local-6989586621687721469"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-528"></span><span id="processError"><span class="annot"><span class="annottext">processError :: forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPErr a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processError"><span class="hs-identifier hs-var hs-var">processError</span></a></span></span><span> </span><span id="local-6989586621687722644"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722644"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722645"><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722645"><span class="hs-identifier hs-var">retryCtx</span></a></span></span><span> </span><span id="local-6989586621687722646"><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722646"><span class="hs-identifier hs-var">decodedHeaders</span></a></span></span><span> </span><span id="local-6989586621687722647"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722647"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span id="local-6989586621687722648"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722648"><span class="hs-identifier hs-var">reqJson</span></a></span></span><span> </span><span id="local-6989586621687722649"><span class="annot"><span class="annottext">HTTPErr a
</span><a href="#local-6989586621687722649"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621687722650"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722650"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722651"><span class="annot"><span class="annottext">invocation :: Invocation 'ScheduledType
</span><a href="#local-6989586621687722651"><span class="hs-identifier hs-var hs-var">invocation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HTTPErr a
</span><a href="#local-6989586621687722649"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-530"></span><span>        </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HClient"><span class="hs-identifier hs-type">HClient</span></a></span><span> </span><span id="local-6989586621687722653"><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621687722653"><span class="hs-identifier hs-var">httpException</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-531"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722654"><span class="annot"><span class="annottext">statusMaybe :: Maybe Int
</span><a href="#local-6989586621687722654"><span class="hs-identifier hs-var hs-var">statusMaybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HttpException -&gt; Maybe Int
</span><a href="Hasura.HTTP.html#getHTTPExceptionStatus"><span class="hs-identifier hs-var">getHTTPExceptionStatus</span></a></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621687722653"><span class="hs-identifier hs-var">httpException</span></a></span><span>
</span><span id="line-532"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe Int
-&gt; [HeaderConf]
-&gt; SerializableBlob
-&gt; [HeaderConf]
-&gt; Value
-&gt; Invocation 'ScheduledType
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkInvocation"><span class="hs-identifier hs-var">mkInvocation</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722644"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722654"><span class="hs-identifier hs-var">statusMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722646"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; SerializableBlob
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html#fromLBS"><span class="hs-identifier hs-var">SB.fromLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; SerializableBlob) -&gt; ByteString -&gt; SerializableBlob
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HttpException -&gt; ByteString
</span><a href="Hasura.Eventing.HTTP.html#httpExceptionErrorEncoding"><span class="hs-identifier hs-var">httpExceptionErrorEncoding</span></a></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621687722653"><span class="hs-identifier hs-var">httpException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722648"><span class="hs-identifier hs-var">reqJson</span></a></span><span>
</span><span id="line-533"></span><span>        </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HStatus"><span class="hs-identifier hs-type">HStatus</span></a></span><span> </span><span id="local-6989586621687722658"><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722658"><span class="hs-identifier hs-var">errResp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722659"><span class="annot"><span class="annottext">respPayload :: SerializableBlob
</span><a href="#local-6989586621687722659"><span class="hs-identifier hs-var hs-var">respPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPResp a -&gt; SerializableBlob
forall (a :: TriggerTypes). HTTPResp a -&gt; SerializableBlob
</span><a href="Hasura.Eventing.HTTP.html#hrsBody"><span class="hs-identifier hs-var">hrsBody</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722658"><span class="hs-identifier hs-var">errResp</span></a></span><span>
</span><span id="line-535"></span><span>              </span><span id="local-6989586621687722661"><span class="annot"><span class="annottext">respHeaders :: [HeaderConf]
</span><a href="#local-6989586621687722661"><span class="hs-identifier hs-var hs-var">respHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPResp a -&gt; [HeaderConf]
forall (a :: TriggerTypes). HTTPResp a -&gt; [HeaderConf]
</span><a href="Hasura.Eventing.HTTP.html#hrsHeaders"><span class="hs-identifier hs-var">hrsHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722658"><span class="hs-identifier hs-var">errResp</span></a></span><span>
</span><span id="line-536"></span><span>              </span><span id="local-6989586621687722663"><span class="annot"><span class="annottext">respStatus :: Int
</span><a href="#local-6989586621687722663"><span class="hs-identifier hs-var hs-var">respStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPResp a -&gt; Int
forall (a :: TriggerTypes). HTTPResp a -&gt; Int
</span><a href="Hasura.Eventing.HTTP.html#hrsStatus"><span class="hs-identifier hs-var">hrsStatus</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722658"><span class="hs-identifier hs-var">errResp</span></a></span><span>
</span><span id="line-537"></span><span>          </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe Int
-&gt; [HeaderConf]
-&gt; SerializableBlob
-&gt; [HeaderConf]
-&gt; Value
-&gt; Invocation 'ScheduledType
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkInvocation"><span class="hs-identifier hs-var">mkInvocation</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722644"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722663"><span class="hs-identifier hs-var">respStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722646"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableBlob
</span><a href="#local-6989586621687722659"><span class="hs-identifier hs-var">respPayload</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722661"><span class="hs-identifier hs-var">respHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722648"><span class="hs-identifier hs-var">reqJson</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HOther"><span class="hs-identifier hs-type">HOther</span></a></span><span> </span><span id="local-6989586621687722665"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621687722665"><span class="hs-identifier hs-var">detail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722666"><span class="annot"><span class="annottext">errMsg :: SerializableBlob
</span><a href="#local-6989586621687722666"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; SerializableBlob
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html#fromLBS"><span class="hs-identifier hs-var">SB.fromLBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; SerializableBlob) -&gt; ByteString -&gt; SerializableBlob
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html#encode"><span class="hs-identifier hs-var">J.encode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621687722665"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>          </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe Int
-&gt; [HeaderConf]
-&gt; SerializableBlob
-&gt; [HeaderConf]
-&gt; Value
-&gt; Invocation 'ScheduledType
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkInvocation"><span class="hs-identifier hs-var">mkInvocation</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722644"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722646"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableBlob
</span><a href="#local-6989586621687722666"><span class="hs-identifier hs-var">errMsg</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722648"><span class="hs-identifier hs-var">reqJson</span></a></span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#insertScheduledEventInvocation"><span class="hs-identifier hs-var">insertScheduledEventInvocation</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722651"><span class="hs-identifier hs-var">invocation</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722647"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-542"></span><span>  </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; RetryContext
-&gt; HTTPErr a
-&gt; ScheduledEventType
-&gt; ScheduledTriggerMetrics
-&gt; m ()
forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; HTTPErr a
-&gt; ScheduledEventType
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#retryOrMarkError"><span class="hs-identifier hs-var">retryOrMarkError</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722644"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722645"><span class="hs-identifier hs-var">retryCtx</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPErr a
</span><a href="#local-6989586621687722649"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722647"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722650"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span id="local-6989586621687721602"><span id="local-6989586621687721603"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#retryOrMarkError"><span class="hs-identifier hs-type">retryOrMarkError</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721602"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721602"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721602"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#RetryContext"><span class="hs-identifier hs-type">RetryContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-548"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HTTPErr"><span class="hs-identifier hs-type">HTTPErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721603"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-551"></span><span>  </span><span class="annot"><a href="#local-6989586621687721602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-552"></span><span id="retryOrMarkError"><span class="annot"><span class="annottext">retryOrMarkError :: forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadIO m, MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId
-&gt; RetryContext
-&gt; HTTPErr a
-&gt; ScheduledEventType
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#retryOrMarkError"><span class="hs-identifier hs-var hs-var">retryOrMarkError</span></a></span></span><span> </span><span id="local-6989586621687722690"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722690"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722691"><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722691"><span class="hs-identifier hs-var">retryCtx</span></a></span></span><span> </span><span id="local-6989586621687722692"><span class="annot"><span class="annottext">HTTPErr a
</span><a href="#local-6989586621687722692"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621687722693"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722693"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span id="local-6989586621687722694"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722694"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#RetryContext"><span class="hs-identifier hs-type">RetryContext</span></a></span><span> </span><span id="local-6989586621687722695"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722695"><span class="hs-identifier hs-var">tries</span></a></span></span><span> </span><span id="local-6989586621687722696"><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722696"><span class="hs-identifier hs-var">retryConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RetryContext
</span><a href="#local-6989586621687722691"><span class="hs-identifier hs-var">retryCtx</span></a></span><span>
</span><span id="line-554"></span><span>      </span><span id="local-6989586621687722697"><span class="annot"><span class="annottext">mRetryHeader :: Maybe Text
</span><a href="#local-6989586621687722697"><span class="hs-identifier hs-var hs-var">mRetryHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPErr a -&gt; Maybe Text
forall (a :: TriggerTypes). HTTPErr a -&gt; Maybe Text
</span><a href="Hasura.Eventing.HTTP.html#getRetryAfterHeaderFromHTTPErr"><span class="hs-identifier hs-var">getRetryAfterHeaderFromHTTPErr</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPErr a
</span><a href="#local-6989586621687722692"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-555"></span><span>      </span><span id="local-6989586621687722699"><span class="annot"><span class="annottext">mRetryHeaderSeconds :: Maybe Int
</span><a href="#local-6989586621687722699"><span class="hs-identifier hs-var hs-var">mRetryHeaderSeconds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Int
</span><a href="Hasura.Eventing.HTTP.html#parseRetryHeaderValue"><span class="hs-identifier hs-var">parseRetryHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Int) -&gt; Maybe Text -&gt; Maybe Int
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687722697"><span class="hs-identifier hs-var">mRetryHeader</span></a></span><span>
</span><span id="line-556"></span><span>      </span><span id="local-6989586621687722701"><span class="annot"><span class="annottext">triesExhausted :: Bool
</span><a href="#local-6989586621687722701"><span class="hs-identifier hs-var hs-var">triesExhausted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722695"><span class="hs-identifier hs-var">tries</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">STRetryConf -&gt; Int
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#strcNumRetries"><span class="hs-identifier hs-var">strcNumRetries</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722696"><span class="hs-identifier hs-var">retryConf</span></a></span><span>
</span><span id="line-557"></span><span>      </span><span id="local-6989586621687722703"><span class="annot"><span class="annottext">noRetryHeader :: Bool
</span><a href="#local-6989586621687722703"><span class="hs-identifier hs-var hs-var">noRetryHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722699"><span class="hs-identifier hs-var">mRetryHeaderSeconds</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687722701"><span class="hs-identifier hs-var">triesExhausted</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687722703"><span class="hs-identifier hs-var">noRetryHeader</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var">setScheduledEventOp</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722690"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventStatus -&gt; ScheduledEventOp
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpStatus"><span class="hs-identifier hs-var">SEOpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#SESError"><span class="hs-identifier hs-var">SESError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722693"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-561"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722693"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-562"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmCronEventsProcessedTotalFailure"><span class="hs-identifier hs-var">stmCronEventsProcessedTotalFailure</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722694"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmOneOffEventsProcessedTotalFailure"><span class="hs-identifier hs-var">stmOneOffEventsProcessedTotalFailure</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722694"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-565"></span><span>      </span><span id="local-6989586621687722708"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722708"><span class="hs-identifier hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; m UTCTime
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722709"><span class="annot"><span class="annottext">delay :: Int
</span><a href="#local-6989586621687722709"><span class="hs-identifier hs-var hs-var">delay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span>
</span><span id="line-568"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Int
forall b. Integral b =&gt; DiffTime -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; Int) -&gt; DiffTime -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Refined NonNegative DiffTime -&gt; DiffTime
forall {k} (p :: k) x. Refined p x -&gt; x
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/refined-0.8-b40efcc9b0260e802a32460f94ca38ced336d3f5163ccc01fe8e32d7f56bcb6d/share/doc/html/src/Refined.html#unrefine"><span class="hs-identifier hs-var">unrefine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRetryConf -&gt; Refined NonNegative DiffTime
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#strcRetryIntervalSeconds"><span class="hs-identifier hs-var">strcRetryIntervalSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722696"><span class="hs-identifier hs-var">retryConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>              </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722699"><span class="hs-identifier hs-var">mRetryHeaderSeconds</span></a></span><span>
</span><span id="line-571"></span><span>          </span><span id="local-6989586621687722711"><span class="annot"><span class="annottext">diff :: NominalDiffTime
</span><a href="#local-6989586621687722711"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NominalDiffTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722709"><span class="hs-identifier hs-var">delay</span></a></span><span>
</span><span id="line-572"></span><span>          </span><span id="local-6989586621687722712"><span class="annot"><span class="annottext">retryTime :: UTCTime
</span><a href="#local-6989586621687722712"><span class="hs-identifier hs-var hs-var">retryTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; UTCTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">addUTCTime</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621687722711"><span class="hs-identifier hs-var">diff</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722708"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var">setScheduledEventOp</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722690"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; ScheduledEventOp
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpRetry"><span class="hs-identifier hs-var">SEOpRetry</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722712"><span class="hs-identifier hs-var">retryTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722693"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="hs-comment">{- Note [Scheduled event lifecycle]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Scheduled events move between six different states over the course of their
lifetime, as represented by the following flowchart:

    &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;      &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;      &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
    &#9474; scheduled &#9474;&#9472;(1)&#9472;&#8594;&#9474; locked &#9474;&#9472;(2)&#9472;&#8594;&#9474; delivered &#9474;
    &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;      &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;      &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
            &#8593;              &#9474;           &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
            &#9492;&#9472;&#9472;&#9472;&#9472;(3)&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9532;&#9472;&#9472;&#9472;&#9472;&#9472;(4)&#9472;&#9472;&#8594;&#9474; error &#9474;
                           &#9474;           &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
                           &#9474;           &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
                           &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;(5)&#9472;&#9472;&#8594;&#9474; dead &#9474;
                                       &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;

When a scheduled event is first created, it starts in the 'scheduled' state,
and it can transition to other states in the following ways:
  1. When graphql-engine fetches a scheduled event from the database to process
     it, it sets its state to 'locked'. This prevents multiple graphql-engine
     instances running on the same database from processing the same
     scheduled event concurrently.
  2. When a scheduled event is processed successfully, it is marked 'delivered'.
  3. If a scheduled event fails to be processed, but it hasn&#8217;t yet reached
     its maximum retry limit, its retry counter is incremented and
     it is returned to the 'scheduled' state.
  4. If a scheduled event fails to be processed and *has* reached its
     retry limit, its state is set to 'error'.
  5. If for whatever reason the difference between the current time and the
     scheduled time is greater than the tolerance of the scheduled event, it
     will not be processed and its state will be set to 'dead'.
-}</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span id="local-6989586621687721583"><span id="local-6989586621687721584"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processSuccess"><span class="hs-identifier hs-type">processSuccess</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721583"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721583"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721583"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-609"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Headers.html#HeaderConf"><span class="hs-identifier hs-type">HeaderConf</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.HTTP.html#HTTPResp"><span class="hs-identifier hs-type">HTTPResp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721584"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><a href="Hasura.Server.Prometheus.html#ScheduledTriggerMetrics"><span class="hs-identifier hs-type">ScheduledTriggerMetrics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>  </span><span class="annot"><a href="#local-6989586621687721583"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-616"></span><span id="processSuccess"><span class="annot"><span class="annottext">processSuccess :: forall (m :: * -&gt; *) (a :: TriggerTypes).
(MonadMetadataStorage m, MonadError QErr m, MonadIO m) =&gt;
ScheduledEventId
-&gt; [HeaderConf]
-&gt; ScheduledEventType
-&gt; Value
-&gt; HTTPResp a
-&gt; ScheduledTriggerMetrics
-&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processSuccess"><span class="hs-identifier hs-var hs-var">processSuccess</span></a></span></span><span> </span><span id="local-6989586621687722727"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722727"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722728"><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722728"><span class="hs-identifier hs-var">decodedHeaders</span></a></span></span><span> </span><span id="local-6989586621687722729"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722729"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span id="local-6989586621687722730"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722730"><span class="hs-identifier hs-var">reqBodyJson</span></a></span></span><span> </span><span id="local-6989586621687722731"><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722731"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span id="local-6989586621687722732"><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722732"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722733"><span class="annot"><span class="annottext">respBody :: SerializableBlob
</span><a href="#local-6989586621687722733"><span class="hs-identifier hs-var hs-var">respBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPResp a -&gt; SerializableBlob
forall (a :: TriggerTypes). HTTPResp a -&gt; SerializableBlob
</span><a href="Hasura.Eventing.HTTP.html#hrsBody"><span class="hs-identifier hs-var">hrsBody</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722731"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-618"></span><span>      </span><span id="local-6989586621687722734"><span class="annot"><span class="annottext">respHeaders :: [HeaderConf]
</span><a href="#local-6989586621687722734"><span class="hs-identifier hs-var hs-var">respHeaders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPResp a -&gt; [HeaderConf]
forall (a :: TriggerTypes). HTTPResp a -&gt; [HeaderConf]
</span><a href="Hasura.Eventing.HTTP.html#hrsHeaders"><span class="hs-identifier hs-var">hrsHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722731"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-619"></span><span>      </span><span id="local-6989586621687722735"><span class="annot"><span class="annottext">respStatus :: Int
</span><a href="#local-6989586621687722735"><span class="hs-identifier hs-var hs-var">respStatus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HTTPResp a -&gt; Int
forall (a :: TriggerTypes). HTTPResp a -&gt; Int
</span><a href="Hasura.Eventing.HTTP.html#hrsStatus"><span class="hs-identifier hs-var">hrsStatus</span></a></span><span> </span><span class="annot"><span class="annottext">HTTPResp a
</span><a href="#local-6989586621687722731"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-620"></span><span>      </span><span id="local-6989586621687722736"><span class="annot"><span class="annottext">invocation :: Invocation 'ScheduledType
</span><a href="#local-6989586621687722736"><span class="hs-identifier hs-var hs-var">invocation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe Int
-&gt; [HeaderConf]
-&gt; SerializableBlob
-&gt; [HeaderConf]
-&gt; Value
-&gt; Invocation 'ScheduledType
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkInvocation"><span class="hs-identifier hs-var">mkInvocation</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722727"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722735"><span class="hs-identifier hs-var">respStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722728"><span class="hs-identifier hs-var">decodedHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableBlob
</span><a href="#local-6989586621687722733"><span class="hs-identifier hs-var">respBody</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722734"><span class="hs-identifier hs-var">respHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722730"><span class="hs-identifier hs-var">reqBodyJson</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
Invocation 'ScheduledType
-&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#insertScheduledEventInvocation"><span class="hs-identifier hs-var">insertScheduledEventInvocation</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722736"><span class="hs-identifier hs-var">invocation</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722729"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var">setScheduledEventOp</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722727"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventStatus -&gt; ScheduledEventOp
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpStatus"><span class="hs-identifier hs-var">SEOpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#SESDelivered"><span class="hs-identifier hs-var">SESDelivered</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722729"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722729"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmCronEventsProcessedTotalSuccess"><span class="hs-identifier hs-var">stmCronEventsProcessedTotalSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722732"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>    </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Counter -&gt; IO ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/ekg-prometheus-0.3.0.0/opt/doc/html/ekg-prometheus/src/System.Metrics.Prometheus.Counter.html#inc"><span class="hs-identifier hs-var">Prometheus.Counter.inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledTriggerMetrics -&gt; Counter
</span><a href="Hasura.Server.Prometheus.html#stmOneOffEventsProcessedTotalSuccess"><span class="hs-identifier hs-var">stmOneOffEventsProcessedTotalSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledTriggerMetrics
</span><a href="#local-6989586621687722732"><span class="hs-identifier hs-var">scheduledTriggerMetric</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span id="local-6989586621687721552"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#processDead"><span class="hs-identifier hs-type">processDead</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-629"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-630"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-631"></span><span>  </span><span class="annot"><a href="#local-6989586621687721552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-632"></span><span id="processDead"><span class="annot"><span class="annottext">processDead :: forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadError QErr m) =&gt;
ScheduledEventId -&gt; ScheduledEventType -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#processDead"><span class="hs-identifier hs-var hs-var">processDead</span></a></span></span><span> </span><span id="local-6989586621687722744"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722744"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722745"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722745"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-633"></span><span>  </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#setScheduledEventOp"><span class="hs-identifier hs-var">setScheduledEventOp</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722744"><span class="hs-identifier hs-var">eventId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventStatus -&gt; ScheduledEventOp
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpStatus"><span class="hs-identifier hs-var">SEOpStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#SESDead"><span class="hs-identifier hs-var">SESDead</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722745"><span class="hs-identifier hs-var">type'</span></a></span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkInvocation"><span class="hs-identifier hs-type">mkInvocation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-636"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-637"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Headers.html#HeaderConf"><span class="hs-identifier hs-type">HeaderConf</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-639"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html#SerializableBlob"><span class="hs-identifier hs-type">SB.SerializableBlob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Headers.html#HeaderConf"><span class="hs-identifier hs-type">HeaderConf</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-641"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html#Invocation"><span class="hs-identifier hs-type">Invocation</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html#ScheduledType"><span class="hs-identifier hs-type">ScheduledType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span id="mkInvocation"><span class="annot"><span class="annottext">mkInvocation :: ScheduledEventId
-&gt; Maybe Int
-&gt; [HeaderConf]
-&gt; SerializableBlob
-&gt; [HeaderConf]
-&gt; Value
-&gt; Invocation 'ScheduledType
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkInvocation"><span class="hs-identifier hs-var hs-var">mkInvocation</span></a></span></span><span> </span><span id="local-6989586621687722747"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722747"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722748"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722748"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span id="local-6989586621687722749"><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722749"><span class="hs-identifier hs-var">reqHeaders</span></a></span></span><span> </span><span id="local-6989586621687722750"><span class="annot"><span class="annottext">SerializableBlob
</span><a href="#local-6989586621687722750"><span class="hs-identifier hs-var">respBody</span></a></span></span><span> </span><span id="local-6989586621687722751"><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722751"><span class="hs-identifier hs-var">respHeaders</span></a></span></span><span> </span><span id="local-6989586621687722752"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722752"><span class="hs-identifier hs-var">reqBodyJson</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-644"></span><span>  </span><span class="annot"><span class="annottext">ScheduledEventId
-&gt; Maybe Int
-&gt; WebhookRequest
-&gt; Response 'ScheduledType
-&gt; Invocation 'ScheduledType
forall (a :: TriggerTypes).
ScheduledEventId
-&gt; Maybe Int -&gt; WebhookRequest -&gt; Response a -&gt; Invocation a
</span><a href="Hasura.RQL.Types.Eventing.html#Invocation"><span class="hs-identifier hs-var">Invocation</span></a></span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722747"><span class="hs-identifier hs-var">eventId</span></a></span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722748"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; [HeaderConf] -&gt; Text -&gt; WebhookRequest
</span><a href="Hasura.Eventing.HTTP.html#mkWebhookReq"><span class="hs-identifier hs-var">mkWebhookReq</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621687722752"><span class="hs-identifier hs-var">reqBodyJson</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722749"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Hasura.RQL.Types.Eventing.html#invocationVersionST"><span class="hs-identifier hs-var">invocationVersionST</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
-&gt; SerializableBlob -&gt; [HeaderConf] -&gt; Response 'ScheduledType
forall (a :: TriggerTypes).
Maybe Int -&gt; SerializableBlob -&gt; [HeaderConf] -&gt; Response a
</span><a href="Hasura.Eventing.HTTP.html#mkInvocationResp"><span class="hs-identifier hs-var">mkInvocationResp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722748"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">SerializableBlob
</span><a href="#local-6989586621687722750"><span class="hs-identifier hs-var">respBody</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722751"><span class="hs-identifier hs-var">respHeaders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-comment">-- metadata database transactions</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span class="hs-comment">-- | Get cron trigger stats for cron jobs with fewer than 100 future reified</span><span>
</span><span id="line-653"></span><span class="hs-comment">-- events in the database</span><span>
</span><span id="line-654"></span><span class="hs-comment">--</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- The point here is to maintain a certain number of future events so the user</span><span>
</span><span id="line-656"></span><span class="hs-comment">-- can kind of see what's coming up, and obviously to give 'processCronEvents'</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- something to do.</span><span>
</span><span id="line-658"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getDeprivedCronTriggerStatsTx"><span class="hs-identifier hs-type">getDeprivedCronTriggerStatsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#CronTriggerStats"><span class="hs-identifier hs-type">CronTriggerStats</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-659"></span><span id="getDeprivedCronTriggerStatsTx"><span class="annot"><span class="annottext">getDeprivedCronTriggerStatsTx :: [TriggerName] -&gt; TxE QErr [CronTriggerStats]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getDeprivedCronTriggerStatsTx"><span class="hs-identifier hs-var hs-var">getDeprivedCronTriggerStatsTx</span></a></span></span><span> </span><span id="local-6989586621687722757"><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621687722757"><span class="hs-identifier hs-var">cronTriggerNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-660"></span><span>  </span><span class="annot"><span class="annottext">((TriggerName, Int, UTCTime) -&gt; CronTriggerStats)
-&gt; [(TriggerName, Int, UTCTime)] -&gt; [CronTriggerStats]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621687722758"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722758"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722759"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722759"><span class="hs-identifier hs-var">count</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687722760"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722760"><span class="hs-identifier hs-var">maxTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Int -&gt; UTCTime -&gt; CronTriggerStats
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#CronTriggerStats"><span class="hs-identifier hs-var">CronTriggerStats</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722758"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722759"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722760"><span class="hs-identifier hs-var">maxTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="annottext">([(TriggerName, Int, UTCTime)] -&gt; [CronTriggerStats])
-&gt; TxET QErr IO [(TriggerName, Int, UTCTime)]
-&gt; TxE QErr [CronTriggerStats]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; Identity PGTextArray
-&gt; Bool
-&gt; TxET QErr IO [(TriggerName, Int, UTCTime)]
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="">[PG.sql|
      SELECT t.trigger_name, coalesce(q.upcoming_events_count, 0), coalesce(q.max_scheduled_time, now())
      FROM (SELECT UNNEST ($1::text[]) as trigger_name) as t
      LEFT JOIN
      ( SELECT
         trigger_name,
          count(1) as upcoming_events_count,
          max(scheduled_time) as max_scheduled_time
         FROM hdb_catalog.hdb_cron_events
         WHERE tries = 0 and status = 'scheduled'
         GROUP BY trigger_name
      ) AS q
      ON t.trigger_name = q.trigger_name
      WHERE coalesce(q.upcoming_events_count, 0) &lt; 100
     |]</span></span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGTextArray -&gt; Identity PGTextArray
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(PGTextArray -&gt; Identity PGTextArray)
-&gt; PGTextArray -&gt; Identity PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; PGTextArray
</span><a href="Hasura.RQL.Types.Eventing.html#PGTextArray"><span class="hs-identifier hs-var">PGTextArray</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; PGTextArray) -&gt; [Text] -&gt; PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TriggerName -&gt; Text) -&gt; [TriggerName] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621687722757"><span class="hs-identifier hs-var">cronTriggerNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-682"></span><span class="hs-comment">--  - cron events have minute resolution, while one-off events have arbitrary</span><span>
</span><span id="line-683"></span><span class="hs-comment">--    resolution, so it doesn't make sense to fetch them at the same rate</span><span>
</span><span id="line-684"></span><span class="hs-comment">--  - if we decide to fetch cron events less frequently we should wake up that</span><span>
</span><span id="line-685"></span><span class="hs-comment">--    thread at second 0 of every minute, and then pass hasura's now time into</span><span>
</span><span id="line-686"></span><span class="hs-comment">--    the query (since the DB may disagree about the time)</span><span>
</span><span id="line-687"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsForDeliveryTx"><span class="hs-identifier hs-type">getScheduledEventsForDeliveryTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEvent"><span class="hs-identifier hs-type">CronEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffScheduledEvent"><span class="hs-identifier hs-type">OneOffScheduledEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span id="getScheduledEventsForDeliveryTx"><span class="annot"><span class="annottext">getScheduledEventsForDeliveryTx :: [TriggerName] -&gt; TxE QErr ([CronEvent], [OneOffScheduledEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsForDeliveryTx"><span class="hs-identifier hs-var hs-var">getScheduledEventsForDeliveryTx</span></a></span></span><span> </span><span id="local-6989586621687722766"><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621687722766"><span class="hs-identifier hs-var">cronTriggerNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CronEvent]
 -&gt; [OneOffScheduledEvent] -&gt; ([CronEvent], [OneOffScheduledEvent]))
-&gt; TxET QErr IO [CronEvent]
-&gt; TxET
     QErr
     IO
     ([OneOffScheduledEvent] -&gt; ([CronEvent], [OneOffScheduledEvent]))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET QErr IO [CronEvent]
</span><a href="#local-6989586621687722767"><span class="hs-identifier hs-var">getCronEventsForDelivery</span></a></span><span> </span><span class="annot"><span class="annottext">TxET
  QErr
  IO
  ([OneOffScheduledEvent] -&gt; ([CronEvent], [OneOffScheduledEvent]))
-&gt; TxET QErr IO [OneOffScheduledEvent]
-&gt; TxE QErr ([CronEvent], [OneOffScheduledEvent])
forall a b.
TxET QErr IO (a -&gt; b) -&gt; TxET QErr IO a -&gt; TxET QErr IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET QErr IO [OneOffScheduledEvent]
</span><a href="#local-6989586621687722768"><span class="hs-identifier hs-var">getOneOffEventsForDelivery</span></a></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><a href="#local-6989586621687722767"><span class="hs-identifier hs-type">getCronEventsForDelivery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEvent"><span class="hs-identifier hs-type">CronEvent</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-692"></span><span>    </span><span id="local-6989586621687722767"><span class="annot"><span class="annottext">getCronEventsForDelivery :: TxET QErr IO [CronEvent]
</span><a href="#local-6989586621687722767"><span class="hs-identifier hs-var hs-var">getCronEventsForDelivery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-693"></span><span>      </span><span class="annot"><span class="annottext">(Identity (ViaJSON CronEvent) -&gt; CronEvent)
-&gt; [Identity (ViaJSON CronEvent)] -&gt; [CronEvent]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ViaJSON CronEvent -&gt; CronEvent
forall a. ViaJSON a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getViaJSON"><span class="hs-identifier hs-var">PG.getViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ViaJSON CronEvent -&gt; CronEvent)
-&gt; (Identity (ViaJSON CronEvent) -&gt; ViaJSON CronEvent)
-&gt; Identity (ViaJSON CronEvent)
-&gt; CronEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity (ViaJSON CronEvent) -&gt; ViaJSON CronEvent
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>        </span><span class="annot"><span class="annottext">([Identity (ViaJSON CronEvent)] -&gt; [CronEvent])
-&gt; TxET QErr IO [Identity (ViaJSON CronEvent)]
-&gt; TxET QErr IO [CronEvent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; Identity PGTextArray
-&gt; Bool
-&gt; TxET QErr IO [Identity (ViaJSON CronEvent)]
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-695"></span><span>          </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-696"></span><span>          </span><span class="annot"><span class="">[PG.sql|
        WITH cte AS
          ( UPDATE hdb_catalog.hdb_cron_events
            SET status = 'locked'
            WHERE id IN ( SELECT t.id
                          FROM hdb_catalog.hdb_cron_events t
                          WHERE ( t.status = 'scheduled'
                                  and (
                                   (t.next_retry_at is NULL and t.scheduled_time &lt;= now()) or
                                   (t.next_retry_at is not NULL and t.next_retry_at &lt;= now())
                                  )
                                ) AND trigger_name = ANY($1)
                          FOR UPDATE SKIP LOCKED
                          )
            RETURNING *
          )
        SELECT row_to_json(t.*) FROM cte AS t
      |]</span></span><span>
</span><span id="line-714"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGTextArray -&gt; Identity PGTextArray
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(PGTextArray -&gt; Identity PGTextArray)
-&gt; PGTextArray -&gt; Identity PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; PGTextArray
</span><a href="Hasura.RQL.Types.Eventing.html#PGTextArray"><span class="hs-identifier hs-var">PGTextArray</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; PGTextArray) -&gt; [Text] -&gt; PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TriggerName -&gt; Text) -&gt; [TriggerName] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621687722766"><span class="hs-identifier hs-var">cronTriggerNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="#local-6989586621687722768"><span class="hs-identifier hs-type">getOneOffEventsForDelivery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffScheduledEvent"><span class="hs-identifier hs-type">OneOffScheduledEvent</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621687722768"><span class="annot"><span class="annottext">getOneOffEventsForDelivery :: TxET QErr IO [OneOffScheduledEvent]
</span><a href="#local-6989586621687722768"><span class="hs-identifier hs-var hs-var">getOneOffEventsForDelivery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>      </span><span class="annot"><span class="annottext">(Identity (ViaJSON OneOffScheduledEvent) -&gt; OneOffScheduledEvent)
-&gt; [Identity (ViaJSON OneOffScheduledEvent)]
-&gt; [OneOffScheduledEvent]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ViaJSON OneOffScheduledEvent -&gt; OneOffScheduledEvent
forall a. ViaJSON a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getViaJSON"><span class="hs-identifier hs-var">PG.getViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ViaJSON OneOffScheduledEvent -&gt; OneOffScheduledEvent)
-&gt; (Identity (ViaJSON OneOffScheduledEvent)
    -&gt; ViaJSON OneOffScheduledEvent)
-&gt; Identity (ViaJSON OneOffScheduledEvent)
-&gt; OneOffScheduledEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity (ViaJSON OneOffScheduledEvent)
-&gt; ViaJSON OneOffScheduledEvent
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>        </span><span class="annot"><span class="annottext">([Identity (ViaJSON OneOffScheduledEvent)]
 -&gt; [OneOffScheduledEvent])
-&gt; TxET QErr IO [Identity (ViaJSON OneOffScheduledEvent)]
-&gt; TxET QErr IO [OneOffScheduledEvent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; ()
-&gt; Bool
-&gt; TxET QErr IO [Identity (ViaJSON OneOffScheduledEvent)]
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-721"></span><span>          </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-722"></span><span>          </span><span class="annot"><span class="">[PG.sql|
         WITH cte AS (
            UPDATE hdb_catalog.hdb_scheduled_events
            SET status = 'locked'
            WHERE id IN ( SELECT t.id
                          FROM hdb_catalog.hdb_scheduled_events t
                          WHERE ( t.status = 'scheduled'
                                  and (
                                   (t.next_retry_at is NULL and t.scheduled_time &lt;= now()) or
                                   (t.next_retry_at is not NULL and t.next_retry_at &lt;= now())
                                  )
                                )
                          FOR UPDATE SKIP LOCKED
                          )
            RETURNING *
          )
         SELECT row_to_json(t.*) FROM cte AS t
      |]</span></span><span>
</span><span id="line-740"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertInvocationTx"><span class="hs-identifier hs-type">insertInvocationTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html#Invocation"><span class="hs-identifier hs-type">Invocation</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html#ScheduledType"><span class="hs-identifier hs-type">ScheduledType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span id="insertInvocationTx"><span class="annot"><span class="annottext">insertInvocationTx :: Invocation 'ScheduledType -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertInvocationTx"><span class="hs-identifier hs-var hs-var">insertInvocationTx</span></a></span></span><span> </span><span id="local-6989586621687722771"><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span></span><span> </span><span id="local-6989586621687722772"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722772"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722772"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-746"></span><span>    </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-747"></span><span>      </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; (ScheduledEventId, Maybe Int64, ViaJSON Value, ViaJSON Value)
-&gt; Bool
-&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-748"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-749"></span><span>        </span><span class="annot"><span class="">[PG.sql|
         INSERT INTO hdb_catalog.hdb_cron_event_invocation_logs
         (event_id, status, request, response)
         VALUES ($1, $2, $3, $4)
        |]</span></span><span>
</span><span id="line-754"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; ScheduledEventId
forall (a :: TriggerTypes). Invocation a -&gt; ScheduledEventId
</span><a href="Hasura.RQL.Types.Eventing.html#iEventId"><span class="hs-identifier hs-var">iEventId</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-755"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int64) -&gt; Maybe Int -&gt; Maybe Int64
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; Maybe Int
forall (a :: TriggerTypes). Invocation a -&gt; Maybe Int
</span><a href="Hasura.RQL.Types.Eventing.html#iStatus"><span class="hs-identifier hs-var">iStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">,</span><span>
</span><span id="line-756"></span><span>          </span><span class="annot"><span class="annottext">Value -&gt; ViaJSON Value
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ViaJSON Value) -&gt; Value -&gt; ViaJSON Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WebhookRequest -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(WebhookRequest -&gt; Value) -&gt; WebhookRequest -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; WebhookRequest
forall (a :: TriggerTypes). Invocation a -&gt; WebhookRequest
</span><a href="Hasura.RQL.Types.Eventing.html#iRequest"><span class="hs-identifier hs-var">iRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-757"></span><span>          </span><span class="annot"><span class="annottext">Value -&gt; ViaJSON Value
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ViaJSON Value) -&gt; Value -&gt; ViaJSON Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Response 'ScheduledType -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Response 'ScheduledType -&gt; Value)
-&gt; Response 'ScheduledType -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; Response 'ScheduledType
forall (a :: TriggerTypes). Invocation a -&gt; Response a
</span><a href="Hasura.RQL.Types.Eventing.html#iResponse"><span class="hs-identifier hs-var">iResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-760"></span><span>      </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; Identity ScheduledEventId -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-761"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-762"></span><span>        </span><span class="annot"><span class="">[PG.sql|
          UPDATE hdb_catalog.hdb_cron_events
          SET tries = tries + 1
          WHERE id = $1
          |]</span></span><span>
</span><span id="line-767"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Identity ScheduledEventId
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(ScheduledEventId -&gt; Identity ScheduledEventId)
-&gt; ScheduledEventId -&gt; Identity ScheduledEventId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; ScheduledEventId
forall (a :: TriggerTypes). Invocation a -&gt; ScheduledEventId
</span><a href="Hasura.RQL.Types.Eventing.html#iEventId"><span class="hs-identifier hs-var">iEventId</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-770"></span><span>      </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; (ScheduledEventId, Maybe Int64, ViaJSON Value, ViaJSON Value)
-&gt; Bool
-&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-771"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-772"></span><span>        </span><span class="annot"><span class="">[PG.sql|
         INSERT INTO hdb_catalog.hdb_scheduled_event_invocation_logs
         (event_id, status, request, response)
         VALUES ($1, $2, $3, $4)
        |]</span></span><span>
</span><span id="line-777"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; ScheduledEventId
forall (a :: TriggerTypes). Invocation a -&gt; ScheduledEventId
</span><a href="Hasura.RQL.Types.Eventing.html#iEventId"><span class="hs-identifier hs-var">iEventId</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-778"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int64) -&gt; Maybe Int -&gt; Maybe Int64
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; Maybe Int
forall (a :: TriggerTypes). Invocation a -&gt; Maybe Int
</span><a href="Hasura.RQL.Types.Eventing.html#iStatus"><span class="hs-identifier hs-var">iStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">,</span><span>
</span><span id="line-779"></span><span>          </span><span class="annot"><span class="annottext">Value -&gt; ViaJSON Value
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ViaJSON Value) -&gt; Value -&gt; ViaJSON Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WebhookRequest -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(WebhookRequest -&gt; Value) -&gt; WebhookRequest -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; WebhookRequest
forall (a :: TriggerTypes). Invocation a -&gt; WebhookRequest
</span><a href="Hasura.RQL.Types.Eventing.html#iRequest"><span class="hs-identifier hs-var">iRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-780"></span><span>          </span><span class="annot"><span class="annottext">Value -&gt; ViaJSON Value
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ViaJSON Value) -&gt; Value -&gt; ViaJSON Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Response 'ScheduledType -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Response 'ScheduledType -&gt; Value)
-&gt; Response 'ScheduledType -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; Response 'ScheduledType
forall (a :: TriggerTypes). Invocation a -&gt; Response a
</span><a href="Hasura.RQL.Types.Eventing.html#iResponse"><span class="hs-identifier hs-var">iResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span>
</span><span id="line-781"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-783"></span><span>      </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; Identity ScheduledEventId -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-784"></span><span>        </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-785"></span><span>        </span><span class="annot"><span class="">[PG.sql|
          UPDATE hdb_catalog.hdb_scheduled_events
          SET tries = tries + 1
          WHERE id = $1
          |]</span></span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Identity ScheduledEventId
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(ScheduledEventId -&gt; Identity ScheduledEventId)
-&gt; ScheduledEventId -&gt; Identity ScheduledEventId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType -&gt; ScheduledEventId
forall (a :: TriggerTypes). Invocation a -&gt; ScheduledEventId
</span><a href="Hasura.RQL.Types.Eventing.html#iEventId"><span class="hs-identifier hs-var">iEventId</span></a></span><span> </span><span class="annot"><span class="annottext">Invocation 'ScheduledType
</span><a href="#local-6989586621687722771"><span class="hs-identifier hs-var">invo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-791"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-792"></span><span>
</span><span id="line-793"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#setScheduledEventOpTx"><span class="hs-identifier hs-type">setScheduledEventOpTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-794"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#ScheduledEventOp"><span class="hs-identifier hs-type">ScheduledEventOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span id="setScheduledEventOpTx"><span class="annot"><span class="annottext">setScheduledEventOpTx :: ScheduledEventId
-&gt; ScheduledEventOp -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#setScheduledEventOpTx"><span class="hs-identifier hs-var hs-var">setScheduledEventOpTx</span></a></span></span><span> </span><span id="local-6989586621687722779"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722779"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722780"><span class="annot"><span class="annottext">ScheduledEventOp
</span><a href="#local-6989586621687722780"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621687722781"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722781"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventOp
</span><a href="#local-6989586621687722780"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-796"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpRetry"><span class="hs-identifier hs-type">SEOpRetry</span></a></span><span> </span><span id="local-6989586621687722782"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722782"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; TxE QErr ()
</span><a href="#local-6989586621687722783"><span class="hs-identifier hs-var">setRetry</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722782"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-797"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#SEOpStatus"><span class="hs-identifier hs-type">SEOpStatus</span></a></span><span> </span><span id="local-6989586621687722784"><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="#local-6989586621687722784"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus -&gt; TxE QErr ()
</span><a href="#local-6989586621687722785"><span class="hs-identifier hs-var">setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="#local-6989586621687722784"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-799"></span><span>    </span><span id="local-6989586621687722783"><span class="annot"><span class="annottext">setRetry :: UTCTime -&gt; TxE QErr ()
</span><a href="#local-6989586621687722783"><span class="hs-identifier hs-var hs-var">setRetry</span></a></span></span><span> </span><span id="local-6989586621687722786"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722786"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-800"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722781"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-801"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-802"></span><span>          </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; (UTCTime, ScheduledEventId) -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-803"></span><span>            </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-804"></span><span>            </span><span class="annot"><span class="">[PG.sql|
            UPDATE hdb_catalog.hdb_cron_events
            SET next_retry_at = $1,
            STATUS = 'scheduled'
            WHERE id = $2
            |]</span></span><span>
</span><span id="line-810"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722786"><span class="hs-identifier hs-var">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722779"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-812"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-813"></span><span>          </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; (UTCTime, ScheduledEventId) -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-814"></span><span>            </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-815"></span><span>            </span><span class="annot"><span class="">[PG.sql|
            UPDATE hdb_catalog.hdb_scheduled_events
            SET next_retry_at = $1,
            STATUS = 'scheduled'
            WHERE id = $2
            |]</span></span><span>
</span><span id="line-821"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722786"><span class="hs-identifier hs-var">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722779"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-823"></span><span>    </span><span id="local-6989586621687722785"><span class="annot"><span class="annottext">setStatus :: ScheduledEventStatus -&gt; TxE QErr ()
</span><a href="#local-6989586621687722785"><span class="hs-identifier hs-var hs-var">setStatus</span></a></span></span><span> </span><span id="local-6989586621687722787"><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="#local-6989586621687722787"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722781"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-825"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-826"></span><span>          </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; (ScheduledEventId, ScheduledEventStatus)
-&gt; Bool
-&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-827"></span><span>            </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-828"></span><span>            </span><span class="annot"><span class="">[PG.sql|
            UPDATE hdb_catalog.hdb_cron_events
            SET status = $2
            WHERE id = $1
           |]</span></span><span>
</span><span id="line-833"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722779"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="#local-6989586621687722787"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-835"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-836"></span><span>          </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; (ScheduledEventId, ScheduledEventStatus)
-&gt; Bool
-&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-837"></span><span>            </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-838"></span><span>            </span><span class="annot"><span class="">[PG.sql|
            UPDATE hdb_catalog.hdb_scheduled_events
            SET status = $2
            WHERE id = $1
           |]</span></span><span>
</span><span id="line-843"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722779"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus
</span><a href="#local-6989586621687722787"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#unlockScheduledEventsTx"><span class="hs-identifier hs-type">unlockScheduledEventsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-847"></span><span id="unlockScheduledEventsTx"><span class="annot"><span class="annottext">unlockScheduledEventsTx :: ScheduledEventType -&gt; [ScheduledEventId] -&gt; TxE QErr Int
</span><a href="Hasura.Eventing.ScheduledTrigger.html#unlockScheduledEventsTx"><span class="hs-identifier hs-var hs-var">unlockScheduledEventsTx</span></a></span></span><span> </span><span id="local-6989586621687722788"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722788"><span class="hs-identifier hs-var">type'</span></a></span></span><span> </span><span id="local-6989586621687722789"><span class="annot"><span class="annottext">[ScheduledEventId]
</span><a href="#local-6989586621687722789"><span class="hs-identifier hs-var">eventIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-848"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722790"><span class="annot"><span class="annottext">eventIdsTextArray :: [Text]
</span><a href="#local-6989586621687722790"><span class="hs-identifier hs-var hs-var">eventIdsTextArray</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScheduledEventId -&gt; Text) -&gt; [ScheduledEventId] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Text
</span><a href="Hasura.RQL.Types.Eventing.html#unEventId"><span class="hs-identifier hs-var">unEventId</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventId]
</span><a href="#local-6989586621687722789"><span class="hs-identifier hs-var">eventIds</span></a></span><span>
</span><span id="line-849"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722788"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-850"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identity Int -&gt; Int
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Int -&gt; Int)
-&gt; (SingleRow (Identity Int) -&gt; Identity Int)
-&gt; SingleRow (Identity Int)
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity Int) -&gt; Identity Int
forall a. SingleRow a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getRow"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>            </span><span class="annot"><span class="annottext">(SingleRow (Identity Int) -&gt; Int)
-&gt; TxET QErr IO (SingleRow (Identity Int)) -&gt; TxE QErr Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; Identity PGTextArray
-&gt; Bool
-&gt; TxET QErr IO (SingleRow (Identity Int))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-853"></span><span>              </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-854"></span><span>              </span><span class="annot"><span class="">[PG.sql|
        WITH &quot;cte&quot; AS
        (UPDATE hdb_catalog.hdb_cron_events
        SET status = 'scheduled'
        WHERE id = ANY($1::text[]) and status = 'locked'
        RETURNING *)
        SELECT count(*) FROM &quot;cte&quot;
      |]</span></span><span>
</span><span id="line-862"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGTextArray -&gt; Identity PGTextArray
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(PGTextArray -&gt; Identity PGTextArray)
-&gt; PGTextArray -&gt; Identity PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; PGTextArray
</span><a href="Hasura.RQL.Types.Eventing.html#PGTextArray"><span class="hs-identifier hs-var">PGTextArray</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687722790"><span class="hs-identifier hs-var">eventIdsTextArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-864"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-865"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identity Int -&gt; Int
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Int -&gt; Int)
-&gt; (SingleRow (Identity Int) -&gt; Identity Int)
-&gt; SingleRow (Identity Int)
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity Int) -&gt; Identity Int
forall a. SingleRow a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getRow"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>            </span><span class="annot"><span class="annottext">(SingleRow (Identity Int) -&gt; Int)
-&gt; TxET QErr IO (SingleRow (Identity Int)) -&gt; TxE QErr Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; Identity PGTextArray
-&gt; Bool
-&gt; TxET QErr IO (SingleRow (Identity Int))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-867"></span><span>              </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-868"></span><span>              </span><span class="annot"><span class="">[PG.sql|
        WITH &quot;cte&quot; AS
        (UPDATE hdb_catalog.hdb_scheduled_events
        SET status = 'scheduled'
        WHERE id = ANY($1::text[]) AND status = 'locked'
        RETURNING *)
        SELECT count(*) FROM &quot;cte&quot;
      |]</span></span><span>
</span><span id="line-876"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGTextArray -&gt; Identity PGTextArray
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(PGTextArray -&gt; Identity PGTextArray)
-&gt; PGTextArray -&gt; Identity PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; PGTextArray
</span><a href="Hasura.RQL.Types.Eventing.html#PGTextArray"><span class="hs-identifier hs-var">PGTextArray</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621687722790"><span class="hs-identifier hs-var">eventIdsTextArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#unlockAllLockedScheduledEventsTx"><span class="hs-identifier hs-type">unlockAllLockedScheduledEventsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span id="unlockAllLockedScheduledEventsTx"><span class="annot"><span class="annottext">unlockAllLockedScheduledEventsTx :: TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#unlockAllLockedScheduledEventsTx"><span class="hs-identifier hs-var hs-var">unlockAllLockedScheduledEventsTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-881"></span><span>  </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr) -&gt; Query -&gt; () -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-882"></span><span>    </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span class="annot"><span class="">[PG.sql|
          UPDATE hdb_catalog.hdb_cron_events
          SET status = 'scheduled'
          WHERE status = 'locked'
          |]</span></span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-890"></span><span>  </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr) -&gt; Query -&gt; () -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-892"></span><span>    </span><span class="annot"><span class="">[PG.sql|
          UPDATE hdb_catalog.hdb_scheduled_events
          SET status = 'scheduled'
          WHERE status = 'locked'
          |]</span></span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsTx"><span class="hs-identifier hs-type">insertCronEventsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEventSeed"><span class="hs-identifier hs-type">CronEventSeed</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span id="insertCronEventsTx"><span class="annot"><span class="annottext">insertCronEventsTx :: [CronEventSeed] -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertCronEventsTx"><span class="hs-identifier hs-var hs-var">insertCronEventsTx</span></a></span></span><span> </span><span id="local-6989586621687722793"><span class="annot"><span class="annottext">[CronEventSeed]
</span><a href="#local-6989586621687722793"><span class="hs-identifier hs-var">cronSeeds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722794"><span class="annot"><span class="annottext">insertCronEventsSql :: Text
</span><a href="#local-6989586621687722794"><span class="hs-identifier hs-var hs-var">insertCronEventsSql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-903"></span><span>        </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-builder-0.6.7-f4a85772703867a466f6f7a936eb5266f793abadaae26843b4a066520ac361ae/share/doc/html/src/Text.Builder.html#run"><span class="hs-identifier hs-var">TB.run</span></a></span><span>
</span><span id="line-904"></span><span>          </span><span class="annot"><span class="annottext">(Builder -&gt; Text) -&gt; Builder -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLInsert -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span>
</span><span id="line-905"></span><span>            </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLInsert"><span class="hs-identifier hs-type">S.SQLInsert</span></a></span><span>
</span><span id="line-906"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">siTable :: QualifiedTable
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#siTable"><span class="hs-identifier hs-var">siTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#cronEventsTable"><span class="hs-identifier hs-var">cronEventsTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-907"></span><span>                </span><span class="annot"><span class="annottext">siCols :: [PGCol]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#siCols"><span class="hs-identifier hs-var">siCols</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PGCol) -&gt; [Text] -&gt; [PGCol]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PGCol
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#unsafePGCol"><span class="hs-identifier hs-var">unsafePGCol</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;trigger_name&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scheduled_time&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-908"></span><span>                </span><span class="annot"><span class="annottext">siValues :: ValuesExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#siValues"><span class="hs-identifier hs-var">siValues</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TupleExp] -&gt; ValuesExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#ValuesExp"><span class="hs-identifier hs-var">S.ValuesExp</span></a></span><span> </span><span class="annot"><span class="annottext">([TupleExp] -&gt; ValuesExp) -&gt; [TupleExp] -&gt; ValuesExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CronEventSeed -&gt; TupleExp) -&gt; [CronEventSeed] -&gt; [TupleExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; TupleExp
</span><a href="#local-6989586621687722804"><span class="hs-identifier hs-var">toTupleExp</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; TupleExp)
-&gt; (CronEventSeed -&gt; [Text]) -&gt; CronEventSeed -&gt; TupleExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CronEventSeed -&gt; [Text]
</span><a href="#local-6989586621687722805"><span class="hs-identifier hs-var">toArr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CronEventSeed]
</span><a href="#local-6989586621687722793"><span class="hs-identifier hs-var">cronSeeds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-909"></span><span>                </span><span class="annot"><span class="annottext">siConflict :: Maybe SQLConflict
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#siConflict"><span class="hs-identifier hs-var">siConflict</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLConflict -&gt; Maybe SQLConflict
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(SQLConflict -&gt; Maybe SQLConflict)
-&gt; SQLConflict -&gt; Maybe SQLConflict
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe SQLConflictTarget -&gt; SQLConflict
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#DoNothing"><span class="hs-identifier hs-var">S.DoNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SQLConflictTarget
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-910"></span><span>                </span><span class="annot"><span class="annottext">siRet :: Maybe RetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#siRet"><span class="hs-identifier hs-var">siRet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RetExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-911"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-912"></span><span>  </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr) -&gt; Query -&gt; () -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span> </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Query
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#fromText"><span class="hs-identifier hs-var">PG.fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687722794"><span class="hs-identifier hs-var">insertCronEventsSql</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-914"></span><span>    </span><span id="local-6989586621687722805"><span class="annot"><span class="annottext">toArr :: CronEventSeed -&gt; [Text]
</span><a href="#local-6989586621687722805"><span class="hs-identifier hs-var hs-var">toArr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEventSeed"><span class="hs-identifier hs-type">CronEventSeed</span></a></span><span> </span><span id="local-6989586621687722810"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722810"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621687722811"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722811"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722810"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; Text
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#formatTime%27"><span class="hs-identifier hs-var">formatTime'</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722811"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-915"></span><span>    </span><span id="local-6989586621687722804"><span class="annot"><span class="annottext">toTupleExp :: [Text] -&gt; TupleExp
</span><a href="#local-6989586621687722804"><span class="hs-identifier hs-var hs-var">toTupleExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; TupleExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#TupleExp"><span class="hs-identifier hs-var">S.TupleExp</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; TupleExp)
-&gt; ([Text] -&gt; [SQLExp]) -&gt; [Text] -&gt; TupleExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; [Text] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span>
</span><span id="line-916"></span><span>
</span><span id="line-917"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#insertOneOffScheduledEventTx"><span class="hs-identifier hs-type">insertOneOffScheduledEventTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffEvent"><span class="hs-identifier hs-type">OneOffEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html#EventId"><span class="hs-identifier hs-type">EventId</span></a></span><span>
</span><span id="line-918"></span><span id="insertOneOffScheduledEventTx"><span class="annot"><span class="annottext">insertOneOffScheduledEventTx :: OneOffEvent -&gt; TxE QErr ScheduledEventId
</span><a href="Hasura.Eventing.ScheduledTrigger.html#insertOneOffScheduledEventTx"><span class="hs-identifier hs-var hs-var">insertOneOffScheduledEventTx</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CreateScheduledEvent"><span class="hs-identifier hs-type">CreateScheduledEvent</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722817"><span id="local-6989586621687722818"><span id="local-6989586621687722819"><span id="local-6989586621687722820"><span id="local-6989586621687722821"><span id="local-6989586621687722822"><span id="local-6989586621687722823"><span id="local-6989586621687722824"><span class="annot"><span class="annottext">[HeaderConf]
Maybe Text
Maybe Value
Maybe RequestTransform
Maybe MetadataResponseTransform
UTCTime
InputWebhook
STRetryConf
cseWebhook :: InputWebhook
cseScheduleAt :: UTCTime
csePayload :: Maybe Value
cseHeaders :: [HeaderConf]
cseRetryConf :: STRetryConf
cseComment :: Maybe Text
cseRequestTransform :: Maybe RequestTransform
cseResponseTransform :: Maybe MetadataResponseTransform
cseWebhook :: OneOffEvent -&gt; InputWebhook
cseScheduleAt :: OneOffEvent -&gt; UTCTime
csePayload :: OneOffEvent -&gt; Maybe Value
cseHeaders :: OneOffEvent -&gt; [HeaderConf]
cseRetryConf :: OneOffEvent -&gt; STRetryConf
cseComment :: OneOffEvent -&gt; Maybe Text
cseRequestTransform :: OneOffEvent -&gt; Maybe RequestTransform
cseResponseTransform :: OneOffEvent -&gt; Maybe MetadataResponseTransform
</span><a href="#local-6989586621687722817"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-919"></span><span>  </span><span class="annot"><span class="annottext">Identity ScheduledEventId -&gt; ScheduledEventId
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span>
</span><span id="line-920"></span><span>    </span><span class="annot"><span class="annottext">(Identity ScheduledEventId -&gt; ScheduledEventId)
-&gt; (SingleRow (Identity ScheduledEventId)
    -&gt; Identity ScheduledEventId)
-&gt; SingleRow (Identity ScheduledEventId)
-&gt; ScheduledEventId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity ScheduledEventId) -&gt; Identity ScheduledEventId
forall a. SingleRow a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getRow"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span>
</span><span id="line-921"></span><span>    </span><span class="annot"><span class="annottext">(SingleRow (Identity ScheduledEventId) -&gt; ScheduledEventId)
-&gt; TxET QErr IO (SingleRow (Identity ScheduledEventId))
-&gt; TxE QErr ScheduledEventId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; (ViaJSON InputWebhook, UTCTime, ViaJSON (Maybe Value),
    ViaJSON STRetryConf, ViaJSON [HeaderConf], Maybe Text)
-&gt; Bool
-&gt; TxET QErr IO (SingleRow (Identity ScheduledEventId))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span>
</span><span id="line-922"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-923"></span><span>      </span><span class="annot"><span class="">[PG.sql|
    INSERT INTO hdb_catalog.hdb_scheduled_events
    (webhook_conf,scheduled_time,payload,retry_conf,header_conf,comment)
    VALUES
    ($1, $2, $3, $4, $5, $6) RETURNING id
    |]</span></span><span>
</span><span id="line-929"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">InputWebhook -&gt; ViaJSON InputWebhook
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">InputWebhook
</span><a href="#local-6989586621687722817"><span class="hs-identifier hs-var">cseWebhook</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-930"></span><span>        </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621687722818"><span class="hs-identifier hs-var">cseScheduleAt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-931"></span><span>        </span><span class="annot"><span class="annottext">Maybe Value -&gt; ViaJSON (Maybe Value)
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621687722819"><span class="hs-identifier hs-var">csePayload</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-932"></span><span>        </span><span class="annot"><span class="annottext">STRetryConf -&gt; ViaJSON STRetryConf
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">STRetryConf
</span><a href="#local-6989586621687722821"><span class="hs-identifier hs-var">cseRetryConf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-933"></span><span>        </span><span class="annot"><span class="annottext">[HeaderConf] -&gt; ViaJSON [HeaderConf]
forall a. a -&gt; ViaJSON a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-var">PG.ViaJSON</span></a></span><span> </span><span class="annot"><span class="annottext">[HeaderConf]
</span><a href="#local-6989586621687722820"><span class="hs-identifier hs-var">cseHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-934"></span><span>        </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687722822"><span class="hs-identifier hs-var">cseComment</span></a></span><span>
</span><span id="line-935"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#dropFutureCronEventsTx"><span class="hs-identifier hs-type">dropFutureCronEventsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ClearCronEvents"><span class="hs-identifier hs-type">ClearCronEvents</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span id="dropFutureCronEventsTx"><span class="annot"><span class="annottext">dropFutureCronEventsTx :: ClearCronEvents -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#dropFutureCronEventsTx"><span class="hs-identifier hs-var hs-var">dropFutureCronEventsTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-940"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#SingleCronTrigger"><span class="hs-identifier hs-type">SingleCronTrigger</span></a></span><span> </span><span id="local-6989586621687722834"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722834"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-941"></span><span>    </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; Identity TriggerName -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-942"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-943"></span><span>      </span><span class="annot"><span class="">[PG.sql|
     DELETE FROM hdb_catalog.hdb_cron_events
     WHERE trigger_name = $1 AND scheduled_time &gt; now() AND tries = 0
    |]</span></span><span>
</span><span id="line-947"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; Identity TriggerName
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722834"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-949"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#MetadataCronTriggers"><span class="hs-identifier hs-type">MetadataCronTriggers</span></a></span><span> </span><span id="local-6989586621687722836"><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621687722836"><span class="hs-identifier hs-var">triggerNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-950"></span><span>    </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; Identity PGTextArray -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-951"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-952"></span><span>      </span><span class="annot"><span class="">[PG.sql|
     DELETE FROM hdb_catalog.hdb_cron_events
     WHERE scheduled_time &gt; now() AND tries = 0 AND trigger_name = ANY($1::text[])
    |]</span></span><span>
</span><span id="line-956"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGTextArray -&gt; Identity PGTextArray
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">(PGTextArray -&gt; Identity PGTextArray)
-&gt; PGTextArray -&gt; Identity PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; PGTextArray
</span><a href="Hasura.RQL.Types.Eventing.html#PGTextArray"><span class="hs-identifier hs-var">PGTextArray</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; PGTextArray) -&gt; [Text] -&gt; PGTextArray
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TriggerName -&gt; Text) -&gt; [TriggerName] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621687722836"><span class="hs-identifier hs-var">triggerNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#cronEventsTable"><span class="hs-identifier hs-type">cronEventsTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span>
</span><span id="line-960"></span><span id="cronEventsTable"><span class="annot"><span class="annottext">cronEventsTable :: QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#cronEventsTable"><span class="hs-identifier hs-var hs-var">cronEventsTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-961"></span><span>  </span><span class="annot"><span class="annottext">SchemaName -&gt; TableName -&gt; QualifiedTable
forall a. SchemaName -&gt; a -&gt; QualifiedObject a
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedObject"><span class="hs-identifier hs-var">QualifiedObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaName
</span><span class="hs-string">&quot;hdb_catalog&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TableName -&gt; QualifiedTable) -&gt; TableName -&gt; QualifiedTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableName
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#TableName"><span class="hs-identifier hs-var">TableName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hdb_cron_events&quot;</span></span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkScheduledEventStatusFilter"><span class="hs-identifier hs-type">mkScheduledEventStatusFilter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventStatus"><span class="hs-identifier hs-type">ScheduledEventStatus</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span>
</span><span id="line-964"></span><span id="mkScheduledEventStatusFilter"><span class="annot"><span class="annottext">mkScheduledEventStatusFilter :: [ScheduledEventStatus] -&gt; BoolExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkScheduledEventStatusFilter"><span class="hs-identifier hs-var hs-var">mkScheduledEventStatusFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-966"></span><span>  </span><span id="local-6989586621687722840"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621687722840"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-967"></span><span>    </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp] -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BEIN"><span class="hs-identifier hs-var">S.BEIN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;status&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>      </span><span class="annot"><span class="annottext">([SQLExp] -&gt; BoolExp) -&gt; [SQLExp] -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScheduledEventStatus -&gt; SQLExp)
-&gt; [ScheduledEventStatus] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp)
-&gt; (ScheduledEventStatus -&gt; Text) -&gt; ScheduledEventStatus -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventStatus -&gt; Text
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#scheduledEventStatusToText"><span class="hs-identifier hs-var">scheduledEventStatusToText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621687722840"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#scheduledTimeOrderBy"><span class="hs-identifier hs-type">scheduledTimeOrderBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-type">S.OrderByExp</span></a></span><span>
</span><span id="line-971"></span><span id="scheduledTimeOrderBy"><span class="annot"><span class="annottext">scheduledTimeOrderBy :: OrderByExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#scheduledTimeOrderBy"><span class="hs-identifier hs-var hs-var">scheduledTimeOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722846"><span class="annot"><span class="annottext">scheduledTimeCol :: SQLExp
</span><a href="#local-6989586621687722846"><span class="hs-identifier hs-var hs-var">scheduledTimeCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;scheduled_time&quot;</span></span><span>
</span><span id="line-973"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span>
</span><span id="line-974"></span><span>        </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItem -&gt; [OrderByItem] -&gt; NonEmpty OrderByItem)
-&gt; [OrderByItem] -&gt; OrderByItem -&gt; NonEmpty OrderByItem
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">OrderByItem -&gt; [OrderByItem] -&gt; NonEmpty OrderByItem
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">(NE.:|)</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-975"></span><span>        </span><span class="annot"><span class="annottext">(OrderByItem -&gt; NonEmpty OrderByItem)
-&gt; OrderByItem -&gt; NonEmpty OrderByItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span>
</span><span id="line-976"></span><span>          </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621687722846"><span class="hs-identifier hs-var">scheduledTimeCol</span></a></span><span>
</span><span id="line-977"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderType -&gt; Maybe OrderType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTAsc"><span class="hs-identifier hs-var">S.OTAsc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span>          </span><span class="annot"><span class="annottext">Maybe NullsOrder
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span class="hs-comment">-- | Build a select expression which outputs total count and</span><span>
</span><span id="line-981"></span><span class="hs-comment">-- list of json rows with pagination limit and offset applied</span><span>
</span><span id="line-982"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkPaginationSelectExp"><span class="hs-identifier hs-type">mkPaginationSelectExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-983"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-984"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventPagination"><span class="hs-identifier hs-type">ScheduledEventPagination</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-985"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#RowsCountOption"><span class="hs-identifier hs-type">RowsCountOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-986"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-987"></span><span id="mkPaginationSelectExp"><span class="annot"><span class="annottext">mkPaginationSelectExp :: Select -&gt; ScheduledEventPagination -&gt; RowsCountOption -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkPaginationSelectExp"><span class="hs-identifier hs-var hs-var">mkPaginationSelectExp</span></a></span></span><span> </span><span id="local-6989586621687722850"><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722850"><span class="hs-identifier hs-var">allRowsSelect</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventPagination"><span class="hs-identifier hs-type">ScheduledEventPagination</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687722852"><span id="local-6989586621687722853"><span class="annot"><span class="annottext">Maybe Int
_sepLimit :: Maybe Int
_sepOffset :: Maybe Int
_sepLimit :: ScheduledEventPagination -&gt; Maybe Int
_sepOffset :: ScheduledEventPagination -&gt; Maybe Int
</span><a href="#local-6989586621687722852"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621687722856"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722856"><span class="hs-identifier hs-var">shouldIncludeRowsCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-988"></span><span>  </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-989"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selCTEs :: [(TableAlias, InnerCTE)]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selCTEs"><span class="hs-identifier hs-var">S.selCTEs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableAlias
</span><a href="#local-6989586621687722859"><span class="hs-identifier hs-var">countCteAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select -&gt; InnerCTE
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#ICTESelect"><span class="hs-identifier hs-var">S.ICTESelect</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722850"><span class="hs-identifier hs-var">allRowsSelect</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableAlias
</span><a href="#local-6989586621687722861"><span class="hs-identifier hs-var">limitCteAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InnerCTE
</span><a href="#local-6989586621687722862"><span class="hs-identifier hs-var">limitCteSelect</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-990"></span><span>      </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-991"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722856"><span class="hs-identifier hs-var">shouldIncludeRowsCount</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-992"></span><span>          </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#IncludeRowsCount"><span class="hs-identifier hs-var">IncludeRowsCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621687722865"><span class="hs-identifier hs-var">countExtractor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621687722866"><span class="hs-identifier hs-var">rowsExtractor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-993"></span><span>          </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#DontIncludeRowsCount"><span class="hs-identifier hs-var">DontIncludeRowsCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621687722866"><span class="hs-identifier hs-var">rowsExtractor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-994"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-996"></span><span>    </span><span id="local-6989586621687722859"><span class="annot"><span class="annottext">countCteAlias :: TableAlias
</span><a href="#local-6989586621687722859"><span class="hs-identifier hs-var hs-var">countCteAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableAlias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkTableAlias"><span class="hs-identifier hs-var">S.mkTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count_cte&quot;</span></span><span>
</span><span id="line-997"></span><span>    </span><span id="local-6989586621687722861"><span class="annot"><span class="annottext">limitCteAlias :: TableAlias
</span><a href="#local-6989586621687722861"><span class="hs-identifier hs-var hs-var">limitCteAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableAlias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkTableAlias"><span class="hs-identifier hs-var">S.mkTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;limit_cte&quot;</span></span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>    </span><span id="local-6989586621687722865"><span class="annot"><span class="annottext">countExtractor :: Extractor
</span><a href="#local-6989586621687722865"><span class="hs-identifier hs-var hs-var">countExtractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1000"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722871"><span class="annot"><span class="annottext">selectExp :: Select
</span><a href="#local-6989586621687722871"><span class="hs-identifier hs-var hs-var">selectExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1001"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1002"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#countStar"><span class="hs-identifier hs-var">S.countStar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1003"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableIdentifier -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkIdenFromExp"><span class="hs-identifier hs-var">S.mkIdenFromExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableAlias -&gt; TableIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#tableAliasToIdentifier"><span class="hs-identifier hs-var">S.tableAliasToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">TableAlias
</span><a href="#local-6989586621687722859"><span class="hs-identifier hs-var">countCteAlias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1005"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722871"><span class="hs-identifier hs-var">selectExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>    </span><span id="local-6989586621687722862"><span class="annot"><span class="annottext">limitCteSelect :: InnerCTE
</span><a href="#local-6989586621687722862"><span class="hs-identifier hs-var hs-var">limitCteSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1008"></span><span>      </span><span class="annot"><span class="annottext">Select -&gt; InnerCTE
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#ICTESelect"><span class="hs-identifier hs-var">S.ICTESelect</span></a></span><span>
</span><span id="line-1009"></span><span>        </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1010"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1011"></span><span>            </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableIdentifier -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkIdenFromExp"><span class="hs-identifier hs-var">S.mkIdenFromExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableAlias -&gt; TableIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#tableAliasToIdentifier"><span class="hs-identifier hs-var">S.tableAliasToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">TableAlias
</span><a href="#local-6989586621687722859"><span class="hs-identifier hs-var">countCteAlias</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1012"></span><span>            </span><span class="annot"><span class="annottext">selLimit :: Maybe LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selLimit"><span class="hs-identifier hs-var">S.selLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LimitExp"><span class="hs-identifier hs-var">S.LimitExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; LimitExp) -&gt; (Int -&gt; SQLExp) -&gt; Int -&gt; LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LimitExp) -&gt; Maybe Int -&gt; Maybe LimitExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722852"><span class="hs-identifier hs-var">_sepLimit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1013"></span><span>            </span><span class="annot"><span class="annottext">selOffset :: Maybe OffsetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOffset"><span class="hs-identifier hs-var">S.selOffset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; OffsetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OffsetExp"><span class="hs-identifier hs-var">S.OffsetExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; OffsetExp) -&gt; (Int -&gt; SQLExp) -&gt; Int -&gt; OffsetExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; OffsetExp) -&gt; Maybe Int -&gt; Maybe OffsetExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687722853"><span class="hs-identifier hs-var">_sepOffset</span></a></span><span>
</span><span id="line-1014"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span>    </span><span id="local-6989586621687722866"><span class="annot"><span class="annottext">rowsExtractor :: Extractor
</span><a href="#local-6989586621687722866"><span class="hs-identifier hs-var hs-var">rowsExtractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1017"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722886"><span class="annot"><span class="annottext">jsonAgg :: SQLExp
</span><a href="#local-6989586621687722886"><span class="hs-identifier hs-var hs-var">jsonAgg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEUnsafe"><span class="hs-identifier hs-var">S.SEUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json_agg(row_to_json(limit_cte.*))&quot;</span></span><span>
</span><span id="line-1018"></span><span>          </span><span id="local-6989586621687722888"><span class="annot"><span class="annottext">selectExp :: Select
</span><a href="#local-6989586621687722888"><span class="hs-identifier hs-var hs-var">selectExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1019"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1020"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621687722886"><span class="hs-identifier hs-var">jsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1021"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TableIdentifier -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkIdenFromExp"><span class="hs-identifier hs-var">S.mkIdenFromExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableAlias -&gt; TableIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#tableAliasToIdentifier"><span class="hs-identifier hs-var">S.tableAliasToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">TableAlias
</span><a href="#local-6989586621687722861"><span class="hs-identifier hs-var">limitCteAlias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1023"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#handleIfNull"><span class="hs-identifier hs-var">S.handleIfNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722888"><span class="hs-identifier hs-var">selectExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span id="local-6989586621687721667"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#withCount"><span class="hs-identifier hs-type">withCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721667"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-type">WithOptionalTotalCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721667"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1026"></span><span id="withCount"><span class="annot"><span class="annottext">withCount :: forall a. (Int, ViaJSON a) -&gt; WithOptionalTotalCount a
</span><a href="Hasura.Eventing.ScheduledTrigger.html#withCount"><span class="hs-identifier hs-var hs-var">withCount</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687722890"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722890"><span class="hs-identifier hs-var">count</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span id="local-6989586621687722891"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687722891"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; a -&gt; WithOptionalTotalCount a
forall a. Maybe Int -&gt; a -&gt; WithOptionalTotalCount a
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-var">WithOptionalTotalCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621687722890"><span class="hs-identifier hs-var">count</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687722891"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1027"></span><span>
</span><span id="line-1028"></span><span id="local-6989586621687721671"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#withoutCount"><span class="hs-identifier hs-type">withoutCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721671"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-type">WithOptionalTotalCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721671"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1029"></span><span id="withoutCount"><span class="annot"><span class="annottext">withoutCount :: forall a. ViaJSON a -&gt; WithOptionalTotalCount a
</span><a href="Hasura.Eventing.ScheduledTrigger.html#withoutCount"><span class="hs-identifier hs-var hs-var">withoutCount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#ViaJSON"><span class="hs-identifier hs-type">PG.ViaJSON</span></a></span><span> </span><span id="local-6989586621687722894"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687722894"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; a -&gt; WithOptionalTotalCount a
forall a. Maybe Int -&gt; a -&gt; WithOptionalTotalCount a
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-var">WithOptionalTotalCount</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621687722894"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span id="local-6989586621687721673"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#executeWithOptionalTotalCount"><span class="hs-identifier hs-type">executeWithOptionalTotalCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-type">J.FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721673"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#Query"><span class="hs-identifier hs-type">PG.Query</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#RowsCountOption"><span class="hs-identifier hs-type">RowsCountOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-type">WithOptionalTotalCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687721673"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1032"></span><span id="executeWithOptionalTotalCount"><span class="annot"><span class="annottext">executeWithOptionalTotalCount :: forall a.
FromJSON a =&gt;
Query -&gt; RowsCountOption -&gt; TxE QErr (WithOptionalTotalCount a)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#executeWithOptionalTotalCount"><span class="hs-identifier hs-var hs-var">executeWithOptionalTotalCount</span></a></span></span><span> </span><span id="local-6989586621687722908"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621687722908"><span class="hs-identifier hs-var">sql</span></a></span></span><span> </span><span id="local-6989586621687722909"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722909"><span class="hs-identifier hs-var">getRowsCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722909"><span class="hs-identifier hs-var">getRowsCount</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1034"></span><span>    </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#IncludeRowsCount"><span class="hs-identifier hs-var">IncludeRowsCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, ViaJSON a) -&gt; WithOptionalTotalCount a
forall a. (Int, ViaJSON a) -&gt; WithOptionalTotalCount a
</span><a href="Hasura.Eventing.ScheduledTrigger.html#withCount"><span class="hs-identifier hs-var">withCount</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, ViaJSON a) -&gt; WithOptionalTotalCount a)
-&gt; (SingleRow (Int, ViaJSON a) -&gt; (Int, ViaJSON a))
-&gt; SingleRow (Int, ViaJSON a)
-&gt; WithOptionalTotalCount a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Int, ViaJSON a) -&gt; (Int, ViaJSON a)
forall a. SingleRow a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getRow"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SingleRow (Int, ViaJSON a) -&gt; WithOptionalTotalCount a)
-&gt; TxET QErr IO (SingleRow (Int, ViaJSON a))
-&gt; TxE QErr (WithOptionalTotalCount a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; () -&gt; Bool -&gt; TxET QErr IO (SingleRow (Int, ViaJSON a))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span> </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621687722908"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1035"></span><span>    </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#DontIncludeRowsCount"><span class="hs-identifier hs-var">DontIncludeRowsCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ViaJSON a -&gt; WithOptionalTotalCount a
forall a. ViaJSON a -&gt; WithOptionalTotalCount a
</span><a href="Hasura.Eventing.ScheduledTrigger.html#withoutCount"><span class="hs-identifier hs-var">withoutCount</span></a></span><span> </span><span class="annot"><span class="annottext">(ViaJSON a -&gt; WithOptionalTotalCount a)
-&gt; (SingleRow (Identity (ViaJSON a)) -&gt; ViaJSON a)
-&gt; SingleRow (Identity (ViaJSON a))
-&gt; WithOptionalTotalCount a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity (ViaJSON a) -&gt; ViaJSON a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (ViaJSON a) -&gt; ViaJSON a)
-&gt; (SingleRow (Identity (ViaJSON a)) -&gt; Identity (ViaJSON a))
-&gt; SingleRow (Identity (ViaJSON a))
-&gt; ViaJSON a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity (ViaJSON a)) -&gt; Identity (ViaJSON a)
forall a. SingleRow a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html#getRow"><span class="hs-identifier hs-var">PG.getRow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SingleRow (Identity (ViaJSON a)) -&gt; WithOptionalTotalCount a)
-&gt; TxET QErr IO (SingleRow (Identity (ViaJSON a)))
-&gt; TxE QErr (WithOptionalTotalCount a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; ()
-&gt; Bool
-&gt; TxET QErr IO (SingleRow (Identity (ViaJSON a)))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">PG.withQE</span></a></span><span> </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621687722908"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getOneOffScheduledEventsTx"><span class="hs-identifier hs-type">getOneOffScheduledEventsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1038"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventPagination"><span class="hs-identifier hs-type">ScheduledEventPagination</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1039"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventStatus"><span class="hs-identifier hs-type">ScheduledEventStatus</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1040"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#RowsCountOption"><span class="hs-identifier hs-type">RowsCountOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1041"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-type">WithOptionalTotalCount</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOffScheduledEvent"><span class="hs-identifier hs-type">OneOffScheduledEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span id="getOneOffScheduledEventsTx"><span class="annot"><span class="annottext">getOneOffScheduledEventsTx :: ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [OneOffScheduledEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getOneOffScheduledEventsTx"><span class="hs-identifier hs-var hs-var">getOneOffScheduledEventsTx</span></a></span></span><span> </span><span id="local-6989586621687722910"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621687722910"><span class="hs-identifier hs-var">pagination</span></a></span></span><span> </span><span id="local-6989586621687722911"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621687722911"><span class="hs-identifier hs-var">statuses</span></a></span></span><span> </span><span id="local-6989586621687722912"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722912"><span class="hs-identifier hs-var">getRowsCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722915"><span class="annot"><span class="annottext">table :: QualifiedTable
</span><a href="#local-6989586621687722915"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaName -&gt; TableName -&gt; QualifiedTable
forall a. SchemaName -&gt; a -&gt; QualifiedObject a
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedObject"><span class="hs-identifier hs-var">QualifiedObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaName
</span><span class="hs-string">&quot;hdb_catalog&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TableName -&gt; QualifiedTable) -&gt; TableName -&gt; QualifiedTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableName
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#TableName"><span class="hs-identifier hs-var">TableName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hdb_scheduled_events&quot;</span></span><span>
</span><span id="line-1044"></span><span>      </span><span id="local-6989586621687722916"><span class="annot"><span class="annottext">statusFilter :: BoolExp
</span><a href="#local-6989586621687722916"><span class="hs-identifier hs-var hs-var">statusFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus] -&gt; BoolExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkScheduledEventStatusFilter"><span class="hs-identifier hs-var">mkScheduledEventStatusFilter</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621687722911"><span class="hs-identifier hs-var">statuses</span></a></span><span>
</span><span id="line-1045"></span><span>      </span><span id="local-6989586621687722917"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621687722917"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1046"></span><span>        </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1047"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1048"></span><span>            </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSimpleFromExp"><span class="hs-identifier hs-var">S.mkSimpleFromExp</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722915"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1049"></span><span>            </span><span class="annot"><span class="annottext">selWhere :: Maybe WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selWhere"><span class="hs-identifier hs-var">S.selWhere</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereFrag -&gt; Maybe WhereFrag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(WhereFrag -&gt; Maybe WhereFrag) -&gt; WhereFrag -&gt; Maybe WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-var">S.WhereFrag</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687722916"><span class="hs-identifier hs-var">statusFilter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1050"></span><span>            </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">OrderByExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#scheduledTimeOrderBy"><span class="hs-identifier hs-var">scheduledTimeOrderBy</span></a></span><span>
</span><span id="line-1051"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1052"></span><span>      </span><span id="local-6989586621687722922"><span class="annot"><span class="annottext">sql :: Query
</span><a href="#local-6989586621687722922"><span class="hs-identifier hs-var hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#fromBuilder"><span class="hs-identifier hs-var">PG.fromBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query) -&gt; Builder -&gt; Query
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Builder) -&gt; Select -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; ScheduledEventPagination -&gt; RowsCountOption -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkPaginationSelectExp"><span class="hs-identifier hs-var">mkPaginationSelectExp</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722917"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621687722910"><span class="hs-identifier hs-var">pagination</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722912"><span class="hs-identifier hs-var">getRowsCount</span></a></span><span>
</span><span id="line-1053"></span><span>  </span><span class="annot"><span class="annottext">Query
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [OneOffScheduledEvent])
forall a.
FromJSON a =&gt;
Query -&gt; RowsCountOption -&gt; TxE QErr (WithOptionalTotalCount a)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#executeWithOptionalTotalCount"><span class="hs-identifier hs-var">executeWithOptionalTotalCount</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621687722922"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722912"><span class="hs-identifier hs-var">getRowsCount</span></a></span><span>
</span><span id="line-1054"></span><span>
</span><span id="line-1055"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getCronEventsTx"><span class="hs-identifier hs-type">getCronEventsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1056"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1057"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventPagination"><span class="hs-identifier hs-type">ScheduledEventPagination</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventStatus"><span class="hs-identifier hs-type">ScheduledEventStatus</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1059"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#RowsCountOption"><span class="hs-identifier hs-type">RowsCountOption</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1060"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-type">WithOptionalTotalCount</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronEvent"><span class="hs-identifier hs-type">CronEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span id="getCronEventsTx"><span class="annot"><span class="annottext">getCronEventsTx :: TriggerName
-&gt; ScheduledEventPagination
-&gt; [ScheduledEventStatus]
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [CronEvent])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getCronEventsTx"><span class="hs-identifier hs-var hs-var">getCronEventsTx</span></a></span></span><span> </span><span id="local-6989586621687722924"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722924"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span id="local-6989586621687722925"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621687722925"><span class="hs-identifier hs-var">pagination</span></a></span></span><span> </span><span id="local-6989586621687722926"><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621687722926"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span id="local-6989586621687722927"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722927"><span class="hs-identifier hs-var">getRowsCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1062"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722928"><span class="annot"><span class="annottext">triggerNameFilter :: BoolExp
</span><a href="#local-6989586621687722928"><span class="hs-identifier hs-var hs-var">triggerNameFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1063"></span><span>        </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;trigger_name&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722924"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1064"></span><span>      </span><span id="local-6989586621687722931"><span class="annot"><span class="annottext">statusFilter :: BoolExp
</span><a href="#local-6989586621687722931"><span class="hs-identifier hs-var hs-var">statusFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus] -&gt; BoolExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkScheduledEventStatusFilter"><span class="hs-identifier hs-var">mkScheduledEventStatusFilter</span></a></span><span> </span><span class="annot"><span class="annottext">[ScheduledEventStatus]
</span><a href="#local-6989586621687722926"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-1065"></span><span>      </span><span id="local-6989586621687722932"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621687722932"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1066"></span><span>        </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1067"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1068"></span><span>            </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSimpleFromExp"><span class="hs-identifier hs-var">S.mkSimpleFromExp</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#cronEventsTable"><span class="hs-identifier hs-var">cronEventsTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1069"></span><span>            </span><span class="annot"><span class="annottext">selWhere :: Maybe WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selWhere"><span class="hs-identifier hs-var">S.selWhere</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereFrag -&gt; Maybe WhereFrag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(WhereFrag -&gt; Maybe WhereFrag) -&gt; WhereFrag -&gt; Maybe WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-var">S.WhereFrag</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; WhereFrag) -&gt; BoolExp -&gt; WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BinOp -&gt; BoolExp -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BEBin"><span class="hs-identifier hs-var">S.BEBin</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#AndOp"><span class="hs-identifier hs-var">S.AndOp</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687722928"><span class="hs-identifier hs-var">triggerNameFilter</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687722931"><span class="hs-identifier hs-var">statusFilter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1070"></span><span>            </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">OrderByExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#scheduledTimeOrderBy"><span class="hs-identifier hs-var">scheduledTimeOrderBy</span></a></span><span>
</span><span id="line-1071"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1072"></span><span>      </span><span id="local-6989586621687722935"><span class="annot"><span class="annottext">sql :: Query
</span><a href="#local-6989586621687722935"><span class="hs-identifier hs-var hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#fromBuilder"><span class="hs-identifier hs-var">PG.fromBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query) -&gt; Builder -&gt; Query
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Builder) -&gt; Select -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; ScheduledEventPagination -&gt; RowsCountOption -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkPaginationSelectExp"><span class="hs-identifier hs-var">mkPaginationSelectExp</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722932"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621687722925"><span class="hs-identifier hs-var">pagination</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722927"><span class="hs-identifier hs-var">getRowsCount</span></a></span><span>
</span><span id="line-1073"></span><span>  </span><span class="annot"><span class="annottext">Query
-&gt; RowsCountOption -&gt; TxE QErr (WithOptionalTotalCount [CronEvent])
forall a.
FromJSON a =&gt;
Query -&gt; RowsCountOption -&gt; TxE QErr (WithOptionalTotalCount a)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#executeWithOptionalTotalCount"><span class="hs-identifier hs-var">executeWithOptionalTotalCount</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621687722935"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722927"><span class="hs-identifier hs-var">getRowsCount</span></a></span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#deleteScheduledEventTx"><span class="hs-identifier hs-type">deleteScheduledEventTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1076"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventId"><span class="hs-identifier hs-type">ScheduledEventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventType"><span class="hs-identifier hs-type">ScheduledEventType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span id="deleteScheduledEventTx"><span class="annot"><span class="annottext">deleteScheduledEventTx :: ScheduledEventId -&gt; ScheduledEventType -&gt; TxE QErr ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#deleteScheduledEventTx"><span class="hs-identifier hs-var hs-var">deleteScheduledEventTx</span></a></span></span><span> </span><span id="local-6989586621687722936"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722936"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1078"></span><span>  </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1079"></span><span>    </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; Identity ScheduledEventId -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-1080"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1081"></span><span>      </span><span class="annot"><span class="">[PG.sql|
      DELETE FROM hdb_catalog.hdb_scheduled_events
       WHERE id = $1
    |]</span></span><span>
</span><span id="line-1085"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Identity ScheduledEventId
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722936"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1087"></span><span>  </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1088"></span><span>    </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; Identity ScheduledEventId -&gt; Bool -&gt; TxE QErr ()
forall (m :: * -&gt; *) r e.
(MonadIO m, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m ()
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#unitQE"><span class="hs-identifier hs-var">PG.unitQE</span></a></span><span>
</span><span id="line-1089"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">defaultTxErrorHandler</span></a></span><span>
</span><span id="line-1090"></span><span>      </span><span class="annot"><span class="">[PG.sql|
      DELETE FROM hdb_catalog.hdb_cron_events
       WHERE id = $1
    |]</span></span><span>
</span><span id="line-1094"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Identity ScheduledEventId
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722936"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#invocationFieldExtractors"><span class="hs-identifier hs-type">invocationFieldExtractors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1098"></span><span id="invocationFieldExtractors"><span class="annot"><span class="annottext">invocationFieldExtractors :: QualifiedTable -&gt; [Extractor]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#invocationFieldExtractors"><span class="hs-identifier hs-var hs-var">invocationFieldExtractors</span></a></span></span><span> </span><span id="local-6989586621687722937"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722937"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1099"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var">seIden</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-1100"></span><span>    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var">seIden</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_id&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-1101"></span><span>    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var">seIden</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;status&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-1102"></span><span>    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="#local-6989586621687722939"><span class="hs-identifier hs-var">withJsonTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var">seIden</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-1103"></span><span>    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="#local-6989586621687722939"><span class="hs-identifier hs-var">withJsonTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var">seIden</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;response&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-1104"></span><span>    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe ColumnAlias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var">seIden</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;created_at&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ColumnAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1105"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-1106"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1107"></span><span>    </span><span id="local-6989586621687722939"><span class="annot"><span class="annottext">withJsonTypeAnn :: SQLExp -&gt; SQLExp
</span><a href="#local-6989586621687722939"><span class="hs-identifier hs-var hs-var">withJsonTypeAnn</span></a></span></span><span> </span><span id="local-6989586621687722941"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621687722941"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; TypeAnn -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SETyAnn"><span class="hs-identifier hs-var">S.SETyAnn</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621687722941"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeAnn -&gt; SQLExp) -&gt; TypeAnn -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#TypeAnn"><span class="hs-identifier hs-var">S.TypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-1108"></span><span>    </span><span id="local-6989586621687722938"><span class="annot"><span class="annottext">seIden :: Text -&gt; SQLExp
</span><a href="#local-6989586621687722938"><span class="hs-identifier hs-var hs-var">seIden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(QIdentifier -&gt; SQLExp) -&gt; (Text -&gt; QIdentifier) -&gt; Text -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Identifier -&gt; QIdentifier
forall a. IsIdentifier a =&gt; QualifiedTable -&gt; a -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdentifierTable"><span class="hs-identifier hs-var">S.mkQIdentifierTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722937"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; QIdentifier)
-&gt; (Text -&gt; Identifier) -&gt; Text -&gt; QIdentifier
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#mkEventIdBoolExp"><span class="hs-identifier hs-type">mkEventIdBoolExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Eventing.html#EventId"><span class="hs-identifier hs-type">EventId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span>
</span><span id="line-1111"></span><span id="mkEventIdBoolExp"><span class="annot"><span class="annottext">mkEventIdBoolExp :: QualifiedTable -&gt; ScheduledEventId -&gt; BoolExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkEventIdBoolExp"><span class="hs-identifier hs-var hs-var">mkEventIdBoolExp</span></a></span></span><span> </span><span id="local-6989586621687722946"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722946"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621687722947"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722947"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1112"></span><span>  </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(QIdentifier -&gt; SQLExp) -&gt; QIdentifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Identifier -&gt; QIdentifier
forall a. IsIdentifier a =&gt; QualifiedTable -&gt; a -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdentifierTable"><span class="hs-identifier hs-var">S.mkQIdentifierTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722946"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; QIdentifier) -&gt; Identifier -&gt; QIdentifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_id&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId -&gt; Text
</span><a href="Hasura.RQL.Types.Eventing.html#unEventId"><span class="hs-identifier hs-var">unEventId</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722947"><span class="hs-identifier hs-var">eventId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span>
</span><span id="line-1117"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventInvocationsTx"><span class="hs-identifier hs-type">getScheduledEventInvocationsTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1118"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#GetScheduledEventInvocations"><span class="hs-identifier hs-type">GetScheduledEventInvocations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1119"></span><span>  </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">PG.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#WithOptionalTotalCount"><span class="hs-identifier hs-type">WithOptionalTotalCount</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#ScheduledEventInvocation"><span class="hs-identifier hs-type">ScheduledEventInvocation</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span id="getScheduledEventInvocationsTx"><span class="annot"><span class="annottext">getScheduledEventInvocationsTx :: GetScheduledEventInvocations
-&gt; TxE QErr (WithOptionalTotalCount [ScheduledEventInvocation])
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventInvocationsTx"><span class="hs-identifier hs-var hs-var">getScheduledEventInvocationsTx</span></a></span></span><span> </span><span id="local-6989586621687722948"><span class="annot"><span class="annottext">GetScheduledEventInvocations
</span><a href="#local-6989586621687722948"><span class="hs-identifier hs-var">getEventInvocations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1121"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722949"><span class="annot"><span class="annottext">eventsTables :: EventTables
</span><a href="#local-6989586621687722949"><span class="hs-identifier hs-var hs-var">eventsTables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; QualifiedTable -&gt; QualifiedTable -&gt; EventTables
</span><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier hs-var">EventTables</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722951"><span class="hs-identifier hs-var">oneOffInvocationsTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722952"><span class="hs-identifier hs-var">cronInvocationsTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#cronEventsTable"><span class="hs-identifier hs-var">cronEventsTable</span></a></span><span>
</span><span id="line-1122"></span><span>      </span><span id="local-6989586621687722953"><span class="annot"><span class="annottext">sql :: Query
</span><a href="#local-6989586621687722953"><span class="hs-identifier hs-var hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html#fromBuilder"><span class="hs-identifier hs-var">PG.fromBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query) -&gt; Builder -&gt; Query
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Builder) -&gt; Select -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EventTables -&gt; GetScheduledEventInvocations -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQuery"><span class="hs-identifier hs-var">getScheduledEventsInvocationsQuery</span></a></span><span> </span><span class="annot"><span class="annottext">EventTables
</span><a href="#local-6989586621687722949"><span class="hs-identifier hs-var">eventsTables</span></a></span><span> </span><span class="annot"><span class="annottext">GetScheduledEventInvocations
</span><a href="#local-6989586621687722948"><span class="hs-identifier hs-var">getEventInvocations</span></a></span><span>
</span><span id="line-1123"></span><span>  </span><span class="annot"><span class="annottext">Query
-&gt; RowsCountOption
-&gt; TxE QErr (WithOptionalTotalCount [ScheduledEventInvocation])
forall a.
FromJSON a =&gt;
Query -&gt; RowsCountOption -&gt; TxE QErr (WithOptionalTotalCount a)
</span><a href="Hasura.Eventing.ScheduledTrigger.html#executeWithOptionalTotalCount"><span class="hs-identifier hs-var">executeWithOptionalTotalCount</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621687722953"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetScheduledEventInvocations -&gt; RowsCountOption
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#_geiGetRowsCount"><span class="hs-identifier hs-var">_geiGetRowsCount</span></a></span><span> </span><span class="annot"><span class="annottext">GetScheduledEventInvocations
</span><a href="#local-6989586621687722948"><span class="hs-identifier hs-var">getEventInvocations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1125"></span><span>    </span><span id="local-6989586621687722951"><span class="annot"><span class="annottext">oneOffInvocationsTable :: QualifiedTable
</span><a href="#local-6989586621687722951"><span class="hs-identifier hs-var hs-var">oneOffInvocationsTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaName -&gt; TableName -&gt; QualifiedTable
forall a. SchemaName -&gt; a -&gt; QualifiedObject a
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedObject"><span class="hs-identifier hs-var">QualifiedObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaName
</span><span class="hs-string">&quot;hdb_catalog&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TableName -&gt; QualifiedTable) -&gt; TableName -&gt; QualifiedTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableName
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#TableName"><span class="hs-identifier hs-var">TableName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hdb_scheduled_event_invocation_logs&quot;</span></span><span>
</span><span id="line-1126"></span><span>    </span><span id="local-6989586621687722952"><span class="annot"><span class="annottext">cronInvocationsTable :: QualifiedTable
</span><a href="#local-6989586621687722952"><span class="hs-identifier hs-var hs-var">cronInvocationsTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaName -&gt; TableName -&gt; QualifiedTable
forall a. SchemaName -&gt; a -&gt; QualifiedObject a
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedObject"><span class="hs-identifier hs-var">QualifiedObject</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaName
</span><span class="hs-string">&quot;hdb_catalog&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TableName -&gt; QualifiedTable) -&gt; TableName -&gt; QualifiedTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TableName
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#TableName"><span class="hs-identifier hs-var">TableName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hdb_cron_event_invocation_logs&quot;</span></span><span>
</span><span id="line-1127"></span><span>
</span><span id="line-1128"></span><span class="hs-keyword">data</span><span> </span><span id="EventTables"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier hs-var">EventTables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EventTables"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier hs-var">EventTables</span></a></span></span><span>
</span><span id="line-1129"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="etOneOffInvocationsTable"><span class="annot"><span class="annottext">EventTables -&gt; QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#etOneOffInvocationsTable"><span class="hs-identifier hs-var hs-var">etOneOffInvocationsTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1130"></span><span>    </span><span id="etCronInvocationsTable"><span class="annot"><span class="annottext">EventTables -&gt; QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#etCronInvocationsTable"><span class="hs-identifier hs-var hs-var">etCronInvocationsTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1131"></span><span>    </span><span id="etCronEventsTable"><span class="annot"><span class="annottext">EventTables -&gt; QualifiedTable
</span><a href="Hasura.Eventing.ScheduledTrigger.html#etCronEventsTable"><span class="hs-identifier hs-var hs-var">etCronEventsTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span>
</span><span id="line-1132"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQueryNoPagination"><span class="hs-identifier hs-type">getScheduledEventsInvocationsQueryNoPagination</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier hs-type">EventTables</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#GetScheduledEventInvocationsBy"><span class="hs-identifier hs-type">GetScheduledEventInvocationsBy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1135"></span><span id="getScheduledEventsInvocationsQueryNoPagination"><span class="annot"><span class="annottext">getScheduledEventsInvocationsQueryNoPagination :: EventTables -&gt; GetScheduledEventInvocationsBy -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQueryNoPagination"><span class="hs-identifier hs-var hs-var">getScheduledEventsInvocationsQueryNoPagination</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier hs-type">EventTables</span></a></span><span> </span><span id="local-6989586621687722962"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722962"><span class="hs-identifier hs-var">oneOffInvocationsTable</span></a></span></span><span> </span><span id="local-6989586621687722963"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722963"><span class="hs-identifier hs-var">cronInvocationsTable</span></a></span></span><span> </span><span id="local-6989586621687722964"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722964"><span class="hs-identifier hs-var">cronEventsTable'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621687722965"><span class="annot"><span class="annottext">GetScheduledEventInvocationsBy
</span><a href="#local-6989586621687722965"><span class="hs-identifier hs-var">invocationsBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1136"></span><span>  </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722966"><span class="hs-identifier hs-var">allRowsSelect</span></a></span><span>
</span><span id="line-1137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1138"></span><span>    </span><span id="local-6989586621687722969"><span class="annot"><span class="annottext">createdAtOrderBy :: QualifiedTable -&gt; OrderByExp
</span><a href="#local-6989586621687722969"><span class="hs-identifier hs-var hs-var">createdAtOrderBy</span></a></span></span><span> </span><span id="local-6989586621687722970"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722970"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1139"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722971"><span class="annot"><span class="annottext">createdAtCol :: SQLExp
</span><a href="#local-6989586621687722971"><span class="hs-identifier hs-var hs-var">createdAtCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(QIdentifier -&gt; SQLExp) -&gt; QIdentifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Identifier -&gt; QIdentifier
forall a. IsIdentifier a =&gt; QualifiedTable -&gt; a -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdentifierTable"><span class="hs-identifier hs-var">S.mkQIdentifierTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722970"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; QIdentifier) -&gt; Identifier -&gt; QIdentifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;created_at&quot;</span></span><span>
</span><span id="line-1140"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItem -&gt; [OrderByItem] -&gt; NonEmpty OrderByItem)
-&gt; [OrderByItem] -&gt; OrderByItem -&gt; NonEmpty OrderByItem
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">OrderByItem -&gt; [OrderByItem] -&gt; NonEmpty OrderByItem
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">(NE.:|)</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(OrderByItem -&gt; NonEmpty OrderByItem)
-&gt; OrderByItem -&gt; NonEmpty OrderByItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621687722971"><span class="hs-identifier hs-var">createdAtCol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderType -&gt; Maybe OrderType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTDesc"><span class="hs-identifier hs-var">S.OTDesc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe NullsOrder
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span>    </span><span id="local-6989586621687722966"><span class="annot"><span class="annottext">allRowsSelect :: Select
</span><a href="#local-6989586621687722966"><span class="hs-identifier hs-var hs-var">allRowsSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GetScheduledEventInvocationsBy
</span><a href="#local-6989586621687722965"><span class="hs-identifier hs-var">invocationsBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1143"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#GIBEventId"><span class="hs-identifier hs-type">GIBEventId</span></a></span><span> </span><span id="local-6989586621687722974"><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722974"><span class="hs-identifier hs-var">eventId</span></a></span></span><span> </span><span id="local-6989586621687722975"><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722975"><span class="hs-identifier hs-var">eventType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1144"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722976"><span class="annot"><span class="annottext">table :: QualifiedTable
</span><a href="#local-6989586621687722976"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="#local-6989586621687722975"><span class="hs-identifier hs-var">eventType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1145"></span><span>              </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#OneOff"><span class="hs-identifier hs-var">OneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722962"><span class="hs-identifier hs-var">oneOffInvocationsTable</span></a></span><span>
</span><span id="line-1146"></span><span>              </span><span class="annot"><span class="annottext">ScheduledEventType
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#Cron"><span class="hs-identifier hs-var">Cron</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722963"><span class="hs-identifier hs-var">cronInvocationsTable</span></a></span><span>
</span><span id="line-1147"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1148"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; [Extractor]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#invocationFieldExtractors"><span class="hs-identifier hs-var">invocationFieldExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722976"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1149"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSimpleFromExp"><span class="hs-identifier hs-var">S.mkSimpleFromExp</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722976"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1150"></span><span>                </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp -&gt; Maybe OrderByExp) -&gt; OrderByExp -&gt; Maybe OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; OrderByExp
</span><a href="#local-6989586621687722969"><span class="hs-identifier hs-var">createdAtOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722976"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1151"></span><span>                </span><span class="annot"><span class="annottext">selWhere :: Maybe WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selWhere"><span class="hs-identifier hs-var">S.selWhere</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereFrag -&gt; Maybe WhereFrag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(WhereFrag -&gt; Maybe WhereFrag) -&gt; WhereFrag -&gt; Maybe WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-var">S.WhereFrag</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; WhereFrag) -&gt; BoolExp -&gt; WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; ScheduledEventId -&gt; BoolExp
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkEventIdBoolExp"><span class="hs-identifier hs-var">mkEventIdBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722976"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventId
</span><a href="#local-6989586621687722974"><span class="hs-identifier hs-var">eventId</span></a></span><span>
</span><span id="line-1152"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1153"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#GIBEvent"><span class="hs-identifier hs-type">GIBEvent</span></a></span><span> </span><span id="local-6989586621687722978"><span class="annot"><span class="annottext">ScheduledEvent
</span><a href="#local-6989586621687722978"><span class="hs-identifier hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScheduledEvent
</span><a href="#local-6989586621687722978"><span class="hs-identifier hs-var">event</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1154"></span><span>        </span><span class="annot"><span class="annottext">ScheduledEvent
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#SEOneOff"><span class="hs-identifier hs-var">SEOneOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1155"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722980"><span class="annot"><span class="annottext">table :: QualifiedTable
</span><a href="#local-6989586621687722980"><span class="hs-identifier hs-var hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722962"><span class="hs-identifier hs-var">oneOffInvocationsTable</span></a></span><span>
</span><span id="line-1156"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1157"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; [Extractor]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#invocationFieldExtractors"><span class="hs-identifier hs-var">invocationFieldExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722980"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1158"></span><span>                  </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSimpleFromExp"><span class="hs-identifier hs-var">S.mkSimpleFromExp</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722980"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1159"></span><span>                  </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp -&gt; Maybe OrderByExp) -&gt; OrderByExp -&gt; Maybe OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; OrderByExp
</span><a href="#local-6989586621687722969"><span class="hs-identifier hs-var">createdAtOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722980"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1160"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1161"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#SECron"><span class="hs-identifier hs-type">SECron</span></a></span><span> </span><span id="local-6989586621687722982"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722982"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1162"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722983"><span class="annot"><span class="annottext">invocationTable :: QualifiedTable
</span><a href="#local-6989586621687722983"><span class="hs-identifier hs-var hs-var">invocationTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722963"><span class="hs-identifier hs-var">cronInvocationsTable</span></a></span><span>
</span><span id="line-1163"></span><span>              </span><span id="local-6989586621687722984"><span class="annot"><span class="annottext">eventTable :: QualifiedTable
</span><a href="#local-6989586621687722984"><span class="hs-identifier hs-var hs-var">eventTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722964"><span class="hs-identifier hs-var">cronEventsTable'</span></a></span><span>
</span><span id="line-1164"></span><span>              </span><span id="local-6989586621687722985"><span class="annot"><span class="annottext">joinCondition :: JoinCond
</span><a href="#local-6989586621687722985"><span class="hs-identifier hs-var hs-var">joinCondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1165"></span><span>                </span><span class="annot"><span class="annottext">BoolExp -&gt; JoinCond
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#JoinOn"><span class="hs-identifier hs-var">S.JoinOn</span></a></span><span>
</span><span id="line-1166"></span><span>                  </span><span class="annot"><span class="annottext">(BoolExp -&gt; JoinCond) -&gt; BoolExp -&gt; JoinCond
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span>
</span><span id="line-1167"></span><span>                    </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span>
</span><span id="line-1168"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(QIdentifier -&gt; SQLExp) -&gt; QIdentifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Identifier -&gt; QIdentifier
forall a. IsIdentifier a =&gt; QualifiedTable -&gt; a -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdentifierTable"><span class="hs-identifier hs-var">S.mkQIdentifierTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722984"><span class="hs-identifier hs-var">eventTable</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; QIdentifier) -&gt; Identifier -&gt; QIdentifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(QIdentifier -&gt; SQLExp) -&gt; QIdentifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Identifier -&gt; QIdentifier
forall a. IsIdentifier a =&gt; QualifiedTable -&gt; a -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdentifierTable"><span class="hs-identifier hs-var">S.mkQIdentifierTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722983"><span class="hs-identifier hs-var">invocationTable</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; QIdentifier) -&gt; Identifier -&gt; QIdentifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;event_id&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>              </span><span id="local-6989586621687722987"><span class="annot"><span class="annottext">joinTables :: JoinExpr
</span><a href="#local-6989586621687722987"><span class="hs-identifier hs-var hs-var">joinTables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1171"></span><span>                </span><span class="annot"><span class="annottext">FromItem -&gt; JoinType -&gt; FromItem -&gt; JoinCond -&gt; JoinExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#JoinExpr"><span class="hs-identifier hs-var">S.JoinExpr</span></a></span><span>
</span><span id="line-1172"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe TableAlias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722983"><span class="hs-identifier hs-var">invocationTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TableAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span><span>                  </span><span class="annot"><span class="annottext">JoinType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Inner"><span class="hs-identifier hs-var">S.Inner</span></a></span><span>
</span><span id="line-1174"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe TableAlias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722984"><span class="hs-identifier hs-var">eventTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TableAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>                  </span><span class="annot"><span class="annottext">JoinCond
</span><a href="#local-6989586621687722985"><span class="hs-identifier hs-var">joinCondition</span></a></span><span>
</span><span id="line-1176"></span><span>              </span><span id="local-6989586621687722991"><span class="annot"><span class="annottext">triggerBoolExp :: BoolExp
</span><a href="#local-6989586621687722991"><span class="hs-identifier hs-var hs-var">triggerBoolExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1177"></span><span>                </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span>
</span><span id="line-1178"></span><span>                  </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span>
</span><span id="line-1179"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(QIdentifier -&gt; SQLExp) -&gt; QIdentifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Identifier -&gt; QIdentifier
forall a. IsIdentifier a =&gt; QualifiedTable -&gt; a -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdentifierTable"><span class="hs-identifier hs-var">S.mkQIdentifierTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722984"><span class="hs-identifier hs-var">eventTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;trigger_name&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621687722982"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1181"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1182"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; [Extractor]
</span><a href="Hasura.Eventing.ScheduledTrigger.html#invocationFieldExtractors"><span class="hs-identifier hs-var">invocationFieldExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722983"><span class="hs-identifier hs-var">invocationTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1183"></span><span>                  </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">JoinExpr -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIJoin"><span class="hs-identifier hs-var">S.FIJoin</span></a></span><span> </span><span class="annot"><span class="annottext">JoinExpr
</span><a href="#local-6989586621687722987"><span class="hs-identifier hs-var">joinTables</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1184"></span><span>                  </span><span class="annot"><span class="annottext">selWhere :: Maybe WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selWhere"><span class="hs-identifier hs-var">S.selWhere</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereFrag -&gt; Maybe WhereFrag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(WhereFrag -&gt; Maybe WhereFrag) -&gt; WhereFrag -&gt; Maybe WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-var">S.WhereFrag</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687722991"><span class="hs-identifier hs-var">triggerBoolExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1185"></span><span>                  </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp -&gt; Maybe OrderByExp) -&gt; OrderByExp -&gt; Maybe OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; OrderByExp
</span><a href="#local-6989586621687722969"><span class="hs-identifier hs-var">createdAtOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687722983"><span class="hs-identifier hs-var">invocationTable</span></a></span><span>
</span><span id="line-1186"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQuery"><span class="hs-identifier hs-type">getScheduledEventsInvocationsQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#EventTables"><span class="hs-identifier hs-type">EventTables</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#GetScheduledEventInvocations"><span class="hs-identifier hs-type">GetScheduledEventInvocations</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1189"></span><span id="getScheduledEventsInvocationsQuery"><span class="annot"><span class="annottext">getScheduledEventsInvocationsQuery :: EventTables -&gt; GetScheduledEventInvocations -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQuery"><span class="hs-identifier hs-var hs-var">getScheduledEventsInvocationsQuery</span></a></span></span><span> </span><span id="local-6989586621687722994"><span class="annot"><span class="annottext">EventTables
</span><a href="#local-6989586621687722994"><span class="hs-identifier hs-var">eventTables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#GetScheduledEventInvocations"><span class="hs-identifier hs-type">GetScheduledEventInvocations</span></a></span><span> </span><span id="local-6989586621687722996"><span class="annot"><span class="annottext">GetScheduledEventInvocationsBy
</span><a href="#local-6989586621687722996"><span class="hs-identifier hs-var">invocationsBy</span></a></span></span><span> </span><span id="local-6989586621687722997"><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621687722997"><span class="hs-identifier hs-var">pagination</span></a></span></span><span> </span><span id="local-6989586621687722998"><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722998"><span class="hs-identifier hs-var">shouldIncludeRowsCount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1190"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687722999"><span class="annot"><span class="annottext">invocationsSelect :: Select
</span><a href="#local-6989586621687722999"><span class="hs-identifier hs-var hs-var">invocationsSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventTables -&gt; GetScheduledEventInvocationsBy -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#getScheduledEventsInvocationsQueryNoPagination"><span class="hs-identifier hs-var">getScheduledEventsInvocationsQueryNoPagination</span></a></span><span> </span><span class="annot"><span class="annottext">EventTables
</span><a href="#local-6989586621687722994"><span class="hs-identifier hs-var">eventTables</span></a></span><span> </span><span class="annot"><span class="annottext">GetScheduledEventInvocationsBy
</span><a href="#local-6989586621687722996"><span class="hs-identifier hs-var">invocationsBy</span></a></span><span>
</span><span id="line-1191"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; ScheduledEventPagination -&gt; RowsCountOption -&gt; Select
</span><a href="Hasura.Eventing.ScheduledTrigger.html#mkPaginationSelectExp"><span class="hs-identifier hs-var">mkPaginationSelectExp</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621687722999"><span class="hs-identifier hs-var">invocationsSelect</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduledEventPagination
</span><a href="#local-6989586621687722997"><span class="hs-identifier hs-var">pagination</span></a></span><span> </span><span class="annot"><span class="annottext">RowsCountOption
</span><a href="#local-6989586621687722998"><span class="hs-identifier hs-var">shouldIncludeRowsCount</span></a></span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- | Logger to accumulate stats of fetched scheduled events over a period of time and log once using @'L.Logger L.Hasura'.</span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- See @'createStatsLogger' for more details.</span><span>
</span><span id="line-1195"></span><span id="local-6989586621687721691"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-type">createFetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721691"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687721691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-type">FetchedScheduledEventsStatsLogger</span></a></span></span><span>
</span><span id="line-1196"></span><span id="createFetchedScheduledEventsStatsLogger"><span class="annot"><span class="annottext">createFetchedScheduledEventsStatsLogger :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; m FetchedScheduledEventsStatsLogger
</span><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-var hs-var">createFetchedScheduledEventsStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; m FetchedScheduledEventsStatsLogger
forall (m :: * -&gt; *) stats impl.
(MonadIO m, ToEngineLog stats impl, Monoid stats) =&gt;
Logger impl -&gt; m (Trigger stats stats)
</span><a href="Hasura.Logging.html#createStatsLogger"><span class="hs-identifier hs-var">L.createStatsLogger</span></a></span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span class="annot"><span class="hs-comment">-- | Close the fetched scheduled events stats logger.</span></span><span>
</span><span id="line-1199"></span><span id="local-6989586621687721698"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-type">closeFetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1200"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721698"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-type">FetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687721698"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1201"></span><span id="closeFetchedScheduledEventsStatsLogger"><span class="annot"><span class="annottext">closeFetchedScheduledEventsStatsLogger :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; FetchedScheduledEventsStatsLogger -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-var hs-var">closeFetchedScheduledEventsStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EngineLogType Hasura
-&gt; Logger Hasura -&gt; FetchedScheduledEventsStatsLogger -&gt; m ()
forall (m :: * -&gt; *) impl stats.
(MonadIO m, EnabledLogTypes impl) =&gt;
EngineLogType impl -&gt; Logger impl -&gt; Trigger stats stats -&gt; m ()
</span><a href="Hasura.Logging.html#closeStatsLogger"><span class="hs-identifier hs-var">L.closeStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">EngineLogType Hasura
</span><a href="Hasura.Logging.html#scheduledTriggerProcessLogType"><span class="hs-identifier hs-var">L.scheduledTriggerProcessLogType</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span class="annot"><span class="hs-comment">-- | Log statistics of fetched scheduled events. See @'logStats' for more details.</span></span><span>
</span><span id="line-1204"></span><span id="local-6989586621687721520"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#logFetchedScheduledEventsStats"><span class="hs-identifier hs-type">logFetchedScheduledEventsStats</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1205"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721520"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1206"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedScheduledEventsStatsLogger"><span class="hs-identifier hs-type">FetchedScheduledEventsStatsLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1207"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#CronEventsCount"><span class="hs-identifier hs-type">CronEventsCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1208"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#OneOffScheduledEventsCount"><span class="hs-identifier hs-type">OneOffScheduledEventsCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1209"></span><span>  </span><span class="annot"><a href="#local-6989586621687721520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1210"></span><span id="logFetchedScheduledEventsStats"><span class="annot"><span class="annottext">logFetchedScheduledEventsStats :: forall (m :: * -&gt; *).
MonadIO m =&gt;
FetchedScheduledEventsStatsLogger
-&gt; CronEventsCount -&gt; OneOffScheduledEventsCount -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#logFetchedScheduledEventsStats"><span class="hs-identifier hs-var hs-var">logFetchedScheduledEventsStats</span></a></span></span><span> </span><span id="local-6989586621687723015"><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
</span><a href="#local-6989586621687723015"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687723016"><span class="annot"><span class="annottext">CronEventsCount
</span><a href="#local-6989586621687723016"><span class="hs-identifier hs-var">cron</span></a></span></span><span> </span><span id="local-6989586621687723017"><span class="annot"><span class="annottext">OneOffScheduledEventsCount
</span><a href="#local-6989586621687723017"><span class="hs-identifier hs-var">oneOff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1211"></span><span>  </span><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
-&gt; FetchedScheduledEventsStats -&gt; m ()
forall (m :: * -&gt; *) stats.
MonadIO m =&gt;
Trigger stats stats -&gt; stats -&gt; m ()
</span><a href="Hasura.Logging.html#logStats"><span class="hs-identifier hs-var">L.logStats</span></a></span><span> </span><span class="annot"><span class="annottext">FetchedScheduledEventsStatsLogger
</span><a href="#local-6989586621687723015"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronEventsCount
-&gt; OneOffScheduledEventsCount -&gt; Int -&gt; FetchedScheduledEventsStats
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedScheduledEventsStats"><span class="hs-identifier hs-var">FetchedScheduledEventsStats</span></a></span><span> </span><span class="annot"><span class="annottext">CronEventsCount
</span><a href="#local-6989586621687723016"><span class="hs-identifier hs-var">cron</span></a></span><span> </span><span class="annot"><span class="annottext">OneOffScheduledEventsCount
</span><a href="#local-6989586621687723017"><span class="hs-identifier hs-var">oneOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span class="hs-comment">-- | Logger to accumulate stats of fetched cron triggers, for generating cron events, over a period of time and</span><span>
</span><span id="line-1214"></span><span class="hs-comment">-- log once using @'L.Logger L.Hasura'.</span><span>
</span><span id="line-1215"></span><span class="hs-comment">-- See @'createStatsLogger' for more details.</span><span>
</span><span id="line-1216"></span><span id="local-6989586621687721708"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedCronTriggerStatsLogger"><span class="hs-identifier hs-type">createFetchedCronTriggerStatsLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721708"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687721708"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedCronTriggerStatsLogger"><span class="hs-identifier hs-type">FetchedCronTriggerStatsLogger</span></a></span></span><span>
</span><span id="line-1217"></span><span id="createFetchedCronTriggerStatsLogger"><span class="annot"><span class="annottext">createFetchedCronTriggerStatsLogger :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; m FetchedCronTriggerStatsLogger
</span><a href="Hasura.Eventing.ScheduledTrigger.html#createFetchedCronTriggerStatsLogger"><span class="hs-identifier hs-var hs-var">createFetchedCronTriggerStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; m FetchedCronTriggerStatsLogger
forall (m :: * -&gt; *) stats impl.
(MonadIO m, ToEngineLog stats impl, Monoid stats) =&gt;
Logger impl -&gt; m (Trigger stats stats)
</span><a href="Hasura.Logging.html#createStatsLogger"><span class="hs-identifier hs-var">L.createStatsLogger</span></a></span><span>
</span><span id="line-1218"></span><span>
</span><span id="line-1219"></span><span class="annot"><span class="hs-comment">-- | Close the fetched cron trigger stats logger.</span></span><span>
</span><span id="line-1220"></span><span id="local-6989586621687721711"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedCronTriggersStatsLogger"><span class="hs-identifier hs-type">closeFetchedCronTriggersStatsLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1221"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721711"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedCronTriggerStatsLogger"><span class="hs-identifier hs-type">FetchedCronTriggerStatsLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621687721711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1222"></span><span id="closeFetchedCronTriggersStatsLogger"><span class="annot"><span class="annottext">closeFetchedCronTriggersStatsLogger :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura -&gt; FetchedCronTriggerStatsLogger -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#closeFetchedCronTriggersStatsLogger"><span class="hs-identifier hs-var hs-var">closeFetchedCronTriggersStatsLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EngineLogType Hasura
-&gt; Logger Hasura -&gt; FetchedCronTriggerStatsLogger -&gt; m ()
forall (m :: * -&gt; *) impl stats.
(MonadIO m, EnabledLogTypes impl) =&gt;
EngineLogType impl -&gt; Logger impl -&gt; Trigger stats stats -&gt; m ()
</span><a href="Hasura.Logging.html#closeStatsLogger"><span class="hs-identifier hs-var">L.closeStatsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">EngineLogType Hasura
</span><a href="Hasura.Logging.html#cronEventGeneratorProcessType"><span class="hs-identifier hs-var">L.cronEventGeneratorProcessType</span></a></span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="annot"><span class="hs-comment">-- | Log statistics of fetched cron triggers. See @'logStats' for more details.</span></span><span>
</span><span id="line-1225"></span><span id="local-6989586621687721363"><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.html#logFetchedCronTriggersStats"><span class="hs-identifier hs-type">logFetchedCronTriggersStats</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687721363"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1227"></span><span>  </span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedCronTriggerStatsLogger"><span class="hs-identifier hs-type">FetchedCronTriggerStatsLogger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1228"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Eventing.ScheduledTrigger.Types.html#CronTriggerStats"><span class="hs-identifier hs-type">CronTriggerStats</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1229"></span><span>  </span><span class="annot"><a href="#local-6989586621687721363"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1230"></span><span id="logFetchedCronTriggersStats"><span class="annot"><span class="annottext">logFetchedCronTriggersStats :: forall (m :: * -&gt; *).
MonadIO m =&gt;
FetchedCronTriggerStatsLogger -&gt; [CronTriggerStats] -&gt; m ()
</span><a href="Hasura.Eventing.ScheduledTrigger.html#logFetchedCronTriggersStats"><span class="hs-identifier hs-var hs-var">logFetchedCronTriggersStats</span></a></span></span><span> </span><span id="local-6989586621687723032"><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
</span><a href="#local-6989586621687723032"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621687723033"><span class="annot"><span class="annottext">[CronTriggerStats]
</span><a href="#local-6989586621687723033"><span class="hs-identifier hs-var">cronTriggerStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1231"></span><span>  </span><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger -&gt; FetchedCronTriggerStats -&gt; m ()
forall (m :: * -&gt; *) stats.
MonadIO m =&gt;
Trigger stats stats -&gt; stats -&gt; m ()
</span><a href="Hasura.Logging.html#logStats"><span class="hs-identifier hs-var">L.logStats</span></a></span><span> </span><span class="annot"><span class="annottext">FetchedCronTriggerStatsLogger
</span><a href="#local-6989586621687723032"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CronTriggerStats] -&gt; Int -&gt; FetchedCronTriggerStats
</span><a href="Hasura.Eventing.ScheduledTrigger.Types.html#FetchedCronTriggerStats"><span class="hs-identifier hs-var">FetchedCronTriggerStats</span></a></span><span> </span><span class="annot"><span class="annottext">[CronTriggerStats]
</span><a href="#local-6989586621687723033"><span class="hs-identifier hs-var">cronTriggerStats</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span></pre></body></html>