<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | How to construct and execute a call to a remote schema for a remote join.</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- There are three steps required to do this:</span><span>
</span><span id="line-4"></span><span class="hs-comment">--   1. construct the call: given the requested fields, the phantom fields, the</span><span>
</span><span id="line-5"></span><span class="hs-comment">--      values extracted by the LHS, construct a GraphQL query</span><span>
</span><span id="line-6"></span><span class="hs-comment">--   2. execute that GraphQL query over the network</span><span>
</span><span id="line-7"></span><span class="hs-comment">--   3. build a index of the variables out of the response</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- This can be done as one function, but we also export the individual steps for</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- debugging / test purposes. We congregate all intermediary state in the opaque</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- 'RemoteSchemaCall' type.</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Executing a remote join</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#makeRemoteSchemaJoinCall"><span class="hs-identifier">makeRemoteSchemaJoinCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Individual steps</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier">RemoteSchemaCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildRemoteSchemaCall"><span class="hs-identifier">buildRemoteSchemaCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#executeRemoteSchemaCall"><span class="hs-identifier">executeRemoteSchemaCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildJoinIndex"><span class="hs-identifier">buildJoinIndex</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">view</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_3</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier">Data.Aeson.Ordered</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AO</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.HashMap.Strict.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Text.Extended.html#commaSeparated"><span class="hs-identifier">commaSeparated</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier">toTxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator">(&lt;&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Validation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Validation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toEither</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-error-message-1.0.0/opt/doc/html/hasura-error-message/src"><span class="hs-identifier">Hasura.Base.ErrorMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-error-message-1.0.0/opt/doc/html/hasura-error-message/src"><span class="hs-identifier">fromErrorMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Remote.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Remote</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Remote.html#getVariableDefinitionAndValue"><span class="hs-identifier">getVariableDefinitionAndValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Remote.html#resolveRemoteVariable"><span class="hs-identifier">resolveRemoteVariable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Remote.html#runVariableCache"><span class="hs-identifier">runVariableCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html"><span class="hs-identifier">Hasura.GraphQL.Execute.RemoteJoin.Types</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier">Hasura.GraphQL.Parser</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier">GQLReq</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReqOutgoing"><span class="hs-identifier">GQLReqOutgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.RemoteSchema.html"><span class="hs-identifier">Hasura.RQL.IR.RemoteSchema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.RemoteSchema.html#convertSelectionSet"><span class="hs-identifier">convertSelectionSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.ToSchema.html"><span class="hs-identifier">Hasura.RQL.Types.Relationships.ToSchema</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html"><span class="hs-identifier">Hasura.RQL.Types.RemoteSchema</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ResultCustomization.html"><span class="hs-identifier">Hasura.RQL.Types.ResultCustomization</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Session.html"><span class="hs-identifier">Hasura.Session</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.GraphQL.Draft.Syntax</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- Executing a remote join</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | Construct and execute a call to a remote schema for a remote join.</span><span>
</span><span id="line-57"></span><span id="local-6989586621689418450"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#makeRemoteSchemaJoinCall"><span class="hs-identifier hs-type">makeRemoteSchemaJoinCall</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418450"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-comment">-- | Function to send a request over the network.</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReqOutgoing"><span class="hs-identifier hs-type">GQLReqOutgoing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418450"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-comment">-- | User information.</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-comment">-- | Information about that remote join.</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#RemoteSchemaJoin"><span class="hs-identifier hs-type">RemoteSchemaJoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-comment">-- | Mapping from 'JoinArgumentId' to its corresponding 'JoinArgument'.</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#JoinArgument"><span class="hs-identifier hs-type">JoinArgument</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-comment">-- | The resulting join index (see 'buildJoinIndex') if any.</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="#local-6989586621689418450"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Value</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-69"></span><span id="makeRemoteSchemaJoinCall"><span class="annot"><span class="annottext">makeRemoteSchemaJoinCall :: (GQLReqOutgoing -&gt; m ByteString)
-&gt; UserInfo
-&gt; RemoteSchemaJoin
-&gt; IntMap JoinArgument
-&gt; m (Maybe (IntMap Value))
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#makeRemoteSchemaJoinCall"><span class="hs-identifier hs-var hs-var">makeRemoteSchemaJoinCall</span></a></span></span><span> </span><span id="local-6989586621689418449"><span class="annot"><span class="annottext">GQLReqOutgoing -&gt; m ByteString
</span><a href="#local-6989586621689418449"><span class="hs-identifier hs-var">networkFunction</span></a></span></span><span> </span><span id="local-6989586621689418448"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689418448"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span id="local-6989586621689418447"><span class="annot"><span class="annottext">RemoteSchemaJoin
</span><a href="#local-6989586621689418447"><span class="hs-identifier hs-var">remoteSchemaJoin</span></a></span></span><span> </span><span id="local-6989586621689418446"><span class="annot"><span class="annottext">IntMap JoinArgument
</span><a href="#local-6989586621689418446"><span class="hs-identifier hs-var">joinArguments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-comment">-- step 1: construct the internal intermediary representation</span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621689418445"><span class="annot"><span class="annottext">Maybe RemoteSchemaCall
</span><a href="#local-6989586621689418445"><span class="hs-identifier hs-var">maybeRemoteCall</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaJoin
-&gt; IntMap JoinArgument -&gt; UserInfo -&gt; m (Maybe RemoteSchemaCall)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
RemoteSchemaJoin
-&gt; IntMap JoinArgument -&gt; UserInfo -&gt; m (Maybe RemoteSchemaCall)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildRemoteSchemaCall"><span class="hs-identifier hs-var">buildRemoteSchemaCall</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaJoin
</span><a href="#local-6989586621689418447"><span class="hs-identifier hs-var">remoteSchemaJoin</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap JoinArgument
</span><a href="#local-6989586621689418446"><span class="hs-identifier hs-var">joinArguments</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689418448"><span class="hs-identifier hs-var">userInfo</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-comment">-- if there actually is a remote call:</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">Maybe RemoteSchemaCall
-&gt; (RemoteSchemaCall -&gt; m (IntMap Value))
-&gt; m (Maybe (IntMap Value))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">Maybe RemoteSchemaCall
</span><a href="#local-6989586621689418445"><span class="hs-identifier hs-var">maybeRemoteCall</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689418443"><span class="annot"><span class="annottext">RemoteSchemaCall
</span><a href="#local-6989586621689418443"><span class="hs-identifier hs-var">remoteCall</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- step 2: execute it over the network</span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621689418442"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418442"><span class="hs-identifier hs-var">responseValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GQLReqOutgoing -&gt; m ByteString) -&gt; RemoteSchemaCall -&gt; m Object
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
(GQLReqOutgoing -&gt; m ByteString) -&gt; RemoteSchemaCall -&gt; m Object
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#executeRemoteSchemaCall"><span class="hs-identifier hs-var">executeRemoteSchemaCall</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqOutgoing -&gt; m ByteString
</span><a href="#local-6989586621689418449"><span class="hs-identifier hs-var">networkFunction</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaCall
</span><a href="#local-6989586621689418443"><span class="hs-identifier hs-var">remoteCall</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- step 3: build the join index</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">RemoteSchemaCall -&gt; Object -&gt; m (IntMap Value)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
RemoteSchemaCall -&gt; Object -&gt; m (IntMap Value)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildJoinIndex"><span class="hs-identifier hs-var">buildJoinIndex</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaCall
</span><a href="#local-6989586621689418443"><span class="hs-identifier hs-var">remoteCall</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418442"><span class="hs-identifier hs-var">responseValue</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Internal representation</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | Intermediate type containing all of the information required to perform</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- a remote schema call, constructed from the static join information.</span><span>
</span><span id="line-84"></span><span class="hs-keyword">data</span><span> </span><span id="RemoteSchemaCall"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-var">RemoteSchemaCall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RemoteSchemaCall"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-var">RemoteSchemaCall</span></a></span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="rscCustomizer"><span class="annot"><span class="annottext">RemoteSchemaCall -&gt; ResultCustomizer
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#rscCustomizer"><span class="hs-identifier hs-var hs-var">rscCustomizer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ResultCustomization.html#ResultCustomizer"><span class="hs-identifier hs-type">ResultCustomizer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span id="rscGQLRequest"><span class="annot"><span class="annottext">RemoteSchemaCall -&gt; GQLReqOutgoing
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#rscGQLRequest"><span class="hs-identifier hs-var hs-var">rscGQLRequest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReqOutgoing"><span class="hs-identifier hs-type">GQLReqOutgoing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span id="rscResponsePaths"><span class="annot"><span class="annottext">RemoteSchemaCall -&gt; IntMap ResponsePath
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#rscResponsePaths"><span class="hs-identifier hs-var hs-var">rscResponsePaths</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ResponsePath"><span class="hs-identifier hs-type">ResponsePath</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Used to extract the value from a remote schema response.</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- For example: if a remote relationship is defined to retrieve data from some</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- deeply nested field, this is the path towards that deeply nested field.</span><span>
</span><span id="line-94"></span><span class="hs-keyword">newtype</span><span> </span><span id="ResponsePath"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ResponsePath"><span class="hs-identifier hs-var">ResponsePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ResponsePath"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ResponsePath"><span class="hs-identifier hs-var">ResponsePath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621689418433"><span id="local-6989586621689418435"><span class="annot"><span class="annottext">ResponsePath -&gt; ResponsePath -&gt; Bool
(ResponsePath -&gt; ResponsePath -&gt; Bool)
-&gt; (ResponsePath -&gt; ResponsePath -&gt; Bool) -&gt; Eq ResponsePath
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ResponsePath -&gt; ResponsePath -&gt; Bool
$c/= :: ResponsePath -&gt; ResponsePath -&gt; Bool
== :: ResponsePath -&gt; ResponsePath -&gt; Bool
$c== :: ResponsePath -&gt; ResponsePath -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689418426"><span id="local-6989586621689418428"><span id="local-6989586621689418430"><span class="annot"><span class="annottext">Int -&gt; ResponsePath -&gt; ShowS
[ResponsePath] -&gt; ShowS
ResponsePath -&gt; String
(Int -&gt; ResponsePath -&gt; ShowS)
-&gt; (ResponsePath -&gt; String)
-&gt; ([ResponsePath] -&gt; ShowS)
-&gt; Show ResponsePath
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ResponsePath] -&gt; ShowS
$cshowList :: [ResponsePath] -&gt; ShowS
show :: ResponsePath -&gt; String
$cshow :: ResponsePath -&gt; String
showsPrec :: Int -&gt; ResponsePath -&gt; ShowS
$cshowsPrec :: Int -&gt; ResponsePath -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- Step 1: building the remote call</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Constructs a 'RemoteSchemaCall' from some static information, such as the</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- definition of the join, and dynamic information such as the user's</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- information and the map of join arguments.</span><span>
</span><span id="line-103"></span><span id="local-6989586621689418654"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildRemoteSchemaCall"><span class="hs-identifier hs-type">buildRemoteSchemaCall</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418654"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#RemoteSchemaJoin"><span class="hs-identifier hs-type">RemoteSchemaJoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#JoinArgument"><span class="hs-identifier hs-type">JoinArgument</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="Hasura.Session.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="#local-6989586621689418654"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-type">RemoteSchemaCall</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-109"></span><span id="buildRemoteSchemaCall"><span class="annot"><span class="annottext">buildRemoteSchemaCall :: RemoteSchemaJoin
-&gt; IntMap JoinArgument -&gt; UserInfo -&gt; m (Maybe RemoteSchemaCall)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildRemoteSchemaCall"><span class="hs-identifier hs-var hs-var">buildRemoteSchemaCall</span></a></span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#RemoteSchemaJoin"><span class="hs-identifier hs-type">RemoteSchemaJoin</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689418418"><span id="local-6989586621689418419"><span id="local-6989586621689418420"><span id="local-6989586621689418421"><span id="local-6989586621689418422"><span id="local-6989586621689418423"><span class="annot"><span class="annottext">NonEmpty FieldCall
HashMap Name (InputValue RemoteSchemaVariable)
HashMap FieldName JoinColumnAlias
ResultCustomizer
RemoteSchemaInfo
SelectionSet Void RemoteSchemaVariable
_rsjRemoteSchema :: RemoteSchemaJoin -&gt; RemoteSchemaInfo
_rsjFieldCall :: RemoteSchemaJoin -&gt; NonEmpty FieldCall
_rsjJoinColumnAliases :: RemoteSchemaJoin -&gt; HashMap FieldName JoinColumnAlias
_rsjSelSet :: RemoteSchemaJoin -&gt; SelectionSet Void RemoteSchemaVariable
_rsjResultCustomizer :: RemoteSchemaJoin -&gt; ResultCustomizer
_rsjArgs :: RemoteSchemaJoin -&gt; HashMap Name (InputValue RemoteSchemaVariable)
_rsjRemoteSchema :: RemoteSchemaInfo
_rsjFieldCall :: NonEmpty FieldCall
_rsjJoinColumnAliases :: HashMap FieldName JoinColumnAlias
_rsjSelSet :: SelectionSet Void RemoteSchemaVariable
_rsjResultCustomizer :: ResultCustomizer
_rsjArgs :: HashMap Name (InputValue RemoteSchemaVariable)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#_rsjRemoteSchema"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621689418411"><span class="annot"><span class="annottext">IntMap JoinArgument
</span><a href="#local-6989586621689418411"><span class="hs-identifier hs-var">arguments</span></a></span></span><span> </span><span id="local-6989586621689418410"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689418410"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- for each join argument, we generate a unique field, with the alias</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- &quot;f&quot; &lt;&gt; argumentId</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621689418409"><span class="annot"><span class="annottext">IntMap
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
</span><a href="#local-6989586621689418409"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int
  -&gt; JoinArgument
  -&gt; m (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
        ResultCustomizer))
 -&gt; IntMap JoinArgument
 -&gt; m (IntMap
         (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
          ResultCustomizer)))
-&gt; IntMap JoinArgument
-&gt; (Int
    -&gt; JoinArgument
    -&gt; m (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
          ResultCustomizer))
-&gt; m (IntMap
        (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
         ResultCustomizer))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; JoinArgument
 -&gt; m (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
       ResultCustomizer))
-&gt; IntMap JoinArgument
-&gt; m (IntMap
        (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
         ResultCustomizer))
forall (t :: * -&gt; *) a b.
Applicative t =&gt;
(Int -&gt; a -&gt; t b) -&gt; IntMap a -&gt; t (IntMap b)
</span><span class="hs-identifier hs-var">IntMap.traverseWithKey</span></span><span> </span><span class="annot"><span class="annottext">IntMap JoinArgument
</span><a href="#local-6989586621689418411"><span class="hs-identifier hs-var">arguments</span></a></span><span> </span><span class="annot"><span class="annottext">((Int
  -&gt; JoinArgument
  -&gt; m (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
        ResultCustomizer))
 -&gt; m (IntMap
         (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
          ResultCustomizer)))
-&gt; (Int
    -&gt; JoinArgument
    -&gt; m (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
          ResultCustomizer))
-&gt; m (IntMap
        (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
         ResultCustomizer))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689418406"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689418406"><span class="hs-identifier hs-var">argumentId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.Types.html#JoinArgument"><span class="hs-identifier hs-type">JoinArgument</span></a></span><span> </span><span id="local-6989586621689418404"><span class="annot"><span class="annottext">HashMap FieldName Value
</span><a href="#local-6989586621689418404"><span class="hs-identifier hs-var">argument</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621689418403"><span class="annot"><span class="annottext">HashMap Name (Value Void)
</span><a href="#local-6989586621689418403"><span class="hs-identifier hs-var">graphqlArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([(Name, Value Void)] -&gt; HashMap Name (Value Void))
-&gt; m [(Name, Value Void)] -&gt; m (HashMap Name (Value Void))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Value Void)] -&gt; HashMap Name (Value Void)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">(m [(Name, Value Void)] -&gt; m (HashMap Name (Value Void)))
-&gt; m [(Name, Value Void)] -&gt; m (HashMap Name (Value Void))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">[(FieldName, Value)]
-&gt; ((FieldName, Value) -&gt; m (Name, Value Void))
-&gt; m [(Name, Value Void)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap FieldName Value -&gt; [(FieldName, Value)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName Value
</span><a href="#local-6989586621689418404"><span class="hs-identifier hs-var">argument</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621689418399"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418399"><span class="hs-identifier hs-var">columnName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689418398"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418398"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>        </span><span id="local-6989586621689418397"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418397"><span class="hs-identifier hs-var">graphQLName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Name
forall (m :: * -&gt; *). MonadError QErr m =&gt; Text -&gt; m Name
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#parseGraphQLName"><span class="hs-identifier hs-var">parseGraphQLName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418399"><span class="hs-identifier hs-var">columnName</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span id="local-6989586621689418395"><span class="annot"><span class="annottext">Value Void
</span><a href="#local-6989586621689418395"><span class="hs-identifier hs-var">graphQLValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; m (Value Void)
forall (n :: * -&gt; *). MonadError QErr n =&gt; Value -&gt; n (Value Void)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ordJSONValueToGValue"><span class="hs-identifier hs-var">ordJSONValueToGValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418398"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><span class="annottext">(Name, Value Void) -&gt; m (Name, Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418397"><span class="hs-identifier hs-var">graphQLName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value Void
</span><a href="#local-6989586621689418395"><span class="hs-identifier hs-var">graphQLValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Creating the alias should never fail.</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689418393"><span class="annot"><span class="annottext">aliasText :: Text
</span><a href="#local-6989586621689418393"><span class="hs-identifier hs-var hs-var">aliasText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689418406"><span class="hs-identifier hs-var">argumentId</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621689418390"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418390"><span class="hs-identifier hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Maybe Name
</span><span class="hs-identifier hs-var">G.mkName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418393"><span class="hs-identifier hs-var">aliasText</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">Maybe Name -&gt; m Name -&gt; m Name
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Name
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418393"><span class="hs-identifier hs-var">aliasText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' is not a valid GraphQL name!&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689418386"><span class="annot"><span class="annottext">responsePath :: NonEmpty Name
</span><a href="#local-6989586621689418386"><span class="hs-identifier hs-var hs-var">responsePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418390"><span class="hs-identifier hs-var">alias</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; NonEmpty Name
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">(FieldCall -&gt; Name) -&gt; [FieldCall] -&gt; [Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FieldCall -&gt; Name
</span><a href="Hasura.RQL.Types.Relationships.ToSchema.html#fcName"><span class="hs-identifier hs-var hs-var">fcName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty FieldCall -&gt; [FieldCall]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.tail</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall
</span><a href="#local-6989586621689418419"><span class="hs-identifier hs-var">_rsjFieldCall</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621689418382"><span class="annot"><span class="annottext">rootField :: Name
</span><a href="#local-6989586621689418382"><span class="hs-identifier hs-var hs-var">rootField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldCall -&gt; Name
</span><a href="Hasura.RQL.Types.Relationships.ToSchema.html#fcName"><span class="hs-identifier hs-var hs-var">fcName</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldCall -&gt; Name) -&gt; FieldCall -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall -&gt; FieldCall
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">NE.head</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall
</span><a href="#local-6989586621689418419"><span class="hs-identifier hs-var">_rsjFieldCall</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621689418380"><span class="annot"><span class="annottext">resultCustomizer :: ResultCustomizer
</span><a href="#local-6989586621689418380"><span class="hs-identifier hs-var hs-var">resultCustomizer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AliasMapping -&gt; ResultCustomizer -&gt; ResultCustomizer
</span><a href="Hasura.RQL.Types.ResultCustomization.html#applyAliasMapping"><span class="hs-identifier hs-var">applyAliasMapping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; AliasMapping
</span><a href="Hasura.RQL.Types.ResultCustomization.html#singletonAliasMapping"><span class="hs-identifier hs-var">singletonAliasMapping</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418382"><span class="hs-identifier hs-var">rootField</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418390"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResultCustomizer
</span><a href="#local-6989586621689418422"><span class="hs-identifier hs-var">_rsjResultCustomizer</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621689418377"><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418377"><span class="hs-identifier hs-var">gqlField</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap Name (InputValue RemoteSchemaVariable)
-&gt; HashMap Name (Value Void)
-&gt; SelectionSet NoFragments RemoteSchemaVariable
-&gt; Name
-&gt; NonEmpty FieldCall
-&gt; m (Field NoFragments RemoteSchemaVariable)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
HashMap Name (InputValue RemoteSchemaVariable)
-&gt; HashMap Name (Value Void)
-&gt; SelectionSet NoFragments RemoteSchemaVariable
-&gt; Name
-&gt; NonEmpty FieldCall
-&gt; m (Field NoFragments RemoteSchemaVariable)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#fieldCallsToField"><span class="hs-identifier hs-var">fieldCallsToField</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (InputValue RemoteSchemaVariable)
</span><a href="#local-6989586621689418423"><span class="hs-identifier hs-var">_rsjArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Void)
</span><a href="#local-6989586621689418403"><span class="hs-identifier hs-var">graphqlArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectionSet Void RemoteSchemaVariable
-&gt; SelectionSet NoFragments RemoteSchemaVariable
forall var.
Eq var =&gt;
SelectionSet Void var -&gt; SelectionSet NoFragments var
</span><a href="Hasura.RQL.IR.RemoteSchema.html#convertSelectionSet"><span class="hs-identifier hs-var">convertSelectionSet</span></a></span><span> </span><span class="annot"><span class="annottext">SelectionSet Void RemoteSchemaVariable
</span><a href="#local-6989586621689418421"><span class="hs-identifier hs-var">_rsjSelSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418390"><span class="hs-identifier hs-var">alias</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall
</span><a href="#local-6989586621689418419"><span class="hs-identifier hs-var">_rsjFieldCall</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">(Field NoFragments RemoteSchemaVariable, NonEmpty Name,
 ResultCustomizer)
-&gt; m (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
      ResultCustomizer)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418377"><span class="hs-identifier hs-var">gqlField</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621689418386"><span class="hs-identifier hs-var">responsePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResultCustomizer
</span><a href="#local-6989586621689418380"><span class="hs-identifier hs-var">resultCustomizer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-comment">-- this constructs the actual GraphQL Request that can be sent to the remote</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">Maybe
  (NonEmpty
     (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
      ResultCustomizer))
-&gt; (NonEmpty
      (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
       ResultCustomizer)
    -&gt; m RemoteSchemaCall)
-&gt; m (Maybe RemoteSchemaCall)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Field NoFragments RemoteSchemaVariable, NonEmpty Name,
  ResultCustomizer)]
-&gt; Maybe
     (NonEmpty
        (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
         ResultCustomizer))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">NE.nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">([(Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)]
 -&gt; Maybe
      (NonEmpty
         (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
          ResultCustomizer)))
-&gt; [(Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)]
-&gt; Maybe
     (NonEmpty
        (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
         ResultCustomizer))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
-&gt; [(Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">IntMap.elems</span></span><span> </span><span class="annot"><span class="annottext">IntMap
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
</span><a href="#local-6989586621689418409"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((NonEmpty
    (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)
  -&gt; m RemoteSchemaCall)
 -&gt; m (Maybe RemoteSchemaCall))
-&gt; (NonEmpty
      (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
       ResultCustomizer)
    -&gt; m RemoteSchemaCall)
-&gt; m (Maybe RemoteSchemaCall)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621689418373"><span class="annot"><span class="annottext">NonEmpty
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
</span><a href="#local-6989586621689418373"><span class="hs-identifier hs-var">neFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621689418372"><span class="annot"><span class="annottext">GQLReqOutgoing
</span><a href="#local-6989586621689418372"><span class="hs-identifier hs-var">gqlRequest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><span class="annottext">(NonEmpty (Field NoFragments Variable) -&gt; GQLReqOutgoing)
-&gt; m (NonEmpty (Field NoFragments Variable)) -&gt; m GQLReqOutgoing
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Field NoFragments Variable) -&gt; GQLReqOutgoing
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#fieldsToRequest"><span class="hs-identifier hs-var">fieldsToRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(m (NonEmpty (Field NoFragments Variable)) -&gt; m GQLReqOutgoing)
-&gt; (((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
      ResultCustomizer)
     -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
    -&gt; m (NonEmpty (Field NoFragments Variable)))
-&gt; ((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)
    -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
-&gt; m GQLReqOutgoing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StateT
  RemoteJSONVariableMap m (NonEmpty (Field NoFragments Variable))
-&gt; m (NonEmpty (Field NoFragments Variable))
forall (m :: * -&gt; *) a.
Monad m =&gt;
StateT RemoteJSONVariableMap m a -&gt; m a
</span><a href="Hasura.GraphQL.Execute.Remote.html#runVariableCache"><span class="hs-identifier hs-var">runVariableCache</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   RemoteJSONVariableMap m (NonEmpty (Field NoFragments Variable))
 -&gt; m (NonEmpty (Field NoFragments Variable)))
-&gt; (((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
      ResultCustomizer)
     -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
    -&gt; StateT
         RemoteJSONVariableMap m (NonEmpty (Field NoFragments Variable)))
-&gt; ((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)
    -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
-&gt; m (NonEmpty (Field NoFragments Variable))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
-&gt; ((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)
    -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
-&gt; StateT
     RemoteJSONVariableMap m (NonEmpty (Field NoFragments Variable))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
</span><a href="#local-6989586621689418373"><span class="hs-identifier hs-var">neFields</span></a></span><span> </span><span class="annot"><span class="annottext">(((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
  -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
 -&gt; m GQLReqOutgoing)
-&gt; ((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)
    -&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable))
-&gt; m GQLReqOutgoing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621689418369"><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418369"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResultCustomizer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaVariable -&gt; StateT RemoteJSONVariableMap m Variable)
-&gt; Field NoFragments RemoteSchemaVariable
-&gt; StateT RemoteJSONVariableMap m (Field NoFragments Variable)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserInfo
-&gt; RemoteSchemaVariable -&gt; StateT RemoteJSONVariableMap m Variable
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
UserInfo
-&gt; RemoteSchemaVariable -&gt; StateT RemoteJSONVariableMap m Variable
</span><a href="Hasura.GraphQL.Execute.Remote.html#resolveRemoteVariable"><span class="hs-identifier hs-var">resolveRemoteVariable</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621689418410"><span class="hs-identifier hs-var">userInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418369"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689418367"><span class="annot"><span class="annottext">customizer :: ResultCustomizer
</span><a href="#local-6989586621689418367"><span class="hs-identifier hs-var hs-var">customizer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
  ResultCustomizer)
 -&gt; ResultCustomizer)
-&gt; IntMap
     (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
      ResultCustomizer)
-&gt; ResultCustomizer
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  ResultCustomizer
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
  ResultCustomizer
-&gt; (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
    ResultCustomizer)
-&gt; ResultCustomizer
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  ResultCustomizer
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
  ResultCustomizer
forall s t a b. Field3 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
</span><a href="#local-6989586621689418409"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span id="local-6989586621689418365"><span class="annot"><span class="annottext">responsePath :: IntMap ResponsePath
</span><a href="#local-6989586621689418365"><span class="hs-identifier hs-var hs-var">responsePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
  ResultCustomizer)
 -&gt; ResponsePath)
-&gt; IntMap
     (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
      ResultCustomizer)
-&gt; IntMap ResponsePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Name -&gt; ResponsePath
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ResponsePath"><span class="hs-identifier hs-var">ResponsePath</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Name -&gt; ResponsePath)
-&gt; ((Field NoFragments RemoteSchemaVariable, NonEmpty Name,
     ResultCustomizer)
    -&gt; NonEmpty Name)
-&gt; (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
    ResultCustomizer)
-&gt; ResponsePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (NonEmpty Name)
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
  (NonEmpty Name)
-&gt; (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
    ResultCustomizer)
-&gt; NonEmpty Name
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (NonEmpty Name)
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
  (NonEmpty Name)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap
  (Field NoFragments RemoteSchemaVariable, NonEmpty Name,
   ResultCustomizer)
</span><a href="#local-6989586621689418409"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">RemoteSchemaCall -&gt; m RemoteSchemaCall
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaCall -&gt; m RemoteSchemaCall)
-&gt; RemoteSchemaCall -&gt; m RemoteSchemaCall
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResultCustomizer
-&gt; GQLReqOutgoing -&gt; IntMap ResponsePath -&gt; RemoteSchemaCall
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-var">RemoteSchemaCall</span></a></span><span> </span><span class="annot"><span class="annottext">ResultCustomizer
</span><a href="#local-6989586621689418367"><span class="hs-identifier hs-var">customizer</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqOutgoing
</span><a href="#local-6989586621689418372"><span class="hs-identifier hs-var">gqlRequest</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap ResponsePath
</span><a href="#local-6989586621689418365"><span class="hs-identifier hs-var">responsePath</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Fold nested 'FieldCall's into a bare 'Field', inserting the passed</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- selection set at the leaf of the tree we construct.</span><span>
</span><span id="line-140"></span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#fieldCallsToField"><span class="hs-identifier hs-type">fieldCallsToField</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689418591"><span class="annot"><a href="#local-6989586621689418591"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-comment">-- | user input arguments to the remote join field</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-type">P.InputValue</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-comment">-- | Contains the values of the variables that have been defined in the remote join definition</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">-- | Inserted at leaf of nested FieldCalls</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">G.SelectionSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.NoFragments</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-comment">-- | Top-level name to set for this Field</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.ToSchema.html#FieldCall"><span class="hs-identifier hs-type">FieldCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="#local-6989586621689418591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Field</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.NoFragments</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span id="fieldCallsToField"><span class="annot"><span class="annottext">fieldCallsToField :: HashMap Name (InputValue RemoteSchemaVariable)
-&gt; HashMap Name (Value Void)
-&gt; SelectionSet NoFragments RemoteSchemaVariable
-&gt; Name
-&gt; NonEmpty FieldCall
-&gt; m (Field NoFragments RemoteSchemaVariable)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#fieldCallsToField"><span class="hs-identifier hs-var hs-var">fieldCallsToField</span></a></span></span><span> </span><span id="local-6989586621689418364"><span class="annot"><span class="annottext">HashMap Name (InputValue RemoteSchemaVariable)
</span><a href="#local-6989586621689418364"><span class="hs-identifier hs-var">rrArguments</span></a></span></span><span> </span><span id="local-6989586621689418363"><span class="annot"><span class="annottext">HashMap Name (Value Void)
</span><a href="#local-6989586621689418363"><span class="hs-identifier hs-var">variables</span></a></span></span><span> </span><span id="local-6989586621689418362"><span class="annot"><span class="annottext">SelectionSet NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418362"><span class="hs-identifier hs-var">finalSelSet</span></a></span></span><span> </span><span id="local-6989586621689418361"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418361"><span class="hs-identifier hs-var">topAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="annottext">(Field NoFragments RemoteSchemaVariable
 -&gt; Field NoFragments RemoteSchemaVariable)
-&gt; m (Field NoFragments RemoteSchemaVariable)
-&gt; m (Field NoFragments RemoteSchemaVariable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621689418360"><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418360"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418360"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_fAlias :: Maybe Name
</span><span class="hs-identifier hs-var">G._fAlias</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418361"><span class="hs-identifier hs-var">topAlias</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Field NoFragments RemoteSchemaVariable)
 -&gt; m (Field NoFragments RemoteSchemaVariable))
-&gt; (NonEmpty FieldCall
    -&gt; m (Field NoFragments RemoteSchemaVariable))
-&gt; NonEmpty FieldCall
-&gt; m (Field NoFragments RemoteSchemaVariable)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall -&gt; m (Field NoFragments RemoteSchemaVariable)
</span><a href="#local-6989586621689418358"><span class="hs-identifier hs-var">nest</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- almost: `foldr nest finalSelSet`</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621689418358"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.ToSchema.html#FieldCall"><span class="hs-identifier hs-type">FieldCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Field</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.NoFragments</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621689418358"><span class="annot"><span class="annottext">nest :: NonEmpty FieldCall -&gt; m (Field NoFragments RemoteSchemaVariable)
</span><a href="#local-6989586621689418358"><span class="hs-identifier hs-var hs-var">nest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Relationships.ToSchema.html#FieldCall"><span class="hs-identifier hs-type">FieldCall</span></a></span><span> </span><span id="local-6989586621689418356"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418356"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621689418355"><span class="annot"><span class="annottext">RemoteArguments
</span><a href="#local-6989586621689418355"><span class="hs-identifier hs-var">remoteArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621689418354"><span class="annot"><span class="annottext">[FieldCall]
</span><a href="#local-6989586621689418354"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>      </span><span id="local-6989586621689418353"><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418353"><span class="hs-identifier hs-var">templatedArguments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Void)
-&gt; HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418352"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap Name (Value Void)
 -&gt; HashMap Name (Value RemoteSchemaVariable))
-&gt; m (HashMap Name (Value Void))
-&gt; m (HashMap Name (Value RemoteSchemaVariable))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Void)
-&gt; RemoteArguments -&gt; m (HashMap Name (Value Void))
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
HashMap Name (Value Void)
-&gt; RemoteArguments -&gt; m (HashMap Name (Value Void))
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#createArguments"><span class="hs-identifier hs-var">createArguments</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Void)
</span><a href="#local-6989586621689418363"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteArguments
</span><a href="#local-6989586621689418355"><span class="hs-identifier hs-var">remoteArgs</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span id="local-6989586621689418349"><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418349"><span class="hs-identifier hs-var">graphQLarguments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InputValue RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable))
-&gt; HashMap Name (InputValue RemoteSchemaVariable)
-&gt; m (HashMap Name (Value RemoteSchemaVariable))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">InputValue RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418348"><span class="hs-identifier hs-var">peel</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (InputValue RemoteSchemaVariable)
</span><a href="#local-6989586621689418364"><span class="hs-identifier hs-var">rrArguments</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621689418347"><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418347"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689418346"><span class="annot"><span class="annottext">SelectionSet NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418346"><span class="hs-identifier hs-var">selSet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FieldCall] -&gt; Maybe (NonEmpty FieldCall)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">NE.nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">[FieldCall]
</span><a href="#local-6989586621689418354"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689418345"><span class="annot"><span class="annottext">NonEmpty FieldCall
</span><a href="#local-6989586621689418345"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>          </span><span id="local-6989586621689418344"><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418344"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall -&gt; m (Field NoFragments RemoteSchemaVariable)
</span><a href="#local-6989586621689418358"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldCall
</span><a href="#local-6989586621689418345"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><span class="annottext">(HashMap Name (Value RemoteSchemaVariable),
 SelectionSet NoFragments RemoteSchemaVariable)
-&gt; m (HashMap Name (Value RemoteSchemaVariable),
      SelectionSet NoFragments RemoteSchemaVariable)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418353"><span class="hs-identifier hs-var">templatedArguments</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
-&gt; Selection NoFragments RemoteSchemaVariable
forall (frag :: * -&gt; *) var. Field frag var -&gt; Selection frag var
</span><span class="hs-identifier hs-var">G.SelectionField</span></span><span> </span><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418344"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="annottext">Maybe (NonEmpty FieldCall)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>          </span><span id="local-6989586621689418342"><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418342"><span class="hs-identifier hs-var">arguments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><span class="annottext">(Name
 -&gt; Value RemoteSchemaVariable
 -&gt; Value RemoteSchemaVariable
 -&gt; m (Value RemoteSchemaVariable))
-&gt; HashMap Name (Value RemoteSchemaVariable)
-&gt; HashMap Name (Value RemoteSchemaVariable)
-&gt; m (HashMap Name (Value RemoteSchemaVariable))
forall (m :: * -&gt; *) k v.
(Monad m, Eq k, Hashable k) =&gt;
(k -&gt; v -&gt; v -&gt; m v)
-&gt; HashMap k v -&gt; HashMap k v -&gt; m (HashMap k v)
</span><a href="Data.HashMap.Strict.Extended.html#unionWithM"><span class="hs-identifier hs-var">Map.unionWithM</span></a></span><span>
</span><span id="line-168"></span><span>              </span><span class="annot"><span class="annottext">Name
-&gt; Value RemoteSchemaVariable
-&gt; Value RemoteSchemaVariable
-&gt; m (Value RemoteSchemaVariable)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Name
-&gt; Value RemoteSchemaVariable
-&gt; Value RemoteSchemaVariable
-&gt; m (Value RemoteSchemaVariable)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#combineValues"><span class="hs-identifier hs-var">combineValues</span></a></span><span>
</span><span id="line-169"></span><span>              </span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418349"><span class="hs-identifier hs-var">graphQLarguments</span></a></span><span>
</span><span id="line-170"></span><span>              </span><span class="hs-comment">-- converting (G.Value Void) -&gt; (G.Value Variable) to merge the</span><span>
</span><span id="line-171"></span><span>              </span><span class="hs-comment">-- 'rrArguments' with the 'variables'</span><span>
</span><span id="line-172"></span><span>              </span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418353"><span class="hs-identifier hs-var">templatedArguments</span></a></span><span>
</span><span id="line-173"></span><span>          </span><span class="annot"><span class="annottext">(HashMap Name (Value RemoteSchemaVariable),
 SelectionSet NoFragments RemoteSchemaVariable)
-&gt; m (HashMap Name (Value RemoteSchemaVariable),
      SelectionSet NoFragments RemoteSchemaVariable)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418342"><span class="hs-identifier hs-var">arguments</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectionSet NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418362"><span class="hs-identifier hs-var">finalSelSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">Field NoFragments RemoteSchemaVariable
-&gt; m (Field NoFragments RemoteSchemaVariable)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Field NoFragments RemoteSchemaVariable
 -&gt; m (Field NoFragments RemoteSchemaVariable))
-&gt; Field NoFragments RemoteSchemaVariable
-&gt; m (Field NoFragments RemoteSchemaVariable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
-&gt; Name
-&gt; HashMap Name (Value RemoteSchemaVariable)
-&gt; [Directive RemoteSchemaVariable]
-&gt; SelectionSet NoFragments RemoteSchemaVariable
-&gt; Field NoFragments RemoteSchemaVariable
forall (frag :: * -&gt; *) var.
Maybe Name
-&gt; Name
-&gt; HashMap Name (Value var)
-&gt; [Directive var]
-&gt; SelectionSet frag var
-&gt; Field frag var
</span><span class="hs-identifier hs-var">G.Field</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418356"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418347"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SelectionSet NoFragments RemoteSchemaVariable
</span><a href="#local-6989586621689418346"><span class="hs-identifier hs-var">selSet</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="#local-6989586621689418352"><span class="hs-identifier hs-type">convert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621689418352"><span class="annot"><span class="annottext">convert :: HashMap Name (Value Void)
-&gt; HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418352"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Value RemoteSchemaVariable)
-&gt; HashMap Name (Value Void)
-&gt; HashMap Name (Value RemoteSchemaVariable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Value RemoteSchemaVariable
forall var. Value Void -&gt; Value var
</span><span class="hs-identifier hs-var">G.literal</span></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="#local-6989586621689418348"><span class="hs-identifier hs-type">peel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-type">P.InputValue</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621689418348"><span class="annot"><span class="annottext">peel :: InputValue RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418348"><span class="hs-identifier hs-var hs-var">peel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-type">P.GraphQLValue</span></a></span><span> </span><span id="local-6989586621689418336"><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418336"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418336"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-type">P.JSONValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-comment">-- At this point, it is theoretically impossible that we have</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- unpacked a variable into a JSONValue, as there's no &quot;outer</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-comment">-- scope&quot; at which this value could have been peeled.</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-comment">-- FIXME: check that this is correct!</span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; m (Value RemoteSchemaVariable)
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;internal error: encountered an already expanded variable when folding remote field arguments&quot;</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Create an argument map using the inputs taken from the left hand side.</span><span>
</span><span id="line-190"></span><span id="local-6989586621689418549"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#createArguments"><span class="hs-identifier hs-type">createArguments</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418549"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.ToSchema.html#RemoteArguments"><span class="hs-identifier hs-type">RemoteArguments</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><a href="#local-6989586621689418549"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-195"></span><span id="createArguments"><span class="annot"><span class="annottext">createArguments :: HashMap Name (Value Void)
-&gt; RemoteArguments -&gt; m (HashMap Name (Value Void))
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#createArguments"><span class="hs-identifier hs-var hs-var">createArguments</span></a></span></span><span> </span><span id="local-6989586621689418334"><span class="annot"><span class="annottext">HashMap Name (Value Void)
</span><a href="#local-6989586621689418334"><span class="hs-identifier hs-var">variables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Relationships.ToSchema.html#RemoteArguments"><span class="hs-identifier hs-type">RemoteArguments</span></a></span><span> </span><span id="local-6989586621689418332"><span class="annot"><span class="annottext">HashMap Name (Value Name)
</span><a href="#local-6989586621689418332"><span class="hs-identifier hs-var">arguments</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><span class="annottext">Validation [Text] (HashMap Name (Value Void))
-&gt; Either [Text] (HashMap Name (Value Void))
forall e a. Validation e a -&gt; Either e a
</span><span class="hs-identifier hs-var">toEither</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value Name -&gt; Validation [Text] (Value Void))
-&gt; HashMap Name (Value Name)
-&gt; Validation [Text] (HashMap Name (Value Void))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Value Name -&gt; Validation [Text] (Value Void)
</span><a href="#local-6989586621689418331"><span class="hs-identifier hs-var">substituteVariables</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Name)
</span><a href="#local-6989586621689418332"><span class="hs-identifier hs-var">arguments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">Either [Text] (HashMap Name (Value Void))
-&gt; ([Text] -&gt; m (HashMap Name (Value Void)))
-&gt; m (HashMap Name (Value Void))
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621689418329"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418329"><span class="hs-identifier hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m (HashMap Name (Value Void))
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m (HashMap Name (Value Void)))
-&gt; Text -&gt; m (HashMap Name (Value Void))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Found errors: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418329"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621689418331"><span class="annot"><span class="annottext">substituteVariables :: Value Name -&gt; Validation [Text] (Value Void)
</span><a href="#local-6989586621689418331"><span class="hs-identifier hs-var hs-var">substituteVariables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VVariable</span></span><span> </span><span id="local-6989586621689418325"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418325"><span class="hs-identifier hs-var">variableName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; HashMap Name (Value Void) -&gt; Maybe (Value Void)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418325"><span class="hs-identifier hs-var">variableName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Void)
</span><a href="#local-6989586621689418334"><span class="hs-identifier hs-var">variables</span></a></span><span>
</span><span id="line-202"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Value Void)
-&gt; Validation [Text] (Value Void) -&gt; Validation [Text] (Value Void)
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Validation [Text] (Value Void)
forall err a. err -&gt; Validation err a
</span><span class="hs-identifier hs-var">Failure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Value for variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418325"><span class="hs-identifier hs-var">variableName</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not provided&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VList</span></span><span> </span><span id="local-6989586621689418321"><span class="annot"><span class="annottext">[Value Name]
</span><a href="#local-6989586621689418321"><span class="hs-identifier hs-var">listValue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">([Value Void] -&gt; Value Void)
-&gt; Validation [Text] [Value Void] -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Value Void] -&gt; Value Void
forall var. [Value var] -&gt; Value var
</span><span class="hs-identifier hs-var">G.VList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value Name -&gt; Validation [Text] (Value Void))
-&gt; [Value Name] -&gt; Validation [Text] [Value Void]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Value Name -&gt; Validation [Text] (Value Void)
</span><a href="#local-6989586621689418331"><span class="hs-identifier hs-var">substituteVariables</span></a></span><span> </span><span class="annot"><span class="annottext">[Value Name]
</span><a href="#local-6989586621689418321"><span class="hs-identifier hs-var">listValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VObject</span></span><span> </span><span id="local-6989586621689418319"><span class="annot"><span class="annottext">HashMap Name (Value Name)
</span><a href="#local-6989586621689418319"><span class="hs-identifier hs-var">objectValue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">(HashMap Name (Value Void) -&gt; Value Void)
-&gt; Validation [Text] (HashMap Name (Value Void))
-&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Void) -&gt; Value Void
forall var. HashMap Name (Value var) -&gt; Value var
</span><span class="hs-identifier hs-var">G.VObject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value Name -&gt; Validation [Text] (Value Void))
-&gt; HashMap Name (Value Name)
-&gt; Validation [Text] (HashMap Name (Value Void))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Value Name -&gt; Validation [Text] (Value Void)
</span><a href="#local-6989586621689418331"><span class="hs-identifier hs-var">substituteVariables</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value Name)
</span><a href="#local-6989586621689418319"><span class="hs-identifier hs-var">objectValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VInt</span></span><span> </span><span id="local-6989586621689418317"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621689418317"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Validation [Text] (Value Void))
-&gt; Value Void -&gt; Validation [Text] (Value Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value Void
forall var. Integer -&gt; Value var
</span><span class="hs-identifier hs-var">G.VInt</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621689418317"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VFloat</span></span><span> </span><span id="local-6989586621689418315"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621689418315"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Validation [Text] (Value Void))
-&gt; Value Void -&gt; Validation [Text] (Value Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Value Void
forall var. Scientific -&gt; Value var
</span><span class="hs-identifier hs-var">G.VFloat</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621689418315"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VString</span></span><span> </span><span id="local-6989586621689418313"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418313"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Validation [Text] (Value Void))
-&gt; Value Void -&gt; Validation [Text] (Value Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value Void
forall var. Text -&gt; Value var
</span><span class="hs-identifier hs-var">G.VString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418313"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VEnum</span></span><span> </span><span id="local-6989586621689418311"><span class="annot"><span class="annottext">EnumValue
</span><a href="#local-6989586621689418311"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Validation [Text] (Value Void))
-&gt; Value Void -&gt; Validation [Text] (Value Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EnumValue -&gt; Value Void
forall var. EnumValue -&gt; Value var
</span><span class="hs-identifier hs-var">G.VEnum</span></span><span> </span><span class="annot"><span class="annottext">EnumValue
</span><a href="#local-6989586621689418311"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-211"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">G.VBoolean</span></span><span> </span><span id="local-6989586621689418309"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689418309"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Validation [Text] (Value Void))
-&gt; Value Void -&gt; Validation [Text] (Value Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Value Void
forall var. Bool -&gt; Value var
</span><span class="hs-identifier hs-var">G.VBoolean</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689418309"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">Value Name
</span><span class="hs-identifier hs-var">G.VNull</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; Validation [Text] (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value Void -&gt; Validation [Text] (Value Void))
-&gt; Value Void -&gt; Validation [Text] (Value Void)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value Void
forall var. Value var
</span><span class="hs-identifier hs-var">G.VNull</span></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- | Combine two GraphQL values together.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- This is used to combine different input arguments into one. This function can</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- only combine objects or lists pairwise, and fails if it has to combine any</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- other combination of values.</span><span>
</span><span id="line-219"></span><span class="hs-comment">--</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- &gt;&gt;&gt; combineValues (Object (fromList [(&quot;id&quot;, Number 1)]) (Object (fromList [(&quot;name&quot;, String &quot;foo&quot;)])</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- Object (fromList [(&quot;id&quot;, Number 1), (&quot;name&quot;, String &quot;foo&quot;)])</span><span>
</span><span id="line-222"></span><span id="local-6989586621689418542"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#combineValues"><span class="hs-identifier hs-type">combineValues</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418542"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="#local-6989586621689418542"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.RemoteSchema.html#RemoteSchemaVariable"><span class="hs-identifier hs-type">RemoteSchemaVariable</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-228"></span><span id="combineValues"><span class="annot"><span class="annottext">combineValues :: Name
-&gt; Value RemoteSchemaVariable
-&gt; Value RemoteSchemaVariable
-&gt; m (Value RemoteSchemaVariable)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#combineValues"><span class="hs-identifier hs-var hs-var">combineValues</span></a></span></span><span> </span><span id="local-6989586621689418307"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418307"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621689418306"><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418306"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span id="local-6989586621689418305"><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418305"><span class="hs-identifier hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418306"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418305"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.VObject</span></span><span> </span><span id="local-6989586621689418304"><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418304"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.VObject</span></span><span> </span><span id="local-6989586621689418303"><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418303"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
-&gt; Value RemoteSchemaVariable
forall var. HashMap Name (Value var) -&gt; Value var
</span><span class="hs-identifier hs-var">G.VObject</span></span><span> </span><span class="annot"><span class="annottext">(HashMap Name (Value RemoteSchemaVariable)
 -&gt; Value RemoteSchemaVariable)
-&gt; m (HashMap Name (Value RemoteSchemaVariable))
-&gt; m (Value RemoteSchemaVariable)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Name
 -&gt; Value RemoteSchemaVariable
 -&gt; Value RemoteSchemaVariable
 -&gt; m (Value RemoteSchemaVariable))
-&gt; HashMap Name (Value RemoteSchemaVariable)
-&gt; HashMap Name (Value RemoteSchemaVariable)
-&gt; m (HashMap Name (Value RemoteSchemaVariable))
forall (m :: * -&gt; *) k v.
(Monad m, Eq k, Hashable k) =&gt;
(k -&gt; v -&gt; v -&gt; m v)
-&gt; HashMap k v -&gt; HashMap k v -&gt; m (HashMap k v)
</span><a href="Data.HashMap.Strict.Extended.html#unionWithM"><span class="hs-identifier hs-var">Map.unionWithM</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Value RemoteSchemaVariable
-&gt; Value RemoteSchemaVariable
-&gt; m (Value RemoteSchemaVariable)
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Name
-&gt; Value RemoteSchemaVariable
-&gt; Value RemoteSchemaVariable
-&gt; m (Value RemoteSchemaVariable)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#combineValues"><span class="hs-identifier hs-var">combineValues</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418304"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Name (Value RemoteSchemaVariable)
</span><a href="#local-6989586621689418303"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.VList</span></span><span> </span><span id="local-6989586621689418302"><span class="annot"><span class="annottext">[Value RemoteSchemaVariable]
</span><a href="#local-6989586621689418302"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.VList</span></span><span> </span><span id="local-6989586621689418301"><span class="annot"><span class="annottext">[Value RemoteSchemaVariable]
</span><a href="#local-6989586621689418301"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable))
-&gt; Value RemoteSchemaVariable -&gt; m (Value RemoteSchemaVariable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Value RemoteSchemaVariable] -&gt; Value RemoteSchemaVariable
forall var. [Value var] -&gt; Value var
</span><span class="hs-identifier hs-var">G.VList</span></span><span> </span><span class="annot"><span class="annottext">([Value RemoteSchemaVariable] -&gt; Value RemoteSchemaVariable)
-&gt; [Value RemoteSchemaVariable] -&gt; Value RemoteSchemaVariable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Value RemoteSchemaVariable]
</span><a href="#local-6989586621689418302"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[Value RemoteSchemaVariable]
-&gt; [Value RemoteSchemaVariable] -&gt; [Value RemoteSchemaVariable]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Value RemoteSchemaVariable]
</span><a href="#local-6989586621689418301"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621689418300"><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418300"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621689418299"><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418299"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; m (Value RemoteSchemaVariable)
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m (Value RemoteSchemaVariable))
-&gt; Text -&gt; m (Value RemoteSchemaVariable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;combineValues: cannot combine values (&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418300"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) and (&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">Value RemoteSchemaVariable
</span><a href="#local-6989586621689418299"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) for field &quot;</span></span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var hs-var">G.unName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621689418307"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;; lists can only be merged with lists, objects can only be merged with objects&quot;</span></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-comment">-- | Craft a GraphQL query document from the list of fields.</span><span>
</span><span id="line-239"></span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#fieldsToRequest"><span class="hs-identifier hs-type">fieldsToRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Field</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.NoFragments</span></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-type">P.Variable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReqOutgoing"><span class="hs-identifier hs-type">GQLReqOutgoing</span></a></span><span>
</span><span id="line-240"></span><span id="fieldsToRequest"><span class="annot"><span class="annottext">fieldsToRequest :: NonEmpty (Field NoFragments Variable) -&gt; GQLReqOutgoing
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#fieldsToRequest"><span class="hs-identifier hs-var hs-var">fieldsToRequest</span></a></span></span><span> </span><span id="local-6989586621689418296"><span class="annot"><span class="annottext">NonEmpty (Field NoFragments Variable)
</span><a href="#local-6989586621689418296"><span class="hs-identifier hs-var">gFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">GQLReq :: forall a.
Maybe OperationName -&gt; a -&gt; Maybe VariableValues -&gt; GQLReq a
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReq"><span class="hs-identifier hs-type">GQLReq</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_grOperationName :: Maybe OperationName
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#_grOperationName"><span class="hs-identifier hs-var">_grOperationName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OperationName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">_grVariables :: Maybe VariableValues
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#_grVariables"><span class="hs-identifier hs-var">_grVariables</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HashMap VariableDefinition Value -&gt; Bool
forall k v. HashMap k v -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">HashMap VariableDefinition Value
</span><a href="#local-6989586621689418291"><span class="hs-identifier hs-var">variableInfos</span></a></span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe VariableValues
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">VariableValues -&gt; Maybe VariableValues
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(VariableValues -&gt; Maybe VariableValues)
-&gt; VariableValues -&gt; Maybe VariableValues
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VariableDefinition -&gt; Name)
-&gt; HashMap VariableDefinition Value -&gt; VariableValues
forall k2 k1 v.
(Eq k2, Hashable k2) =&gt;
(k1 -&gt; k2) -&gt; HashMap k1 v -&gt; HashMap k2 v
</span><span class="hs-identifier hs-var">mapKeys</span></span><span> </span><span class="annot"><span class="annottext">VariableDefinition -&gt; Name
</span><span class="hs-identifier hs-var hs-var">G._vdName</span></span><span> </span><span class="annot"><span class="annottext">HashMap VariableDefinition Value
</span><a href="#local-6989586621689418291"><span class="hs-identifier hs-var">variableInfos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">_grQuery :: SingleOperation
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#_grQuery"><span class="hs-identifier hs-var">_grQuery</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><span class="annottext">TypedOperationDefinition :: forall (frag :: * -&gt; *) var.
OperationType
-&gt; Maybe Name
-&gt; [VariableDefinition]
-&gt; [Directive var]
-&gt; SelectionSet frag var
-&gt; TypedOperationDefinition frag var
</span><span class="hs-identifier hs-type">G.TypedOperationDefinition</span></span><span>
</span><span id="line-249"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_todSelectionSet :: SelectionSet NoFragments Name
</span><span class="hs-identifier hs-var">G._todSelectionSet</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>              </span><span class="hs-comment">-- convert from Field Variable to Field Name</span><span>
</span><span id="line-251"></span><span>              </span><span class="annot"><span class="annottext">NonEmpty (Selection NoFragments Name)
-&gt; SelectionSet NoFragments Name
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Selection NoFragments Name)
 -&gt; SelectionSet NoFragments Name)
-&gt; NonEmpty (Selection NoFragments Name)
-&gt; SelectionSet NoFragments Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Field NoFragments Name -&gt; Selection NoFragments Name
forall (frag :: * -&gt; *) var. Field frag var -&gt; Selection frag var
</span><span class="hs-identifier hs-var">G.SelectionField</span></span><span> </span><span class="annot"><span class="annottext">(Field NoFragments Name -&gt; Selection NoFragments Name)
-&gt; (Field NoFragments Variable -&gt; Field NoFragments Name)
-&gt; Field NoFragments Variable
-&gt; Selection NoFragments Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Variable -&gt; Name)
-&gt; Field NoFragments Variable -&gt; Field NoFragments Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Variable -&gt; Name
forall a. HasName a =&gt; a -&gt; Name
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-var">P.getName</span></a></span><span> </span><span class="annot"><span class="annottext">(Field NoFragments Variable -&gt; Selection NoFragments Name)
-&gt; NonEmpty (Field NoFragments Variable)
-&gt; NonEmpty (Selection NoFragments Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Field NoFragments Variable)
</span><a href="#local-6989586621689418296"><span class="hs-identifier hs-var">gFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">_todVariableDefinitions :: [VariableDefinition]
</span><span class="hs-identifier hs-var">G._todVariableDefinitions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap VariableDefinition Value -&gt; [VariableDefinition]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">HashMap VariableDefinition Value
</span><a href="#local-6989586621689418291"><span class="hs-identifier hs-var">variableInfos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><span class="annottext">_todType :: OperationType
</span><span class="hs-identifier hs-var">G._todType</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OperationType
</span><span class="hs-identifier hs-var">G.OperationTypeQuery</span></span><span class="hs-special">,</span><span>
</span><span id="line-254"></span><span>            </span><span class="annot"><span class="annottext">_todName :: Maybe Name
</span><span class="hs-identifier hs-var">G._todName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-255"></span><span>            </span><span class="annot"><span class="annottext">_todDirectives :: [Directive Name]
</span><span class="hs-identifier hs-var">G._todDirectives</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="#local-6989586621689418291"><span class="hs-identifier hs-type">variableInfos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.VariableDefinition</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621689418291"><span class="annot"><span class="annottext">variableInfos :: HashMap VariableDefinition Value
</span><a href="#local-6989586621689418291"><span class="hs-identifier hs-var hs-var">variableInfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VariableDefinition, Value)] -&gt; HashMap VariableDefinition Value
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(VariableDefinition, Value)] -&gt; HashMap VariableDefinition Value)
-&gt; [(VariableDefinition, Value)]
-&gt; HashMap VariableDefinition Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Field NoFragments Variable -&gt; [(VariableDefinition, Value)])
-&gt; NonEmpty (Field NoFragments Variable)
-&gt; [(VariableDefinition, Value)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Variable -&gt; [(VariableDefinition, Value)])
-&gt; Field NoFragments Variable -&gt; [(VariableDefinition, Value)]
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Variable -&gt; [(VariableDefinition, Value)]
</span><a href="#local-6989586621689418276"><span class="hs-identifier hs-var">getVariableInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Field NoFragments Variable)
</span><a href="#local-6989586621689418296"><span class="hs-identifier hs-var">gFields</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><a href="#local-6989586621689418276"><span class="hs-identifier hs-type">getVariableInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-type">P.Variable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.VariableDefinition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621689418276"><span class="annot"><span class="annottext">getVariableInfo :: Variable -&gt; [(VariableDefinition, Value)]
</span><a href="#local-6989586621689418276"><span class="hs-identifier hs-var hs-var">getVariableInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VariableDefinition, Value) -&gt; [(VariableDefinition, Value)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((VariableDefinition, Value) -&gt; [(VariableDefinition, Value)])
-&gt; (Variable -&gt; (VariableDefinition, Value))
-&gt; Variable
-&gt; [(VariableDefinition, Value)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Value) -&gt; Value)
-&gt; (VariableDefinition, (Name, Value))
-&gt; (VariableDefinition, Value)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Name, Value) -&gt; Value
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((VariableDefinition, (Name, Value))
 -&gt; (VariableDefinition, Value))
-&gt; (Variable -&gt; (VariableDefinition, (Name, Value)))
-&gt; Variable
-&gt; (VariableDefinition, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Variable -&gt; (VariableDefinition, (Name, Value))
</span><a href="Hasura.GraphQL.Execute.Remote.html#getVariableDefinitionAndValue"><span class="hs-identifier hs-var">getVariableDefinitionAndValue</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- Step 2: sending the call over the network</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- | Sends the call over the network, and parse the resulting ByteString.</span><span>
</span><span id="line-268"></span><span id="local-6989586621689418647"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#executeRemoteSchemaCall"><span class="hs-identifier hs-type">executeRemoteSchemaCall</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-comment">-- | Function to send a request over the network.</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#GQLReqOutgoing"><span class="hs-identifier hs-type">GQLReqOutgoing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-comment">-- | Information about that call.</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-type">RemoteSchemaCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-comment">-- | Resulting JSON object</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><a href="#local-6989586621689418647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Object</span></a></span></span><span>
</span><span id="line-276"></span><span id="executeRemoteSchemaCall"><span class="annot"><span class="annottext">executeRemoteSchemaCall :: (GQLReqOutgoing -&gt; m ByteString) -&gt; RemoteSchemaCall -&gt; m Object
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#executeRemoteSchemaCall"><span class="hs-identifier hs-var hs-var">executeRemoteSchemaCall</span></a></span></span><span> </span><span id="local-6989586621689418275"><span class="annot"><span class="annottext">GQLReqOutgoing -&gt; m ByteString
</span><a href="#local-6989586621689418275"><span class="hs-identifier hs-var">networkFunction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-type">RemoteSchemaCall</span></a></span><span> </span><span id="local-6989586621689418274"><span class="annot"><span class="annottext">ResultCustomizer
</span><a href="#local-6989586621689418274"><span class="hs-identifier hs-var">customizer</span></a></span></span><span> </span><span id="local-6989586621689418273"><span class="annot"><span class="annottext">GQLReqOutgoing
</span><a href="#local-6989586621689418273"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntMap ResponsePath
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621689418272"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689418272"><span class="hs-identifier hs-var">responseBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GQLReqOutgoing -&gt; m ByteString
</span><a href="#local-6989586621689418275"><span class="hs-identifier hs-var">networkFunction</span></a></span><span> </span><span class="annot"><span class="annottext">GQLReqOutgoing
</span><a href="#local-6989586621689418273"><span class="hs-identifier hs-var">request</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span id="local-6989586621689418271"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418271"><span class="hs-identifier hs-var">responseJSON</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; Either String Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.eitherDecode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621689418272"><span class="hs-identifier hs-var">responseBody</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">Either String Value -&gt; (String -&gt; m Value) -&gt; m Value
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621689418269"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689418269"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Value
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Value) -&gt; Text -&gt; m Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Remote server response is not valid JSON: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689418269"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621689418268"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418268"><span class="hs-identifier hs-var">responseObject</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Object
forall s. IsString s =&gt; Value -&gt; Either s Object
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.asObject</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418271"><span class="hs-identifier hs-var">responseJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text Object -&gt; (Text -&gt; m Object) -&gt; m Object
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Object
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689418266"><span class="annot"><span class="annottext">errors :: Maybe Value
</span><a href="#local-6989586621689418266"><span class="hs-identifier hs-var hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Maybe Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;errors&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418268"><span class="hs-identifier hs-var">responseObject</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-keyword">if</span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Value -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621689418266"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621689418266"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value -&gt; Maybe Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.Null</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Maybe Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;data&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418268"><span class="hs-identifier hs-var">responseObject</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>          </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Object
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot;data\&quot; field not found in remote response&quot;</span></span><span>
</span><span id="line-287"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689418261"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418261"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689418260"><span class="annot"><span class="annottext">v' :: Value
</span><a href="#local-6989586621689418260"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResultCustomizer -&gt; Value -&gt; Value
</span><a href="Hasura.RQL.Types.ResultCustomization.html#applyResultCustomizer"><span class="hs-identifier hs-var">applyResultCustomizer</span></a></span><span> </span><span class="annot"><span class="annottext">ResultCustomizer
</span><a href="#local-6989586621689418274"><span class="hs-identifier hs-var">customizer</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418261"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-289"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Object
forall s. IsString s =&gt; Value -&gt; Either s Object
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.asObject</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418260"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text Object -&gt; (Text -&gt; m Object) -&gt; m Object
forall (m :: * -&gt; *) e a.
Applicative m =&gt;
Either e a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="Hasura.Prelude.html#onLeft"><span class="hs-operator hs-var">`onLeft`</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Object
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">QErr -&gt; m Object
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Errors from remote server&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qeInternal :: Maybe QErrExtra
</span><a href="Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErrExtra -&gt; Maybe QErrExtra
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(QErrExtra -&gt; Maybe QErrExtra) -&gt; QErrExtra -&gt; Maybe QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; QErrExtra
</span><a href="Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-var">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; QErrExtra) -&gt; Value -&gt; QErrExtra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">A.object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;errors&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Maybe Value -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">A..=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.fromOrdered</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Maybe Value -&gt; Maybe Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621689418266"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-294"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- Step 3: extracting the join index</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Construct a join index from the remote source's 'AO.Value' response.</span><span>
</span><span id="line-300"></span><span class="hs-comment">--</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- This function extracts from the 'RemoteJoinCall' a mapping from</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- 'JoinArgumentId' to 'ResponsePath': from an integer that uniquely identifies</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- a join argument to the &quot;path&quot; at which we expect that value in the</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- response. With it, and with the actual reponse JSON value obtained from the</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- remote server, it constructs a corresponding mapping of, for each argument,</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- its extracted value.</span><span>
</span><span id="line-307"></span><span class="hs-comment">--</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- If the response does not have value at any of the provided 'ResponsePath's,</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- throw a generic 'QErr'.</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- NOTE(jkachmar): If we switch to an 'Applicative' validator, we can collect</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- more than one missing 'ResponsePath's (rather than short-circuiting on the</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- first missing value).</span><span>
</span><span id="line-314"></span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildJoinIndex"><span class="hs-identifier hs-type">buildJoinIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621689418646"><span class="annot"><a href="#local-6989586621689418646"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418646"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-type">RemoteSchemaCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Object</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><a href="#local-6989586621689418646"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span id="buildJoinIndex"><span class="annot"><span class="annottext">buildJoinIndex :: RemoteSchemaCall -&gt; Object -&gt; m (IntMap Value)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#buildJoinIndex"><span class="hs-identifier hs-var hs-var">buildJoinIndex</span></a></span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#RemoteSchemaCall"><span class="hs-identifier hs-type">RemoteSchemaCall</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689418249"><span id="local-6989586621689418250"><span id="local-6989586621689418251"><span class="annot"><span class="annottext">IntMap ResponsePath
ResultCustomizer
GQLReqOutgoing
rscResponsePaths :: IntMap ResponsePath
rscGQLRequest :: GQLReqOutgoing
rscCustomizer :: ResultCustomizer
rscResponsePaths :: RemoteSchemaCall -&gt; IntMap ResponsePath
rscGQLRequest :: RemoteSchemaCall -&gt; GQLReqOutgoing
rscCustomizer :: RemoteSchemaCall -&gt; ResultCustomizer
</span><a href="#local-6989586621689418249"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621689418248"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418248"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><span class="annottext">IntMap ResponsePath
-&gt; (ResponsePath -&gt; m Value) -&gt; m (IntMap Value)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">IntMap ResponsePath
</span><a href="#local-6989586621689418249"><span class="hs-identifier hs-var">rscResponsePaths</span></a></span><span> </span><span class="annot"><span class="annottext">((ResponsePath -&gt; m Value) -&gt; m (IntMap Value))
-&gt; (ResponsePath -&gt; m Value) -&gt; m (IntMap Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ResponsePath"><span class="hs-identifier hs-type">ResponsePath</span></a></span><span> </span><span id="local-6989586621689418247"><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621689418247"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><span class="annottext">Value -&gt; [Text] -&gt; m Value
</span><a href="#local-6989586621689418246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.Object</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418248"><span class="hs-identifier hs-var">response</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; [Name] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var hs-var">G.unName</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Text])
-&gt; (NonEmpty Name -&gt; [Name]) -&gt; NonEmpty Name -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name -&gt; [Name]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty Name -&gt; [Text]) -&gt; NonEmpty Name -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621689418247"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="#local-6989586621689418246"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418646"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Value</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621689418246"><span class="annot"><span class="annottext">go :: Value -&gt; [Text] -&gt; m Value
</span><a href="#local-6989586621689418246"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621689418244"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418244"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span id="local-6989586621689418243"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418243"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418243"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; m Value
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418244"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span id="local-6989586621689418242"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418242"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621689418241"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418241"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418244"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Object</span></a></span><span> </span><span id="local-6989586621689418240"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418240"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>          </span><span id="local-6989586621689418239"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418239"><span class="hs-identifier hs-var">objValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-330"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Maybe Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418242"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621689418240"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-331"></span><span>              </span><span class="annot"><span class="annottext">Maybe Value -&gt; m Value -&gt; m Value
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Value
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;failed to lookup key '&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418242"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' in response&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>          </span><span class="annot"><span class="annottext">Value -&gt; [Text] -&gt; m Value
</span><a href="#local-6989586621689418246"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621689418239"><span class="hs-identifier hs-var">objValue</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418241"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; m Value
forall (m :: * -&gt; *) a. QErrM m =&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw500"><span class="hs-identifier hs-var">throw500</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Value) -&gt; Text -&gt; m Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-335"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected non-object json value found while path not empty: &quot;</span></span><span>
</span><span id="line-336"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="Data.Text.Extended.html#commaSeparated"><span class="hs-identifier hs-var">commaSeparated</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621689418243"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- Local helpers</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-- NOTE: Ideally this should be done at the remote relationship validation</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- layer.</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- When validating remote relationships, we should store the validated names so</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- that we don't need to continually re-validate them downstream.</span><span>
</span><span id="line-346"></span><span id="local-6989586621689418606"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#parseGraphQLName"><span class="hs-identifier hs-type">parseGraphQLName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418606"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418606"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Name</span></span></span><span>
</span><span id="line-347"></span><span id="parseGraphQLName"><span class="annot"><span class="annottext">parseGraphQLName :: Text -&gt; m Name
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#parseGraphQLName"><span class="hs-identifier hs-var hs-var">parseGraphQLName</span></a></span></span><span> </span><span id="local-6989586621689418238"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418238"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Maybe Name
</span><span class="hs-identifier hs-var">G.mkName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418238"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; m Name -&gt; m Name
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m Name
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#RemoteSchemaError"><span class="hs-identifier hs-var">RemoteSchemaError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Name) -&gt; Text -&gt; m Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418236"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621689418236"><span class="annot"><span class="annottext">errMsg :: Text
</span><a href="#local-6989586621689418236"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621689418238"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; is not a valid GraphQL name&quot;</span></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span id="local-6989586621689418605"><span class="annot"><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ordJSONValueToGValue"><span class="hs-identifier hs-type">ordJSONValueToGValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689418605"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-type">AO.Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621689418605"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">G.Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-353"></span><span id="ordJSONValueToGValue"><span class="annot"><span class="annottext">ordJSONValueToGValue :: Value -&gt; n (Value Void)
</span><a href="Hasura.GraphQL.Execute.RemoteJoin.RemoteSchema.html#ordJSONValueToGValue"><span class="hs-identifier hs-var hs-var">ordJSONValueToGValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">(ErrorMessage -&gt; n (Value Void))
-&gt; (Value Void -&gt; n (Value Void))
-&gt; Either ErrorMessage (Value Void)
-&gt; n (Value Void)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; n (Value Void)
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="Hasura.Base.Error.html#ValidationFailed"><span class="hs-identifier hs-var">ValidationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; n (Value Void))
-&gt; (ErrorMessage -&gt; Text) -&gt; ErrorMessage -&gt; n (Value Void)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ErrorMessage -&gt; Text
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-error-message-1.0.0/opt/doc/html/hasura-error-message/src"><span class="hs-identifier hs-var hs-var">fromErrorMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value Void -&gt; n (Value Void)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessage (Value Void) -&gt; n (Value Void))
-&gt; (Value -&gt; Either ErrorMessage (Value Void))
-&gt; Value
-&gt; n (Value Void)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either ErrorMessage (Value Void)
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/hasura-schema-parsers-1.0.0/opt/doc/html/hasura-schema-parsers/src"><span class="hs-identifier hs-var">P.jsonToGraphQL</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Either ErrorMessage (Value Void))
-&gt; (Value -&gt; Value) -&gt; Value -&gt; Either ErrorMessage (Value Void)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="../file:///workdir/dist-newstyle/build/x86_64-linux/ghc-8.10.7/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src"><span class="hs-identifier hs-var">AO.fromOrdered</span></a></span><span>
</span><span id="line-355"></span></pre></body></html>