<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -O0 #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Arg and Env Parsing for initialisation of the engine along with</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- corresponding logging and other helper functionality.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- This module is intended as the interface for options parsing and</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- its submodules should not need to be imported directly.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Server.Init</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- TODO(SOLOMON): Reduce API surface area drastically.</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html"><span class="hs-identifier">Hasura.Server.Init</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html"><span class="hs-identifier">Hasura.Server.Init.Env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html"><span class="hs-identifier">Hasura.Server.Init.Arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Logging.html"><span class="hs-identifier">Hasura.Server.Init.Logging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.TH</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.PG.Query</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PG</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Error</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.EventTrigger.html"><span class="hs-identifier">Hasura.Eventing.EventTrigger</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EventTrigger</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ES</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Options.html"><span class="hs-identifier">Hasura.GraphQL.Schema.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Options</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RTC</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Auth</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Cors.html"><span class="hs-identifier">Hasura.Server.Cors</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cors</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html"><span class="hs-identifier">Hasura.Server.Init.Arg</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html"><span class="hs-identifier">Hasura.Server.Init.Env</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Logging.html"><span class="hs-identifier">Hasura.Server.Init.Logging</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logging</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Types</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Utils.html"><span class="hs-identifier">Hasura.Server.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Utils</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.WebSockets</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- TODO(SOLOMON): Where does this note belong?</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">{- Note [ReadOnly Mode]
~~~~~~~~~~~~~~~~~~~~~~~~~

This mode starts the server in a (database) read-only mode. That is, only
read-only queries are allowed on users' database sources, and write
queries throw a runtime error. The use-case is for failsafe operations.
Metadata APIs are also disabled.

Following is the precise behaviour -
  1. For any GraphQL API (relay/hasura; http/websocket) - disable execution of
  mutations
  2. Metadata API is disabled
  3. /v2/query API - insert, delete, update, run_sql are disabled
  4. /v1/query API - insert, delete, update, run_sql are disabled
  5. No source catalog migrations are run
  6. During build schema cache phase, building event triggers are disabled (as
  they create corresponding database triggers)
-}</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- NOTE(SOLOMON): Does this belong here?</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Query the Metadata DB for the catalog version.</span><span>
</span><span id="line-72"></span><span class="annot"><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-type">getDbId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.TxE</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">Error.QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-type">Types.MetadataDbId</span></a></span><span>
</span><span id="line-73"></span><span id="getDbId"><span class="annot"><span class="annottext">getDbId :: TxE QErr MetadataDbId
</span><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-var hs-var">getDbId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; MetadataDbId
</span><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-var">Types.MetadataDbId</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; MetadataDbId)
-&gt; (SingleRow (Identity Text) -&gt; Text)
-&gt; SingleRow (Identity Text)
-&gt; MetadataDbId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity Text -&gt; Text
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Text -&gt; Text)
-&gt; (SingleRow (Identity Text) -&gt; Identity Text)
-&gt; SingleRow (Identity Text)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity Text) -&gt; Identity Text
forall a. SingleRow a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getRow</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">(SingleRow (Identity Text) -&gt; MetadataDbId)
-&gt; TxET QErr IO (SingleRow (Identity Text))
-&gt; TxE QErr MetadataDbId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; () -&gt; Bool -&gt; TxET QErr IO (SingleRow (Identity Text))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><span class="hs-identifier hs-var">Q.withQE</span></span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">PG.defaultTxErrorHandler</span></a></span><span>
</span><span id="line-77"></span><span>      </span><span class="annot"><span class="">[Q.sql|
    SELECT (hasura_uuid :: text) FROM hdb_catalog.hdb_version
  |]</span></span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-type">getPgVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q.TxE</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">Error.QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-type">Types.PGVersion</span></a></span><span>
</span><span id="line-84"></span><span id="getPgVersion"><span class="annot"><span class="annottext">getPgVersion :: TxE QErr PGVersion
</span><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-var hs-var">getPgVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PGVersion
</span><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-var">Types.PGVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PGVersion) -&gt; TxET QErr IO Int -&gt; TxE QErr PGVersion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET QErr IO Int
forall (m :: * -&gt; *) e. MonadIO m =&gt; TxET e m Int
</span><span class="hs-identifier hs-var">Q.serverVersion</span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="annot"><a href="Hasura.Server.Init.html#generateInstanceId"><span class="hs-identifier hs-type">generateInstanceId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-type">Types.InstanceId</span></a></span><span>
</span><span id="line-87"></span><span id="generateInstanceId"><span class="annot"><span class="annottext">generateInstanceId :: IO InstanceId
</span><a href="Hasura.Server.Init.html#generateInstanceId"><span class="hs-identifier hs-var hs-var">generateInstanceId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InstanceId
</span><a href="Hasura.Server.Types.html#InstanceId"><span class="hs-identifier hs-var">Types.InstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InstanceId) -&gt; IO Text -&gt; IO InstanceId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO Text
</span><a href="Hasura.Server.Utils.html#generateFingerprint"><span class="hs-identifier hs-var">Utils.generateFingerprint</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">data</span><span> </span><span id="StartupTimeInfo"><span class="annot"><a href="Hasura.Server.Init.html#StartupTimeInfo"><span class="hs-identifier hs-var">StartupTimeInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StartupTimeInfo"><span class="annot"><a href="Hasura.Server.Init.html#StartupTimeInfo"><span class="hs-identifier hs-var">StartupTimeInfo</span></a></span></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_stiMessage"><span class="annot"><span class="annottext">StartupTimeInfo -&gt; Text
</span><a href="Hasura.Server.Init.html#_stiMessage"><span class="hs-identifier hs-var hs-var">_stiMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>    </span><span id="_stiTimeTaken"><span class="annot"><span class="annottext">StartupTimeInfo -&gt; Double
</span><a href="Hasura.Server.Init.html#_stiTimeTaken"><span class="hs-identifier hs-var hs-var">_stiTimeTaken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- TODO(SOLOMON): Remove this template splice</span><span>
</span><span id="line-95"></span><span class="hs-special">$(</span><span id="local-6989586621689531913"><span id="local-6989586621689531915"><span id="local-6989586621689531917"><span id="local-6989586621689531919"><span id="local-6989586621689531921"><span id="local-6989586621689531923"><span class="hs-identifier">J.deriveJSON</span><span> </span><span class="hs-identifier">hasuraJSON</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">StartupTimeInfo</span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Given the 'RawServeOptions' parsed from the arg parser,</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- postprocess the db url and fetch env vars associated with the main</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- command parser, then process the subcommand raw values if</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-103"></span><span id="local-6989586621689531907"><span class="annot"><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-type">mkHGEOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">L.EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689531907"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptionsRaw"><span class="hs-identifier hs-type">HGEOptionsRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#RawServeOptions"><span class="hs-identifier hs-type">RawServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689531907"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-type">HGEOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689531907"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-105"></span><span id="mkHGEOptions"><span class="annot"><span class="annottext">mkHGEOptions :: HGEOptionsRaw (RawServeOptions impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
</span><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-var hs-var">mkHGEOptions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptionsRaw"><span class="hs-identifier hs-type">HGEOptionsRaw</span></a></span><span> </span><span id="local-6989586621689531904"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresRawConnInfo)
</span><a href="#local-6989586621689531904"><span class="hs-identifier hs-var">rawDbUrl</span></a></span></span><span> </span><span id="local-6989586621689531903"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689531903"><span class="hs-identifier hs-var">rawMetadataDbUrl</span></a></span></span><span> </span><span id="local-6989586621689531902"><span class="annot"><span class="annottext">HGECommand (RawServeOptions impl)
</span><a href="#local-6989586621689531902"><span class="hs-identifier hs-var">rawCmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621689531901"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621689531901"><span class="hs-identifier hs-var">dbUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresRawConnInfo)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
</span><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-var">processPostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresRawConnInfo)
</span><a href="#local-6989586621689531904"><span class="hs-identifier hs-var">rawDbUrl</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621689531899"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689531899"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; String -&gt; WithEnv (Maybe String)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689531903"><span class="hs-identifier hs-var">rawMetadataDbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe String))
-&gt; String -&gt; WithEnv (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.html#metadataDbUrlEnv"><span class="hs-identifier hs-var">metadataDbUrlEnv</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621689531896"><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
</span><a href="#local-6989586621689531896"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HGECommand (RawServeOptions impl)
</span><a href="#local-6989586621689531902"><span class="hs-identifier hs-var">rawCmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HCServe"><span class="hs-identifier hs-type">HCServe</span></a></span><span> </span><span id="local-6989586621689531894"><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531894"><span class="hs-identifier hs-var">rso</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServeOptions impl -&gt; HGECommand (ServeOptions impl)
forall a. a -&gt; HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCServe"><span class="hs-identifier hs-var">HCServe</span></a></span><span> </span><span class="annot"><span class="annottext">(ServeOptions impl -&gt; HGECommand (ServeOptions impl))
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (ServeOptions impl)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (ServeOptions impl)
forall impl.
EnabledLogTypes impl =&gt;
RawServeOptions impl -&gt; WithEnv (ServeOptions impl)
</span><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-var">mkServeOptions</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531894"><span class="hs-identifier hs-var">rso</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (RawServeOptions impl)
</span><a href="Hasura.Server.Init.Config.html#HCExport"><span class="hs-identifier hs-var">HCExport</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCExport"><span class="hs-identifier hs-var">HCExport</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (RawServeOptions impl)
</span><a href="Hasura.Server.Init.Config.html#HCClean"><span class="hs-identifier hs-var">HCClean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCClean"><span class="hs-identifier hs-var">HCClean</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (RawServeOptions impl)
</span><a href="Hasura.Server.Init.Config.html#HCVersion"><span class="hs-identifier hs-var">HCVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCVersion"><span class="hs-identifier hs-var">HCVersion</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HCDowngrade"><span class="hs-identifier hs-type">HCDowngrade</span></a></span><span> </span><span id="local-6989586621689531888"><span class="annot"><span class="annottext">DowngradeOptions
</span><a href="#local-6989586621689531888"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DowngradeOptions -&gt; HGECommand (ServeOptions impl)
forall a. DowngradeOptions -&gt; HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCDowngrade"><span class="hs-identifier hs-var">HCDowngrade</span></a></span><span> </span><span class="annot"><span class="annottext">DowngradeOptions
</span><a href="#local-6989586621689531888"><span class="hs-identifier hs-var">tgt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="annottext">HGEOptions (ServeOptions impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HGEOptions (ServeOptions impl)
 -&gt; WithEnv (HGEOptions (ServeOptions impl)))
-&gt; HGEOptions (ServeOptions impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
-&gt; Maybe String
-&gt; HGECommand (ServeOptions impl)
-&gt; HGEOptions (ServeOptions impl)
forall impl.
PostgresConnInfo (Maybe UrlConf)
-&gt; Maybe String -&gt; HGECommand impl -&gt; HGEOptions impl
</span><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-var">HGEOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
</span><a href="#local-6989586621689531901"><span class="hs-identifier hs-var">dbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621689531899"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
</span><a href="#local-6989586621689531896"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | 'PostressConnInfo' is a a tuple of some @a@ with a 'Maybe Int'</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- representing the retries setting. This function thus takes a</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- retries setting and a 'PostgresRawConnInfo' from the arg parser and</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- merges those results with the contents of their corresponding env</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- vars.</span><span>
</span><span id="line-121"></span><span class="annot"><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-type">processPostgresConnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresRawConnInfo"><span class="hs-identifier hs-type">PostgresRawConnInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">RTC.UrlConf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span id="processPostgresConnInfo"><span class="annot"><span class="annottext">processPostgresConnInfo :: PostgresConnInfo (Maybe PostgresRawConnInfo)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
</span><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-var hs-var">processPostgresConnInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621689531884"><span id="local-6989586621689531885"><span class="annot"><span class="annottext">Maybe Int
Maybe PostgresRawConnInfo
_pciRetries :: forall a. PostgresConnInfo a -&gt; Maybe Int
_pciDatabaseConn :: forall a. PostgresConnInfo a -&gt; a
_pciRetries :: Maybe Int
_pciDatabaseConn :: Maybe PostgresRawConnInfo
</span><a href="Hasura.Server.Init.Config.html#_pciRetries"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621689531881"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531881"><span class="hs-identifier hs-var">withEnvRetries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531884"><span class="hs-identifier hs-var">_pciRetries</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe Int)) -&gt; String -&gt; WithEnv (Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.html#retriesNumEnv"><span class="hs-identifier hs-var">retriesNumEnv</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621689531879"><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621689531879"><span class="hs-identifier hs-var">databaseUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresRawConnInfo -&gt; WithEnv (Maybe UrlConf)
</span><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-var">rawConnInfoToUrlConf</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PostgresRawConnInfo
</span><a href="#local-6989586621689531885"><span class="hs-identifier hs-var">_pciDatabaseConn</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe UrlConf)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PostgresConnInfo (Maybe UrlConf)
 -&gt; WithEnv (PostgresConnInfo (Maybe UrlConf)))
-&gt; PostgresConnInfo (Maybe UrlConf)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf -&gt; Maybe Int -&gt; PostgresConnInfo (Maybe UrlConf)
forall a. a -&gt; Maybe Int -&gt; PostgresConnInfo a
</span><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-var">PostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
</span><a href="#local-6989586621689531879"><span class="hs-identifier hs-var">databaseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531881"><span class="hs-identifier hs-var">withEnvRetries</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | A helper function for 'processPostgresConnInfo' which fetches</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- postgres connection info from the 'WithEnv' and merges it with the</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- arg parser result.</span><span>
</span><span id="line-132"></span><span class="annot"><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-type">rawConnInfoToUrlConf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresRawConnInfo"><span class="hs-identifier hs-type">PostgresRawConnInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">RTC.UrlConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span id="rawConnInfoToUrlConf"><span class="annot"><span class="annottext">rawConnInfoToUrlConf :: Maybe PostgresRawConnInfo -&gt; WithEnv (Maybe UrlConf)
</span><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-var hs-var">rawConnInfoToUrlConf</span></a></span></span><span> </span><span id="local-6989586621689531877"><span class="annot"><span class="annottext">Maybe PostgresRawConnInfo
</span><a href="#local-6989586621689531877"><span class="hs-identifier hs-var">maybeRawConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621689531876"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621689531876"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  [(String, String)] (ExceptT String Identity) [(String, String)]
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689531874"><span class="annot"><span class="annottext">databaseUrlEnvVar :: String
</span><a href="#local-6989586621689531874"><span class="hs-identifier hs-var hs-var">databaseUrlEnvVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.html#databaseUrlEnv"><span class="hs-identifier hs-var">databaseUrlEnv</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621689531872"><span class="annot"><span class="annottext">hasDatabaseUrlEnv :: Bool
</span><a href="#local-6989586621689531872"><span class="hs-identifier hs-var hs-var">hasDatabaseUrlEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, String) -&gt; Bool) -&gt; [(String, String)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689531874"><span class="hs-identifier hs-var">databaseUrlEnvVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool)
-&gt; ((String, String) -&gt; String) -&gt; (String, String) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621689531876"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">Maybe UrlConf -&gt; WithEnv (Maybe UrlConf)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe UrlConf -&gt; WithEnv (Maybe UrlConf))
-&gt; Maybe UrlConf -&gt; WithEnv (Maybe UrlConf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PostgresRawConnInfo
</span><a href="#local-6989586621689531877"><span class="hs-identifier hs-var">maybeRawConnInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">-- If no --database-url or connection options provided in CLI command</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">Maybe PostgresRawConnInfo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531872"><span class="hs-identifier hs-var">hasDatabaseUrlEnv</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- Consider env variable as is in order to store it as @`UrlConf`</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">-- in default source configuration in metadata</span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="annottext">UrlConf -&gt; Maybe UrlConf
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UrlConf -&gt; Maybe UrlConf) -&gt; UrlConf -&gt; Maybe UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; UrlConf
</span><a href="Hasura.RQL.Types.Common.html#UrlFromEnv"><span class="hs-identifier hs-var">RTC.UrlFromEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UrlConf) -&gt; Text -&gt; UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621689531874"><span class="hs-identifier hs-var">databaseUrlEnvVar</span></a></span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621689531868"><span class="annot"><span class="annottext">PostgresRawConnInfo
</span><a href="#local-6989586621689531868"><span class="hs-identifier hs-var">databaseConn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">UrlConf -&gt; Maybe UrlConf
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UrlConf -&gt; Maybe UrlConf)
-&gt; (URLTemplate -&gt; UrlConf) -&gt; URLTemplate -&gt; Maybe UrlConf
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InputWebhook -&gt; UrlConf
</span><a href="Hasura.RQL.Types.Common.html#UrlValue"><span class="hs-identifier hs-var">RTC.UrlValue</span></a></span><span> </span><span class="annot"><span class="annottext">(InputWebhook -&gt; UrlConf)
-&gt; (URLTemplate -&gt; InputWebhook) -&gt; URLTemplate -&gt; UrlConf
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">URLTemplate -&gt; InputWebhook
</span><a href="Hasura.RQL.Types.Common.html#InputWebhook"><span class="hs-identifier hs-var">RTC.InputWebhook</span></a></span><span> </span><span class="annot"><span class="annottext">(URLTemplate -&gt; Maybe UrlConf) -&gt; URLTemplate -&gt; Maybe UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PostgresRawConnInfo
</span><a href="#local-6989586621689531868"><span class="hs-identifier hs-var">databaseConn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PGConnDatabaseUrl"><span class="hs-identifier hs-type">PGConnDatabaseUrl</span></a></span><span> </span><span id="local-6989586621689531864"><span class="annot"><span class="annottext">URLTemplate
</span><a href="#local-6989586621689531864"><span class="hs-identifier hs-var">urlTemplate</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">URLTemplate
</span><a href="#local-6989586621689531864"><span class="hs-identifier hs-var">urlTemplate</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PGConnDetails"><span class="hs-identifier hs-type">PGConnDetails</span></a></span><span> </span><span id="local-6989586621689531862"><span class="annot"><span class="annottext">PostgresRawConnDetails
</span><a href="#local-6989586621689531862"><span class="hs-identifier hs-var">connDetails</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PostgresRawConnDetails -&gt; URLTemplate
</span><a href="Hasura.Server.Init.Config.html#rawConnDetailsToUrl"><span class="hs-identifier hs-var">rawConnDetailsToUrl</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresRawConnDetails
</span><a href="#local-6989586621689531862"><span class="hs-identifier hs-var">connDetails</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- TODO(SOLOMON): Decompose 'mkServeOptions'</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Merge the results of the serve subcommmand arg parser with</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- corresponding values from the 'WithEnv' context.</span><span>
</span><span id="line-156"></span><span id="local-6989586621689532035"><span class="annot"><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-type">mkServeOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">L.EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689532035"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#RawServeOptions"><span class="hs-identifier hs-type">RawServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689532035"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621689532035"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-157"></span><span id="mkServeOptions"><span class="annot"><span class="annottext">mkServeOptions :: RawServeOptions impl -&gt; WithEnv (ServeOptions impl)
</span><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-var hs-var">mkServeOptions</span></a></span></span><span> </span><span id="local-6989586621689531860"><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621689531859"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531859"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8080</span></span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int)
-&gt; WithEnv (Maybe Int)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Int
forall impl. RawServeOptions impl -&gt; Maybe Int
</span><a href="Hasura.Server.Init.Config.html#rsoPort"><span class="hs-identifier hs-var hs-var">rsoPort</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#servePortEnv"><span class="hs-identifier hs-var">servePortEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621689531855"><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621689531855"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">HostPreference -&gt; Maybe HostPreference -&gt; HostPreference
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">HostPreference
</span><span class="hs-string">&quot;*&quot;</span></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">(Maybe HostPreference -&gt; HostPreference)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe HostPreference)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) HostPreference
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe HostPreference
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe HostPreference)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe HostPreference
forall impl. RawServeOptions impl -&gt; Maybe HostPreference
</span><a href="Hasura.Server.Init.Config.html#rsoHost"><span class="hs-identifier hs-var hs-var">rsoHost</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#serveHostEnv"><span class="hs-identifier hs-var">serveHostEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621689531852"><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621689531852"><span class="hs-identifier hs-var">connParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RawConnParams
-&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams
</span><a href="#local-6989586621689531851"><span class="hs-identifier hs-var">mkConnParams</span></a></span><span> </span><span class="annot"><span class="annottext">(RawConnParams
 -&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams)
-&gt; RawConnParams
-&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; RawConnParams
forall impl. RawServeOptions impl -&gt; RawConnParams
</span><a href="Hasura.Server.Init.Config.html#rsoConnParams"><span class="hs-identifier hs-var hs-var">rsoConnParams</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621689531849"><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621689531849"><span class="hs-identifier hs-var">txIso</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIsolation -&gt; Maybe TxIsolation -&gt; TxIsolation
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">TxIsolation
</span><span class="hs-identifier hs-var">Q.ReadCommitted</span></span><span> </span><span class="annot"><span class="annottext">(Maybe TxIsolation -&gt; TxIsolation)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe TxIsolation)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) TxIsolation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe TxIsolation
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe TxIsolation)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe TxIsolation
forall impl. RawServeOptions impl -&gt; Maybe TxIsolation
</span><a href="Hasura.Server.Init.Config.html#rsoTxIso"><span class="hs-identifier hs-var hs-var">rsoTxIso</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#txIsolationEnv"><span class="hs-identifier hs-var">txIsolationEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621689531845"><span class="annot"><span class="annottext">HashSet AdminSecretHash
</span><a href="#local-6989586621689531845"><span class="hs-identifier hs-var">adminScrt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe AdminSecretHash -&gt; HashSet AdminSecretHash)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe AdminSecretHash)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HashSet AdminSecretHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet AdminSecretHash
-&gt; (AdminSecretHash -&gt; HashSet AdminSecretHash)
-&gt; Maybe AdminSecretHash
-&gt; HashSet AdminSecretHash
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">AdminSecretHash -&gt; HashSet AdminSecretHash
forall a. Hashable a =&gt; a -&gt; HashSet a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT
   [(String, String)]
   (ExceptT String Identity)
   (Maybe AdminSecretHash)
 -&gt; ReaderT
      [(String, String)]
      (ExceptT String Identity)
      (HashSet AdminSecretHash))
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe AdminSecretHash)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HashSet AdminSecretHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe AdminSecretHash
-&gt; [String]
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe AdminSecretHash)
forall a. FromEnv a =&gt; Maybe a -&gt; [String] -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnvs"><span class="hs-identifier hs-var">withEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe AdminSecretHash
forall impl. RawServeOptions impl -&gt; Maybe AdminSecretHash
</span><a href="Hasura.Server.Init.Config.html#rsoAdminSecret"><span class="hs-identifier hs-var hs-var">rsoAdminSecret</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String]
 -&gt; ReaderT
      [(String, String)]
      (ExceptT String Identity)
      (Maybe AdminSecretHash))
-&gt; [String]
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe AdminSecretHash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((String, String) -&gt; String) -&gt; [(String, String)] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#adminSecretEnv"><span class="hs-identifier hs-var">adminSecretEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#accessKeyEnv"><span class="hs-identifier hs-var">accessKeyEnv</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621689531838"><span class="annot"><span class="annottext">Maybe (AuthHookG Text AuthHookType)
</span><a href="#local-6989586621689531838"><span class="hs-identifier hs-var">authHook</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AuthHookG (Maybe Text) (Maybe AuthHookType)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe (AuthHookG Text AuthHookType))
forall a.
FromEnv a =&gt;
AuthHookG (Maybe a) (Maybe AuthHookType)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe (AuthHookG a AuthHookType))
</span><a href="#local-6989586621689531837"><span class="hs-identifier hs-var">mkAuthHook</span></a></span><span> </span><span class="annot"><span class="annottext">(AuthHookG (Maybe Text) (Maybe AuthHookType)
 -&gt; ReaderT
      [(String, String)]
      (ExceptT String Identity)
      (Maybe (AuthHookG Text AuthHookType)))
-&gt; AuthHookG (Maybe Text) (Maybe AuthHookType)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe (AuthHookG Text AuthHookType))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; AuthHookG (Maybe Text) (Maybe AuthHookType)
forall impl.
RawServeOptions impl -&gt; AuthHookG (Maybe Text) (Maybe AuthHookType)
</span><a href="Hasura.Server.Init.Config.html#rsoAuthHook"><span class="hs-identifier hs-var hs-var">rsoAuthHook</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621689531835"><span class="annot"><span class="annottext">[JWTConfig]
</span><a href="#local-6989586621689531835"><span class="hs-identifier hs-var">jwtSecret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe JWTConfig -&gt; [JWTConfig] -&gt; [JWTConfig]
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-operator hs-var">`onNothing`</span></a></span><span> </span><span class="annot"><span class="annottext">[JWTConfig]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe JWTConfig -&gt; [JWTConfig])
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe JWTConfig)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) [JWTConfig]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe JWTConfig
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe JWTConfig)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe JWTConfig
forall impl. RawServeOptions impl -&gt; Maybe JWTConfig
</span><a href="Hasura.Server.Init.Config.html#rsoJwtSecret"><span class="hs-identifier hs-var hs-var">rsoJwtSecret</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#jwtSecretEnv"><span class="hs-identifier hs-var">jwtSecretEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621689531831"><span class="annot"><span class="annottext">Maybe RoleName
</span><a href="#local-6989586621689531831"><span class="hs-identifier hs-var">unAuthRole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe RoleName -&gt; String -&gt; WithEnv (Maybe RoleName)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe RoleName
forall impl. RawServeOptions impl -&gt; Maybe RoleName
</span><a href="Hasura.Server.Init.Config.html#rsoUnAuthRole"><span class="hs-identifier hs-var hs-var">rsoUnAuthRole</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe RoleName))
-&gt; String -&gt; WithEnv (Maybe RoleName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#unAuthRoleEnv"><span class="hs-identifier hs-var">unAuthRoleEnv</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span id="local-6989586621689531828"><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689531828"><span class="hs-identifier hs-var">corsCfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
</span><a href="#local-6989586621689531827"><span class="hs-identifier hs-var">mkCorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CorsConfig
 -&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig)
-&gt; Maybe CorsConfig
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe CorsConfig
forall impl. RawServeOptions impl -&gt; Maybe CorsConfig
</span><a href="Hasura.Server.Init.Config.html#rsoCorsConfig"><span class="hs-identifier hs-var hs-var">rsoCorsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621689531825"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531825"><span class="hs-identifier hs-var">enableConsole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoEnableConsole"><span class="hs-identifier hs-var hs-var">rsoEnableConsole</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv Bool) -&gt; String -&gt; WithEnv Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableConsoleEnv"><span class="hs-identifier hs-var">enableConsoleEnv</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621689531821"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689531821"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; String -&gt; WithEnv (Maybe Text)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Text
forall impl. RawServeOptions impl -&gt; Maybe Text
</span><a href="Hasura.Server.Init.Config.html#rsoConsoleAssetsDir"><span class="hs-identifier hs-var hs-var">rsoConsoleAssetsDir</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#consoleAssetsDirEnv"><span class="hs-identifier hs-var">consoleAssetsDirEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621689531818"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531818"><span class="hs-identifier hs-var">enableTelemetry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
-&gt; WithEnv Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Bool
forall impl. RawServeOptions impl -&gt; Maybe Bool
</span><a href="Hasura.Server.Init.Config.html#rsoEnableTelemetry"><span class="hs-identifier hs-var hs-var">rsoEnableTelemetry</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableTelemetryEnv"><span class="hs-identifier hs-var">enableTelemetryEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621689531815"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689531815"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers -&gt; StringifyNumbers -&gt; Bool -&gt; StringifyNumbers
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="Hasura.GraphQL.Schema.Options.html#Don%27tStringifyNumbers"><span class="hs-identifier hs-var">Options.Don'tStringifyNumbers</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="Hasura.GraphQL.Schema.Options.html#StringifyNumbers"><span class="hs-identifier hs-var">Options.StringifyNumbers</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; StringifyNumbers)
-&gt; WithEnv Bool
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) StringifyNumbers
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoStringifyNum"><span class="hs-identifier hs-var hs-var">rsoStringifyNum</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#stringifyNumEnv"><span class="hs-identifier hs-var">stringifyNumEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621689531809"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531809"><span class="hs-identifier hs-var">dangerousBooleanCollapse</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
-&gt; WithEnv Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Bool
forall impl. RawServeOptions impl -&gt; Maybe Bool
</span><a href="Hasura.Server.Init.Config.html#rsoDangerousBooleanCollapse"><span class="hs-identifier hs-var hs-var">rsoDangerousBooleanCollapse</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#dangerousBooleanCollapseEnv"><span class="hs-identifier hs-var">dangerousBooleanCollapseEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621689531806"><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621689531806"><span class="hs-identifier hs-var">enabledAPIs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">[API] -&gt; HashSet API
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([API] -&gt; HashSet API)
-&gt; (Maybe [API] -&gt; [API]) -&gt; Maybe [API] -&gt; HashSet API
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[API] -&gt; Maybe [API] -&gt; [API]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[API]
</span><a href="Hasura.Server.Init.html#defaultEnabledAPIs"><span class="hs-identifier hs-var">defaultEnabledAPIs</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="annottext">(Maybe [API] -&gt; HashSet API)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe [API])
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (HashSet API)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [API]
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe [API])
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe [API]
forall impl. RawServeOptions impl -&gt; Maybe [API]
</span><a href="Hasura.Server.Init.Config.html#rsoEnabledAPIs"><span class="hs-identifier hs-var hs-var">rsoEnabledAPIs</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enabledAPIsEnv"><span class="hs-identifier hs-var">enabledAPIsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621689531801"><span class="annot"><span class="annottext">SubscriptionsOptions
</span><a href="#local-6989586621689531801"><span class="hs-identifier hs-var">lqOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  [(String, String)] (ExceptT String Identity) SubscriptionsOptions
</span><a href="#local-6989586621689531800"><span class="hs-identifier hs-var">mkLQOpts</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span id="local-6989586621689531799"><span class="annot"><span class="annottext">SubscriptionsOptions
</span><a href="#local-6989586621689531799"><span class="hs-identifier hs-var">streamQOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  [(String, String)] (ExceptT String Identity) SubscriptionsOptions
</span><a href="#local-6989586621689531798"><span class="hs-identifier hs-var">mkStreamQueryOpts</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621689531797"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531797"><span class="hs-identifier hs-var">enableAL</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoEnableAllowlist"><span class="hs-identifier hs-var hs-var">rsoEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv Bool) -&gt; String -&gt; WithEnv Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableAllowlistEnv"><span class="hs-identifier hs-var">enableAllowlistEnv</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621689531794"><span class="annot"><span class="annottext">HashSet (EngineLogType impl)
</span><a href="#local-6989586621689531794"><span class="hs-identifier hs-var">enabledLogs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">HashSet (EngineLogType impl)
-&gt; ([EngineLogType impl] -&gt; HashSet (EngineLogType impl))
-&gt; Maybe [EngineLogType impl]
-&gt; HashSet (EngineLogType impl)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType impl)
forall impl. EnabledLogTypes impl =&gt; HashSet (EngineLogType impl)
</span><a href="Hasura.Logging.html#defaultEnabledLogTypes"><span class="hs-identifier hs-var">L.defaultEnabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[EngineLogType impl] -&gt; HashSet (EngineLogType impl)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="annottext">(Maybe [EngineLogType impl] -&gt; HashSet (EngineLogType impl))
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe [EngineLogType impl])
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HashSet (EngineLogType impl))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [EngineLogType impl]
-&gt; String
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe [EngineLogType impl])
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe [EngineLogType impl]
forall impl. RawServeOptions impl -&gt; Maybe [EngineLogType impl]
</span><a href="Hasura.Server.Init.Config.html#rsoEnabledLogTypes"><span class="hs-identifier hs-var hs-var">rsoEnabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enabledLogsEnv"><span class="hs-identifier hs-var">enabledLogsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621689531790"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621689531790"><span class="hs-identifier hs-var">serverLogLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Maybe LogLevel -&gt; LogLevel
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">L.LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe LogLevel -&gt; LogLevel)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe LogLevel)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) LogLevel
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe LogLevel
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe LogLevel)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe LogLevel
forall impl. RawServeOptions impl -&gt; Maybe LogLevel
</span><a href="Hasura.Server.Init.Config.html#rsoLogLevel"><span class="hs-identifier hs-var hs-var">rsoLogLevel</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#logLevelEnv"><span class="hs-identifier hs-var">logLevelEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621689531786"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531786"><span class="hs-identifier hs-var">devMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoDevMode"><span class="hs-identifier hs-var hs-var">rsoDevMode</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv Bool) -&gt; String -&gt; WithEnv Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlDevModeEnv"><span class="hs-identifier hs-var">graphqlDevModeEnv</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621689531783"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531783"><span class="hs-identifier hs-var">adminInternalErrors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
-&gt; WithEnv Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Bool
forall impl. RawServeOptions impl -&gt; Maybe Bool
</span><a href="Hasura.Server.Init.Config.html#rsoAdminInternalErrors"><span class="hs-identifier hs-var hs-var">rsoAdminInternalErrors</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlAdminInternalErrorsEnv"><span class="hs-identifier hs-var">graphqlAdminInternalErrorsEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Default to `true` to enable backwards compatibility</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689531780"><span class="annot"><span class="annottext">internalErrorsConfig :: ResponseInternalErrorsConfig
</span><a href="#local-6989586621689531780"><span class="hs-identifier hs-var hs-var">internalErrorsConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-keyword">if</span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531786"><span class="hs-identifier hs-var">devMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="Hasura.Server.Init.Config.html#InternalErrorsAllRequests"><span class="hs-identifier hs-var">InternalErrorsAllRequests</span></a></span><span>
</span><span id="line-200"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531783"><span class="hs-identifier hs-var">adminInternalErrors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="Hasura.Server.Init.Config.html#InternalErrorsAdminOnly"><span class="hs-identifier hs-var">InternalErrorsAdminOnly</span></a></span><span>
</span><span id="line-201"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="Hasura.Server.Init.Config.html#InternalErrorsDisabled"><span class="hs-identifier hs-var">InternalErrorsDisabled</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621689531776"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531776"><span class="hs-identifier hs-var">eventsHttpPoolSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Int
forall impl. RawServeOptions impl -&gt; Maybe Int
</span><a href="Hasura.Server.Init.Config.html#rsoEventsHttpPoolSize"><span class="hs-identifier hs-var hs-var">rsoEventsHttpPoolSize</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlEventsHttpPoolSizeEnv"><span class="hs-identifier hs-var">graphqlEventsHttpPoolSizeEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621689531773"><span class="annot"><span class="annottext">Maybe Milliseconds
</span><a href="#local-6989586621689531773"><span class="hs-identifier hs-var">eventsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Milliseconds -&gt; String -&gt; WithEnv (Maybe Milliseconds)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Milliseconds
forall impl. RawServeOptions impl -&gt; Maybe Milliseconds
</span><a href="Hasura.Server.Init.Config.html#rsoEventsFetchInterval"><span class="hs-identifier hs-var hs-var">rsoEventsFetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlEventsFetchIntervalEnv"><span class="hs-identifier hs-var">graphqlEventsFetchIntervalEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621689531770"><span class="annot"><span class="annottext">Maybe Milliseconds
</span><a href="#local-6989586621689531770"><span class="hs-identifier hs-var">maybeAsyncActionsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Milliseconds -&gt; String -&gt; WithEnv (Maybe Milliseconds)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Milliseconds
forall impl. RawServeOptions impl -&gt; Maybe Milliseconds
</span><a href="Hasura.Server.Init.Config.html#rsoAsyncActionsFetchInterval"><span class="hs-identifier hs-var hs-var">rsoAsyncActionsFetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#asyncActionsFetchIntervalEnv"><span class="hs-identifier hs-var">asyncActionsFetchIntervalEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621689531767"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689531767"><span class="hs-identifier hs-var">enableRemoteSchemaPerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
-&gt; RemoteSchemaPermissions -&gt; Bool -&gt; RemoteSchemaPermissions
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="Hasura.GraphQL.Schema.Options.html#DisableRemoteSchemaPermissions"><span class="hs-identifier hs-var">Options.DisableRemoteSchemaPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="Hasura.GraphQL.Schema.Options.html#EnableRemoteSchemaPermissions"><span class="hs-identifier hs-var">Options.EnableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; RemoteSchemaPermissions)
-&gt; WithEnv Bool
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     RemoteSchemaPermissions
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoEnableRemoteSchemaPermissions"><span class="hs-identifier hs-var hs-var">rsoEnableRemoteSchemaPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableRemoteSchemaPermsEnv"><span class="hs-identifier hs-var">enableRemoteSchemaPermsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621689531762"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531762"><span class="hs-identifier hs-var">webSocketCompressionFromEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoWebSocketCompression"><span class="hs-identifier hs-var hs-var">rsoWebSocketCompression</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv Bool) -&gt; String -&gt; WithEnv Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketCompressionEnv"><span class="hs-identifier hs-var">webSocketCompressionEnv</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>  </span><span id="local-6989586621689531759"><span class="annot"><span class="annottext">Maybe Milliseconds
</span><a href="#local-6989586621689531759"><span class="hs-identifier hs-var">maybeSchemaPollInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Milliseconds -&gt; String -&gt; WithEnv (Maybe Milliseconds)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Milliseconds
forall impl. RawServeOptions impl -&gt; Maybe Milliseconds
</span><a href="Hasura.Server.Init.Config.html#rsoSchemaPollInterval"><span class="hs-identifier hs-var hs-var">rsoSchemaPollInterval</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#schemaPollIntervalEnv"><span class="hs-identifier hs-var">schemaPollIntervalEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689531756"><span class="annot"><span class="annottext">connectionOptions :: ConnectionOptions
</span><a href="#local-6989586621689531756"><span class="hs-identifier hs-var hs-var">connectionOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="annottext">ConnectionOptions
</span><span class="hs-identifier hs-var">WS.defaultConnectionOptions</span></span><span>
</span><span id="line-218"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connectionCompressionOptions :: CompressionOptions
</span><span class="hs-identifier hs-var">WS.connectionCompressionOptions</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531762"><span class="hs-identifier hs-var">webSocketCompressionFromEnv</span></a></span><span>
</span><span id="line-220"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PermessageDeflate -&gt; CompressionOptions
</span><span class="hs-identifier hs-var">WS.PermessageDeflateCompression</span></span><span> </span><span class="annot"><span class="annottext">PermessageDeflate
</span><span class="hs-identifier hs-var">WS.defaultPermessageDeflate</span></span><span>
</span><span id="line-221"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CompressionOptions
</span><span class="hs-identifier hs-var">WS.NoCompression</span></span><span>
</span><span id="line-222"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621689531750"><span class="annot"><span class="annottext">asyncActionsFetchInterval :: OptionalInterval
</span><a href="#local-6989586621689531750"><span class="hs-identifier hs-var hs-var">asyncActionsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionalInterval
-&gt; (Milliseconds -&gt; OptionalInterval)
-&gt; Maybe Milliseconds
-&gt; OptionalInterval
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621689531749"><span class="hs-identifier hs-var">defaultAsyncActionsFetchInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Milliseconds -&gt; OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#msToOptionalInterval"><span class="hs-identifier hs-var">msToOptionalInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Milliseconds
</span><a href="#local-6989586621689531770"><span class="hs-identifier hs-var">maybeAsyncActionsFetchInterval</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span id="local-6989586621689531747"><span class="annot"><span class="annottext">schemaPollInterval :: OptionalInterval
</span><a href="#local-6989586621689531747"><span class="hs-identifier hs-var hs-var">schemaPollInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionalInterval
-&gt; (Milliseconds -&gt; OptionalInterval)
-&gt; Maybe Milliseconds
-&gt; OptionalInterval
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621689531746"><span class="hs-identifier hs-var">defaultSchemaPollInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Milliseconds -&gt; OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#msToOptionalInterval"><span class="hs-identifier hs-var">msToOptionalInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Milliseconds
</span><a href="#local-6989586621689531759"><span class="hs-identifier hs-var">maybeSchemaPollInterval</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621689531745"><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621689531745"><span class="hs-identifier hs-var">webSocketKeepAlive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="annottext">Seconds -&gt; KeepAliveDelay
</span><a href="Hasura.Server.Init.Config.html#KeepAliveDelay"><span class="hs-identifier hs-var">KeepAliveDelay</span></a></span><span> </span><span class="annot"><span class="annottext">(Seconds -&gt; KeepAliveDelay)
-&gt; (Maybe Int -&gt; Seconds) -&gt; Maybe Int -&gt; KeepAliveDelay
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Seconds
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Seconds) -&gt; (Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Seconds
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Int -&gt; KeepAliveDelay)
-&gt; WithEnv (Maybe Int)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) KeepAliveDelay
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Int
forall impl. RawServeOptions impl -&gt; Maybe Int
</span><a href="Hasura.Server.Init.Config.html#rsoWebSocketKeepAlive"><span class="hs-identifier hs-var hs-var">rsoWebSocketKeepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketKeepAliveEnv"><span class="hs-identifier hs-var">webSocketKeepAliveEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621689531741"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689531741"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
-&gt; ([ExperimentalFeature] -&gt; HashSet ExperimentalFeature)
-&gt; Maybe [ExperimentalFeature]
-&gt; HashSet ExperimentalFeature
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[ExperimentalFeature] -&gt; HashSet ExperimentalFeature
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [ExperimentalFeature] -&gt; HashSet ExperimentalFeature)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe [ExperimentalFeature])
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (HashSet ExperimentalFeature)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [ExperimentalFeature]
-&gt; String
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe [ExperimentalFeature])
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe [ExperimentalFeature]
forall impl. RawServeOptions impl -&gt; Maybe [ExperimentalFeature]
</span><a href="Hasura.Server.Init.Config.html#rsoExperimentalFeatures"><span class="hs-identifier hs-var hs-var">rsoExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#experimentalFeaturesEnv"><span class="hs-identifier hs-var">experimentalFeaturesEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621689531738"><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689531738"><span class="hs-identifier hs-var">inferFunctionPerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; (Bool -&gt; InferFunctionPermissions)
-&gt; Maybe Bool
-&gt; InferFunctionPermissions
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="Hasura.GraphQL.Schema.Options.html#InferFunctionPermissions"><span class="hs-identifier hs-var">Options.InferFunctionPermissions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InferFunctionPermissions
-&gt; InferFunctionPermissions -&gt; Bool -&gt; InferFunctionPermissions
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="Hasura.GraphQL.Schema.Options.html#Don%27tInferFunctionPermissions"><span class="hs-identifier hs-var">Options.Don'tInferFunctionPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="Hasura.GraphQL.Schema.Options.html#InferFunctionPermissions"><span class="hs-identifier hs-var">Options.InferFunctionPermissions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; InferFunctionPermissions)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     InferFunctionPermissions
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Bool
forall impl. RawServeOptions impl -&gt; Maybe Bool
</span><a href="Hasura.Server.Init.Config.html#rsoInferFunctionPermissions"><span class="hs-identifier hs-var hs-var">rsoInferFunctionPermissions</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#inferFunctionPermsEnv"><span class="hs-identifier hs-var">inferFunctionPermsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621689531733"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689531733"><span class="hs-identifier hs-var">maintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">MaintenanceMode ()
-&gt; MaintenanceMode () -&gt; Bool -&gt; MaintenanceMode ()
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
forall a. MaintenanceMode a
</span><a href="Hasura.Server.Types.html#MaintenanceModeDisabled"><span class="hs-identifier hs-var">Types.MaintenanceModeDisabled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; MaintenanceMode ()
forall a. a -&gt; MaintenanceMode a
</span><a href="Hasura.Server.Types.html#MaintenanceModeEnabled"><span class="hs-identifier hs-var">Types.MaintenanceModeEnabled</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; MaintenanceMode ())
-&gt; WithEnv Bool
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (MaintenanceMode ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoEnableMaintenanceMode"><span class="hs-identifier hs-var hs-var">rsoEnableMaintenanceMode</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableMaintenanceModeEnv"><span class="hs-identifier hs-var">enableMaintenanceModeEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621689531728"><span class="annot"><span class="annottext">NonNegativeInt
</span><a href="#local-6989586621689531728"><span class="hs-identifier hs-var">eventsFetchBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">NonNegativeInt -&gt; Maybe NonNegativeInt -&gt; NonNegativeInt
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">NonNegativeInt
</span><a href="Hasura.Eventing.EventTrigger.html#defaultFetchBatchSize"><span class="hs-identifier hs-var">EventTrigger.defaultFetchBatchSize</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><span class="annottext">(Maybe NonNegativeInt -&gt; NonNegativeInt)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe NonNegativeInt)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) NonNegativeInt
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe NonNegativeInt
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe NonNegativeInt)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe NonNegativeInt
forall impl. RawServeOptions impl -&gt; Maybe NonNegativeInt
</span><a href="Hasura.Server.Init.Config.html#rsoEventsFetchBatchSize"><span class="hs-identifier hs-var hs-var">rsoEventsFetchBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#eventsFetchBatchSizeEnv"><span class="hs-identifier hs-var">eventsFetchBatchSizeEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621689531724"><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621689531724"><span class="hs-identifier hs-var">gracefulShutdownTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="annottext">Seconds -&gt; Maybe Seconds -&gt; Seconds
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Seconds
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Seconds -&gt; Seconds)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Seconds)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) Seconds
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Seconds
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Seconds)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Seconds
forall impl. RawServeOptions impl -&gt; Maybe Seconds
</span><a href="Hasura.Server.Init.Config.html#rsoGracefulShutdownTimeout"><span class="hs-identifier hs-var hs-var">rsoGracefulShutdownTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#gracefulShutdownEnv"><span class="hs-identifier hs-var">gracefulShutdownEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621689531721"><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621689531721"><span class="hs-identifier hs-var">webSocketConnectionInitTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">Seconds -&gt; WSConnectionInitTimeout
</span><a href="Hasura.Server.Init.Config.html#WSConnectionInitTimeout"><span class="hs-identifier hs-var">WSConnectionInitTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">(Seconds -&gt; WSConnectionInitTimeout)
-&gt; (Maybe Int -&gt; Seconds) -&gt; Maybe Int -&gt; WSConnectionInitTimeout
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Seconds
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Seconds) -&gt; (Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Seconds
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Int -&gt; WSConnectionInitTimeout)
-&gt; WithEnv (Maybe Int)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     WSConnectionInitTimeout
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe Int
forall impl. RawServeOptions impl -&gt; Maybe Int
</span><a href="Hasura.Server.Init.Config.html#rsoWebSocketConnectionInitTimeout"><span class="hs-identifier hs-var hs-var">rsoWebSocketConnectionInitTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketConnectionInitTimeoutEnv"><span class="hs-identifier hs-var">webSocketConnectionInitTimeoutEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621689531717"><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689531717"><span class="hs-identifier hs-var">enableMetadataQueryLogging</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
-&gt; MetadataQueryLoggingMode -&gt; Bool -&gt; MetadataQueryLoggingMode
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="Hasura.Server.Logging.html#MetadataQueryLoggingDisabled"><span class="hs-identifier hs-var">Logging.MetadataQueryLoggingDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="Hasura.Server.Logging.html#MetadataQueryLoggingEnabled"><span class="hs-identifier hs-var">Logging.MetadataQueryLoggingEnabled</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">(Bool -&gt; MetadataQueryLoggingMode)
-&gt; WithEnv Bool
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     MetadataQueryLoggingMode
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoEnableMetadataQueryLoggingEnv"><span class="hs-identifier hs-var hs-var">rsoEnableMetadataQueryLoggingEnv</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableMetadataQueryLoggingEnv"><span class="hs-identifier hs-var">enableMetadataQueryLoggingEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>  </span><span id="local-6989586621689531712"><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689531712"><span class="hs-identifier hs-var">globalDefaultNamingCase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe NamingCase -&gt; String -&gt; WithEnv (Maybe NamingCase)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe NamingCase
forall impl. RawServeOptions impl -&gt; Maybe NamingCase
</span><a href="Hasura.Server.Init.Config.html#rsoDefaultNamingConvention"><span class="hs-identifier hs-var hs-var">rsoDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe NamingCase))
-&gt; String -&gt; WithEnv (Maybe NamingCase)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#defaultNamingConventionEnv"><span class="hs-identifier hs-var">defaultNamingConventionEnv</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621689531709"><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621689531709"><span class="hs-identifier hs-var">extensionsSchema</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">ExtensionsSchema -&gt; Maybe ExtensionsSchema -&gt; ExtensionsSchema
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ExtensionsSchema
</span><a href="Hasura.SQL.Types.html#ExtensionsSchema"><span class="hs-identifier hs-var">PG.ExtensionsSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;public&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ExtensionsSchema -&gt; ExtensionsSchema)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe ExtensionsSchema)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) ExtensionsSchema
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ExtensionsSchema
-&gt; String
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe ExtensionsSchema)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe ExtensionsSchema
forall impl. RawServeOptions impl -&gt; Maybe ExtensionsSchema
</span><a href="Hasura.Server.Init.Config.html#rsoExtensionsSchema"><span class="hs-identifier hs-var hs-var">rsoExtensionsSchema</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; ReaderT
      [(String, String)]
      (ExceptT String Identity)
      (Maybe ExtensionsSchema))
-&gt; String
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe ExtensionsSchema)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#metadataDBExtensionsSchemaEnv"><span class="hs-identifier hs-var">metadataDBExtensionsSchemaEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">ServeOptions impl -&gt; WithEnv (ServeOptions impl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ServeOptions impl -&gt; WithEnv (ServeOptions impl))
-&gt; ServeOptions impl -&gt; WithEnv (ServeOptions impl)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; HostPreference
-&gt; ConnParams
-&gt; TxIsolation
-&gt; HashSet AdminSecretHash
-&gt; Maybe (AuthHookG Text AuthHookType)
-&gt; [JWTConfig]
-&gt; Maybe RoleName
-&gt; CorsConfig
-&gt; Bool
-&gt; Maybe Text
-&gt; Bool
-&gt; StringifyNumbers
-&gt; Bool
-&gt; HashSet API
-&gt; SubscriptionsOptions
-&gt; SubscriptionsOptions
-&gt; Bool
-&gt; HashSet (EngineLogType impl)
-&gt; LogLevel
-&gt; ResponseInternalErrorsConfig
-&gt; Maybe Int
-&gt; Maybe Milliseconds
-&gt; OptionalInterval
-&gt; RemoteSchemaPermissions
-&gt; ConnectionOptions
-&gt; KeepAliveDelay
-&gt; InferFunctionPermissions
-&gt; MaintenanceMode ()
-&gt; OptionalInterval
-&gt; HashSet ExperimentalFeature
-&gt; NonNegativeInt
-&gt; Bool
-&gt; Seconds
-&gt; WSConnectionInitTimeout
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; MetadataQueryLoggingMode
-&gt; Maybe NamingCase
-&gt; ExtensionsSchema
-&gt; ServeOptions impl
forall impl.
Int
-&gt; HostPreference
-&gt; ConnParams
-&gt; TxIsolation
-&gt; HashSet AdminSecretHash
-&gt; Maybe (AuthHookG Text AuthHookType)
-&gt; [JWTConfig]
-&gt; Maybe RoleName
-&gt; CorsConfig
-&gt; Bool
-&gt; Maybe Text
-&gt; Bool
-&gt; StringifyNumbers
-&gt; Bool
-&gt; HashSet API
-&gt; SubscriptionsOptions
-&gt; SubscriptionsOptions
-&gt; Bool
-&gt; HashSet (EngineLogType impl)
-&gt; LogLevel
-&gt; ResponseInternalErrorsConfig
-&gt; Maybe Int
-&gt; Maybe Milliseconds
-&gt; OptionalInterval
-&gt; RemoteSchemaPermissions
-&gt; ConnectionOptions
-&gt; KeepAliveDelay
-&gt; InferFunctionPermissions
-&gt; MaintenanceMode ()
-&gt; OptionalInterval
-&gt; HashSet ExperimentalFeature
-&gt; NonNegativeInt
-&gt; Bool
-&gt; Seconds
-&gt; WSConnectionInitTimeout
-&gt; EventingMode
-&gt; ReadOnlyMode
-&gt; MetadataQueryLoggingMode
-&gt; Maybe NamingCase
-&gt; ExtensionsSchema
-&gt; ServeOptions impl
</span><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-var">ServeOptions</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531859"><span class="hs-identifier hs-var">port</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">HostPreference
</span><a href="#local-6989586621689531855"><span class="hs-identifier hs-var">host</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">ConnParams
</span><a href="#local-6989586621689531852"><span class="hs-identifier hs-var">connParams</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">TxIsolation
</span><a href="#local-6989586621689531849"><span class="hs-identifier hs-var">txIso</span></a></span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">HashSet AdminSecretHash
</span><a href="#local-6989586621689531845"><span class="hs-identifier hs-var">adminScrt</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">Maybe (AuthHookG Text AuthHookType)
</span><a href="#local-6989586621689531838"><span class="hs-identifier hs-var">authHook</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="annottext">[JWTConfig]
</span><a href="#local-6989586621689531835"><span class="hs-identifier hs-var">jwtSecret</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">Maybe RoleName
</span><a href="#local-6989586621689531831"><span class="hs-identifier hs-var">unAuthRole</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689531828"><span class="hs-identifier hs-var">corsCfg</span></a></span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531825"><span class="hs-identifier hs-var">enableConsole</span></a></span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621689531821"><span class="hs-identifier hs-var">consoleAssetsDir</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531818"><span class="hs-identifier hs-var">enableTelemetry</span></a></span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621689531815"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531809"><span class="hs-identifier hs-var">dangerousBooleanCollapse</span></a></span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><span class="annottext">HashSet API
</span><a href="#local-6989586621689531806"><span class="hs-identifier hs-var">enabledAPIs</span></a></span><span>
</span><span id="line-275"></span><span>      </span><span class="annot"><span class="annottext">SubscriptionsOptions
</span><a href="#local-6989586621689531801"><span class="hs-identifier hs-var">lqOpts</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="annot"><span class="annottext">SubscriptionsOptions
</span><a href="#local-6989586621689531799"><span class="hs-identifier hs-var">streamQOpts</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531797"><span class="hs-identifier hs-var">enableAL</span></a></span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><span class="annottext">HashSet (EngineLogType impl)
</span><a href="#local-6989586621689531794"><span class="hs-identifier hs-var">enabledLogs</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621689531790"><span class="hs-identifier hs-var">serverLogLevel</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">ResponseInternalErrorsConfig
</span><a href="#local-6989586621689531780"><span class="hs-identifier hs-var">internalErrorsConfig</span></a></span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531776"><span class="hs-identifier hs-var">eventsHttpPoolSize</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="annottext">Maybe Milliseconds
</span><a href="#local-6989586621689531773"><span class="hs-identifier hs-var">eventsFetchInterval</span></a></span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621689531750"><span class="hs-identifier hs-var">asyncActionsFetchInterval</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621689531767"><span class="hs-identifier hs-var">enableRemoteSchemaPerms</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="#local-6989586621689531756"><span class="hs-identifier hs-var">connectionOptions</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621689531745"><span class="hs-identifier hs-var">webSocketKeepAlive</span></a></span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">InferFunctionPermissions
</span><a href="#local-6989586621689531738"><span class="hs-identifier hs-var">inferFunctionPerms</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621689531733"><span class="hs-identifier hs-var">maintenanceMode</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">OptionalInterval
</span><a href="#local-6989586621689531747"><span class="hs-identifier hs-var">schemaPollInterval</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621689531741"><span class="hs-identifier hs-var">experimentalFeatures</span></a></span><span>
</span><span id="line-291"></span><span>      </span><span class="annot"><span class="annottext">NonNegativeInt
</span><a href="#local-6989586621689531728"><span class="hs-identifier hs-var">eventsFetchBatchSize</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531786"><span class="hs-identifier hs-var">devMode</span></a></span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">Seconds
</span><a href="#local-6989586621689531724"><span class="hs-identifier hs-var">gracefulShutdownTime</span></a></span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621689531721"><span class="hs-identifier hs-var">webSocketConnectionInitTimeout</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingEnabled"><span class="hs-identifier hs-var">Types.EventingEnabled</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeDisabled"><span class="hs-identifier hs-var">Types.ReadOnlyModeDisabled</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621689531717"><span class="hs-identifier hs-var">enableMetadataQueryLogging</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span class="annot"><span class="annottext">Maybe NamingCase
</span><a href="#local-6989586621689531712"><span class="hs-identifier hs-var">globalDefaultNamingCase</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><span class="annottext">ExtensionsSchema
</span><a href="#local-6989586621689531709"><span class="hs-identifier hs-var">extensionsSchema</span></a></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621689531749"><span class="annot"><span class="annottext">defaultAsyncActionsFetchInterval :: OptionalInterval
</span><a href="#local-6989586621689531749"><span class="hs-identifier hs-var hs-var">defaultAsyncActionsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Milliseconds -&gt; OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="annot"><span class="annottext">Milliseconds
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-comment">-- 1000 Milliseconds or 1 Second</span><span>
</span><span id="line-302"></span><span>    </span><span id="local-6989586621689531746"><span class="annot"><span class="annottext">defaultSchemaPollInterval :: OptionalInterval
</span><a href="#local-6989586621689531746"><span class="hs-identifier hs-var hs-var">defaultSchemaPollInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Milliseconds -&gt; OptionalInterval
</span><a href="Hasura.Server.Init.Config.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="annot"><span class="annottext">Milliseconds
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-comment">-- 1000 Milliseconds or 1 Second</span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621689531851"><span class="annot"><span class="annottext">mkConnParams :: RawConnParams
-&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams
</span><a href="#local-6989586621689531851"><span class="hs-identifier hs-var hs-var">mkConnParams</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#RawConnParams"><span class="hs-identifier hs-type">RawConnParams</span></a></span><span> </span><span id="local-6989586621689531700"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531700"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621689531699"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531699"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621689531698"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531698"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621689531697"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531697"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621689531696"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621689531696"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621689531695"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531695"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>      </span><span id="local-6989586621689531694"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531694"><span class="hs-identifier hs-var">stripes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int)
-&gt; WithEnv (Maybe Int)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531700"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgStripesEnv"><span class="hs-identifier hs-var">pgStripesEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-comment">-- Note: by Little's Law we can expect e.g. (with 50 max connections) a</span><span>
</span><span id="line-306"></span><span>      </span><span class="hs-comment">-- hard throughput cap at 1000RPS when db queries take 50ms on average:</span><span>
</span><span id="line-307"></span><span>      </span><span id="local-6989586621689531692"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531692"><span class="hs-identifier hs-var">conns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int)
-&gt; WithEnv (Maybe Int)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531699"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgConnsEnv"><span class="hs-identifier hs-var">pgConnsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>      </span><span id="local-6989586621689531690"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531690"><span class="hs-identifier hs-var">iTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">180</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int)
-&gt; WithEnv (Maybe Int)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; String -&gt; WithEnv (Maybe Int)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621689531698"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgTimeoutEnv"><span class="hs-identifier hs-var">pgTimeoutEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621689531688"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531688"><span class="hs-identifier hs-var">connLifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime -&gt; String -&gt; WithEnv (Maybe NominalDiffTime)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531697"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgConnLifetimeEnv"><span class="hs-identifier hs-var">pgConnLifetimeEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WithEnv (Maybe NominalDiffTime)
-&gt; (Maybe NominalDiffTime -&gt; Maybe NominalDiffTime)
-&gt; WithEnv (Maybe NominalDiffTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime -&gt; Maybe NominalDiffTime
</span><a href="Hasura.Server.Utils.html#parseConnLifeTime"><span class="hs-identifier hs-var">Utils.parseConnLifeTime</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span id="local-6989586621689531684"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531684"><span class="hs-identifier hs-var">allowPrepare</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
-&gt; WithEnv Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe Bool)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621689531696"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgUsePrepareEnv"><span class="hs-identifier hs-var">pgUsePrepareEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>      </span><span id="local-6989586621689531682"><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531682"><span class="hs-identifier hs-var">poolTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime -&gt; String -&gt; WithEnv (Maybe NominalDiffTime)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531695"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgPoolTimeoutEnv"><span class="hs-identifier hs-var">pgPoolTimeoutEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621689531680"><span class="annot"><span class="annottext">allowCancel :: Bool
</span><a href="#local-6989586621689531680"><span class="hs-identifier hs-var hs-var">allowCancel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><span class="annottext">ConnParams
-&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConnParams
 -&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams)
-&gt; ConnParams
-&gt; ReaderT [(String, String)] (ExceptT String Identity) ConnParams
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Int
-&gt; Bool
-&gt; Maybe NominalDiffTime
-&gt; Maybe NominalDiffTime
-&gt; Bool
-&gt; ConnParams
</span><span class="hs-identifier hs-var">Q.ConnParams</span></span><span>
</span><span id="line-315"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531694"><span class="hs-identifier hs-var">stripes</span></a></span><span>
</span><span id="line-316"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531692"><span class="hs-identifier hs-var">conns</span></a></span><span>
</span><span id="line-317"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621689531690"><span class="hs-identifier hs-var">iTime</span></a></span><span>
</span><span id="line-318"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531684"><span class="hs-identifier hs-var">allowPrepare</span></a></span><span>
</span><span id="line-319"></span><span>          </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531688"><span class="hs-identifier hs-var">connLifetime</span></a></span><span>
</span><span id="line-320"></span><span>          </span><span class="annot"><span class="annottext">Maybe NominalDiffTime
</span><a href="#local-6989586621689531682"><span class="hs-identifier hs-var">poolTimeout</span></a></span><span>
</span><span id="line-321"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531680"><span class="hs-identifier hs-var">allowCancel</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621689531837"><span class="annot"><span class="annottext">mkAuthHook :: AuthHookG (Maybe a) (Maybe AuthHookType)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe (AuthHookG a AuthHookType))
</span><a href="#local-6989586621689531837"><span class="hs-identifier hs-var hs-var">mkAuthHook</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Auth.WebHook.html#AuthHookG"><span class="hs-identifier hs-type">Auth.AuthHookG</span></a></span><span> </span><span id="local-6989586621689531677"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689531677"><span class="hs-identifier hs-var">mUrl</span></a></span></span><span> </span><span id="local-6989586621689531676"><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531676"><span class="hs-identifier hs-var">mType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>      </span><span id="local-6989586621689531675"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689531675"><span class="hs-identifier hs-var">mUrlEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; String -&gt; WithEnv (Maybe a)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689531677"><span class="hs-identifier hs-var">mUrl</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe a)) -&gt; String -&gt; WithEnv (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookEnv"><span class="hs-identifier hs-var">authHookEnv</span></a></span><span>
</span><span id="line-325"></span><span>      </span><span id="local-6989586621689531673"><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531673"><span class="hs-identifier hs-var">authModeM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType -&gt; String -&gt; WithEnv (Maybe AuthHookType)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531676"><span class="hs-identifier hs-var">mType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookModeEnv"><span class="hs-identifier hs-var">authHookModeEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>      </span><span id="local-6989586621689531671"><span class="annot"><span class="annottext">AuthHookType
</span><a href="#local-6989586621689531671"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) AuthHookType
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) AuthHookType
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531673"><span class="hs-identifier hs-var">authModeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe AuthHookType
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) AuthHookType
</span><a href="#local-6989586621689531670"><span class="hs-identifier hs-var">authHookTyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531676"><span class="hs-identifier hs-var">mType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">Maybe (AuthHookG a AuthHookType)
-&gt; ReaderT
     [(String, String)]
     (ExceptT String Identity)
     (Maybe (AuthHookG a AuthHookType))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; AuthHookType -&gt; AuthHookG a AuthHookType)
-&gt; AuthHookType -&gt; a -&gt; AuthHookG a AuthHookType
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; AuthHookType -&gt; AuthHookG a AuthHookType
forall a b. a -&gt; b -&gt; AuthHookG a b
</span><a href="Hasura.Server.Auth.WebHook.html#AuthHookG"><span class="hs-identifier hs-var">Auth.AuthHookG</span></a></span><span> </span><span class="annot"><span class="annottext">AuthHookType
</span><a href="#local-6989586621689531671"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; AuthHookG a AuthHookType)
-&gt; Maybe a -&gt; Maybe (AuthHookG a AuthHookType)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621689531675"><span class="hs-identifier hs-var">mUrlEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-comment">-- Also support HASURA_GRAPHQL_AUTH_HOOK_TYPE</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-comment">-- TODO (from master):- drop this in next major update</span><span>
</span><span id="line-331"></span><span>    </span><span id="local-6989586621689531670"><span class="annot"><span class="annottext">authHookTyEnv :: Maybe AuthHookType
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) AuthHookType
</span><a href="#local-6989586621689531670"><span class="hs-identifier hs-var hs-var">authHookTyEnv</span></a></span></span><span> </span><span id="local-6989586621689531668"><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531668"><span class="hs-identifier hs-var">mType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>      </span><span class="annot"><span class="annottext">AuthHookType -&gt; Maybe AuthHookType -&gt; AuthHookType
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">AuthHookType
</span><a href="Hasura.Server.Auth.WebHook.html#AHTGet"><span class="hs-identifier hs-var">Auth.AHTGet</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">(Maybe AuthHookType -&gt; AuthHookType)
-&gt; WithEnv (Maybe AuthHookType)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) AuthHookType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType -&gt; String -&gt; WithEnv (Maybe AuthHookType)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621689531668"><span class="hs-identifier hs-var">mType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HASURA_GRAPHQL_AUTH_HOOK_TYPE&quot;</span></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621689531827"><span class="annot"><span class="annottext">mkCorsConfig :: Maybe CorsConfig
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
</span><a href="#local-6989586621689531827"><span class="hs-identifier hs-var hs-var">mkCorsConfig</span></a></span></span><span> </span><span id="local-6989586621689531666"><span class="annot"><span class="annottext">Maybe CorsConfig
</span><a href="#local-6989586621689531666"><span class="hs-identifier hs-var">mCfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>      </span><span id="local-6989586621689531665"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531665"><span class="hs-identifier hs-var">corsDisabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#disableCorsEnv"><span class="hs-identifier hs-var">disableCorsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>      </span><span id="local-6989586621689531663"><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689531663"><span class="hs-identifier hs-var">corsCfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531665"><span class="hs-identifier hs-var">corsDisabled</span></a></span><span>
</span><span id="line-339"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CorsConfig
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; CorsConfig
</span><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-var">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CorsConfig -&gt; Maybe CorsConfig -&gt; CorsConfig
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="Hasura.Server.Cors.html#CCAllowAll"><span class="hs-identifier hs-var">Cors.CCAllowAll</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe CorsConfig -&gt; CorsConfig)
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe CorsConfig)
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig
-&gt; String
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) (Maybe CorsConfig)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CorsConfig
</span><a href="#local-6989586621689531666"><span class="hs-identifier hs-var">mCfg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#corsDomainEnv"><span class="hs-identifier hs-var">corsDomainEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>      </span><span id="local-6989586621689531659"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531659"><span class="hs-identifier hs-var">readCookVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; WithEnv Bool
</span><a href="Hasura.Server.Init.Env.html#withEnvBool"><span class="hs-identifier hs-var">withEnvBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Bool
forall impl. RawServeOptions impl -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#rsoWsReadCookie"><span class="hs-identifier hs-var hs-var">rsoWsReadCookie</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#wsReadCookieEnv"><span class="hs-identifier hs-var">wsReadCookieEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621689531656"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531656"><span class="hs-identifier hs-var">wsReadCookie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CorsConfig -&gt; Bool
</span><a href="Hasura.Server.Cors.html#isCorsDisabled"><span class="hs-identifier hs-var">Cors.isCorsDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689531663"><span class="hs-identifier hs-var">corsCfg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531659"><span class="hs-identifier hs-var">readCookVal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531659"><span class="hs-identifier hs-var">readCookVal</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-346"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; WithEnv Bool
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv Bool) -&gt; String -&gt; WithEnv Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#wsReadCookieEnv"><span class="hs-identifier hs-var">wsReadCookieEnv</span></a></span><span>
</span><span id="line-348"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; can only be used when CORS is disabled&quot;</span></span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">CorsConfig
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CorsConfig
 -&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig)
-&gt; CorsConfig
-&gt; ReaderT [(String, String)] (ExceptT String Identity) CorsConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689531663"><span class="hs-identifier hs-var">corsCfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-type">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; CorsConfig
</span><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-var">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621689531656"><span class="hs-identifier hs-var">wsReadCookie</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="annottext">CorsConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621689531663"><span class="hs-identifier hs-var">corsCfg</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621689531800"><span class="annot"><span class="annottext">mkLQOpts :: ReaderT
  [(String, String)] (ExceptT String Identity) SubscriptionsOptions
</span><a href="#local-6989586621689531800"><span class="hs-identifier hs-var hs-var">mkLQOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>      </span><span id="local-6989586621689531653"><span class="annot"><span class="annottext">Maybe RefetchInterval
</span><a href="#local-6989586621689531653"><span class="hs-identifier hs-var">refetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval -&gt; String -&gt; WithEnv (Maybe RefetchInterval)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe RefetchInterval
forall impl. RawServeOptions impl -&gt; Maybe RefetchInterval
</span><a href="Hasura.Server.Init.Config.html#rsoMxRefetchInt"><span class="hs-identifier hs-var hs-var">rsoMxRefetchInt</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe RefetchInterval))
-&gt; String -&gt; WithEnv (Maybe RefetchInterval)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#mxRefetchDelayEnv"><span class="hs-identifier hs-var">mxRefetchDelayEnv</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span id="local-6989586621689531650"><span class="annot"><span class="annottext">Maybe BatchSize
</span><a href="#local-6989586621689531650"><span class="hs-identifier hs-var">batchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize -&gt; String -&gt; WithEnv (Maybe BatchSize)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe BatchSize
forall impl. RawServeOptions impl -&gt; Maybe BatchSize
</span><a href="Hasura.Server.Init.Config.html#rsoMxBatchSize"><span class="hs-identifier hs-var hs-var">rsoMxBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe BatchSize))
-&gt; String -&gt; WithEnv (Maybe BatchSize)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#mxBatchSizeEnv"><span class="hs-identifier hs-var">mxBatchSizeEnv</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">SubscriptionsOptions
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) SubscriptionsOptions
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsOptions
 -&gt; ReaderT
      [(String, String)] (ExceptT String Identity) SubscriptionsOptions)
-&gt; SubscriptionsOptions
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) SubscriptionsOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize -&gt; Maybe RefetchInterval -&gt; SubscriptionsOptions
</span><a href="Hasura.GraphQL.Execute.Subscription.Options.html#mkSubscriptionsOptions"><span class="hs-identifier hs-var">ES.mkSubscriptionsOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize
</span><a href="#local-6989586621689531650"><span class="hs-identifier hs-var">batchSize</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval
</span><a href="#local-6989586621689531653"><span class="hs-identifier hs-var">refetchInterval</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621689531798"><span class="annot"><span class="annottext">mkStreamQueryOpts :: ReaderT
  [(String, String)] (ExceptT String Identity) SubscriptionsOptions
</span><a href="#local-6989586621689531798"><span class="hs-identifier hs-var hs-var">mkStreamQueryOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>      </span><span id="local-6989586621689531646"><span class="annot"><span class="annottext">Maybe RefetchInterval
</span><a href="#local-6989586621689531646"><span class="hs-identifier hs-var">refetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval -&gt; String -&gt; WithEnv (Maybe RefetchInterval)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe RefetchInterval
forall impl. RawServeOptions impl -&gt; Maybe RefetchInterval
</span><a href="Hasura.Server.Init.Config.html#rsoStreamingMxRefetchInt"><span class="hs-identifier hs-var hs-var">rsoStreamingMxRefetchInt</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe RefetchInterval))
-&gt; String -&gt; WithEnv (Maybe RefetchInterval)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#streamingMxRefetchDelayEnv"><span class="hs-identifier hs-var">streamingMxRefetchDelayEnv</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span id="local-6989586621689531643"><span class="annot"><span class="annottext">Maybe BatchSize
</span><a href="#local-6989586621689531643"><span class="hs-identifier hs-var">batchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize -&gt; String -&gt; WithEnv (Maybe BatchSize)
forall a. FromEnv a =&gt; Maybe a -&gt; String -&gt; WithEnv (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawServeOptions impl -&gt; Maybe BatchSize
forall impl. RawServeOptions impl -&gt; Maybe BatchSize
</span><a href="Hasura.Server.Init.Config.html#rsoStreamingMxBatchSize"><span class="hs-identifier hs-var hs-var">rsoStreamingMxBatchSize</span></a></span><span> </span><span class="annot"><span class="annottext">RawServeOptions impl
</span><a href="#local-6989586621689531860"><span class="hs-identifier hs-var">rso</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; WithEnv (Maybe BatchSize))
-&gt; String -&gt; WithEnv (Maybe BatchSize)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(String, String)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#streamingMxBatchSizeEnv"><span class="hs-identifier hs-var">streamingMxBatchSizeEnv</span></a></span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">SubscriptionsOptions
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) SubscriptionsOptions
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SubscriptionsOptions
 -&gt; ReaderT
      [(String, String)] (ExceptT String Identity) SubscriptionsOptions)
-&gt; SubscriptionsOptions
-&gt; ReaderT
     [(String, String)] (ExceptT String Identity) SubscriptionsOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize -&gt; Maybe RefetchInterval -&gt; SubscriptionsOptions
</span><a href="Hasura.GraphQL.Execute.Subscription.Options.html#mkSubscriptionsOptions"><span class="hs-identifier hs-var">ES.mkSubscriptionsOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BatchSize
</span><a href="#local-6989586621689531643"><span class="hs-identifier hs-var">batchSize</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RefetchInterval
</span><a href="#local-6989586621689531646"><span class="hs-identifier hs-var">refetchInterval</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="Hasura.Server.Init.html#defaultEnabledAPIs"><span class="hs-identifier hs-type">defaultEnabledAPIs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Server.Init.Config.html#API"><span class="hs-identifier hs-type">API</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-365"></span><span id="defaultEnabledAPIs"><span class="annot"><span class="annottext">defaultEnabledAPIs :: [API]
</span><a href="Hasura.Server.Init.html#defaultEnabledAPIs"><span class="hs-identifier hs-var hs-var">defaultEnabledAPIs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#METADATA"><span class="hs-identifier hs-var">METADATA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#GRAPHQL"><span class="hs-identifier hs-var">GRAPHQL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#PGDUMP"><span class="hs-identifier hs-var">PGDUMP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">API
</span><a href="Hasura.Server.Init.Config.html#CONFIG"><span class="hs-identifier hs-var">CONFIG</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-366"></span></pre></body></html>